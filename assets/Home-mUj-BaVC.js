import{r as i,C as Ee,V as ee,B as z,j as t,A as de,a as _e,b as te,s as J,u as Ae,c as Te,d as Ie,n as he}from"./index-voVAQxyZ.js";import{u as ce,a as K,C as Se}from"./react-three-fiber.esm-BrSCth1a.js";const d={DEGREES_TO_RADIANS:Math.PI/180,RADIANS_TO_DEGREES:180/Math.PI,FULL_CIRCLE:360,HALF_CIRCLE:180,MILLISECONDS_PER_DAY:864e5,JULIAN_DATE_OFFSET:24405875e-1,J2000_JULIAN_DATE:2451545,JULIAN_CENTURIES_PER_CENTURY:36525,GMST_CONSTANT:280.46061837,GMST_RATE:360.98564736629,GMST_T_SQUARED_COEFF:387933e-9,GMST_T_CUBED_DIVISOR:3871e4,HOUR_ANGLE_MIN:-180,HOUR_ANGLE_MAX:180,MIN_MAGNITUDE:0,MAX_MAGNITUDE:20,MAGNITUDE_CLAMP_MIN:.1,MAGNITUDE_CLAMP_MAX:3,MAGNITUDE_SIZE_COEFFICIENT:2.5,MAGNITUDE_EXPONENT_DIVISOR:10,COORDINATE_DECIMAL_PLACES:2,DEFAULT_SPHERE_RADIUS:1,DEFAULT_STAR_RADIUS:100,HORIZON_ALTITUDE_THRESHOLD:-5,COSINE_MAX:1,COSINE_MIN:-1},me={O:5995775,B:8101887,A:13293567,F:16316415,G:16774378,K:16765601,M:16737860,L:13386786,T:10044586,Y:6697847},ne=16777215;function X(e){return e*d.DEGREES_TO_RADIANS}function ae(e){return e*d.RADIANS_TO_DEGREES}function Re(e){return e.getTime()/d.MILLISECONDS_PER_DAY+d.JULIAN_DATE_OFFSET}function Le(e){const o=Re(e),s=(o-d.J2000_JULIAN_DATE)/d.JULIAN_CENTURIES_PER_CENTURY;let n=d.GMST_CONSTANT+d.GMST_RATE*(o-d.J2000_JULIAN_DATE)+d.GMST_T_SQUARED_COEFF*s*s-s*s*s/d.GMST_T_CUBED_DIVISOR;return n=(n%d.FULL_CIRCLE+d.FULL_CIRCLE)%d.FULL_CIRCLE,n}function fe(e,o){return((Le(e)+o)%d.FULL_CIRCLE+d.FULL_CIRCLE)%d.FULL_CIRCLE}function pe(e,o,s=new Date){const{ra:n,dec:a}=e,{latitude:l,longitude:E}=o;let r=fe(s,E)-n;r<d.HOUR_ANGLE_MIN&&(r+=d.FULL_CIRCLE),r>d.HOUR_ANGLE_MAX&&(r-=d.FULL_CIRCLE);const h=X(r),_=X(a),A=X(l),m=Math.sin(_)*Math.sin(A)+Math.cos(_)*Math.cos(A)*Math.cos(h),O=ae(Math.asin(m)),I=(Math.sin(_)-Math.sin(X(O))*Math.sin(A))/(Math.cos(X(O))*Math.cos(A));let R;return Math.abs(I)>d.COSINE_MAX?R=I>0?0:d.HALF_CIRCLE:R=ae(Math.acos(Math.max(d.COSINE_MIN,Math.min(d.COSINE_MAX,I)))),Math.sin(h)>0&&(R=d.FULL_CIRCLE-R),{altitude:O,azimuth:R}}function Ne(e,o=d.DEFAULT_SPHERE_RADIUS){const s=X(e.altitude),n=X(e.azimuth),a=Math.sin(s)*o,l=Math.cos(s)*o,E=-Math.sin(n)*l,u=-Math.cos(n)*l;return{x:E,y:a,z:u}}function Ce(e,o,s,n=new Date,a=d.DEFAULT_STAR_RADIUS){const l=pe({ra:e,dec:o},s,n);return{...Ne(l,a),visible:l.altitude>d.HORIZON_ALTITUDE_THRESHOLD}}function Me(e){if(!e)return ne;const o=e.charAt(0).toUpperCase();return me[o]??ne}function Oe(e){if(e===null||isNaN(e))return .5;const o=Math.max(d.MIN_MAGNITUDE,Math.min(d.MAX_MAGNITUDE,e)),s=d.MAGNITUDE_SIZE_COEFFICIENT*Math.pow(10,-o/d.MAGNITUDE_EXPONENT_DIVISOR);return Math.max(d.MAGNITUDE_CLAMP_MIN,Math.min(d.MAGNITUDE_CLAMP_MAX,s))}function De(e){const o=Math.abs(e),s=e>=0?"N":"S";return`${o.toFixed(d.COORDINATE_DECIMAL_PLACES)}°${s}`}function ge(e){const o=Math.abs(e),s=e>=0?"E":"W";return`${o.toFixed(d.COORDINATE_DECIMAL_PLACES)}°${s}`}function xe(e){return`${e.toFixed(d.COORDINATE_DECIMAL_PLACES)}°`}function ve(e){return`${e.toFixed(d.COORDINATE_DECIMAL_PLACES)}°`}const oe={"New York":{latitude:40.7128,longitude:-74.006},London:{latitude:51.5074,longitude:-.1278},Tokyo:{latitude:35.6762,longitude:139.6503},Sydney:{latitude:-33.8688,longitude:151.2093},"São Paulo":{latitude:-23.5505,longitude:-46.6333},"Cape Town":{latitude:-33.9249,longitude:18.4241},"Rio de Janeiro":{latitude:-22.9068,longitude:-43.1729},Greenwich:{latitude:51.4772,longitude:0}},H={EARTH_SPIN_DURATION:5e3,CAMERA_SWOOP_DURATION:2500,STARS_FADE_DURATION:2e3,WELCOME_CARD_DELAY:300,WELCOME_CARD_DISMISS_DURATION:300,LETTER_ANIMATION_DELAY:.25,PLANETS_LINE_START_OFFSET:3},g={BASE_RADIUS:580,SCALE_MULTIPLIER:.35,INITIAL_Z:-600,Z_MOVEMENT_DISTANCE:500,ROTATION_SPEED:.15,ATMOSPHERE_SCALE:1.05,ATMOSPHERE_OPACITY:.15,OUTER_GLOW_SCALE:1.12,OUTER_GLOW_OPACITY:.08,ATMOSPHERE_COLOR:4491519,OUTER_GLOW_COLOR:6728447},x={INITIAL_AZIMUTH:180,INITIAL_ALTITUDE:10,LOOKAT_DISTANCE:100,DRAG_SENSITIVITY:.3,MIN_ALTITUDE:-10,MAX_ALTITUDE:90,DEFAULT_CURSOR:"grab",DRAGGING_CURSOR:"grabbing"},$={COUNT:3e3,SPHERE_RADIUS:800,POINT_SIZE:.8,COLOR:8947848,OPACITY_MULTIPLIER:.5},re={STAR_DISTANCE:500,BASE_SCALE:20},V={MIN_SPEED:.5,SPEED_MODULO:100,SPEED_DIVISOR:50,MIN_INTENSITY:.15,INTENSITY_MODULO:50,INTENSITY_DIVISOR:200},B={BASE_HIT_THRESHOLD:15,SIZE_SCALE_MULTIPLIER:.3,HOVER_LERP:.15,CLICK_DISTANCE_THRESHOLD:5,POINTER_CURSOR:"pointer",DEFAULT_CURSOR:"grab"},q={MIN_INTERVAL_MS:5e3,MAX_INTERVAL_MS:12e3,MAX_ACTIVE:3,INITIAL_DELAY_MS:3e3},k={LIFETIME_S:20,BASE_SIZE:.8,ALTITUDE:80,SPEED:15,SPEED_MIN_FACTOR:.8,SPEED_VARIATION:.4,TUMBLE_X:.01,TUMBLE_Y:.02},W={START_Y_BASE:10,START_Y_RANGE:40,START_Z_LOWER:.3,START_Z_RANGE:.7,DIR_Y_SCALE:.3,DIR_Z_SCALE:.5},Z=[{name:"ISS",color:"#ffffff",size:1,panels:!0,spawnProbability:.15},{name:"Satellite",color:"#aaaaaa",size:.6,panels:!0,spawnProbability:.55},{name:"Debris",color:"#666666",size:.3,panels:!1,spawnProbability:.3}],w={BODY_HEIGHT_MULTIPLIER:.5,BODY_DEPTH_MULTIPLIER:.5,PANEL_X_OFFSET:.8,PANEL_WIDTH:.8,PANEL_THICKNESS:.05,PANEL_DEPTH:.4,PANEL_COLOR:"#1a3a5c"},Pe={DURATION_MS:2e3},ie={INOUT_BACK_C1:1.70158,INOUT_BACK_C2_MULTIPLIER:1.525},M={RADIUS:580,POSITION_Y:-600,WIDTH_SEGMENTS:64,HEIGHT_SEGMENTS_SURFACE:64,HEIGHT_SEGMENTS_ATMOSPHERE:64,ATMOSPHERE_SCALE:1.02,FALLBACK_COLOR:8432354,SHADER_RETRY_DELAY_MS:100,ROTATION_LERP:.05},F={BACKGROUND_COLOR:"#000",BACKGROUND_COLOR_ALT:"#000000",CAMERA_FOV:60,CAMERA_NEAR:.1,CAMERA_FAR:2e3,CAMERA_INITIAL_X:0,CAMERA_INITIAL_Y:50,CAMERA_INITIAL_Z:400,AMBIENT_LIGHT_INTENSITY:.3};function Ue(e){return e<Z[0].spawnProbability?Z[0]:e<Z[0].spawnProbability+Z[1].spawnProbability?Z[1]:Z[2]}function ye(){const o=document.createElement("canvas");o.width=128,o.height=128;const s=o.getContext("2d"),n=128/2;s.clearRect(0,0,128,128);const a=s.createRadialGradient(n,n,0,n,n,n);a.addColorStop(0,"rgba(255, 255, 255, 1)"),a.addColorStop(.1,"rgba(255, 255, 255, 0.8)"),a.addColorStop(.3,"rgba(255, 255, 255, 0.3)"),a.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),s.fillStyle=a,s.fillRect(0,0,128,128),s.save(),s.translate(n,n);for(let u=0;u<4;u++){s.rotate(Math.PI/2);const r=s.createLinearGradient(0,0,0,-n);r.addColorStop(0,"rgba(255, 255, 255, 0.8)"),r.addColorStop(.3,"rgba(255, 255, 255, 0.3)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),s.fillStyle=r,s.beginPath(),s.moveTo(-2,0),s.lineTo(0,-n*.9),s.lineTo(2,0),s.closePath(),s.fill()}s.restore();const l=s.createRadialGradient(n,n,0,n,n,128*.15);l.addColorStop(0,"rgba(255, 255, 255, 1)"),l.addColorStop(.5,"rgba(255, 255, 255, 0.8)"),l.addColorStop(1,"rgba(255, 255, 255, 0)"),s.fillStyle=l,s.fillRect(0,0,128,128);const E=new _e(o);return E.needsUpdate=!0,E}function be(e){let o=0;for(let s=0;s<e.length;s++){const n=e.charCodeAt(s);o=(o<<5)-o+n,o=o&o}return Math.abs(o)}const we=`
  attribute vec3 starColor;
  attribute float starSize;
  attribute float twinkleSpeed;
  attribute float twinklePhase;
  attribute float twinkleIntensity;
  attribute float isHovered;

  uniform float uTime;

  varying vec3 vColor;
  varying float vOpacity;

  void main() {
    vColor = starColor;

    // Subtle twinkle - very gentle brightness variation
    float twinkle = sin(uTime * twinkleSpeed * 0.3 + twinklePhase);
    float twinkleScale = 1.0 + twinkle * twinkleIntensity * 0.15;

    // Stable opacity - minimal twinkle effect
    float baseOpacity = isHovered > 0.5 ? 1.0 : 0.95;
    vOpacity = baseOpacity;

    // Calculate final size - interpolate between base and hover scale
    float baseScale = starSize * 20.0;
    float hoverScale = 40.0;
    float targetScale = mix(baseScale, hoverScale, isHovered);
    float finalSize = targetScale * twinkleScale;

    // Position
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * mvPosition;

    // Size attenuation - scale by distance from camera
    // Using higher multiplier to match original sprite sizes
    gl_PointSize = finalSize * (1500.0 / -mvPosition.z);
  }
`,je=`
  uniform sampler2D uTexture;

  varying vec3 vColor;
  varying float vOpacity;

  void main() {
    vec4 texColor = texture2D(uTexture, gl_PointCoord);
    gl_FragColor = vec4(vColor * texColor.rgb, texColor.a * vOpacity);
  }
`;function Ge({stars:e,observer:o,date:s,onStarClick:n,onStarHover:a}){const l=i.useRef(null),E=i.useRef(null),u=i.useRef(null),[r,h]=i.useState(-1),_=i.useRef(null),{gl:A,camera:m}=ce(),O=i.useMemo(()=>ye(),[]),I=i.useMemo(()=>{const c=[];for(const T of e){if(T.ra===null||T.dec===null)continue;const L=Ce(T.ra,T.dec,o,s,re.STAR_DISTANCE);if(!L.visible)continue;const D=be(T.hostname);c.push({star:T,position:new ee(L.x,L.y,L.z),color:new Ee(Me(T.star_class)),size:Oe(T.sy_vmag),twinkleSpeed:V.MIN_SPEED+D%V.SPEED_MODULO/V.SPEED_DIVISOR,twinklePhase:D%1e3/1e3*Math.PI*2,twinkleIntensity:V.MIN_INTENSITY+D%V.INTENSITY_MODULO/V.INTENSITY_DIVISOR})}return c},[e,o,s]),R=i.useMemo(()=>{const c=I.length,T=new Float32Array(c*3),L=new Float32Array(c*3),D=new Float32Array(c),b=new Float32Array(c),j=new Float32Array(c),G=new Float32Array(c),Y=new Float32Array(c);return I.forEach((v,N)=>{T[N*3]=v.position.x,T[N*3+1]=v.position.y,T[N*3+2]=v.position.z,L[N*3]=v.color.r,L[N*3+1]=v.color.g,L[N*3+2]=v.color.b,D[N]=v.size,b[N]=v.twinkleSpeed,j[N]=v.twinklePhase,G[N]=v.twinkleIntensity,Y[N]=0}),{positions:T,colors:L,sizes:D,twinkleSpeeds:b,twinklePhases:j,twinkleIntensities:G,isHovered:Y}},[I]),P=i.useRef(null);i.useEffect(()=>{if(!u.current)return;const c=u.current;c.setAttribute("position",new z(R.positions,3)),c.setAttribute("starColor",new z(R.colors,3)),c.setAttribute("starSize",new z(R.sizes,1)),c.setAttribute("twinkleSpeed",new z(R.twinkleSpeeds,1)),c.setAttribute("twinklePhase",new z(R.twinklePhases,1)),c.setAttribute("twinkleIntensity",new z(R.twinkleIntensities,1));const T=new z(R.isHovered,1);c.setAttribute("isHovered",T),P.current=T,c.computeBoundingSphere()},[R]),K(c=>{if(E.current&&(E.current.uniforms.uTime.value=c.clock.elapsedTime),P.current){const T=P.current.array;let L=!1;for(let D=0;D<T.length;D++){const j=(D===r?1:0)-T[D];Math.abs(j)>.001&&(T[D]+=j*B.HOVER_LERP,L=!0)}L&&(P.current.needsUpdate=!0)}});const S=i.useCallback(c=>{if(I.length===0)return;const T=A.domElement.getBoundingClientRect(),L=c.clientX-T.left,D=c.clientY-T.top;let b=-1,j=1/0;for(let G=0;G<I.length;G++){const Y=I[G],v=Y.position.clone().project(m);if(v.z>1)continue;const N=(v.x+1)/2*T.width,p=(1-v.y)/2*T.height,C=L-N,se=D-p,Q=Math.sqrt(C*C+se*se),ue=B.BASE_HIT_THRESHOLD+Y.size*re.BASE_SCALE*B.SIZE_SCALE_MULTIPLIER;Q<ue&&Q<j&&(b=G,j=Q)}b!==r?(h(b),b>=0?(A.domElement.style.cursor=B.POINTER_CURSOR,a==null||a(I[b].star,{x:c.clientX,y:c.clientY})):(A.domElement.style.cursor=B.DEFAULT_CURSOR,a==null||a(null))):b>=0&&(a==null||a(I[b].star,{x:c.clientX,y:c.clientY}))},[I,r,A,m,a]),f=i.useCallback(c=>{_.current={x:c.clientX,y:c.clientY}},[]),U=i.useCallback(c=>{if(_.current){const T=c.clientX-_.current.x,L=c.clientY-_.current.y;if(Math.sqrt(T*T+L*L)>B.CLICK_DISTANCE_THRESHOLD)return}r>=0&&I[r]&&(n==null||n(I[r].star))},[r,I,n]),y=i.useCallback(()=>{h(-1),A.domElement.style.cursor=B.DEFAULT_CURSOR,a==null||a(null)},[A,a]);return i.useEffect(()=>{const c=A.domElement;return c.addEventListener("pointerdown",f),c.addEventListener("pointermove",S),c.addEventListener("click",U),c.addEventListener("pointerleave",y),()=>{c.removeEventListener("pointerdown",f),c.removeEventListener("pointermove",S),c.removeEventListener("click",U),c.removeEventListener("pointerleave",y)}},[A,f,S,U,y]),i.useEffect(()=>()=>{O.dispose()},[O]),I.length===0?null:t.jsxs("points",{ref:l,frustumCulled:!1,children:[t.jsx("bufferGeometry",{ref:u}),t.jsx("shaderMaterial",{ref:E,vertexShader:we,fragmentShader:je,uniforms:{uTime:{value:0},uTexture:{value:O}},transparent:!0,depthWrite:!1,blending:de})]})}function Fe({longitude:e=0}){const[o,s]=i.useState(!1),[n,a]=i.useState(null),l=i.useRef(0),E=i.useRef(0),u=i.useMemo(()=>({uRotation:{value:0}}),[]);return i.useEffect(()=>{const r=()=>{try{J.isLoaded()?(a({surfaceVert:J.get("earthSurfaceVert"),surfaceFrag:J.get("earthSurfaceFrag"),atmosphereVert:J.get("atmosphereVert"),atmosphereFrag:J.get("atmosphereFrag")}),s(!0)):setTimeout(r,M.SHADER_RETRY_DELAY_MS)}catch(h){console.warn("Earth shaders not available, using fallback:",h),s(!0)}};r()},[]),i.useEffect(()=>{l.current=-e*Math.PI/180},[e]),K(()=>{const r=l.current-E.current;E.current+=r*M.ROTATION_LERP,u.uRotation.value=E.current}),!o||!n?t.jsx("group",{children:t.jsxs("mesh",{position:[0,M.POSITION_Y,0],children:[t.jsx("sphereGeometry",{args:[M.RADIUS,M.WIDTH_SEGMENTS,M.HEIGHT_SEGMENTS_SURFACE]}),t.jsx("meshBasicMaterial",{color:M.FALLBACK_COLOR})]})}):t.jsxs("group",{children:[t.jsxs("mesh",{position:[0,M.POSITION_Y,0],children:[t.jsx("sphereGeometry",{args:[M.RADIUS,M.WIDTH_SEGMENTS,M.HEIGHT_SEGMENTS_SURFACE]}),t.jsx("shaderMaterial",{vertexShader:n.surfaceVert,fragmentShader:n.surfaceFrag,uniforms:u})]}),t.jsxs("mesh",{position:[0,M.POSITION_Y,0],scale:[M.ATMOSPHERE_SCALE,M.ATMOSPHERE_SCALE,M.ATMOSPHERE_SCALE],children:[t.jsx("sphereGeometry",{args:[M.RADIUS,M.WIDTH_SEGMENTS,M.HEIGHT_SEGMENTS_ATMOSPHERE]}),t.jsx("shaderMaterial",{vertexShader:n.atmosphereVert,fragmentShader:n.atmosphereFrag,transparent:!0,side:te,depthWrite:!1})]})]})}function He({satellite:e,onExpired:o}){const s=i.useRef(null),n=i.useRef(e.createdAt);K(l=>{if(!s.current)return;const E=l.clock.elapsedTime-n.current;if(E>k.LIFETIME_S){o(e.id);return}const u=E*e.speed,r=e.startPosition.clone().add(e.direction.clone().multiplyScalar(u));s.current.position.copy(r),s.current.rotation.x+=k.TUMBLE_X,s.current.rotation.y+=k.TUMBLE_Y});const a=k.BASE_SIZE*e.type.size;return t.jsxs("group",{ref:s,position:e.startPosition,children:[t.jsxs("mesh",{children:[t.jsx("boxGeometry",{args:[a,a*w.BODY_HEIGHT_MULTIPLIER,a*w.BODY_DEPTH_MULTIPLIER]}),t.jsx("meshBasicMaterial",{color:e.type.color})]}),e.type.panels&&t.jsxs(t.Fragment,{children:[t.jsxs("mesh",{position:[a*w.PANEL_X_OFFSET,0,0],children:[t.jsx("boxGeometry",{args:[a*w.PANEL_WIDTH,a*w.PANEL_THICKNESS,a*w.PANEL_DEPTH]}),t.jsx("meshBasicMaterial",{color:w.PANEL_COLOR})]}),t.jsxs("mesh",{position:[-a*w.PANEL_X_OFFSET,0,0],children:[t.jsx("boxGeometry",{args:[a*w.PANEL_WIDTH,a*w.PANEL_THICKNESS,a*w.PANEL_DEPTH]}),t.jsx("meshBasicMaterial",{color:w.PANEL_COLOR})]})]})]})}function ke(){const[e,o]=i.useState([]),s=i.useRef(0),n=i.useRef(null);K(l=>{n.current||(n.current=l.clock)}),i.useEffect(()=>{const l=()=>{n.current&&o(r=>{var y;if(r.length>=q.MAX_ACTIVE)return r;const h=Math.random()>.5,_=h?-80:k.ALTITUDE,A=W.START_Y_BASE+Math.random()*W.START_Y_RANGE,m=-80*(W.START_Z_LOWER+Math.random()*W.START_Z_RANGE),O=h?1:-1,I=(Math.random()-.5)*W.DIR_Y_SCALE,R=(Math.random()-.5)*W.DIR_Z_SCALE,P=new ee(O,I,R).normalize(),S=Math.random(),f=Ue(S),U={id:s.current++,type:f,startPosition:new ee(_,A,m),direction:P,speed:k.SPEED*(k.SPEED_MIN_FACTOR+Math.random()*k.SPEED_VARIATION),createdAt:((y=n.current)==null?void 0:y.elapsedTime)??0,altitude:k.ALTITUDE};return[...r,U]})},E=()=>{const r=q.MIN_INTERVAL_MS+Math.random()*(q.MAX_INTERVAL_MS-q.MIN_INTERVAL_MS);return setTimeout(()=>{l(),u=E()},r)};let u=setTimeout(()=>{l(),u=E()},q.INITIAL_DELAY_MS);return()=>clearTimeout(u)},[]);const a=l=>{o(E=>E.filter(u=>u.id!==l))};return t.jsx("group",{children:e.map(l=>t.jsx(He,{satellite:l,onExpired:a},l.id))})}function le(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function Ye(e){const s=ie.INOUT_BACK_C1*ie.INOUT_BACK_C2_MULTIPLIER;return e<.5?Math.pow(2*e,2)*((s+1)*2*e-s)/2:(Math.pow(2*e-2,2)*((s+1)*(e*2-2)+s)+2)/2}const ze=`
  varying vec3 vNormal;
  varying vec3 vPosition;
  varying vec2 vUv;

  void main() {
    vNormal = normalize(normalMatrix * normal);
    vPosition = position;
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,Be=`
  uniform float uTime;
  uniform float uOpacity;

  varying vec3 vNormal;
  varying vec3 vPosition;
  varying vec2 vUv;

  // Simple noise function
  float hash(vec2 p) {
    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
  }

  float noise(vec2 p) {
    vec2 i = floor(p);
    vec2 f = fract(p);
    f = f * f * (3.0 - 2.0 * f);

    float a = hash(i);
    float b = hash(i + vec2(1.0, 0.0));
    float c = hash(i + vec2(0.0, 1.0));
    float d = hash(i + vec2(1.0, 1.0));

    return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
  }

  float fbm(vec2 p) {
    float sum = 0.0;
    float amp = 0.5;
    for(int i = 0; i < 4; i++) {
      sum += noise(p) * amp;
      p *= 2.0;
      amp *= 0.5;
    }
    return sum;
  }

  void main() {
    // Convert position to spherical coordinates for texture mapping
    vec3 nPos = normalize(vPosition);
    float longitude = atan(nPos.x, nPos.z) + uTime * 0.1;
    float latitude = asin(nPos.y);
    vec2 uv = vec2(longitude / 3.14159, latitude / 1.5708 + 0.5);

    // Ocean base color
    vec3 oceanColor = vec3(0.02, 0.08, 0.15);
    vec3 oceanHighlight = vec3(0.05, 0.15, 0.3);

    // Land generation using noise
    float landNoise = fbm(uv * 8.0);
    float landMask = smoothstep(0.45, 0.55, landNoise);

    // Land colors
    vec3 landLow = vec3(0.08, 0.25, 0.05); // Green lowlands
    vec3 landHigh = vec3(0.3, 0.2, 0.1);   // Brown highlands
    vec3 landColor = mix(landLow, landHigh, fbm(uv * 16.0));

    // Ice caps at poles
    float iceMask = smoothstep(0.7, 0.9, abs(nPos.y));
    vec3 iceColor = vec3(0.9, 0.95, 1.0);

    // Clouds
    float cloudNoise = fbm(uv * 6.0 + uTime * 0.05);
    float cloudMask = smoothstep(0.5, 0.7, cloudNoise);
    vec3 cloudColor = vec3(1.0, 1.0, 1.0);

    // Combine layers
    vec3 surfaceColor = mix(oceanColor, landColor, landMask);
    surfaceColor = mix(surfaceColor, iceColor, iceMask);
    surfaceColor = mix(surfaceColor, cloudColor, cloudMask * 0.7);

    // Simple lighting from camera direction
    vec3 lightDir = normalize(vec3(0.5, 0.3, 1.0));
    float light = max(0.0, dot(vNormal, lightDir));
    float ambient = 0.15;

    // Atmosphere rim lighting
    float rim = 1.0 - max(0.0, dot(vNormal, vec3(0.0, 0.0, 1.0)));
    vec3 atmosphereColor = vec3(0.3, 0.6, 1.0);
    vec3 rimGlow = atmosphereColor * pow(rim, 3.0) * 0.5;

    vec3 finalColor = surfaceColor * (light + ambient) + rimGlow;

    gl_FragColor = vec4(finalColor, uOpacity);
  }
`;function Xe({progress:e}){const o=i.useRef(null),s=i.useMemo(()=>({uTime:{value:0},uOpacity:{value:1}}),[]);if(K((l,E)=>{o.current&&(o.current.rotation.y+=E*g.ROTATION_SPEED),s.uTime.value=l.clock.elapsedTime}),e>=1)return null;const n=g.SCALE_MULTIPLIER*(1-e),a=g.INITIAL_Z-e*g.Z_MOVEMENT_DISTANCE;return t.jsxs("group",{ref:o,position:[0,0,a],scale:[n,n,n],children:[t.jsxs("mesh",{children:[t.jsx("sphereGeometry",{args:[g.BASE_RADIUS,64,64]}),t.jsx("shaderMaterial",{vertexShader:ze,fragmentShader:Be,uniforms:s,transparent:!0})]}),t.jsxs("mesh",{scale:[g.ATMOSPHERE_SCALE,g.ATMOSPHERE_SCALE,g.ATMOSPHERE_SCALE],children:[t.jsx("sphereGeometry",{args:[g.BASE_RADIUS,32,32]}),t.jsx("meshBasicMaterial",{color:g.ATMOSPHERE_COLOR,transparent:!0,opacity:g.ATMOSPHERE_OPACITY,side:te})]}),t.jsxs("mesh",{scale:[g.OUTER_GLOW_SCALE,g.OUTER_GLOW_SCALE,g.OUTER_GLOW_SCALE],children:[t.jsx("sphereGeometry",{args:[g.BASE_RADIUS,32,32]}),t.jsx("meshBasicMaterial",{color:g.OUTER_GLOW_COLOR,transparent:!0,opacity:g.OUTER_GLOW_OPACITY,side:te})]})]})}function Ve({introState:e,onBearingChange:o,controlsEnabled:s}){const{camera:n,gl:a}=ce(),l=i.useRef(!1),E=i.useRef({x:0,y:0}),u=i.useRef({azimuth:x.INITIAL_AZIMUTH,altitude:x.INITIAL_ALTITUDE});return K(()=>{const{phase:r}=e;if(r==="earth-spin"||r==="camera-swoop")n.position.set(0,0,0),n.lookAt(0,0,-100),n.updateProjectionMatrix();else if((r==="stars-fade"||r==="complete")&&!s){n.position.set(0,0,0);const h=u.current.azimuth*Math.PI/180,_=u.current.altitude*Math.PI/180;n.lookAt(-Math.sin(h)*Math.cos(_)*x.LOOKAT_DISTANCE,Math.sin(_)*x.LOOKAT_DISTANCE,-Math.cos(h)*Math.cos(_)*x.LOOKAT_DISTANCE),n.updateProjectionMatrix()}}),i.useEffect(()=>{if(!s)return;const r=a.domElement,h=()=>{const{azimuth:S,altitude:f}=u.current,U=S*Math.PI/180,y=f*Math.PI/180;n.position.set(0,0,0),n.lookAt(-Math.sin(U)*Math.cos(y)*100,Math.sin(y)*100,-Math.cos(U)*Math.cos(y)*100),n.updateProjectionMatrix(),o(S,f)},_=S=>{l.current=!0,E.current={x:S.clientX,y:S.clientY},r.style.cursor=x.DRAGGING_CURSOR},A=()=>{l.current=!1,r.style.cursor=x.DEFAULT_CURSOR},m=S=>{if(!l.current)return;const f=S.clientX-E.current.x,U=S.clientY-E.current.y;u.current.azimuth-=f*x.DRAG_SENSITIVITY,u.current.altitude+=U*x.DRAG_SENSITIVITY,u.current.azimuth=(u.current.azimuth%360+360)%360,u.current.altitude=Math.max(x.MIN_ALTITUDE,Math.min(x.MAX_ALTITUDE,u.current.altitude)),E.current={x:S.clientX,y:S.clientY},h()},O=()=>{l.current=!1,r.style.cursor=x.DEFAULT_CURSOR},I=S=>{if(S.touches.length!==1)return;l.current=!0;const f=S.touches[0];E.current={x:f.clientX,y:f.clientY}},R=()=>{l.current=!1},P=S=>{if(!l.current||S.touches.length!==1)return;S.preventDefault();const f=S.touches[0],U=f.clientX-E.current.x,y=f.clientY-E.current.y;u.current.azimuth-=U*x.DRAG_SENSITIVITY,u.current.altitude+=y*x.DRAG_SENSITIVITY,u.current.azimuth=(u.current.azimuth%360+360)%360,u.current.altitude=Math.max(x.MIN_ALTITUDE,Math.min(x.MAX_ALTITUDE,u.current.altitude)),E.current={x:f.clientX,y:f.clientY},h()};return r.style.cursor=x.DEFAULT_CURSOR,r.addEventListener("mousedown",_),r.addEventListener("mouseup",A),r.addEventListener("mousemove",m),r.addEventListener("mouseleave",O),r.addEventListener("touchstart",I),r.addEventListener("touchend",R),r.addEventListener("touchmove",P,{passive:!1}),h(),()=>{r.removeEventListener("mousedown",_),r.removeEventListener("mouseup",A),r.removeEventListener("mousemove",m),r.removeEventListener("mouseleave",O),r.removeEventListener("touchstart",I),r.removeEventListener("touchend",R),r.removeEventListener("touchmove",P)}},[a,n,s,o]),null}function We({opacity:e}){const o=$.COUNT,s=i.useMemo(()=>{const n=new Float32Array(o*3);for(let a=0;a<o;a++){const l=Math.random()*Math.PI*2,E=Math.acos(2*Math.random()-1),u=$.SPHERE_RADIUS;n[a*3]=u*Math.sin(E)*Math.cos(l),n[a*3+1]=u*Math.sin(E)*Math.sin(l),n[a*3+2]=u*Math.cos(E)}return n},[]);return t.jsxs("points",{children:[t.jsx("bufferGeometry",{children:t.jsx("bufferAttribute",{attach:"attributes-position",count:o,array:s,itemSize:3})}),t.jsx("pointsMaterial",{size:$.POINT_SIZE,color:$.COLOR,transparent:!0,opacity:e*$.OPACITY_MULTIPLIER,sizeAttenuation:!1})]})}function Ze(){const[e,o]=i.useState({phase:"earth-spin",progress:0}),s=i.useRef(Date.now()),n=i.useCallback(()=>{o({phase:"complete",progress:1})},[]);i.useEffect(()=>{let u;const r=()=>{const h=Date.now(),_=h-s.current;o(A=>{if(A.phase==="complete")return A;if(A.phase==="earth-spin"){const m=Math.min(_/H.EARTH_SPIN_DURATION,1);return m>=1?(s.current=h,{phase:"camera-swoop",progress:0}):{...A,progress:m}}if(A.phase==="camera-swoop"){const m=Math.min(_/H.CAMERA_SWOOP_DURATION,1);return m>=1?(s.current=h,{phase:"stars-fade",progress:0}):{...A,progress:m}}if(A.phase==="stars-fade"){const m=Math.min(_/H.STARS_FADE_DURATION,1);return m>=1?{phase:"complete",progress:1}:{...A,progress:m}}return A}),e.phase!=="complete"&&(u=requestAnimationFrame(r))};return u=requestAnimationFrame(r),()=>cancelAnimationFrame(u)},[e.phase]);const a=e.phase==="stars-fade"?le(e.progress):e.phase==="complete"?1:0,l=e.phase==="camera-swoop"?Ye(e.progress):e.phase==="stars-fade"||e.phase==="complete"?1:0,E=e.phase==="complete";return{state:e,introEarthExitProgress:l,starsOpacity:a,controlsEnabled:E,skipIntro:n}}function Ke(e){const[o,s]=i.useState(e),[n,a]=i.useState(e),[l,E]=i.useState(!1),u=i.useRef(Date.now()),r=i.useRef(e);i.useEffect(()=>{if(!l)return;let _;const A=()=>{const m=Date.now()-u.current,O=Math.min(m/Pe.DURATION_MS,1),I=le(O),R=r.current.latitude+(n.latitude-r.current.latitude)*I,P=r.current.longitude+(n.longitude-r.current.longitude)*I;s({latitude:R,longitude:P}),O<1?_=requestAnimationFrame(A):(E(!1),s(n))};return _=requestAnimationFrame(A),()=>cancelAnimationFrame(_)},[l,n]);const h=i.useCallback(_=>{r.current=o,u.current=Date.now(),a(_),E(!0)},[o]);return{currentLocation:o,changeLocation:h,isAnimating:l}}function Je({starCount:e,planetCount:o,onDismiss:s,isExiting:n}){const{t:a}=Ae();return t.jsx("div",{className:`welcome-card-container ${n?"exiting":""}`,children:t.jsxs("div",{className:"welcome-card",children:[t.jsx("h2",{className:"welcome-title",children:a("pages.home.infoCard.title")}),t.jsx("p",{className:"welcome-description",children:a("pages.home.infoCard.description")}),t.jsx("div",{className:"welcome-stats",children:a("pages.home.infoCard.stats",{starCount:e.toLocaleString(),planetCount:o.toLocaleString()})}),t.jsx("p",{className:"welcome-hint",children:a("pages.home.infoCard.hint")}),t.jsx("button",{className:"welcome-dismiss",onClick:s,children:a("pages.home.infoCard.dismiss")})]})})}function $e({stars:e,onStarClick:o}){const{currentLocation:s,changeLocation:n,isAnimating:a}=Ke(oe["São Paulo"]),[l]=i.useState(()=>new Date),[E,u]=i.useState({azimuth:180,altitude:-10}),[r,h]=i.useState(!1),[_,A]=i.useState(null),[m,O]=i.useState(null),[I,R]=i.useState("São Paulo"),[P,S]=i.useState(!1),[f,U]=i.useState(!1),y=i.useRef(!1),{state:c,introEarthExitProgress:T,starsOpacity:L,controlsEnabled:D,skipIntro:b}=Ze();i.useEffect(()=>{if(c.phase==="complete"&&!y.current&&!P){const p=setTimeout(()=>{S(!0)},H.WELCOME_CARD_DELAY);return()=>clearTimeout(p)}},[c.phase,P]);const j=i.useCallback(()=>{y.current=!0,U(!0),setTimeout(()=>{S(!1),U(!1)},H.WELCOME_CARD_DISMISS_DURATION)},[]),G=i.useCallback((p,C)=>{u({azimuth:p,altitude:C})},[]),Y=i.useCallback((p,C)=>{n(C),R(p),h(!1)},[n]),v=i.useCallback((p,C)=>{A(p),O(C??null)},[]),N=c.phase==="complete";return t.jsxs("div",{className:"starfield-container",children:[t.jsxs(Se,{camera:{fov:F.CAMERA_FOV,near:F.CAMERA_NEAR,far:F.CAMERA_FAR,position:[F.CAMERA_INITIAL_X,F.CAMERA_INITIAL_Y,F.CAMERA_INITIAL_Z]},gl:{antialias:!0,alpha:!1},style:{background:F.BACKGROUND_COLOR},children:[t.jsx("color",{attach:"background",args:[F.BACKGROUND_COLOR_ALT]}),t.jsx(Ve,{introState:c,onBearingChange:G,controlsEnabled:D}),t.jsx("ambientLight",{intensity:F.AMBIENT_LIGHT_INTENSITY}),t.jsx(Xe,{progress:T}),(c.phase==="stars-fade"||c.phase==="complete")&&t.jsxs(t.Fragment,{children:[t.jsx(We,{opacity:1}),t.jsx(Ge,{stars:e,observer:s,date:l,onStarClick:o,onStarHover:v}),t.jsx(Fe,{longitude:s.longitude}),c.phase==="complete"&&t.jsx(ke,{})]})]}),(c.phase==="stars-fade"||c.phase==="complete")&&t.jsx("div",{className:"scene-fade-overlay",style:{opacity:1-L,pointerEvents:L>=1?"none":"auto"}}),N&&t.jsxs("div",{className:"starfield-bearing",children:[t.jsx("div",{className:"bearing-title",children:"Telescope Bearing"}),t.jsxs("div",{className:"bearing-value",children:[t.jsx("span",{className:"bearing-icon",children:"↔"})," ",xe(E.azimuth)]}),t.jsxs("div",{className:"bearing-value",children:[t.jsx("span",{className:"bearing-icon",children:"↕"})," ",ve(E.altitude)]})]}),_&&m&&N&&t.jsxs("div",{className:"starfield-tooltip",style:{left:`${m.x+20}px`,top:`${m.y-10}px`},children:[t.jsx("div",{className:"tooltip-name",children:_.hostname}),t.jsxs("div",{className:"tooltip-info",children:[_.sy_pnum," planet",_.sy_pnum!==1?"s":"",_.distance_ly&&t.jsxs(t.Fragment,{children:[" · ",_.distance_ly.toFixed(1)," ly"]})]}),t.jsx("div",{className:"tooltip-hint",children:"Click to explore"})]}),N&&t.jsxs("div",{className:"starfield-location",children:[a?t.jsxs("span",{className:"location-coords location-animating",children:["Traveling to ",I,"..."]}):t.jsxs("span",{className:"location-coords",children:[I," · ",De(s.latitude),","," ",ge(s.longitude)]}),t.jsx("button",{className:"location-button",onClick:()=>h(!r),disabled:a,children:"CHANGE LOCATION"}),r&&!a&&t.jsx("div",{className:"location-picker",children:Object.entries(oe).map(([p,C])=>t.jsx("button",{className:"location-option",onClick:()=>Y(p,C),children:p},p))})]}),N&&t.jsx("div",{className:"starfield-info",children:t.jsxs("span",{children:[e.length.toLocaleString()," exoplanet host stars"]})}),c.phase!=="complete"&&t.jsxs("div",{className:"intro-overlay",onClick:b,children:[c.phase==="earth-spin"&&t.jsx("div",{className:"intro-text",children:t.jsxs("div",{className:"intro-title-container",children:[t.jsx("div",{className:"intro-title-line intro-title-line-exo",children:"EXO".split("").map((p,C)=>t.jsx("span",{className:"intro-letter",style:{animationDelay:`${C*H.LETTER_ANIMATION_DELAY}s`},children:p},C))}),t.jsx("div",{className:"intro-title-line intro-title-line-planets",children:"PLANETS".split("").map((p,C)=>t.jsx("span",{className:"intro-letter",style:{animationDelay:`${H.PLANETS_LINE_START_OFFSET*H.LETTER_ANIMATION_DELAY+C*H.LETTER_ANIMATION_DELAY}s`},children:p},C))})]})}),(c.phase==="camera-swoop"||c.phase==="stars-fade")&&t.jsx("div",{className:"intro-text",style:{opacity:c.phase==="stars-fade"?1-L:1},children:t.jsx("span",{className:"intro-subtitle",children:"Explore the cosmos"})}),c.phase!=="stars-fade"&&t.jsx("div",{className:"intro-skip",children:"Click anywhere to skip"})]}),P&&t.jsx(Je,{starCount:e.length,planetCount:e.reduce((p,C)=>p+(C.sy_pnum||0),0),onDismiss:j,isExiting:f})]})}function et(){const{getAllStars:e}=Te(),o=Ie(),s=e(),n=i.useCallback(a=>{o(`/stars/${he(a.hostname)}`)},[o]);return t.jsx($e,{stars:s,onStarClick:n})}export{et as default};
