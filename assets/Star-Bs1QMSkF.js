import{r as l,j as e,s as _,u as L,f as D,L as F,n as E,b as z,g as O,d as $,a as U}from"./index-CaY8PH_5.js";import{a as P,Q as q,C,A as T,F as G,D as V,c as W,V as X,e as Y,L as Q,f as K,d as Z}from"./react-three-fiber.esm-BLyO50Er.js";import{c as J,g as H,a as B}from"./planetUniforms-DXzHnODK.js";import{_ as ee,O as se}from"./OrbitControls-CR6z1PUB.js";const ae=l.forwardRef(function({children:m,follow:r=!0,lockX:c=!1,lockY:a=!1,lockZ:p=!1,...o},h){const n=l.useRef(null),u=l.useRef(null),x=new q;return P(({camera:f})=>{if(!r||!u.current)return;const t=n.current.rotation.clone();u.current.updateMatrix(),u.current.updateWorldMatrix(!1,!1),u.current.getWorldQuaternion(x),f.getWorldQuaternion(n.current.quaternion).premultiply(x.invert()),c&&(n.current.rotation.x=t.x),a&&(n.current.rotation.y=t.y),p&&(n.current.rotation.z=t.z)}),l.useImperativeHandle(h,()=>u.current,[]),l.createElement("group",ee({ref:u},o),l.createElement("group",{ref:n},m))}),b=.15;function te({body:s,isHovered:m,onHover:r,onClick:c}){var y;const a=l.useRef(null),p=l.useRef(null),o=l.useRef(null),h=l.useRef(null),n=l.useRef(Math.random()*Math.PI*2),u=l.useMemo(()=>({uStarColor:{value:new C(s.color)},uTime:{value:0},uTemperature:{value:s.temperature??5778}}),[s.color,s.temperature]),x=l.useRef(null),f=l.useMemo(()=>({uStarColor:{value:new C(s.color)},uTime:{value:0},uIntensity:{value:s.emissiveIntensity??1}}),[s.color,s.emissiveIntensity]),t=l.useMemo(()=>s.planetData?J({planet:s.planetData,detailLevel:"simple",starTemp:s.planetData.st_teff??void 0}):{uBaseColor:{value:new C(s.color)},uTime:{value:0},uTemperature:{value:s.temperature??300},uHasAtmosphere:{value:s.hasAtmosphere??.5},uSeed:{value:Math.random()},uDensity:{value:.5},uInsolation:{value:.5},uStarTemp:{value:5778},uDetailLevel:{value:0}},[s.planetData,s.color,s.temperature,s.hasAtmosphere]),d=l.useMemo(()=>{var i;return H((i=s.planetData)==null?void 0:i.planet_subtype,s.planetType)},[(y=s.planetData)==null?void 0:y.planet_subtype,s.planetType]),M=l.useMemo(()=>B(d),[d]);P((i,v)=>{if(s.type==="planet"&&a.current&&s.orbitPeriod>0&&!m&&(n.current+=Math.PI*2*v*b/(s.orbitPeriod/60)),s.type==="star"&&s.orbitRadius>0&&a.current&&s.orbitPeriod>0&&(n.current+=Math.PI*2*v*b*2/(s.orbitPeriod/60)),s.type==="planet"&&a.current){const j=Math.min(Math.max(s.orbitEccentricity||0,0),.99),g=s.orbitRadius,w=g*Math.sqrt(1-j*j),R=g*j,k=g*Math.cos(n.current)-R,I=w*Math.sin(n.current);a.current.position.x=k,a.current.position.z=I}if(s.type==="star"&&s.orbitRadius>0&&a.current){const j=Math.min(Math.max(s.orbitEccentricity||0,0),.99),g=s.orbitRadius,w=g*Math.sqrt(1-j*j),R=s.isCompanionStar?Math.PI:0,k=g*Math.cos(n.current+R),I=w*Math.sin(n.current+R);a.current.position.x=k,a.current.position.z=I}p.current&&!m&&(p.current.rotation.y+=v*.2);const S=i.clock.elapsedTime;s.type==="star"?(o.current&&(o.current.uniforms.uTime.value=S),x.current&&(x.current.uniforms.uTime.value=S)):s.type==="planet"&&h.current&&(h.current.uniforms.uTime.value=S)});const N=m?1.3:1;if(s.type==="star"){const i=e.jsxs(e.Fragment,{children:[e.jsx("pointLight",{position:[0,0,0],color:s.color,intensity:s.isCompanionStar?1.5:2,distance:s.isCompanionStar?40:50}),e.jsx(ae,{children:e.jsxs("mesh",{children:[e.jsx("planeGeometry",{args:[s.diameter*1.8,s.diameter*1.8]}),e.jsx("shaderMaterial",{transparent:!0,depthWrite:!1,blending:T,uniforms:{uColor:{value:new C(s.color)},uIntensity:{value:s.emissiveIntensity??1}},vertexShader:`
                varying vec2 vUv;
                void main() {
                  vUv = uv;
                  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
              `,fragmentShader:`
                uniform vec3 uColor;
                uniform float uIntensity;
                varying vec2 vUv;
                void main() {
                  vec2 center = vUv - 0.5;
                  float dist = length(center) * 2.0;
                  // Start glow from edge of star (around 0.55 radius in UV space)
                  float glow = 1.0 - smoothstep(0.55, 1.0, dist);
                  // Clamp intensity: min 0.7, max 1.8 to prevent huge glows
                  float clampedIntensity = clamp(uIntensity, 0.7, 1.8);
                  glow = pow(glow, 2.5) * clampedIntensity * 0.35;
                  gl_FragColor = vec4(uColor, glow);
                }
              `})]})}),e.jsxs("mesh",{ref:p,children:[e.jsx("sphereGeometry",{args:[s.diameter/2,64,64]}),e.jsx("shaderMaterial",{ref:o,vertexShader:_.get("starSurfaceVert"),fragmentShader:_.get("starSurfaceFrag"),uniforms:u})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[s.diameter/2*1.15,64,64]}),e.jsx("shaderMaterial",{ref:x,vertexShader:_.get("starCoronaVert"),fragmentShader:_.get("starCoronaFrag"),uniforms:f,transparent:!0,depthWrite:!1,blending:T,side:G})]})]});return s.orbitRadius>0?e.jsx("group",{ref:a,children:i}):e.jsx("group",{children:i})}return e.jsxs("group",{ref:a,children:[e.jsxs("mesh",{ref:p,scale:[N,N,N],onPointerOver:i=>{var j,g;i.stopPropagation(),document.body.style.cursor="pointer";const v=i.clientX??((j=i.nativeEvent)==null?void 0:j.clientX),S=i.clientY??((g=i.nativeEvent)==null?void 0:g.clientY);r(s,v&&S?{x:v,y:S}:void 0)},onPointerMove:i=>{var v,S;if(m){const j=i.clientX??((v=i.nativeEvent)==null?void 0:v.clientX),g=i.clientY??((S=i.nativeEvent)==null?void 0:S.clientY);j&&g&&r(s,{x:j,y:g})}},onPointerOut:i=>{i.stopPropagation(),document.body.style.cursor="grab",r(null)},onClick:i=>{i.stopPropagation(),c==null||c(s)},children:[e.jsx("sphereGeometry",{args:[s.diameter/2,48,48]}),e.jsx("shaderMaterial",{ref:h,vertexShader:_.get("planetVert"),fragmentShader:_.get(M),uniforms:t})]}),s.hasRings&&e.jsxs("mesh",{rotation:[Math.PI/2.5,0,0],children:[e.jsx("ringGeometry",{args:[s.diameter*.7,s.diameter*1.2,64]}),e.jsx("meshBasicMaterial",{color:new C(s.color).lerp(new C("#ffffff"),.4),transparent:!0,opacity:.5,side:V})]}),m&&e.jsxs("mesh",{scale:[1.4,1.4,1.4],children:[e.jsx("sphereGeometry",{args:[s.diameter/2,24,24]}),e.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.15,side:W})]})]})}function A({radius:s,eccentricity:m=0,isHighlighted:r,isBinaryOrbit:c=!1}){const a=l.useRef(null),p=Math.min(Math.max(m,0),.99),o=s,h=o*Math.sqrt(1-p*p),n=c?0:o*p,u=p>.1,x=l.useMemo(()=>{const t=[];for(let N=0;N<=128;N++){const y=N/128*Math.PI*2,i=o*Math.cos(y)-n,v=h*Math.sin(y);t.push(new X(i,0,v))}const d=new Y().setFromPoints(t),M=new Q({transparent:!0,depthWrite:!1});return new K(d,M)},[o,h,n]);return P(()=>{if(a.current){const f=a.current.material;let t,d;r?(t="#ffffff",d=.8):c?(t="#ffaa44",d=.5):u?(t="#aaaaff",d=.45):(t="#888888",d=.3),f.color.set(t),f.opacity=d}}),e.jsx("primitive",{ref:a,object:x})}function ne({star:s,bodies:m,hoveredBody:r,onBodyHover:c}){const{t:a}=L(),[p,o]=l.useState(!1);l.useEffect(()=>{const t=window.matchMedia("(min-width: 769px)");o(t.matches);const d=M=>{o(M.matches)};return t.addEventListener("change",d),()=>t.removeEventListener("change",d)},[]);const h=m.filter(t=>t.type==="star"),n=h.find(t=>t.isPrimaryStar||!t.isCompanionStar),u=h.filter(t=>t.isCompanionStar),x=m.filter(t=>t.type==="planet"),f=h.length>1;return e.jsxs(e.Fragment,{children:[p&&e.jsxs("div",{className:"starsystem-info-panel",children:[e.jsxs("h1",{className:"starsystem-star-name",children:[s.hostname,f&&e.jsx("span",{className:"binary-badge",style:{marginLeft:"8px",fontSize:"0.5em",opacity:.8},children:"★★ Binary"})]}),e.jsxs("div",{className:"starsystem-star-details",children:[e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.type")}),e.jsx("span",{className:"detail-value",children:s.st_spectype||s.star_class||a("pages.starSystem.info.unknown")})]}),s.st_teff&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.temperature")}),e.jsx("span",{className:"detail-value",children:D("st_teff",s.st_teff)})]}),s.st_rad&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.radius")}),e.jsx("span",{className:"detail-value",children:D("st_rad",s.st_rad)})]}),s.st_mass&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.mass")}),e.jsx("span",{className:"detail-value",children:D("st_mass",s.st_mass)})]}),s.distance_ly&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.distance")}),e.jsx("span",{className:"detail-value",children:D("distance_ly",s.distance_ly)})]}),s.st_age&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.age")}),e.jsx("span",{className:"detail-value",children:D("st_age",s.st_age)})]})]}),e.jsxs("div",{className:"starsystem-planet-count",children:[s.sy_snum>1&&e.jsxs("span",{className:"star-count",children:[s.sy_snum," ",a("pages.starSystem.info.stars")," •"," "]}),s.sy_pnum," ",s.sy_pnum===1?a("pages.starSystem.info.planet"):a("pages.starSystem.info.planets"),s.cb_flag&&e.jsxs("span",{className:"circumbinary-note",style:{opacity:.7},children:[" ","(",a("pages.starSystem.info.circumbinary"),")"]})]})]}),e.jsxs("div",{className:"starsystem-planets-panel",children:[e.jsx("h2",{className:"planets-panel-title",children:a("pages.starSystem.info.planetaryBodies")}),e.jsxs("ul",{className:"planets-list",children:[n&&e.jsxs("li",{className:`planet-item ${(r==null?void 0:r.id)===n.id?"hovered":""}`,onMouseEnter:()=>c(n),onMouseLeave:()=>c(null),children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:n.color}}),e.jsx("span",{className:"planet-name",children:n.name}),e.jsx("span",{className:"planet-type",children:a(f?"pages.starSystem.info.primaryStar":"pages.starSystem.info.star")})]}),u.map(t=>e.jsxs("li",{className:`planet-item ${(r==null?void 0:r.id)===t.id?"hovered":""}`,onMouseEnter:()=>c(t),onMouseLeave:()=>c(null),children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:t.color}}),e.jsx("span",{className:"planet-name",children:t.name}),e.jsx("span",{className:"planet-type",children:a("pages.starSystem.info.companionStar")})]},t.id)),x.map(t=>{var d;return e.jsx("li",{className:`planet-item ${(r==null?void 0:r.id)===t.id?"hovered":""}`,onMouseEnter:()=>c(t),onMouseLeave:()=>c(null),children:e.jsxs(F,{to:`/planets/${E(t.id)}`,className:"planet-item-link",children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:t.color}}),e.jsx("span",{className:"planet-name",children:t.name}),e.jsx("span",{className:"planet-type",children:((d=t.planetData)==null?void 0:d.planet_type)||a("pages.starSystem.info.planet")})]})},t.id)})]})]}),p&&e.jsx("div",{className:"starsystem-hint",children:a("pages.starSystem.hint")})]})}function re({count:s=3e3}){const m=l.useMemo(()=>{const r=new Float32Array(s*3);for(let c=0;c<s;c++){const a=Math.random()*Math.PI*2,p=Math.acos(2*Math.random()-1),o=500;r[c*3]=o*Math.sin(p)*Math.cos(a),r[c*3+1]=o*Math.sin(p)*Math.sin(a),r[c*3+2]=o*Math.cos(p)}return r},[s]);return e.jsxs("points",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:s,array:m,itemSize:3})}),e.jsx("pointsMaterial",{size:1.5,color:16777215,transparent:!0,opacity:.6,sizeAttenuation:!1})]})}function le({shouldAutoRotate:s,maxDistance:m}){const r=l.useRef(null);return P((c,a)=>{r.current&&s&&(r.current.setAzimuthalAngle(r.current.getAzimuthalAngle()+a*.1),r.current.update())}),e.jsx(se,{ref:r,enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:5,maxDistance:m,autoRotate:!1})}function ie({star:s,planets:m,onPlanetClick:r}){const c=z(),[a,p]=l.useState(null),[o,h]=l.useState(null),n=l.useMemo(()=>O(s,m),[s,m]),u=l.useMemo(()=>{const t=Math.max(...n.map(i=>i.orbitRadius),10),d=n.find(i=>i.type==="star"),N=((d==null?void 0:d.diameter)??3)*4,y=t*2.5;return Math.max(N,y)},[n]),x=l.useCallback((t,d)=>{p(t),h(d??null)},[]),f=l.useCallback(t=>{t.type==="planet"&&c(`/planets/${E(t.id)}`)},[c]);return e.jsxs("div",{className:"starsystem-container",children:[e.jsx(Z,{camera:{position:[0,u*.5,u],fov:50},style:{background:"black"},children:e.jsxs(l.Suspense,{fallback:null,children:[e.jsx("ambientLight",{intensity:.6}),e.jsx("hemisphereLight",{args:["#ffffff","#444444",.5]}),e.jsx(re,{count:3e3}),n.map(t=>e.jsx(te,{body:t,isHovered:(a==null?void 0:a.id)===t.id,onHover:x,onClick:f},t.id)),n.filter(t=>t.type==="planet").map(t=>e.jsx(A,{radius:t.orbitRadius,eccentricity:t.orbitEccentricity,isHighlighted:(a==null?void 0:a.id)===t.id},`orbit-${t.id}`)),n.filter(t=>t.type==="star"&&t.orbitRadius>0).map(t=>e.jsx(A,{radius:t.orbitRadius,eccentricity:t.orbitEccentricity,isHighlighted:(a==null?void 0:a.id)===t.id,isBinaryOrbit:!0},`orbit-${t.id}`)),e.jsx(le,{shouldAutoRotate:!a,maxDistance:u*3})]})}),e.jsx(ne,{star:s,bodies:n,hoveredBody:a,onBodyHover:t=>x(t)}),a&&a.type==="planet"&&o&&a.planetData&&e.jsxs("div",{className:"starsystem-cursor-tooltip",style:{left:o.x+20,top:o.y-10},children:[e.jsxs("div",{className:"cursor-tooltip-header",children:[e.jsx("div",{className:"cursor-tooltip-name",children:a.planetData.pl_name}),e.jsx("div",{className:"cursor-tooltip-type",children:a.planetData.planet_type})]}),e.jsxs("div",{className:"cursor-tooltip-details",children:[a.planetData.pl_rade&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Radius"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_rade.toFixed(2)," R⊕"]})]}),a.planetData.pl_bmasse&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Mass"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_bmasse.toFixed(2)," M⊕"]})]}),a.planetData.pl_orbper&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Orbital Period"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_orbper.toFixed(2)," days"]})]}),a.planetData.pl_orbsmax&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Semi-major Axis"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_orbsmax.toFixed(3)," AU"]})]}),a.planetData.pl_eqt&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Eq. Temperature"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_eqt.toFixed(0)," K"]})]}),a.planetData.disc_year&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Discovered"}),e.jsx("span",{className:"cursor-tooltip-value",children:a.planetData.disc_year})]}),a.planetData.discoverymethod&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Method"}),e.jsx("span",{className:"cursor-tooltip-value",children:a.planetData.discoverymethod})]})]}),e.jsx("div",{className:"cursor-tooltip-hint",children:"Click to view details"})]})]})}function ue(){const{t:s}=L(),{starId:m}=$(),r=z(),{getStarBySlug:c,getPlanetsByHost:a,isLoading:p}=U(),[o,h]=l.useState(!1),n=m?c(m):void 0,u=n?a(n.hostname):[],x=l.useCallback(f=>{r(`/planets/${E(f.pl_name)}`)},[r]);return p?e.jsx("div",{className:"spinner-container",children:e.jsxs("div",{className:"spinner-content",children:[e.jsx("div",{className:"spinner-orbit",children:e.jsx("div",{className:"spinner-planet"})}),e.jsx("div",{className:"spinner-text",children:s("pages.star.loading")})]})}):n?e.jsxs("div",{className:"starsystem-page",children:[e.jsxs("section",{className:"starsystem-hero-section",children:[e.jsxs("div",{className:"starsystem-hero-header",children:[e.jsx("h1",{className:"starsystem-title",children:n.hostname}),e.jsxs("p",{className:"starsystem-subtitle",children:[n.st_spectype||n.star_class||s("pages.starSystem.info.unknown"),n.distance_ly&&` • ${n.distance_ly.toFixed(2)} ly`,u.length>0&&` • ${u.length} ${u.length===1?s("pages.starSystem.info.planet"):s("pages.starSystem.info.planets")}`]})]}),e.jsx(F,{to:"/",className:"starsystem-back-button",children:s("pages.star.backToStarfield")}),e.jsx(ie,{star:n,planets:u,onPlanetClick:x})]}),e.jsx("button",{className:"starsystem-info-toggle",onClick:()=>h(!o),title:s(o?"pages.star.hideInfo":"pages.star.showInfo"),children:o?"✕":"ℹ"}),o&&e.jsx("div",{className:"starsystem-info-panel-mobile",style:{display:"flex"},onClick:()=>h(!1),children:e.jsxs("div",{className:"starsystem-info-panel-content",onClick:f=>f.stopPropagation(),children:[e.jsx("button",{className:"starsystem-info-close",onClick:()=>h(!1),children:"✕"}),e.jsx("h2",{children:n==null?void 0:n.hostname}),e.jsxs("div",{className:"starsystem-info-content",children:[e.jsxs("div",{className:"starsystem-info-row",children:[e.jsx("span",{className:"label",children:s("pages.star.distance")}),e.jsx("span",{className:"value",children:n!=null&&n.distance_ly?`${n.distance_ly.toFixed(2)} ly`:"N/A"})]}),e.jsxs("div",{className:"starsystem-info-row",children:[e.jsx("span",{className:"label",children:s("pages.star.planets")}),e.jsx("span",{className:"value",children:u.length})]}),(n==null?void 0:n.star_class)&&e.jsxs("div",{className:"starsystem-info-row",children:[e.jsx("span",{className:"label",children:s("pages.star.spectralType")}),e.jsx("span",{className:"value",children:n.star_class})]})]})]})})]}):e.jsx("div",{className:"error-container",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h1",{className:"error-title",children:s("pages.star.notFound.title")}),e.jsx("p",{className:"error-message",children:s("pages.star.notFound.message",{starId:m||""})}),e.jsx(F,{to:"/",className:"starsystem-back-link",children:s("pages.star.notFound.returnToStarfield")})]})})}export{ue as default};
