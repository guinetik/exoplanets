import{u as D,r as d,j as e}from"./index-UIUtINQF.js";import"./reviewService-DiqmSUie.js";import"./pollService-C-kA7Hzz.js";const k="buEpNbTXwpkoPmCnvOBpGbDZgr5x5JgdmPoD8sfQ",T="https://api.nasa.gov/planetary/apod";class S{formatDate(a){return a.toISOString().split("T")[0]}async fetchApod(a){var n,t;const o=a??this.formatDate(new Date);try{const i=await fetch(`${T}?api_key=${k}&date=${o}`);if(!i.ok){const l=await i.json();return{error:!0,code:i.status,message:l.msg||((n=l.error)==null?void 0:n.message)||`HTTP ${i.status}`}}const r=await i.json();return r.code||r.error?{error:!0,code:r.code||500,message:r.msg||((t=r.error)==null?void 0:t.message)||"Unknown error"}:{error:!1,data:{title:r.title,explanation:r.explanation,url:r.url,hdurl:r.hdurl,date:r.date,copyright:r.copyright,mediaType:r.media_type}}}catch(i){return{error:!0,code:500,message:i instanceof Error?i.message:"Network error"}}}isYouTubeUrl(a){return a.includes("youtube.com")||a.includes("youtu.be")}getYouTubeEmbedUrl(a){const o=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,n=a.match(o),t=n&&n[2].length===11?n[2]:null;return t?`https://www.youtube.com/embed/${t}`:a}isVideo(a){return/\.(mp4|webm|ogg)$/i.test(a)||this.isYouTubeUrl(a)}getMediaType(a,o){return this.isYouTubeUrl(a)?"youtube":o==="video"||this.isVideo(a)?"video":"image"}}const u=new S;function U(){const{t:c}=D(),a=()=>{const s=new Date;return s.setHours(12,0,0,0),s},[o,n]=d.useState(a),[t,i]=d.useState(null),[r,l]=d.useState(!0),[x,f]=d.useState(null),[g,j]=d.useState(!1),v=u.formatDate(a()),p=d.useCallback(async s=>{l(!0),f(null);const N=u.formatDate(s),m=await u.fetchApod(N);if(m.error){if(m.code===404){const h=new Date(s);h.setDate(h.getDate()-1),n(h),p(h);return}f(m.message),l(!1);return}i(m.data),l(!1)},[]),y=d.useCallback(()=>{const s=new Date(o);s.setDate(s.getDate()-1),n(s),j(!0),p(s)},[o,p]),b=d.useCallback(()=>{if(!g)return;const s=new Date(o);s.setDate(s.getDate()+1),n(s),j(u.formatDate(s)!==v),p(s)},[o,g,v,p]);d.useEffect(()=>{p(o),window.scrollTo({top:0,behavior:"smooth"})},[]);const w=()=>{if(!t)return null;switch(u.getMediaType(t.url,t.mediaType)){case"youtube":return e.jsx("div",{className:"apod-video-container",children:e.jsx("iframe",{className:"apod-iframe",src:u.getYouTubeEmbedUrl(t.url),allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:t.title})});case"video":return e.jsxs("video",{className:"apod-video",controls:!0,autoPlay:!0,muted:!0,loop:!0,children:[e.jsx("source",{src:t.url,type:`video/${t.url.split(".").pop()}`}),c("pages.apod.videoNotSupported")]});default:return e.jsx("a",{href:t.hdurl||t.url,target:"_blank",rel:"noopener noreferrer",title:c("pages.apod.viewFullSize"),children:e.jsx("img",{className:"apod-image",src:t.url,alt:t.title})})}};return e.jsxs("div",{className:"page-container",children:[e.jsx("h1",{className:"page-title",children:c("pages.apod.title")}),r&&e.jsxs("div",{className:"apod-loading",children:[e.jsx("div",{className:"apod-loading-spinner"}),e.jsx("p",{className:"apod-loading-text",children:c("pages.apod.loading")})]}),x&&!r&&e.jsxs("div",{className:"apod-error",children:[e.jsx("p",{className:"apod-error-text",children:c("pages.apod.error")}),e.jsx("p",{className:"apod-error-detail",children:x})]}),t&&!r&&e.jsxs("div",{className:"apod-content",children:[e.jsx("div",{className:"apod-media-wrapper",children:e.jsxs("figure",{className:"apod-figure",children:[w(),t.copyright&&e.jsxs("figcaption",{className:"apod-copyright",children:["Â© ",t.copyright]})]})}),e.jsxs("div",{className:"apod-info",children:[e.jsxs("h2",{className:"apod-info-title",children:[e.jsx("span",{className:"apod-date",children:t.date}),e.jsx("span",{className:"apod-name",children:t.title})]}),e.jsx("p",{className:"apod-explanation",children:t.explanation})]}),e.jsxs("div",{className:"apod-navigation",children:[e.jsxs("button",{onClick:y,className:"apod-nav-button",children:[e.jsx(E,{}),e.jsx("span",{children:c("pages.apod.yesterday")})]}),e.jsxs("button",{onClick:b,disabled:!g,className:"apod-nav-button",children:[e.jsx("span",{children:c("pages.apod.tomorrow")}),e.jsx(A,{})]})]})]})]})}function E(){return e.jsx("svg",{className:"apod-nav-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}function A(){return e.jsx("svg",{className:"apod-nav-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}export{U as default};
