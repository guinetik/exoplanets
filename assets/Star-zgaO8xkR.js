import{r as n,Q as Ae,g as Y,f as ke,C as z,V as Z,j as e,D as we,A as se,s as L,h as ze,i as He,k as Ge,l as Ye,m as Ve,o as $e,p as qe,q as We,F as Ze,t as Ke,b as Oe,v as Xe,w as Qe,x as Je,y as Le,M as Be,u as H,z as et,d as tt,c as st,n as at,L as Ne}from"./index-B2LdEqhF.js";import{a as V,C as rt,u as it}from"./react-three-fiber.esm-DM0_awdn.js";import{c as nt,T as lt,E as O,u as ae}from"./ExplainableProperty-tZfZFsIc.js";import{_ as ct,O as ot,t as mt,c as ut,i as pt,a as B,l as ht,s as re,b as dt,d as Pe,m as ft,e as fe,f as Ce,g as pe,h as he}from"./transform-6Eq3vFto.js";import{g as vt,a as xt}from"./habitabilityAnalytics-CzP9HgSM.js";const Se=n.forwardRef(function({children:r,follow:s=!0,lockX:i=!1,lockY:a=!1,lockZ:c=!1,...m},x){const p=n.useRef(null),v=n.useRef(null),o=new Ae;return V(({camera:d})=>{if(!s||!v.current)return;const l=p.current.rotation.clone();v.current.updateMatrix(),v.current.updateWorldMatrix(!1,!1),v.current.getWorldQuaternion(o),d.getWorldQuaternion(p.current.quaternion).premultiply(o.invert()),i&&(p.current.rotation.x=l.x),a&&(p.current.rotation.y=l.y),c&&(p.current.rotation.z=l.z)}),n.useImperativeHandle(x,()=>v.current,[]),n.createElement("group",ct({ref:v},m),n.createElement("group",{ref:p},r))}),W=4,ie=8;function gt({starRadius:t,starColor:r,starSeed:s,activityLevel:i}){const a=n.useRef([]),c=n.useRef([]),m=n.useRef(new Array(W).fill(-1e3)),x=n.useRef(i);x.current=i;const p=n.useMemo(()=>{const f=[];for(let u=0;u<W;u++){const h=s+u*.1;f.push({angle:Y(`${h}-angle`)*Math.PI*2,elevation:(Y(`${h}-elev`)-.5)*Math.PI*.8,phase:Y(`${h}-phase`)*Math.PI*2,speed:.7+Y(`${h}-speed`)*.6,size:.8+Y(`${h}-size`)*.4})}return f},[s]),v=n.useMemo(()=>ke(),[]),o=n.useMemo(()=>p.map(f=>({uStarColor:{value:new z(r)},uTime:{value:0},uFlarePhase:{value:0},uFlareLength:{value:t*.8*f.size},uFlareSeed:{value:f.phase}})),[r,t,p]),d=n.useCallback(f=>{const u=performance.now()/1e3;if(f!==void 0&&f>=0&&f<W)m.current[f]=u,console.log(`ðŸ”¥ Triggered flare ${f}`);else{const h=Math.floor(Math.random()*W);m.current[h]=u,console.log(`ðŸ”¥ Triggered random flare ${h}`)}},[]),l=n.useCallback(()=>{const f=performance.now()/1e3;for(let u=0;u<W;u++)m.current[u]=f+u*.2;console.log("ðŸ”¥ðŸ”¥ðŸ”¥ Triggered ALL flares!")},[]);n.useEffect(()=>(console.log("ðŸŒŸ SolarFlares component mounting..."),console.log(`   Star radius: ${t}, Activity: ${i}`),window.solarFlares={trigger:d,triggerAll:l,setActivity:f=>{console.log(`Activity level set to ${f} (only affects new cycles)`)},status:()=>{console.log("Solar Flares Status:"),console.log(`  - Number of flares: ${W}`),console.log(`  - Activity level: ${x.current}`),console.log(`  - Cycle duration: ${ie}s`),console.log(`  - Star radius: ${t}`),console.log("Commands:"),console.log("  solarFlares.trigger()      - Trigger random flare"),console.log("  solarFlares.trigger(0-3)   - Trigger specific flare"),console.log("  solarFlares.triggerAll()   - Trigger all flares")}},console.log("âœ… Solar flares ready! Type solarFlares.status() for commands"),()=>{console.log("ðŸŒŸ SolarFlares component unmounting..."),delete window.solarFlares}),[d,l,t,i]),V(f=>{const u=f.clock.elapsedTime,h=performance.now()/1e3;p.forEach((j,g)=>{const _=c.current[g];if(!_)return;const T=m.current[g],y=h-T,N=3;let b=0;if(y>=0&&y<N)b=y/N,b=Math.sin(b*Math.PI);else{const E=(u*j.speed+j.phase)%ie/ie,P=1-x.current*.6;b=E>P?(E-P)/(1-P):0}_.uniforms.uTime.value=u,_.uniforms.uFlarePhase.value=b})});const S=n.useMemo(()=>p.map(f=>{const u=Math.cos(f.elevation)*Math.cos(f.angle),h=Math.sin(f.elevation),j=Math.cos(f.elevation)*Math.sin(f.angle),g=new Z(u,h,j).multiplyScalar(t*1.05),_=g.clone().normalize(),T=new Ae;return T.setFromUnitVectors(new Z(0,1,0),_),{position:g,quaternion:T}}),[p,t]);return e.jsx("group",{children:p.map((f,u)=>e.jsxs("mesh",{ref:h=>a.current[u]=h,position:S[u].position,quaternion:S[u].quaternion,children:[e.jsx("planeGeometry",{args:[t*.3*f.size,t*1.5*f.size]}),e.jsx("shaderMaterial",{ref:h=>c.current[u]=h,vertexShader:L.get(v.vert),fragmentShader:L.get(v.frag),uniforms:o[u],transparent:!0,depthWrite:!1,blending:se,side:we})]},u))})}const je=.15,_e={CLOSE_THRESHOLD_MULTIPLIER:4,FAR_THRESHOLD_MULTIPLIER:20},D={RAY_STAR_RADIUS:.125,GLOW_SIZE_MULTIPLIER:1.8,RAYS_SIZE_MULTIPLIER:4,CORONA_SCALE_MULTIPLIER:1.5,PRIMARY_LIGHT_INTENSITY:2,COMPANION_LIGHT_INTENSITY:1.5,PRIMARY_LIGHT_DISTANCE:50,COMPANION_LIGHT_DISTANCE:40},Q={INNER_RADIUS_MULTIPLIER:.6,OUTER_RADIUS_MULTIPLIER:1.3,BASE_ROTATION_X:Math.PI/2},de={MAX_ECCENTRICITY:.99};function yt(t,r,s,i){const a=r*.3-.15;return{base:nt(t,r),density:s,insolation:i,variation:a}}function Nt(t){return t?Math.min(t/300,1):.5}function St(t){return t?Math.min(t/2,1):.5}function jt(t,r){const s=r*_e.CLOSE_THRESHOLD_MULTIPLIER,i=r*_e.FAR_THRESHOLD_MULTIPLIER;return 1-Math.min(1,Math.max(0,(t-s)/(i-s)))}function _t({body:t,isHovered:r,onHover:s,onClick:i,onPositionUpdate:a}){const c=n.useRef(null),m=n.useRef(null),x=n.useRef(null),p=n.useRef(null),v=n.useRef(Math.random()*Math.PI*2),o=n.useContext(ve),d=n.useMemo(()=>Y(t.id??t.name),[t.id,t.name]),l=n.useMemo(()=>ze(t.spectralType),[t.spectralType]),S=n.useMemo(()=>({uStarColor:{value:new z(t.color)},uTime:{value:0},uTemperature:{value:t.temperature??5778},uSeed:{value:d},uActivityLevel:{value:l}}),[t.color,t.temperature,d,l]),f=n.useRef(null),u=n.useMemo(()=>({uStarColor:{value:new z(t.color)},uTime:{value:0},uIntensity:{value:t.emissiveIntensity??1},uSeed:{value:d},uActivityLevel:{value:l}}),[t.color,t.emissiveIntensity,d,l]),h=n.useRef(null),j=n.useMemo(()=>({uStarColor:{value:new z(t.color)},uTime:{value:0},uTemperature:{value:t.temperature??5778},uSeed:{value:d},uActivityLevel:{value:l},uStarRadius:{value:D.RAY_STAR_RADIUS}}),[t.color,t.temperature,d,l]),g=n.useMemo(()=>t.planetData?{...He({planet:t.planetData,detailLevel:"detailed",starTemp:t.planetData.st_teff??void 0,showTerminator:!1}),uZoomLevel:{value:0},uBodyDiameter:{value:t.diameter}}:{uBaseColor:{value:new z(t.color)},uTime:{value:0},uTemperature:{value:t.temperature??300},uHasAtmosphere:{value:t.hasAtmosphere??.5},uSeed:{value:Math.random()},uDensity:{value:.5},uInsolation:{value:.5},uStarTemp:{value:5778},uDetailLevel:{value:1},uEnableTerminator:{value:0},uColorTempFactor:{value:.5},uColorCompositionFactor:{value:.5},uColorIrradiationFactor:{value:.5},uColorMetallicityFactor:{value:.5},uZoomLevel:{value:0},uBodyDiameter:{value:t.diameter}},[t.planetData,t.color,t.temperature,t.hasAtmosphere,t.diameter]),_=n.useMemo(()=>t.planetData?Ge(t.planetData):"rocky",[t.planetData]),T=n.useMemo(()=>Ye(_),[_]),y=n.useMemo(()=>Ve("v2"),[]),N=n.useMemo(()=>$e("v2"),[]),b=n.useMemo(()=>qe(),[]),C=n.useMemo(()=>We(),[]),E=n.useRef(null),P=n.useMemo(()=>{var q,xe,ge,ye;const R=t.id?Y(t.id):Math.random(),A=Nt((q=t.planetData)==null?void 0:q.pl_bmasse),w=St((xe=t.planetData)==null?void 0:xe.pl_insol),I=((ge=t.planetData)==null?void 0:ge.pl_eqt)??((ye=t.planetData)!=null&&ye.pl_insol?Math.sqrt(t.planetData.pl_insol)*255:150),U=yt(I,R,A,w).base,k=t.diameter*Q.INNER_RADIUS_MULTIPLIER,X=t.diameter*Q.OUTER_RADIUS_MULTIPLIER;return{uBaseColor:{value:U},uRingColor:{value:U},uTime:{value:0},uSeed:{value:R},uDensity:{value:A},uInsolation:{value:w},uInnerRadius:{value:k},uOuterRadius:{value:X}}},[t.id,t.planetData,t.diameter]);V((R,A)=>{if(t.type==="planet"&&c.current&&t.orbitPeriod>0&&(v.current+=Math.PI*2*A*je/(t.orbitPeriod/60)),t.type==="star"&&t.orbitRadius>0&&c.current&&t.orbitPeriod>0&&(v.current+=Math.PI*2*A*je*2/(t.orbitPeriod/60)),t.type==="planet"&&c.current){const I=Math.min(Math.max(t.orbitEccentricity||0,0),de.MAX_ECCENTRICITY),M=t.orbitRadius,U=M*Math.sqrt(1-I*I),k=M*I,X=M*Math.cos(v.current)-k,q=U*Math.sin(v.current);c.current.position.x=X,c.current.position.z=q}if(t.type==="star"&&t.orbitRadius>0&&c.current){const I=Math.min(Math.max(t.orbitEccentricity||0,0),de.MAX_ECCENTRICITY),M=t.orbitRadius,U=M*Math.sqrt(1-I*I),k=t.isCompanionStar?Math.PI:0,X=M*Math.cos(v.current+k),q=U*Math.sin(v.current+k);c.current.position.x=X,c.current.position.z=q}c.current&&a&&a(t.id,c.current.position),m.current&&(m.current.rotation.x=t.axialTilt,t.isTidallyLocked&&t.type==="planet"?m.current.rotation.y=-v.current+Math.PI:m.current.rotation.y+=A*t.rotationSpeed);const w=R.clock.elapsedTime;if(t.type==="star")x.current&&(x.current.uniforms.uTime.value=w),f.current&&(f.current.uniforms.uTime.value=w),h.current&&(h.current.uniforms.uTime.value=w);else if(t.type==="planet"){if(p.current&&(p.current.uniforms.uTime.value=w,o&&c.current)){const I=o.cameraDistance.current,M=c.current.position,U=Math.sqrt(Math.pow(M.x,2)+Math.pow(M.y-I*.4,2)+Math.pow(M.z-I,2)),k=jt(U,t.diameter);p.current.uniforms.uZoomLevel.value=k}E.current&&(E.current.uniforms.uTime.value=w)}});const $=r?1.3:1;if(t.type==="star"){const R=t.diameter/2,A=e.jsxs(e.Fragment,{children:[e.jsx("pointLight",{position:[0,0,0],color:t.color,intensity:t.isCompanionStar?D.COMPANION_LIGHT_INTENSITY:D.PRIMARY_LIGHT_INTENSITY,distance:t.isCompanionStar?D.COMPANION_LIGHT_DISTANCE:D.PRIMARY_LIGHT_DISTANCE}),e.jsx(Se,{children:e.jsxs("mesh",{children:[e.jsx("planeGeometry",{args:[t.diameter*D.GLOW_SIZE_MULTIPLIER,t.diameter*D.GLOW_SIZE_MULTIPLIER]}),e.jsx("shaderMaterial",{transparent:!0,depthWrite:!1,blending:se,uniforms:{uColor:{value:new z(t.color)},uIntensity:{value:t.emissiveIntensity??1}},vertexShader:`
                varying vec2 vUv;
                void main() {
                  vUv = uv;
                  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
              `,fragmentShader:`
                uniform vec3 uColor;
                uniform float uIntensity;
                varying vec2 vUv;
                void main() {
                  vec2 center = vUv - 0.5;
                  float dist = length(center) * 2.0;
                  // Start glow from edge of star (around 0.55 radius in UV space)
                  float glow = 1.0 - smoothstep(0.55, 1.0, dist);
                  // Clamp intensity: min 0.7, max 1.8 to prevent huge glows
                  float clampedIntensity = clamp(uIntensity, 0.7, 1.8);
                  glow = pow(glow, 2.5) * clampedIntensity * 0.35;
                  gl_FragColor = vec4(uColor, glow);
                }
              `})]})}),e.jsxs("mesh",{ref:m,children:[e.jsx("sphereGeometry",{args:[t.diameter/2,64,64]}),e.jsx("shaderMaterial",{ref:x,vertexShader:L.get(y.vert),fragmentShader:L.get(y.frag),uniforms:S})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[R*D.CORONA_SCALE_MULTIPLIER,64,64]}),e.jsx("shaderMaterial",{ref:f,vertexShader:L.get(N.vert),fragmentShader:L.get(N.frag),uniforms:u,transparent:!0,depthWrite:!1,blending:se,side:Ze})]}),e.jsx(gt,{starRadius:R,starColor:t.color,starSeed:d,activityLevel:l}),e.jsx(Se,{children:e.jsxs("mesh",{children:[e.jsx("planeGeometry",{args:[t.diameter*D.RAYS_SIZE_MULTIPLIER,t.diameter*D.RAYS_SIZE_MULTIPLIER]}),e.jsx("shaderMaterial",{ref:h,vertexShader:L.get(b.vert),fragmentShader:L.get(b.frag),uniforms:j,transparent:!0,depthWrite:!1,blending:se})]})})]});return t.orbitRadius>0?e.jsx("group",{ref:c,children:A}):e.jsx("group",{ref:c,children:A})}return e.jsxs("group",{ref:c,children:[e.jsxs("mesh",{ref:m,scale:[$,$,$],onPointerOver:R=>{var I,M;R.stopPropagation(),document.body.style.cursor="pointer";const A=R.clientX??((I=R.nativeEvent)==null?void 0:I.clientX),w=R.clientY??((M=R.nativeEvent)==null?void 0:M.clientY);s(t,A&&w?{x:A,y:w}:void 0)},onPointerMove:R=>{var A,w;if(r){const I=R.clientX??((A=R.nativeEvent)==null?void 0:A.clientX),M=R.clientY??((w=R.nativeEvent)==null?void 0:w.clientY);I&&M&&s(t,{x:I,y:M})}},onPointerOut:R=>{R.stopPropagation(),document.body.style.cursor="grab",s(null)},onClick:R=>{R.stopPropagation(),i==null||i(t)},children:[e.jsx("sphereGeometry",{args:[t.diameter/2,48,48]}),e.jsx("shaderMaterial",{ref:p,vertexShader:L.get(Ke("v2")),fragmentShader:L.get(T),uniforms:g})]}),t.hasRings&&e.jsxs("mesh",{rotation:[Q.BASE_ROTATION_X+t.axialTilt,0,0],children:[e.jsx("ringGeometry",{args:[t.diameter*Q.INNER_RADIUS_MULTIPLIER,t.diameter*Q.OUTER_RADIUS_MULTIPLIER,64]}),e.jsx("shaderMaterial",{ref:E,vertexShader:L.get(C.vert),fragmentShader:L.get(C.frag),uniforms:P,transparent:!0,depthWrite:!1,side:we})]}),r&&e.jsxs("mesh",{scale:[1.4,1.4,1.4],children:[e.jsx("sphereGeometry",{args:[t.diameter/2,24,24]}),e.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.15,side:Oe})]})]})}const Ee={FADE_DURATION:2.2,FADE_EASING_POWER:3},ne={SEGMENTS:128,FULL_CIRCLE:Math.PI*2,ECCENTRICITY_THRESHOLD:.1},ee={highlighted:{color:"#ffffff",opacity:.8},binaryOrbit:{color:"#ffaa44",opacity:.5},eccentricPlanet:{color:"#aaaaff",opacity:.45},circularPlanet:{color:"#888888",opacity:.3}};function Et(t,r,s){return t?ee.highlighted:r?ee.binaryOrbit:s?ee.eccentricPlanet:ee.circularPlanet}function Re({radius:t,eccentricity:r=0,isHighlighted:s,isBinaryOrbit:i=!1}){const a=n.useRef(null),c=n.useRef(null),[m,x]=n.useState(!1),p=Math.min(Math.max(r,0),de.MAX_ECCENTRICITY),v=t,o=v*Math.sqrt(1-p*p),d=i?0:v*p,l=p>ne.ECCENTRICITY_THRESHOLD,S=n.useMemo(()=>{const f=ne.SEGMENTS,u=[];for(let g=0;g<=f;g++){const _=g/f*ne.FULL_CIRCLE,T=v*Math.cos(_)-d,y=o*Math.sin(_);u.push(new Z(T,0,y))}const h=new Xe().setFromPoints(u),j=new Qe({transparent:!0,depthWrite:!1});return new Je(h,j)},[v,o,d]);return V(f=>{if(!a.current)return;const u=a.current.material;c.current===null&&(c.current=f.clock.elapsedTime);let h=1;if(!m){const g=f.clock.elapsedTime-c.current,_=Math.min(g/Ee.FADE_DURATION,1);h=1-Math.pow(1-_,Ee.FADE_EASING_POWER),_>=1&&x(!0)}const j=Et(s,i,l);u.color.set(j.color),u.opacity=j.opacity*h}),e.jsx("primitive",{ref:a,object:S})}const Te={FADE_DURATION:2.5,FADE_EASING_POWER:3},Ie={WIDTH_SEGMENTS:64,HEIGHT_SEGMENTS:32},Rt={THEME_COUNT:6},Tt={bluePurple:{primary:{hue:.7,saturation:.6,lightness:.5,hueVariation:.1},secondary:{hue:.8,saturation:.5,lightness:.4,hueVariation:.05}},redOrange:{primary:{hue:0,saturation:.7,lightness:.5,hueVariation:.05},secondary:{hue:.05,saturation:.6,lightness:.4,hueVariation:.05}},tealCyan:{primary:{hue:.5,saturation:.5,lightness:.5,hueVariation:.05},secondary:{hue:.55,saturation:.4,lightness:.4,hueVariation:.05}},greenYellow:{primary:{hue:.25,saturation:.5,lightness:.45,hueVariation:.1},secondary:{hue:.15,saturation:.4,lightness:.4,hueVariation:.1}},pinkMagenta:{primary:{hue:.9,saturation:.6,lightness:.55,hueVariation:.05},secondary:{hue:.85,saturation:.5,lightness:.45,hueVariation:.05}},blueViolet:{primary:{hue:.65,saturation:.4,lightness:.35,hueVariation:.1},secondary:{hue:.7,saturation:.3,lightness:.3,hueVariation:.1}}};function It(t){const r=Math.floor(t*Rt.THEME_COUNT),s=Object.values(Tt),i=s[Math.min(r,s.length-1)];return{primary:new z().setHSL(i.primary.hue+t*i.primary.hueVariation,i.primary.saturation,i.primary.lightness),secondary:new z().setHSL(i.secondary.hue+t*i.secondary.hueVariation,i.secondary.saturation,i.secondary.lightness)}}function Mt(t){let r=0;for(let s=0;s<t.length;s++){const i=t.charCodeAt(s);r=(r<<5)-r+i,r=r&r}return Math.abs(r%1e4)/1e4}function bt({systemName:t,density:r=.3,radius:s=400}){const i=n.useRef(null),a=n.useMemo(()=>Mt(t),[t]),c=n.useMemo(()=>It(a),[a]),m=n.useRef(null),[x,p]=n.useState(!1),v=n.useMemo(()=>({uTime:{value:0},uSeed:{value:a},uDensity:{value:r},uOpacity:{value:0},uPrimaryColor:{value:c.primary},uSecondaryColor:{value:c.secondary}}),[a,r,c]);return V(o=>{if(i.current&&(i.current.uniforms.uTime.value=o.clock.elapsedTime,m.current===null&&(m.current=o.clock.elapsedTime),!x)){const d=o.clock.elapsedTime-m.current,l=Math.min(d/Te.FADE_DURATION,1),S=1-Math.pow(1-l,Te.FADE_EASING_POWER);i.current.uniforms.uOpacity.value=S,l>=1&&p(!0)}}),r<=0?null:e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[s,Ie.WIDTH_SEGMENTS,Ie.HEIGHT_SEGMENTS]}),e.jsx("shaderMaterial",{ref:i,vertexShader:L.get("v2NebulaVert"),fragmentShader:L.get("v2NebulaFrag"),uniforms:v,transparent:!0,side:Oe,depthWrite:!1})]})}const F={COUNT:3e3,SPHERE_RADIUS:500,POINT_SIZE:1.5,COLOR:16777215,INITIAL_OPACITY:0,TARGET_OPACITY:.6,FADE_DURATION:2,FADE_EASING_POWER:3},te={AMBIENT_INTENSITY:.6,HEMISPHERE_SKY_COLOR:"#ffffff",HEMISPHERE_GROUND_COLOR:"#444444",HEMISPHERE_INTENSITY:.5},K={ASPECT_RATIO:1.5,FOV:50,MIN_DISTANCE:2,INITIAL_Y_MULTIPLIER:.5},le={MULTIPLIER_DELTA_THRESHOLD:.01,ADJUSTMENT_STOP_THRESHOLD:.001,RESPONSIVE_LERP:.1},G={PROGRESS_RAMP_UP:3,OFFSET_DISTANCE_MULTIPLIER:4,Y_OFFSET_MULTIPLIER:.4,BASE_LERP:.06,FOLLOW_LERP:.12,TARGET_LERP_MULTIPLIER:1.5},J={PROGRESS_RAMP_DOWN:2,CAMERA_RETURN_LERP:.03,TARGET_RETURN_LERP:.03,RESIZE_ADJUST_LERP:.02,RESIZE_TARGET_LERP:.02},At={SPEED:.1},ce={STAR_SIZE_MULTIPLIER:4,ORBITS_MULTIPLIER:2.5,MAX_DISTANCE_MULTIPLIER:3},Me={DENSITY:.7,RADIUS:480},wt={BACKGROUND_COLOR:"black"},De=n.createContext(null),ve=n.createContext(null);function Ot({count:t=F.COUNT}){const r=n.useRef(null),s=n.useRef(null),[i,a]=n.useState(!1),c=n.useMemo(()=>{const m=new Float32Array(t*3);for(let x=0;x<t;x++){const p=Math.random()*Math.PI*2,v=Math.acos(2*Math.random()-1),o=F.SPHERE_RADIUS;m[x*3]=o*Math.sin(v)*Math.cos(p),m[x*3+1]=o*Math.sin(v)*Math.sin(p),m[x*3+2]=o*Math.cos(v)}return m},[t]);return V(m=>{if(r.current&&(s.current===null&&(s.current=m.clock.elapsedTime),!i)){const x=m.clock.elapsedTime-s.current,p=Math.min(x/F.FADE_DURATION,1),v=(1-Math.pow(1-p,F.FADE_EASING_POWER))*F.TARGET_OPACITY;r.current.opacity=v,p>=1&&a(!0)}}),e.jsxs("points",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:t,array:c,itemSize:3})}),e.jsx("pointsMaterial",{ref:r,size:F.POINT_SIZE,color:F.COLOR,transparent:!0,opacity:F.INITIAL_OPACITY,sizeAttenuation:!1})]})}function Fe(t){return K.ASPECT_RATIO/t}function Lt({shouldAutoRotate:t,maxDistance:r,focusedBody:s,baseCameraDistance:i}){const a=n.useRef(null),{camera:c,viewport:m}=it(),x=n.useContext(De),p=n.useContext(ve),v=n.useRef(new Z(0,0,0)),o=n.useRef(!1),d=n.useRef(0),l=n.useRef(1),S=n.useRef(!1);return V((f,u)=>{if(!a.current)return;p&&(p.cameraDistance.current=c.position.length());const h=m.width/m.height,j=Fe(h),g=Math.abs(j-l.current);g>le.MULTIPLIER_DELTA_THRESHOLD&&(S.current=!0);const _=i*j,T=new Z(0,_*K.INITIAL_Y_MULTIPLIER,_);if(l.current=Be.lerp(l.current,j,le.RESPONSIVE_LERP),g<le.ADJUSTMENT_STOP_THRESHOLD&&(S.current=!1),s&&x){const y=x.positions.current.get(s.id);if(y){o.current=!0,d.current=Math.min(d.current+u*G.PROGRESS_RAMP_UP,1);const N=s.diameter*G.OFFSET_DISTANCE_MULTIPLIER,b=new Z(y.x,y.y+N*G.Y_OFFSET_MULTIPLIER,y.z+N),C=G.BASE_LERP+d.current*(G.FOLLOW_LERP-G.BASE_LERP);c.position.lerp(b,C),a.current.target.lerp(y,C*G.TARGET_LERP_MULTIPLIER),a.current.update()}}else o.current||d.current>0?(d.current=Math.max(d.current-u*J.PROGRESS_RAMP_DOWN,0),c.position.lerp(T,J.CAMERA_RETURN_LERP),a.current.target.lerp(v.current,J.TARGET_RETURN_LERP),a.current.update(),d.current<=0&&(o.current=!1)):S.current?(c.position.lerp(T,J.RESIZE_ADJUST_LERP),a.current.target.lerp(v.current,J.RESIZE_TARGET_LERP),a.current.update()):t&&(a.current.setAzimuthalAngle(a.current.getAzimuthalAngle()+u*At.SPEED),a.current.update())}),e.jsx(ot,{ref:a,enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:K.MIN_DISTANCE,maxDistance:r,autoRotate:!1})}function Pt({star:t,planets:r,hoveredBody:s,focusedBody:i,onBodyHover:a,onBodyClick:c,onBackgroundClick:m}){const x=n.useRef(new Map),p=n.useRef(100),v=n.useMemo(()=>({positions:x,registerPosition:(h,j)=>{x.current.set(h,j.clone())}}),[]),o=n.useMemo(()=>({cameraDistance:p}),[]),d=n.useMemo(()=>Le(t,r),[t,r]),l=n.useMemo(()=>{const h=Math.max(...d.map(y=>y.orbitRadius),10),j=d.find(y=>y.type==="star"),_=((j==null?void 0:j.diameter)??3)*ce.STAR_SIZE_MULTIPLIER,T=h*ce.ORBITS_MULTIPLIER;return Math.max(_,T)},[d]),S=n.useMemo(()=>{const h=typeof window<"u"?window.innerWidth/window.innerHeight:K.ASPECT_RATIO,j=Fe(h);return l*j},[l]),f=n.useCallback((h,j)=>{a==null||a(h,j)},[a]),u=n.useCallback(h=>{c==null||c(h)},[c]);return e.jsx("div",{className:"starsystem-container",children:e.jsx(rt,{camera:{position:[0,S*K.INITIAL_Y_MULTIPLIER,S],fov:K.FOV},style:{background:wt.BACKGROUND_COLOR},onPointerMissed:()=>m==null?void 0:m(),children:e.jsx(ve.Provider,{value:o,children:e.jsx(De.Provider,{value:v,children:e.jsxs(n.Suspense,{fallback:null,children:[e.jsx("ambientLight",{intensity:te.AMBIENT_INTENSITY}),e.jsx("hemisphereLight",{args:[te.HEMISPHERE_SKY_COLOR,te.HEMISPHERE_GROUND_COLOR,te.HEMISPHERE_INTENSITY]}),e.jsx(Ot,{count:F.COUNT}),e.jsx(bt,{systemName:t.hostname,density:Me.DENSITY,radius:Me.RADIUS}),d.map(h=>e.jsx(_t,{body:h,isHovered:(s==null?void 0:s.id)===h.id,onHover:f,onClick:u,onPositionUpdate:v.registerPosition},h.id)),d.filter(h=>h.type==="planet").map(h=>e.jsx(Re,{radius:h.orbitRadius,eccentricity:h.orbitEccentricity,isHighlighted:(s==null?void 0:s.id)===h.id},`orbit-${h.id}`)),d.filter(h=>h.type==="star"&&h.orbitRadius>0).map(h=>e.jsx(Re,{radius:h.orbitRadius,eccentricity:h.orbitEccentricity,isHighlighted:(s==null?void 0:s.id)===h.id,isBinaryOrbit:!0},`orbit-${h.id}`)),e.jsx(Lt,{shouldAutoRotate:!s&&!i,maxDistance:l*ce.MAX_DISTANCE_MULTIPLIER,focusedBody:i,baseCameraDistance:l})]})})})})})}function Ct({bodies:t,hoveredBody:r,focusedBody:s,onBodyHover:i,onBodyClick:a,isBinarySystem:c=!1}){const{t:m}=H(),x=t.filter(l=>l.type==="star"),p=x.find(l=>l.isPrimaryStar||!l.isCompanionStar),v=x.filter(l=>l.isCompanionStar),o=t.filter(l=>l.type==="planet"),d=l=>{const S=["planet-item"];return(r==null?void 0:r.id)===l.id&&S.push("hovered"),(s==null?void 0:s.id)===l.id&&S.push("focused"),S.join(" ")};return e.jsxs("div",{className:"starsystem-planets-panel",children:[e.jsx("h2",{className:"planets-panel-title",children:m("pages.starSystem.info.planetaryBodies")}),e.jsxs("ul",{className:"planets-list",children:[p&&e.jsxs("li",{className:d(p),onMouseEnter:()=>i(p),onMouseLeave:()=>i(null),onClick:()=>a==null?void 0:a(p),children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:p.color}}),e.jsx("span",{className:"planet-name",children:p.name}),e.jsx("span",{className:"planet-type",children:m(c?"pages.starSystem.info.primaryStar":"pages.starSystem.info.star")}),(s==null?void 0:s.id)===p.id&&e.jsx("span",{className:"focus-indicator",children:"â—"})]}),v.map(l=>e.jsxs("li",{className:d(l),onMouseEnter:()=>i(l),onMouseLeave:()=>i(null),onClick:()=>a==null?void 0:a(l),children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:l.color}}),e.jsx("span",{className:"planet-name",children:l.name}),e.jsx("span",{className:"planet-type",children:m("pages.starSystem.info.companionStar")}),(s==null?void 0:s.id)===l.id&&e.jsx("span",{className:"focus-indicator",children:"â—"})]},l.id)),o.map(l=>{var S;return e.jsxs("li",{className:d(l),onMouseEnter:()=>i(l),onMouseLeave:()=>i(null),onClick:()=>a==null?void 0:a(l),children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:l.color}}),e.jsx("span",{className:"planet-name",children:l.name}),e.jsx("span",{className:"planet-type",children:((S=l.planetData)==null?void 0:S.planet_type)||m("pages.starSystem.info.planet")}),(s==null?void 0:s.id)===l.id&&e.jsx("span",{className:"focus-indicator",children:"â—"})]},l.id)})]})]})}function oe(t,r){let s,i;if(r===void 0)for(const a of t)a!=null&&(s===void 0?a>=a&&(s=i=a):(s>a&&(s=a),i<a&&(i=a)));else{let a=-1;for(let c of t)(c=r(c,++a,t))!=null&&(s===void 0?c>=c&&(s=i=c):(s>c&&(s=c),i<c&&(i=c)))}return[s,i]}function be(t){return function(r){return r<0?-Math.pow(-r,t):Math.pow(r,t)}}function Dt(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Ft(t){return t<0?-t*t:t*t}function Ut(t){var r=t(B,B),s=1;function i(){return s===1?t(B,B):s===.5?t(Dt,Ft):t(be(s),be(1/s))}return r.exponent=function(a){return arguments.length?(s=+a,i()):s},ht(r)}function Ue(){var t=Ut(mt());return t.copy=function(){return ut(t,Ue()).exponent(t.exponent())},pt.apply(t,arguments),t}function kt(){return Ue.apply(null,arguments).exponent(.5)}function zt({star:t,planets:r,isOpen:s,onClose:i}){var m,x,p,v,o;const{t:a}=H(),c=n.useMemo(()=>{const d=r.filter(g=>g.is_habitable_zone).length,l=r.filter(g=>g.is_earth_like).length,S=r.length>0?r.reduce((g,_)=>g+(_.habitability_score||0),0)/r.length:0,f=r.map(g=>g.disc_year).filter(g=>g!=null).sort((g,_)=>g-_),u=f[0],h=f[f.length-1],j=[...new Set(r.map(g=>g.discoverymethod))];return{habitableCount:d,earthLikeCount:l,avgHabitability:S,firstDiscovery:u,latestDiscovery:h,discoveryMethods:j}},[r]);return n.useEffect(()=>{const d=l=>{l.key==="Escape"&&i()};return s&&(document.addEventListener("keydown",d),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",d),document.body.style.overflow=""}},[s,i]),s?e.jsx("div",{className:"system-overview-overlay",onClick:i,children:e.jsxs("div",{className:"system-overview-modal",onClick:d=>d.stopPropagation(),children:[e.jsx("button",{className:"system-overview-close",onClick:i,children:"âœ•"}),e.jsxs("div",{className:"system-overview-content",children:[e.jsxs("header",{className:"system-overview-header",children:[e.jsx("h1",{className:"system-overview-title",children:t.hostname}),e.jsxs("div",{className:"system-overview-badges",children:[t.st_spectype&&e.jsx("span",{className:"overview-badge spectral",children:t.st_spectype}),t.sy_snum>1&&e.jsxs("span",{className:"overview-badge binary",children:["â˜…â˜… ",a("pages.starSystem.info.binarySystem")]}),t.cb_flag&&e.jsx("span",{className:"overview-badge circumbinary",children:a("pages.starSystem.info.circumbinary")})]})]}),e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.starComparison")}),e.jsx(Ht,{star:t})]}),e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.systemStats")}),e.jsxs("div",{className:"overview-stats-grid",children:[e.jsxs("div",{className:"overview-stat",children:[e.jsx("span",{className:"stat-value",children:t.sy_pnum}),e.jsx("span",{className:"stat-label",children:a("pages.starSystem.info.planets")})]}),e.jsxs("div",{className:"overview-stat",children:[e.jsx("span",{className:"stat-value",children:c.habitableCount}),e.jsx("span",{className:"stat-label",children:a("pages.starSystem.systemOverview.habitableCandidates")})]}),e.jsxs("div",{className:"overview-stat",children:[e.jsx("span",{className:"stat-value",children:((m=t.distance_ly)==null?void 0:m.toFixed(1))||"â€”"}),e.jsx("span",{className:"stat-label",children:a("pages.starSystem.systemOverview.lightYears")})]}),e.jsxs("div",{className:"overview-stat",children:[e.jsx("span",{className:"stat-value",children:t.st_age?`${t.st_age.toFixed(1)} Gyr`:"â€”"}),e.jsx("span",{className:"stat-label",children:a("pages.starSystem.info.age")})]})]})]}),e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.starFeatures.title")}),e.jsx(qt,{star:t,planets:r})]}),r.length>0&&e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.habitability.title")}),e.jsx(Wt,{planets:r})]}),t.distance_ly&&t.distance_ly>0&&e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.travelTime.title")}),e.jsx(lt,{distanceLy:t.distance_ly,compact:!0})]}),r.length>0&&e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.planetaryData")}),e.jsxs("div",{className:"overview-charts-grid",children:[e.jsxs("div",{className:"overview-chart-card",children:[e.jsx("h3",{children:a("pages.starSystem.systemOverview.planetSizes")}),e.jsx(Gt,{planets:r})]}),e.jsxs("div",{className:"overview-chart-card",children:[e.jsx("h3",{children:a("pages.starSystem.systemOverview.orbitalDistances")}),e.jsx(Yt,{planets:r})]})]})]}),r.length>0&&e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.orbitalView.title")}),e.jsxs("div",{className:"overview-charts-grid",children:[e.jsx(Qt,{star:t,planets:r}),e.jsxs("div",{className:"overview-chart-card",children:[e.jsx("h3",{children:a("pages.starSystem.systemOverview.tempSizeChart.title")}),e.jsx(Jt,{planets:r})]})]})]}),e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.skyPosition")}),e.jsxs("div",{className:"overview-position-grid",children:[e.jsxs("div",{className:"position-item",children:[e.jsx("span",{className:"position-label",children:a("pages.starSystem.systemOverview.rightAscension")}),e.jsx("span",{className:"position-value",children:t.rastr||`${(x=t.ra)==null?void 0:x.toFixed(4)}Â°`})]}),e.jsxs("div",{className:"position-item",children:[e.jsx("span",{className:"position-label",children:a("pages.starSystem.systemOverview.declination")}),e.jsx("span",{className:"position-value",children:t.decstr||`${(p=t.dec)==null?void 0:p.toFixed(4)}Â°`})]}),e.jsxs("div",{className:"position-item",children:[e.jsx("span",{className:"position-label",children:a("pages.starSystem.systemOverview.galacticLat")}),e.jsxs("span",{className:"position-value",children:[(v=t.glat)==null?void 0:v.toFixed(2),"Â°"]})]}),e.jsxs("div",{className:"position-item",children:[e.jsx("span",{className:"position-label",children:a("pages.starSystem.systemOverview.galacticLon")}),e.jsxs("span",{className:"position-value",children:[(o=t.glon)==null?void 0:o.toFixed(2),"Â°"]})]})]})]}),r.length>0&&e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.discoveryInfo")}),e.jsxs("div",{className:"overview-discovery-grid",children:[c.firstDiscovery&&e.jsxs("div",{className:"discovery-item",children:[e.jsx("span",{className:"discovery-label",children:a("pages.starSystem.systemOverview.firstDiscovery")}),e.jsx("span",{className:"discovery-value",children:c.firstDiscovery})]}),c.latestDiscovery&&c.latestDiscovery!==c.firstDiscovery&&e.jsxs("div",{className:"discovery-item",children:[e.jsx("span",{className:"discovery-label",children:a("pages.starSystem.systemOverview.latestDiscovery")}),e.jsx("span",{className:"discovery-value",children:c.latestDiscovery})]}),c.discoveryMethods.length>0&&e.jsxs("div",{className:"discovery-item full-width",children:[e.jsx("span",{className:"discovery-label",children:a("pages.starSystem.systemOverview.methods")}),e.jsx("div",{className:"discovery-methods",children:c.discoveryMethods.map(d=>e.jsx("span",{className:"method-badge",children:d},d))})]})]})]}),e.jsxs("section",{className:"overview-section",children:[e.jsx("h2",{className:"overview-section-title",children:a("pages.starSystem.systemOverview.stellarProperties")}),e.jsxs("div",{className:"overview-properties-table",children:[t.st_teff&&e.jsxs("div",{className:"property-row",children:[e.jsx("span",{className:"property-label",children:e.jsx(O,{propertyKey:"starTemperature",category:"star",children:a("pages.starSystem.info.temperature")})}),e.jsx("span",{className:"property-value",children:e.jsxs(O,{propertyKey:"starTemperature",category:"star",children:[t.st_teff.toFixed(0)," K"]})})]}),t.st_rad&&e.jsxs("div",{className:"property-row",children:[e.jsx("span",{className:"property-label",children:e.jsx(O,{propertyKey:"starRadius",category:"star",children:a("pages.starSystem.info.radius")})}),e.jsx("span",{className:"property-value",children:e.jsxs(O,{propertyKey:"starRadius",category:"star",children:[t.st_rad.toFixed(2)," Râ˜‰"]})})]}),t.st_mass&&e.jsxs("div",{className:"property-row",children:[e.jsx("span",{className:"property-label",children:e.jsx(O,{propertyKey:"starMass",category:"star",children:a("pages.starSystem.info.mass")})}),e.jsx("span",{className:"property-value",children:e.jsxs(O,{propertyKey:"starMass",category:"star",children:[t.st_mass.toFixed(2)," Mâ˜‰"]})})]}),t.st_lum&&e.jsxs("div",{className:"property-row",children:[e.jsx("span",{className:"property-label",children:e.jsx(O,{propertyKey:"starLuminosity",category:"star",children:a("pages.starSystem.systemOverview.luminosity")})}),e.jsx("span",{className:"property-value",children:e.jsxs(O,{propertyKey:"starLuminosity",category:"star",children:[t.st_lum.toFixed(3)," Lâ˜‰"]})})]}),t.st_logg&&e.jsxs("div",{className:"property-row",children:[e.jsx("span",{className:"property-label",children:e.jsx(O,{propertyKey:"starSurfaceGravity",category:"star",children:a("pages.starSystem.systemOverview.surfaceGravity")})}),e.jsx("span",{className:"property-value",children:e.jsxs(O,{propertyKey:"starSurfaceGravity",category:"star",children:[t.st_logg.toFixed(2)," log g"]})})]}),t.st_met&&e.jsxs("div",{className:"property-row",children:[e.jsx("span",{className:"property-label",children:e.jsx(O,{propertyKey:"starMetallicity",category:"star",children:a("pages.starSystem.systemOverview.metallicity")})}),e.jsx("span",{className:"property-value",children:e.jsxs(O,{propertyKey:"starMetallicity",category:"star",children:[t.st_met.toFixed(2)," [Fe/H]"]})})]}),t.st_rotp&&e.jsxs("div",{className:"property-row",children:[e.jsx("span",{className:"property-label",children:e.jsx(O,{propertyKey:"starRotationPeriod",category:"star",children:a("pages.starSystem.systemOverview.rotationPeriod")})}),e.jsx("span",{className:"property-value",children:e.jsxs(O,{propertyKey:"starRotationPeriod",category:"star",children:[t.st_rotp.toFixed(1)," days"]})})]})]})]})]})]})}):null}function Ht({star:t}){const{t:r}=H(),s=5778,i=t.st_rad||1,a=t.st_teff||5778,c=100,m=i>=1?c/i:c,x=i>=1?c:c*i,p=v=>v>3e4?"#9bb0ff":v>1e4?"#aabfff":v>7500?"#cad7ff":v>6e3?"#f8f7ff":v>5200?"#fff4e8":v>3700?"#ffd2a1":v>2400?"#ffb56c":"#ff6b35";return e.jsxs("div",{className:"star-comparison-container",children:[e.jsxs("div",{className:"star-comparison-visual",children:[e.jsxs("div",{className:"comparison-body",children:[e.jsx("div",{className:"comparison-sphere sun",style:{width:m,height:m,background:`radial-gradient(circle at 30% 30%, #fff4e8, ${p(s)})`}}),e.jsx("span",{className:"comparison-label",children:r("pages.starSystem.systemOverview.sun")}),e.jsx("span",{className:"comparison-stats",children:r("pages.starSystem.systemOverview.sunStats")})]}),e.jsx("div",{className:"comparison-vs",children:"vs"}),e.jsxs("div",{className:"comparison-body",children:[e.jsx("div",{className:"comparison-sphere star",style:{width:x,height:x,background:`radial-gradient(circle at 30% 30%, #fff, ${p(a)})`}}),e.jsx("span",{className:"comparison-label",children:t.hostname}),e.jsxs("span",{className:"comparison-stats",children:[i.toFixed(2)," Râ˜‰ â€¢ ",a.toFixed(0)," K"]})]})]}),e.jsx("div",{className:"comparison-summary",children:i>1?e.jsx("p",{children:r("pages.starSystem.systemOverview.largerThanSun",{times:i.toFixed(1)})}):i<1?e.jsx("p",{children:r("pages.starSystem.systemOverview.smallerThanSun",{pct:((1-i)*100).toFixed(0)})}):e.jsx("p",{children:r("pages.starSystem.systemOverview.similarToSun")})})]})}function Gt({planets:t}){const r=n.useRef(null),s=n.useRef(null),{width:i}=ae(s);n.useEffect(()=>{if(!r.current||!s.current||i===0)return;const c=200,m={top:20,right:20,bottom:60,left:50},x=i-m.left-m.right,p=c-m.top-m.bottom,v=re(r.current);v.selectAll("*").remove(),v.attr("width",i).attr("height",c);const o=v.append("g").attr("transform",`translate(${m.left},${m.top})`),d=t.filter(u=>u.pl_rade).map(u=>({name:u.pl_name.replace(a.hostname,"").trim()||u.pl_name,radius:u.pl_rade})).sort((u,h)=>h.radius-u.radius).slice(0,10);if(d.length===0)return;const l=dt().domain(d.map(u=>u.name)).range([0,x]).padding(.3),S=Pe().domain([0,ft(d,u=>u.radius)||1]).nice().range([p,0]);o.selectAll(".bar").data(d).join("rect").attr("x",u=>l(u.name)||0).attr("y",u=>S(u.radius)).attr("width",l.bandwidth()).attr("height",u=>p-S(u.radius)).attr("fill","#00ccff").attr("rx",3);const f=o.append("g").attr("transform",`translate(0,${p})`).call(fe(l));f.selectAll("text").attr("fill","#888").attr("font-size","10px").attr("text-anchor","end"),i<400?f.selectAll("text").attr("transform","rotate(-65)"):f.selectAll("text").attr("transform","rotate(-45)"),o.selectAll(".domain, .tick line").attr("stroke","#444"),o.append("g").call(Ce(S).ticks(5)).selectAll("text").attr("fill","#888").attr("font-size","10px"),o.append("text").attr("transform","rotate(-90)").attr("y",-35).attr("x",-p/2).attr("text-anchor","middle").attr("fill","#666").attr("font-size","11px").text("Radius (RâŠ•)"),o.append("line").attr("x1",0).attr("x2",x).attr("y1",S(1)).attr("y2",S(1)).attr("stroke","#00ff88").attr("stroke-dasharray","4,4").attr("opacity",.6),o.append("text").attr("x",x-5).attr("y",S(1)-5).attr("text-anchor","end").attr("fill","#00ff88").attr("font-size","10px").text("Earth")},[t,i]);const a=t[0];return e.jsx("div",{ref:s,className:"chart-container",children:e.jsx("svg",{ref:r})})}function Yt({planets:t}){const r=n.useRef(null),s=n.useRef(null),{width:i}=ae(s);return n.useEffect(()=>{if(!r.current||!s.current||i===0)return;const a=i<500,c=200,m={top:30,right:20,bottom:40,left:50},x=i-m.left-m.right,p=c-m.top-m.bottom,v=re(r.current);v.selectAll("*").remove(),v.attr("width",i).attr("height",c);const o=v.append("g").attr("transform",`translate(${m.left},${m.top})`),d=t.filter(f=>f.pl_orbsmax).map(f=>({name:f.pl_name,distance:f.pl_orbsmax,habitable:f.is_habitable_zone||!1})).sort((f,u)=>f.distance-u.distance);if(d.length===0)return;const l=Math.max(...d.map(f=>f.distance),1),S=pe().domain([Math.min(...d.map(f=>f.distance),.01),l*1.2]).range([0,x]);o.append("rect").attr("x",S(.95)).attr("y",0).attr("width",Math.max(0,S(1.67)-S(.95))).attr("height",p).attr("fill","rgba(0, 255, 136, 0.1)"),o.append("line").attr("x1",0).attr("x2",x).attr("y1",p/2).attr("y2",p/2).attr("stroke","#333"),o.selectAll(".planet-dot").data(d).join("circle").attr("cx",f=>S(f.distance)).attr("cy",p/2).attr("r",a?6:8).attr("fill",f=>f.habitable?"#00ff88":"#00ccff").attr("stroke","#fff").attr("stroke-width",1),o.selectAll(".planet-label").data(d).join("text").attr("x",f=>S(f.distance)).attr("y",p/2-15).attr("text-anchor","middle").attr("fill","#888").attr("font-size","9px").text(f=>f.name.split(" ").pop()||f.name),o.append("g").attr("transform",`translate(0,${p})`).call(fe(S).tickValues([.01,.1,1,10,100]).tickFormat(he(".2"))).selectAll("text").attr("fill","#888").attr("font-size","10px"),o.selectAll(".domain, .tick line").attr("stroke","#444"),o.append("text").attr("x",x/2).attr("y",p+35).attr("text-anchor","middle").attr("fill","#666").attr("font-size","11px").text("Semi-major Axis (AU)"),o.append("text").attr("x",x).attr("y",-10).attr("text-anchor","end").attr("fill","rgba(0, 255, 136, 0.6)").attr("font-size","10px").text("Habitable Zone")},[t,i]),e.jsx("div",{ref:s,className:"chart-container",children:e.jsx("svg",{ref:r})})}const Vt=[{key:"solarAnalog",icon:"â˜€ï¸",className:"solar"},{key:"sunLike",icon:"â­",className:"solar"},{key:"redDwarf",icon:"ðŸ”´",className:"red-dwarf"},{key:"youngSystem",icon:"ðŸŒ±",className:"age"},{key:"matureSystem",icon:"ðŸŒ³",className:"age"},{key:"ancientSystem",icon:"ðŸ›ï¸",className:"age"},{key:"metalRich",icon:"âš™ï¸",className:"metallicity"},{key:"metalPoor",icon:"ðŸ’¨",className:"metallicity"},{key:"binarySystem",icon:"â˜…â˜…",className:"binary"},{key:"circumbinary",icon:"ðŸŒ€",className:"binary"}];function $t(t,r){const s=[],i=r[0];return i&&(i.is_solar_analog?s.push("solarAnalog"):i.is_sun_like_star&&s.push("sunLike"),i.is_red_dwarf_host&&s.push("redDwarf"),i.is_young_system?s.push("youngSystem"):i.is_ancient_system?s.push("ancientSystem"):i.is_mature_system&&s.push("matureSystem"),i.is_metal_rich_star?s.push("metalRich"):i.is_metal_poor_star&&s.push("metalPoor"),t.sy_snum>1&&s.push("binarySystem"),t.cb_flag&&s.push("circumbinary")),s}function qt({star:t,planets:r}){const{t:s}=H(),i=n.useMemo(()=>$t(t,r),[t,r]);return i.length===0?e.jsx("div",{className:"star-features-empty",children:s("pages.starSystem.systemOverview.starFeatures.title")}):e.jsx("div",{className:"star-features-grid",children:i.map(a=>{const c=Vt.find(m=>m.key===a);return c?e.jsxs("div",{className:`star-feature-card ${c.className}`,children:[e.jsxs("div",{className:"star-feature-header",children:[e.jsx("span",{className:"star-feature-icon",children:c.icon}),e.jsx("span",{className:"star-feature-name",children:s(`pages.starSystem.systemOverview.starFeatures.${a}`)})]}),e.jsx("p",{className:"star-feature-description",children:s(`pages.starSystem.systemOverview.starFeatures.${a}Desc`)})]},a):null})})}function Wt({planets:t}){const{t:r}=H(),s=n.useMemo(()=>{if(t.length===0)return null;const m=vt(t),x=xt(t);return{stats:m,breakdown:x}},[t]);if(!s||t.length===0)return e.jsx("div",{className:"habitability-no-data",children:r("pages.starSystem.systemOverview.habitability.noData")});const{stats:i,breakdown:a}=s,c=a.filter(m=>m.count>0);return e.jsxs("div",{className:"habitability-overview-container",children:[e.jsxs("div",{className:"habitability-score-display",children:[e.jsxs("div",{className:"habitability-avg-score",children:[e.jsx("span",{className:"habitability-score-value",children:i.avgScore.toFixed(0)}),e.jsx("span",{className:"habitability-score-label",children:r("pages.starSystem.systemOverview.habitability.avgScore")})]}),i.topScorerName&&e.jsxs("div",{className:"habitability-best-candidate",children:[e.jsx("span",{className:"habitability-candidate-name",children:i.topScorerName.split(" ").pop()}),e.jsxs("span",{className:"habitability-candidate-score",children:[r("pages.starSystem.systemOverview.habitability.score"),": ",i.topScore.toFixed(0)]})]})]}),c.length>0&&e.jsxs("div",{className:"habitability-breakdown-container",children:[e.jsx("span",{className:"habitability-breakdown-title",children:r("pages.starSystem.systemOverview.habitability.breakdown")}),e.jsx("div",{className:"habitability-breakdown-bars",children:c.map(m=>{const x=Math.max(...c.map(o=>o.pct)),p=x>0?m.pct/x*100:0,v=m.category.toLowerCase().replace(/[\s-]/g,"-");return e.jsxs("div",{className:"habitability-bar-row",children:[e.jsx("span",{className:"habitability-bar-label",children:m.category}),e.jsx("div",{className:"habitability-bar-track",children:e.jsx("div",{className:`habitability-bar-fill ${v}`,style:{width:`${p}%`,backgroundColor:m.color}})}),e.jsx("span",{className:"habitability-bar-count",children:m.count})]},m.category)})})]}),e.jsxs("div",{className:"habitability-quick-stats",children:[e.jsxs("div",{className:"habitability-quick-stat",children:[e.jsx("span",{className:"habitability-quick-stat-value",children:i.habitableZone}),e.jsx("span",{className:"habitability-quick-stat-label",children:r("pages.starSystem.systemOverview.habitability.habitableZone")})]}),e.jsxs("div",{className:"habitability-quick-stat",children:[e.jsx("span",{className:"habitability-quick-stat-value",children:i.earthLike}),e.jsx("span",{className:"habitability-quick-stat-label",children:r("pages.starSystem.systemOverview.habitability.earthLike")})]}),e.jsxs("div",{className:"habitability-quick-stat",children:[e.jsx("span",{className:"habitability-quick-stat-value",children:i.total}),e.jsx("span",{className:"habitability-quick-stat-label",children:r("pages.starSystem.info.planets")})]})]})]})}const Zt=.95,Kt=1.67;function Xt(t){const r=t?Math.pow(10,t):1,s=Math.sqrt(Math.max(r,.001));return{inner:Zt*s,outer:Kt*s}}function Qt({star:t,planets:r}){const{t:s}=H(),i=n.useRef(null),a=n.useRef(null),{width:c}=ae(a);return n.useEffect(()=>{if(!i.current||!a.current||c===0)return;const m=c<500,x=Math.min(c,400),p=40,v=(x-p*2)/2,o=x/2,d=x/2,l=re(i.current);l.selectAll("*").remove(),l.attr("width",x).attr("height",x);const S=r.filter(y=>y.pl_orbsmax&&y.pl_orbsmax>0).map(y=>({name:y.pl_name.split(" ").pop()||y.pl_name,semiMajorAxis:y.pl_orbsmax,eccentricity:y.pl_orbeccen||0,habitable:y.is_habitable_zone||!1})).sort((y,N)=>y.semiMajorAxis-N.semiMajorAxis);if(S.length===0)return;const f=Math.max(...S.map(y=>y.semiMajorAxis)),u=Xt(t.st_lum),h=Math.max(f*1.2,u.outer*1.1),j=v/h;l.append("circle").attr("cx",o).attr("cy",d).attr("r",v+p/2).attr("fill","rgba(0, 0, 0, 0.3)");const g=u.inner*j,_=u.outer*j;_>0&&_<=v&&(l.append("circle").attr("cx",o).attr("cy",d).attr("r",_).attr("fill","rgba(0, 255, 136, 0.1)").attr("stroke","rgba(0, 255, 136, 0.3)").attr("stroke-width",1),g>0&&l.append("circle").attr("cx",o).attr("cy",d).attr("r",g).attr("fill","rgba(0, 0, 0, 0.3)").attr("stroke","rgba(0, 255, 136, 0.3)").attr("stroke-width",1).attr("stroke-dasharray","4,4")),[.1,.5,1,2,5,10,20,50].filter(y=>y*j<v&&y<h).forEach(y=>{l.append("circle").attr("cx",o).attr("cy",d).attr("r",y*j).attr("fill","none").attr("stroke","rgba(255, 255, 255, 0.1)").attr("stroke-width",.5),l.append("text").attr("x",o+y*j+3).attr("y",d-3).attr("fill","rgba(255, 255, 255, 0.3)").attr("font-size","8px").text(`${y} AU`)}),l.append("circle").attr("cx",o).attr("cy",d).attr("r",8).attr("fill","#ffcc00").attr("filter","drop-shadow(0 0 10px rgba(255, 200, 0, 0.5))"),S.forEach((y,N)=>{const b=y.semiMajorAxis*j,C=N/S.length*Math.PI*2-Math.PI/2,E=o+Math.cos(C)*b,P=d+Math.sin(C)*b;l.append("circle").attr("cx",o).attr("cy",d).attr("r",b).attr("fill","none").attr("stroke",y.habitable?"rgba(0, 255, 136, 0.4)":"rgba(0, 204, 255, 0.3)").attr("stroke-width",1),l.append("circle").attr("cx",E).attr("cy",P).attr("r",m?4:6).attr("fill",y.habitable?"#00ff88":"#00ccff").attr("stroke","#fff").attr("stroke-width",1),l.append("text").attr("x",E).attr("y",P-10).attr("text-anchor","middle").attr("fill","rgba(255, 255, 255, 0.7)").attr("font-size","9px").text(y.name)})},[t,r,c,s]),e.jsxs("div",{className:"orbital-topdown-container",children:[e.jsx("div",{ref:a,className:"orbital-topdown-chart",children:e.jsx("svg",{ref:i})}),e.jsxs("div",{className:"orbital-legend",children:[e.jsxs("div",{className:"orbital-legend-item",children:[e.jsx("div",{className:"orbital-legend-dot hz"}),e.jsx("span",{children:s("pages.starSystem.systemOverview.orbitalView.habitableZone")})]}),e.jsxs("div",{className:"orbital-legend-item",children:[e.jsx("div",{className:"orbital-legend-dot planet"}),e.jsx("span",{children:s("pages.starSystem.info.planet")})]}),e.jsxs("div",{className:"orbital-legend-item",children:[e.jsx("div",{className:"orbital-legend-dot habitable"}),e.jsx("span",{children:s("pages.starSystem.systemOverview.habitability.habitableZone")})]})]})]})}const me=320,ue=200;function Jt({planets:t}){const{t:r}=H(),s=n.useRef(null),i=n.useRef(null),{width:a}=ae(i);return n.useEffect(()=>{if(!s.current||!i.current||a===0)return;const c=a<500,m=280,x={top:30,right:30,bottom:50,left:60},p=a-x.left-x.right,v=m-x.top-x.bottom,o=re(s.current);o.selectAll("*").remove(),o.attr("width",a).attr("height",m);const d=t.filter(N=>N.pl_eqt&&N.pl_eqt>0&&N.pl_rade&&N.pl_rade>0).map(N=>({name:N.pl_name.split(" ").pop()||N.pl_name,temp:N.pl_eqt,radius:N.pl_rade,mass:N.pl_bmasse||1,score:N.habitability_score,habitable:N.is_habitable_zone||!1}));if(d.length===0)return;const l=o.append("g").attr("transform",`translate(${x.left},${x.top})`),S=oe(d,N=>N.temp),f=oe(d,N=>N.radius),u=pe().domain([Math.min(S[0]*.8,100),Math.max(S[1]*1.2,3e3)]).range([0,p]),h=pe().domain([Math.min(f[0]*.8,.3),Math.max(f[1]*1.2,20)]).range([v,0]);l.append("rect").attr("x",u(me)).attr("y",0).attr("width",p-u(me)).attr("height",v).attr("fill","rgba(255, 100, 100, 0.1)"),l.append("rect").attr("x",u(ue)).attr("y",0).attr("width",u(me)-u(ue)).attr("height",v).attr("fill","rgba(0, 255, 136, 0.1)"),l.append("rect").attr("x",0).attr("y",0).attr("width",u(ue)).attr("height",v).attr("fill","rgba(100, 150, 255, 0.1)");const j=Pe().domain([0,50,100]).range(["#ff4444","#ffaa00","#00ff88"]),g=oe(d,N=>N.mass),_=kt().domain([Math.min(g[0],.1),Math.max(g[1],100)]).range(c?[3,10]:[4,15]);l.selectAll(".planet-bubble").data(d).join("circle").attr("cx",N=>u(N.temp)).attr("cy",N=>h(N.radius)).attr("r",N=>_(N.mass)).attr("fill",N=>j(N.score)).attr("stroke","#fff").attr("stroke-width",1).attr("opacity",.8),d.length<=8&&l.selectAll(".planet-label").data(d).join("text").attr("x",N=>u(N.temp)).attr("y",N=>h(N.radius)-_(N.mass)-4).attr("text-anchor","middle").attr("fill","rgba(255, 255, 255, 0.7)").attr("font-size","9px").text(N=>N.name);const T=255,y=1;u(T)>0&&u(T)<p&&h(y)>0&&h(y)<v&&(l.append("circle").attr("cx",u(T)).attr("cy",h(y)).attr("r",4).attr("fill","none").attr("stroke","#fff").attr("stroke-width",2).attr("stroke-dasharray","2,2"),l.append("text").attr("x",u(T)+8).attr("y",h(y)+3).attr("fill","rgba(255, 255, 255, 0.5)").attr("font-size","9px").text("ðŸŒ")),l.append("g").attr("transform",`translate(0,${v})`).call(fe(u).tickValues([100,200,300,500,1e3,2e3]).tickFormat(he("d"))).selectAll("text").attr("fill","#888").attr("font-size","10px"),l.selectAll(".domain, .tick line").attr("stroke","#444"),l.append("text").attr("x",p/2).attr("y",v+40).attr("text-anchor","middle").attr("fill","#666").attr("font-size","11px").text(r("pages.starSystem.systemOverview.tempSizeChart.xAxis")),l.append("g").call(Ce(h).tickValues([.5,1,2,5,10,20]).tickFormat(he(".1f"))).selectAll("text").attr("fill","#888").attr("font-size","10px"),l.append("text").attr("transform","rotate(-90)").attr("y",-45).attr("x",-v/2).attr("text-anchor","middle").attr("fill","#666").attr("font-size","11px").text(r("pages.starSystem.systemOverview.tempSizeChart.yAxis"))},[t,r,a]),e.jsxs("div",{className:"temp-size-container",children:[e.jsx("div",{ref:i,className:"temp-size-chart",children:e.jsx("svg",{ref:s})}),e.jsxs("div",{className:"temp-size-legend",children:[e.jsxs("div",{className:"temp-size-legend-item",children:[e.jsx("div",{className:"temp-zone-indicator hot"}),e.jsx("span",{children:r("pages.starSystem.systemOverview.tempSizeChart.tooHot")})]}),e.jsxs("div",{className:"temp-size-legend-item",children:[e.jsx("div",{className:"temp-zone-indicator habitable"}),e.jsx("span",{children:r("pages.starSystem.systemOverview.tempSizeChart.habitable")})]}),e.jsxs("div",{className:"temp-size-legend-item",children:[e.jsx("div",{className:"temp-zone-indicator cold"}),e.jsx("span",{children:r("pages.starSystem.systemOverview.tempSizeChart.tooCold")})]}),e.jsxs("div",{className:"temp-size-legend-item temp-size-earth-marker",children:[e.jsx("div",{className:"temp-size-earth-dot"}),e.jsx("span",{children:r("pages.starSystem.systemOverview.tempSizeChart.earth")})]})]})]})}function rs(){const{t}=H(),{starId:r}=et(),s=tt(),{getStarBySlug:i,getPlanetsByHost:a,isLoading:c}=st(),[m,x]=n.useState(!1),[p,v]=n.useState(!1),[o,d]=n.useState(null),[l,S]=n.useState(null),[f,u]=n.useState(!1),[h,j]=n.useState(null),g=r?i(r):void 0,_=g?a(g.hostname):[],T=n.useMemo(()=>g?Le(g,_):[],[g,_]);n.useEffect(()=>{const E=window.matchMedia("(min-width: 769px)");u(E.matches);const P=$=>{u($.matches)};return E.addEventListener("change",P),()=>E.removeEventListener("change",P)},[]);const y=n.useCallback((E,P)=>{d(E),S(P??null)},[]),N=n.useCallback(E=>{(h==null?void 0:h.id)===E.id?E.type==="planet"?s(`/planets/${at(E.id)}`):E.type==="star"&&x(!0):j(E)},[h,s]),b=n.useCallback(()=>{j(null)},[]),C=g?g.sy_snum>1:!1;return c?e.jsx("div",{className:"spinner-container",children:e.jsxs("div",{className:"spinner-content",children:[e.jsx("div",{className:"spinner-orbit",children:e.jsx("div",{className:"spinner-planet"})}),e.jsx("div",{className:"spinner-text",children:t("pages.star.loading")})]})}):g?e.jsx("div",{className:"starsystem-page",children:e.jsxs("section",{className:"starsystem-hero-section",children:[e.jsxs("div",{className:"starsystem-hero-header",children:[e.jsx("h1",{className:"starsystem-title",children:g.hostname}),e.jsxs("p",{className:"starsystem-subtitle",children:[g.st_spectype||g.star_class||t("pages.starSystem.info.unknown"),g.distance_ly&&` â€¢ ${g.distance_ly.toFixed(2)} ly`,_.length>0&&` â€¢ ${_.length} ${_.length===1?t("pages.starSystem.info.planet"):t("pages.starSystem.info.planets")}`]}),e.jsx("button",{className:"system-overview-btn",onClick:()=>x(!0),children:t("pages.starSystem.systemOverview.button")})]}),e.jsx(Ne,{to:"/",className:"starsystem-back-button",children:t("pages.star.backToStarfield")}),e.jsx(Pt,{star:g,planets:_,hoveredBody:o,focusedBody:h,onBodyHover:y,onBodyClick:N,onBackgroundClick:b}),(f||p)&&e.jsx(Ct,{bodies:T,hoveredBody:o,focusedBody:h,onBodyHover:E=>y(E),onBodyClick:N,isBinarySystem:C}),!f&&e.jsx("button",{className:"bodies-toggle-btn",onClick:()=>v(!p),title:t(p?"pages.starSystem.hideBodies":"pages.starSystem.showBodies"),children:p?"âœ•":"â˜°"}),o&&o.type==="planet"&&l&&o.planetData&&e.jsxs("div",{className:"starsystem-cursor-tooltip",style:{left:l.x+20,top:l.y-10},children:[e.jsxs("div",{className:"cursor-tooltip-header",children:[e.jsx("div",{className:"cursor-tooltip-name",children:o.planetData.pl_name}),e.jsx("div",{className:"cursor-tooltip-type",children:o.planetData.planet_type})]}),e.jsxs("div",{className:"cursor-tooltip-details",children:[o.planetData.pl_rade&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Radius"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[o.planetData.pl_rade.toFixed(2)," RâŠ•"]})]}),o.planetData.pl_bmasse&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Mass"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[o.planetData.pl_bmasse.toFixed(2)," MâŠ•"]})]}),o.planetData.pl_orbper&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Orbital Period"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[o.planetData.pl_orbper.toFixed(2)," days"]})]}),o.planetData.pl_orbsmax&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Semi-major Axis"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[o.planetData.pl_orbsmax.toFixed(3)," AU"]})]}),o.planetData.pl_eqt&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Eq. Temperature"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[o.planetData.pl_eqt.toFixed(0)," K"]})]}),o.planetData.disc_year&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Discovered"}),e.jsx("span",{className:"cursor-tooltip-value",children:o.planetData.disc_year})]}),o.planetData.discoverymethod&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Method"}),e.jsx("span",{className:"cursor-tooltip-value",children:o.planetData.discoverymethod})]})]}),e.jsx("div",{className:"cursor-tooltip-hint",children:"Click to view details"})]}),e.jsx(zt,{star:g,planets:_,isOpen:m,onClose:()=>x(!1)})]})}):e.jsx("div",{className:"error-container",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h1",{className:"error-title",children:t("pages.star.notFound.title")}),e.jsx("p",{className:"error-message",children:t("pages.star.notFound.message",{starId:r||""})}),e.jsx(Ne,{to:"/",className:"starsystem-back-link",children:t("pages.star.notFound.returnToStarfield")})]})})}export{rs as default};
