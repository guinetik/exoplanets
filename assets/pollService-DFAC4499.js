import{aH as i,aG as g,aI as l,aJ as h,aK as d,aL as w,aM as p,aN as f,aO as y,aP as b}from"./index-BjrNzXlg.js";const s=g({prefix:"PollService"}),u="exoplanets_poll";async function v(e,t){if(!i())return s.warn("Firebase not configured, creating local-only vote"),{id:t,planet:e,userid:t,timestamp:Date.now()};const r=l(),n=h(r,u,t),c={planet:e,userid:t,timestamp:d.now()};return await w(n,c),s.info("Vote cast:",{planet:e,userid:t}),{id:t,planet:e,userid:t,timestamp:Date.now()}}async function F(e){if(!i())return s.warn("Firebase not configured, returning null"),null;try{const t=l(),r=p(t,u),n=y(r,b("userid","==",e)),c=await f(n);if(c.empty)return null;const a=c.docs[0],o=a.data();return{id:a.id,planet:o.planet,userid:o.userid,timestamp:o.timestamp instanceof d?o.timestamp.toMillis():o.timestamp}}catch(t){return s.error("Failed to fetch user vote:",t),null}}async function D(){if(!i())return s.warn("Firebase not configured, returning empty counts"),[];try{const e=l(),t=p(e,u),r=await f(t),n=new Map;return r.forEach(a=>{const m=a.data().planet;n.set(m,(n.get(m)||0)+1)}),Array.from(n.entries()).map(([a,o])=>({planet:a,count:o})).sort((a,o)=>o.count-a.count)}catch(e){return s.error("Failed to fetch vote counts:",e),[]}}async function C(){if(!i())return 0;try{const e=l(),t=p(e,u);return(await f(t)).size}catch(e){return s.error("Failed to fetch total votes:",e),0}}const V={castVote:v,getUserVote:F,getVoteCounts:D,getTotalVotes:C};export{V as p};
