const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Home-CN5rAcvG.js","./react-three-fiber.esm-DUMiXgWv.js","./Star--aomLzGS.js","./TravelTimeCalculator-FX-a9dOx.js","./transform-DuX5G0rf.js","./habitabilityAnalytics-CzP9HgSM.js","./Planet-DhMVUK9t.js","./reviewService-BXvmQkY2.js","./UserPrompt-B-FIe400.js","./monotone-CvAkBM_g.js","./Habitability-Z8PBx89T.js","./Vote-C_SUivCz.js","./pollService-DFAC4499.js","./Apod-DNF68BGz.js"])))=>i.map(i=>d[i]);
var uN=Object.defineProperty;var hN=(n,e,t)=>e in n?uN(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ir=(n,e,t)=>hN(n,typeof e!="symbol"?e+"":e,t);function dN(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function fN(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mC={exports:{}},Wg={},gC={exports:{}},At={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Id=Symbol.for("react.element"),pN=Symbol.for("react.portal"),mN=Symbol.for("react.fragment"),gN=Symbol.for("react.strict_mode"),yN=Symbol.for("react.profiler"),_N=Symbol.for("react.provider"),xN=Symbol.for("react.context"),vN=Symbol.for("react.forward_ref"),SN=Symbol.for("react.suspense"),bN=Symbol.for("react.memo"),wN=Symbol.for("react.lazy"),pT=Symbol.iterator;function TN(n){return n===null||typeof n!="object"?null:(n=pT&&n[pT]||n["@@iterator"],typeof n=="function"?n:null)}var yC={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_C=Object.assign,xC={};function su(n,e,t){this.props=n,this.context=e,this.refs=xC,this.updater=t||yC}su.prototype.isReactComponent={};su.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};su.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function vC(){}vC.prototype=su.prototype;function oS(n,e,t){this.props=n,this.context=e,this.refs=xC,this.updater=t||yC}var lS=oS.prototype=new vC;lS.constructor=oS;_C(lS,su.prototype);lS.isPureReactComponent=!0;var mT=Array.isArray,SC=Object.prototype.hasOwnProperty,cS={current:null},bC={key:!0,ref:!0,__self:!0,__source:!0};function wC(n,e,t){var i,r={},s=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)SC.call(e,i)&&!bC.hasOwnProperty(i)&&(r[i]=e[i]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];r.children=l}if(n&&n.defaultProps)for(i in o=n.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:Id,type:n,key:s,ref:a,props:r,_owner:cS.current}}function EN(n,e){return{$$typeof:Id,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function uS(n){return typeof n=="object"&&n!==null&&n.$$typeof===Id}function AN(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var gT=/\/+/g;function Ay(n,e){return typeof n=="object"&&n!==null&&n.key!=null?AN(""+n.key):e.toString(36)}function Dp(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Id:case pN:a=!0}}if(a)return a=n,r=r(a),n=i===""?"."+Ay(a,0):i,mT(r)?(t="",n!=null&&(t=n.replace(gT,"$&/")+"/"),Dp(r,e,t,"",function(c){return c})):r!=null&&(uS(r)&&(r=EN(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(gT,"$&/")+"/")+n)),e.push(r)),1;if(a=0,i=i===""?".":i+":",mT(n))for(var o=0;o<n.length;o++){s=n[o];var l=i+Ay(s,o);a+=Dp(s,e,t,l,r)}else if(l=TN(n),typeof l=="function")for(n=l.call(n),o=0;!(s=n.next()).done;)s=s.value,l=i+Ay(s,o++),a+=Dp(s,e,t,l,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function ff(n,e,t){if(n==null)return n;var i=[],r=0;return Dp(n,i,"","",function(s){return e.call(t,s,r++)}),i}function MN(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Si={current:null},Np={transition:null},CN={ReactCurrentDispatcher:Si,ReactCurrentBatchConfig:Np,ReactCurrentOwner:cS};function TC(){throw Error("act(...) is not supported in production builds of React.")}At.Children={map:ff,forEach:function(n,e,t){ff(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return ff(n,function(){e++}),e},toArray:function(n){return ff(n,function(e){return e})||[]},only:function(n){if(!uS(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};At.Component=su;At.Fragment=mN;At.Profiler=yN;At.PureComponent=oS;At.StrictMode=gN;At.Suspense=SN;At.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CN;At.act=TC;At.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=_C({},n.props),r=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=cS.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)SC.call(e,l)&&!bC.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];i.children=o}return{$$typeof:Id,type:n.type,key:r,ref:s,props:i,_owner:a}};At.createContext=function(n){return n={$$typeof:xN,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:_N,_context:n},n.Consumer=n};At.createElement=wC;At.createFactory=function(n){var e=wC.bind(null,n);return e.type=n,e};At.createRef=function(){return{current:null}};At.forwardRef=function(n){return{$$typeof:vN,render:n}};At.isValidElement=uS;At.lazy=function(n){return{$$typeof:wN,_payload:{_status:-1,_result:n},_init:MN}};At.memo=function(n,e){return{$$typeof:bN,type:n,compare:e===void 0?null:e}};At.startTransition=function(n){var e=Np.transition;Np.transition={};try{n()}finally{Np.transition=e}};At.unstable_act=TC;At.useCallback=function(n,e){return Si.current.useCallback(n,e)};At.useContext=function(n){return Si.current.useContext(n)};At.useDebugValue=function(){};At.useDeferredValue=function(n){return Si.current.useDeferredValue(n)};At.useEffect=function(n,e){return Si.current.useEffect(n,e)};At.useId=function(){return Si.current.useId()};At.useImperativeHandle=function(n,e,t){return Si.current.useImperativeHandle(n,e,t)};At.useInsertionEffect=function(n,e){return Si.current.useInsertionEffect(n,e)};At.useLayoutEffect=function(n,e){return Si.current.useLayoutEffect(n,e)};At.useMemo=function(n,e){return Si.current.useMemo(n,e)};At.useReducer=function(n,e,t){return Si.current.useReducer(n,e,t)};At.useRef=function(n){return Si.current.useRef(n)};At.useState=function(n){return Si.current.useState(n)};At.useSyncExternalStore=function(n,e,t){return Si.current.useSyncExternalStore(n,e,t)};At.useTransition=function(){return Si.current.useTransition()};At.version="18.3.1";gC.exports=At;var te=gC.exports;const IN=fN(te),RN=dN({__proto__:null,default:IN},[te]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PN=te,LN=Symbol.for("react.element"),DN=Symbol.for("react.fragment"),NN=Object.prototype.hasOwnProperty,ON=PN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kN={key:!0,ref:!0,__self:!0,__source:!0};function EC(n,e,t){var i,r={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)NN.call(e,i)&&!kN.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:LN,type:n,key:s,ref:a,props:r,_owner:ON.current}}Wg.Fragment=DN;Wg.jsx=EC;Wg.jsxs=EC;mC.exports=Wg;var je=mC.exports,AC={exports:{}},Qi={},MC={exports:{}},CC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(B,X){var ee=B.length;B.push(X);e:for(;0<ee;){var _e=ee-1>>>1,Ge=B[_e];if(0<r(Ge,X))B[_e]=X,B[ee]=Ge,ee=_e;else break e}}function t(B){return B.length===0?null:B[0]}function i(B){if(B.length===0)return null;var X=B[0],ee=B.pop();if(ee!==X){B[0]=ee;e:for(var _e=0,Ge=B.length,ft=Ge>>>1;_e<ft;){var pt=2*(_e+1)-1,wt=B[pt],ne=pt+1,se=B[ne];if(0>r(wt,ee))ne<Ge&&0>r(se,wt)?(B[_e]=se,B[ne]=ee,_e=ne):(B[_e]=wt,B[pt]=ee,_e=pt);else if(ne<Ge&&0>r(se,ee))B[_e]=se,B[ne]=ee,_e=ne;else break e}}return X}function r(B,X){var ee=B.sortIndex-X.sortIndex;return ee!==0?ee:B.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,g=!1,_=!1,y=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(B){for(var X=t(c);X!==null;){if(X.callback===null)i(c);else if(X.startTime<=B)i(c),X.sortIndex=X.expirationTime,e(l,X);else break;X=t(c)}}function T(B){if(_=!1,v(B),!g)if(t(l)!==null)g=!0,Z(R);else{var X=t(c);X!==null&&fe(T,X.startTime-B)}}function R(B,X){g=!1,_&&(_=!1,m(E),E=-1),p=!0;var ee=d;try{for(v(X),h=t(l);h!==null&&(!(h.expirationTime>X)||B&&!I());){var _e=h.callback;if(typeof _e=="function"){h.callback=null,d=h.priorityLevel;var Ge=_e(h.expirationTime<=X);X=n.unstable_now(),typeof Ge=="function"?h.callback=Ge:h===t(l)&&i(l),v(X)}else i(l);h=t(l)}if(h!==null)var ft=!0;else{var pt=t(c);pt!==null&&fe(T,pt.startTime-X),ft=!1}return ft}finally{h=null,d=ee,p=!1}}var C=!1,A=null,E=-1,b=5,S=-1;function I(){return!(n.unstable_now()-S<b)}function D(){if(A!==null){var B=n.unstable_now();S=B;var X=!0;try{X=A(!0,B)}finally{X?P():(C=!1,A=null)}}else C=!1}var P;if(typeof x=="function")P=function(){x(D)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,Y=$.port2;$.port1.onmessage=D,P=function(){Y.postMessage(null)}}else P=function(){y(D,0)};function Z(B){A=B,C||(C=!0,P())}function fe(B,X){E=y(function(){B(n.unstable_now())},X)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(B){B.callback=null},n.unstable_continueExecution=function(){g||p||(g=!0,Z(R))},n.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<B?Math.floor(1e3/B):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(B){switch(d){case 1:case 2:case 3:var X=3;break;default:X=d}var ee=d;d=X;try{return B()}finally{d=ee}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(B,X){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var ee=d;d=B;try{return X()}finally{d=ee}},n.unstable_scheduleCallback=function(B,X,ee){var _e=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?_e+ee:_e):ee=_e,B){case 1:var Ge=-1;break;case 2:Ge=250;break;case 5:Ge=1073741823;break;case 4:Ge=1e4;break;default:Ge=5e3}return Ge=ee+Ge,B={id:u++,callback:X,priorityLevel:B,startTime:ee,expirationTime:Ge,sortIndex:-1},ee>_e?(B.sortIndex=ee,e(c,B),t(l)===null&&B===t(c)&&(_?(m(E),E=-1):_=!0,fe(T,ee-_e))):(B.sortIndex=Ge,e(l,B),g||p||(g=!0,Z(R))),B},n.unstable_shouldYield=I,n.unstable_wrapCallback=function(B){var X=d;return function(){var ee=d;d=X;try{return B.apply(this,arguments)}finally{d=ee}}}})(CC);MC.exports=CC;var UN=MC.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FN=te,Yi=UN;function ye(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var IC=new Set,kh={};function fl(n,e){Oc(n,e),Oc(n+"Capture",e)}function Oc(n,e){for(kh[n]=e,n=0;n<e.length;n++)IC.add(e[n])}var Os=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),px=Object.prototype.hasOwnProperty,VN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,yT={},_T={};function BN(n){return px.call(_T,n)?!0:px.call(yT,n)?!1:VN.test(n)?_T[n]=!0:(yT[n]=!0,!1)}function zN(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function HN(n,e,t,i){if(e===null||typeof e>"u"||zN(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function bi(n,e,t,i,r,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var jn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){jn[n]=new bi(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];jn[e]=new bi(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){jn[n]=new bi(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){jn[n]=new bi(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){jn[n]=new bi(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){jn[n]=new bi(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){jn[n]=new bi(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){jn[n]=new bi(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){jn[n]=new bi(n,5,!1,n.toLowerCase(),null,!1,!1)});var hS=/[\-:]([a-z])/g;function dS(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(hS,dS);jn[e]=new bi(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(hS,dS);jn[e]=new bi(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(hS,dS);jn[e]=new bi(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){jn[n]=new bi(n,1,!1,n.toLowerCase(),null,!1,!1)});jn.xlinkHref=new bi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){jn[n]=new bi(n,1,!1,n.toLowerCase(),null,!0,!0)});function fS(n,e,t,i){var r=jn.hasOwnProperty(e)?jn[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(HN(e,t,r,i)&&(t=null),i||r===null?BN(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var js=FN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pf=Symbol.for("react.element"),oc=Symbol.for("react.portal"),lc=Symbol.for("react.fragment"),pS=Symbol.for("react.strict_mode"),mx=Symbol.for("react.profiler"),RC=Symbol.for("react.provider"),PC=Symbol.for("react.context"),mS=Symbol.for("react.forward_ref"),gx=Symbol.for("react.suspense"),yx=Symbol.for("react.suspense_list"),gS=Symbol.for("react.memo"),fa=Symbol.for("react.lazy"),LC=Symbol.for("react.offscreen"),xT=Symbol.iterator;function Iu(n){return n===null||typeof n!="object"?null:(n=xT&&n[xT]||n["@@iterator"],typeof n=="function"?n:null)}var on=Object.assign,My;function Qu(n){if(My===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);My=e&&e[1]||""}return`
`+My+n}var Cy=!1;function Iy(n,e){if(!n||Cy)return"";Cy=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){i=c}n.call(e.prototype)}else{try{throw Error()}catch(c){i=c}n()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==s[o]){var l=`
`+r[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{Cy=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Qu(n):""}function GN(n){switch(n.tag){case 5:return Qu(n.type);case 16:return Qu("Lazy");case 13:return Qu("Suspense");case 19:return Qu("SuspenseList");case 0:case 2:case 15:return n=Iy(n.type,!1),n;case 11:return n=Iy(n.type.render,!1),n;case 1:return n=Iy(n.type,!0),n;default:return""}}function _x(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case lc:return"Fragment";case oc:return"Portal";case mx:return"Profiler";case pS:return"StrictMode";case gx:return"Suspense";case yx:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case PC:return(n.displayName||"Context")+".Consumer";case RC:return(n._context.displayName||"Context")+".Provider";case mS:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case gS:return e=n.displayName||null,e!==null?e:_x(n.type)||"Memo";case fa:e=n._payload,n=n._init;try{return _x(n(e))}catch{}}return null}function WN(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _x(e);case 8:return e===pS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Wa(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function DC(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function $N(n){var e=DC(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function mf(n){n._valueTracker||(n._valueTracker=$N(n))}function NC(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=DC(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function am(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function xx(n,e){var t=e.checked;return on({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function vT(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=Wa(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function OC(n,e){e=e.checked,e!=null&&fS(n,"checked",e,!1)}function vx(n,e){OC(n,e);var t=Wa(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Sx(n,e.type,t):e.hasOwnProperty("defaultValue")&&Sx(n,e.type,Wa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function ST(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Sx(n,e,t){(e!=="number"||am(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var eh=Array.isArray;function bc(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+Wa(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function bx(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ye(91));return on({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function bT(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ye(92));if(eh(t)){if(1<t.length)throw Error(ye(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Wa(t)}}function kC(n,e){var t=Wa(e.value),i=Wa(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function wT(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function UC(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wx(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?UC(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var gf,FC=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(gf=gf||document.createElement("div"),gf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=gf.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Uh(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var uh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qN=["Webkit","ms","Moz","O"];Object.keys(uh).forEach(function(n){qN.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),uh[e]=uh[n]})});function VC(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||uh.hasOwnProperty(n)&&uh[n]?(""+e).trim():e+"px"}function BC(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=VC(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var jN=on({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Tx(n,e){if(e){if(jN[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ye(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ye(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ye(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ye(62))}}function Ex(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ax=null;function yS(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Mx=null,wc=null,Tc=null;function TT(n){if(n=Ld(n)){if(typeof Mx!="function")throw Error(ye(280));var e=n.stateNode;e&&(e=Kg(e),Mx(n.stateNode,n.type,e))}}function zC(n){wc?Tc?Tc.push(n):Tc=[n]:wc=n}function HC(){if(wc){var n=wc,e=Tc;if(Tc=wc=null,TT(n),e)for(n=0;n<e.length;n++)TT(e[n])}}function GC(n,e){return n(e)}function WC(){}var Ry=!1;function $C(n,e,t){if(Ry)return n(e,t);Ry=!0;try{return GC(n,e,t)}finally{Ry=!1,(wc!==null||Tc!==null)&&(WC(),HC())}}function Fh(n,e){var t=n.stateNode;if(t===null)return null;var i=Kg(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(ye(231,e,typeof t));return t}var Cx=!1;if(Os)try{var Ru={};Object.defineProperty(Ru,"passive",{get:function(){Cx=!0}}),window.addEventListener("test",Ru,Ru),window.removeEventListener("test",Ru,Ru)}catch{Cx=!1}function XN(n,e,t,i,r,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var hh=!1,om=null,lm=!1,Ix=null,KN={onError:function(n){hh=!0,om=n}};function YN(n,e,t,i,r,s,a,o,l){hh=!1,om=null,XN.apply(KN,arguments)}function JN(n,e,t,i,r,s,a,o,l){if(YN.apply(this,arguments),hh){if(hh){var c=om;hh=!1,om=null}else throw Error(ye(198));lm||(lm=!0,Ix=c)}}function pl(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function qC(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function ET(n){if(pl(n)!==n)throw Error(ye(188))}function ZN(n){var e=n.alternate;if(!e){if(e=pl(n),e===null)throw Error(ye(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return ET(r),n;if(s===i)return ET(r),e;s=s.sibling}throw Error(ye(188))}if(t.return!==i.return)t=r,i=s;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,i=s;break}if(o===i){a=!0,i=r,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,i=r;break}if(o===i){a=!0,i=s,t=r;break}o=o.sibling}if(!a)throw Error(ye(189))}}if(t.alternate!==i)throw Error(ye(190))}if(t.tag!==3)throw Error(ye(188));return t.stateNode.current===t?n:e}function jC(n){return n=ZN(n),n!==null?XC(n):null}function XC(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=XC(n);if(e!==null)return e;n=n.sibling}return null}var KC=Yi.unstable_scheduleCallback,AT=Yi.unstable_cancelCallback,QN=Yi.unstable_shouldYield,eO=Yi.unstable_requestPaint,_n=Yi.unstable_now,tO=Yi.unstable_getCurrentPriorityLevel,_S=Yi.unstable_ImmediatePriority,YC=Yi.unstable_UserBlockingPriority,cm=Yi.unstable_NormalPriority,nO=Yi.unstable_LowPriority,JC=Yi.unstable_IdlePriority,$g=null,Zr=null;function iO(n){if(Zr&&typeof Zr.onCommitFiberRoot=="function")try{Zr.onCommitFiberRoot($g,n,void 0,(n.current.flags&128)===128)}catch{}}var Cr=Math.clz32?Math.clz32:aO,rO=Math.log,sO=Math.LN2;function aO(n){return n>>>=0,n===0?32:31-(rO(n)/sO|0)|0}var yf=64,_f=4194304;function th(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function um(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?i=th(o):(s&=a,s!==0&&(i=th(s)))}else a=t&~r,a!==0?i=th(a):s!==0&&(i=th(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Cr(e),r=1<<t,i|=n[t],e&=~r;return i}function oO(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lO(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var a=31-Cr(s),o=1<<a,l=r[a];l===-1?(!(o&t)||o&i)&&(r[a]=oO(o,e)):l<=e&&(n.expiredLanes|=o),s&=~o}}function Rx(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function ZC(){var n=yf;return yf<<=1,!(yf&4194240)&&(yf=64),n}function Py(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Rd(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Cr(e),n[e]=t}function cO(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-Cr(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function xS(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-Cr(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var Gt=0;function QC(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var eI,vS,tI,nI,iI,Px=!1,xf=[],Ra=null,Pa=null,La=null,Vh=new Map,Bh=new Map,ga=[],uO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function MT(n,e){switch(n){case"focusin":case"focusout":Ra=null;break;case"dragenter":case"dragleave":Pa=null;break;case"mouseover":case"mouseout":La=null;break;case"pointerover":case"pointerout":Vh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bh.delete(e.pointerId)}}function Pu(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Ld(e),e!==null&&vS(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function hO(n,e,t,i,r){switch(e){case"focusin":return Ra=Pu(Ra,n,e,t,i,r),!0;case"dragenter":return Pa=Pu(Pa,n,e,t,i,r),!0;case"mouseover":return La=Pu(La,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return Vh.set(s,Pu(Vh.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Bh.set(s,Pu(Bh.get(s)||null,n,e,t,i,r)),!0}return!1}function rI(n){var e=ko(n.target);if(e!==null){var t=pl(e);if(t!==null){if(e=t.tag,e===13){if(e=qC(t),e!==null){n.blockedOn=e,iI(n.priority,function(){tI(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Op(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Lx(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);Ax=i,t.target.dispatchEvent(i),Ax=null}else return e=Ld(t),e!==null&&vS(e),n.blockedOn=t,!1;e.shift()}return!0}function CT(n,e,t){Op(n)&&t.delete(e)}function dO(){Px=!1,Ra!==null&&Op(Ra)&&(Ra=null),Pa!==null&&Op(Pa)&&(Pa=null),La!==null&&Op(La)&&(La=null),Vh.forEach(CT),Bh.forEach(CT)}function Lu(n,e){n.blockedOn===e&&(n.blockedOn=null,Px||(Px=!0,Yi.unstable_scheduleCallback(Yi.unstable_NormalPriority,dO)))}function zh(n){function e(r){return Lu(r,n)}if(0<xf.length){Lu(xf[0],n);for(var t=1;t<xf.length;t++){var i=xf[t];i.blockedOn===n&&(i.blockedOn=null)}}for(Ra!==null&&Lu(Ra,n),Pa!==null&&Lu(Pa,n),La!==null&&Lu(La,n),Vh.forEach(e),Bh.forEach(e),t=0;t<ga.length;t++)i=ga[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<ga.length&&(t=ga[0],t.blockedOn===null);)rI(t),t.blockedOn===null&&ga.shift()}var Ec=js.ReactCurrentBatchConfig,hm=!0;function fO(n,e,t,i){var r=Gt,s=Ec.transition;Ec.transition=null;try{Gt=1,SS(n,e,t,i)}finally{Gt=r,Ec.transition=s}}function pO(n,e,t,i){var r=Gt,s=Ec.transition;Ec.transition=null;try{Gt=4,SS(n,e,t,i)}finally{Gt=r,Ec.transition=s}}function SS(n,e,t,i){if(hm){var r=Lx(n,e,t,i);if(r===null)zy(n,e,i,dm,t),MT(n,i);else if(hO(r,n,e,t,i))i.stopPropagation();else if(MT(n,i),e&4&&-1<uO.indexOf(n)){for(;r!==null;){var s=Ld(r);if(s!==null&&eI(s),s=Lx(n,e,t,i),s===null&&zy(n,e,i,dm,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else zy(n,e,i,null,t)}}var dm=null;function Lx(n,e,t,i){if(dm=null,n=yS(i),n=ko(n),n!==null)if(e=pl(n),e===null)n=null;else if(t=e.tag,t===13){if(n=qC(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return dm=n,null}function sI(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tO()){case _S:return 1;case YC:return 4;case cm:case nO:return 16;case JC:return 536870912;default:return 16}default:return 16}}var wa=null,bS=null,kp=null;function aI(){if(kp)return kp;var n,e=bS,t=e.length,i,r="value"in wa?wa.value:wa.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var a=t-n;for(i=1;i<=a&&e[t-i]===r[s-i];i++);return kp=r.slice(n,1<i?1-i:void 0)}function Up(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function vf(){return!0}function IT(){return!1}function er(n){function e(t,i,r,s,a){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?vf:IT,this.isPropagationStopped=IT,this}return on(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=vf)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=vf)},persist:function(){},isPersistent:vf}),e}var au={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wS=er(au),Pd=on({},au,{view:0,detail:0}),mO=er(Pd),Ly,Dy,Du,qg=on({},Pd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:TS,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Du&&(Du&&n.type==="mousemove"?(Ly=n.screenX-Du.screenX,Dy=n.screenY-Du.screenY):Dy=Ly=0,Du=n),Ly)},movementY:function(n){return"movementY"in n?n.movementY:Dy}}),RT=er(qg),gO=on({},qg,{dataTransfer:0}),yO=er(gO),_O=on({},Pd,{relatedTarget:0}),Ny=er(_O),xO=on({},au,{animationName:0,elapsedTime:0,pseudoElement:0}),vO=er(xO),SO=on({},au,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),bO=er(SO),wO=on({},au,{data:0}),PT=er(wO),TO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},EO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MO(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=AO[n])?!!e[n]:!1}function TS(){return MO}var CO=on({},Pd,{key:function(n){if(n.key){var e=TO[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Up(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?EO[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:TS,charCode:function(n){return n.type==="keypress"?Up(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Up(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),IO=er(CO),RO=on({},qg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),LT=er(RO),PO=on({},Pd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:TS}),LO=er(PO),DO=on({},au,{propertyName:0,elapsedTime:0,pseudoElement:0}),NO=er(DO),OO=on({},qg,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),kO=er(OO),UO=[9,13,27,32],ES=Os&&"CompositionEvent"in window,dh=null;Os&&"documentMode"in document&&(dh=document.documentMode);var FO=Os&&"TextEvent"in window&&!dh,oI=Os&&(!ES||dh&&8<dh&&11>=dh),DT=" ",NT=!1;function lI(n,e){switch(n){case"keyup":return UO.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cI(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var cc=!1;function VO(n,e){switch(n){case"compositionend":return cI(e);case"keypress":return e.which!==32?null:(NT=!0,DT);case"textInput":return n=e.data,n===DT&&NT?null:n;default:return null}}function BO(n,e){if(cc)return n==="compositionend"||!ES&&lI(n,e)?(n=aI(),kp=bS=wa=null,cc=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return oI&&e.locale!=="ko"?null:e.data;default:return null}}var zO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function OT(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!zO[n.type]:e==="textarea"}function uI(n,e,t,i){zC(i),e=fm(e,"onChange"),0<e.length&&(t=new wS("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var fh=null,Hh=null;function HO(n){SI(n,0)}function jg(n){var e=dc(n);if(NC(e))return n}function GO(n,e){if(n==="change")return e}var hI=!1;if(Os){var Oy;if(Os){var ky="oninput"in document;if(!ky){var kT=document.createElement("div");kT.setAttribute("oninput","return;"),ky=typeof kT.oninput=="function"}Oy=ky}else Oy=!1;hI=Oy&&(!document.documentMode||9<document.documentMode)}function UT(){fh&&(fh.detachEvent("onpropertychange",dI),Hh=fh=null)}function dI(n){if(n.propertyName==="value"&&jg(Hh)){var e=[];uI(e,Hh,n,yS(n)),$C(HO,e)}}function WO(n,e,t){n==="focusin"?(UT(),fh=e,Hh=t,fh.attachEvent("onpropertychange",dI)):n==="focusout"&&UT()}function $O(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return jg(Hh)}function qO(n,e){if(n==="click")return jg(e)}function jO(n,e){if(n==="input"||n==="change")return jg(e)}function XO(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Dr=typeof Object.is=="function"?Object.is:XO;function Gh(n,e){if(Dr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!px.call(e,r)||!Dr(n[r],e[r]))return!1}return!0}function FT(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function VT(n,e){var t=FT(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=FT(t)}}function fI(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?fI(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function pI(){for(var n=window,e=am();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=am(n.document)}return e}function AS(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function KO(n){var e=pI(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&fI(t.ownerDocument.documentElement,t)){if(i!==null&&AS(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=VT(t,s);var a=VT(t,i);r&&a&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var YO=Os&&"documentMode"in document&&11>=document.documentMode,uc=null,Dx=null,ph=null,Nx=!1;function BT(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Nx||uc==null||uc!==am(i)||(i=uc,"selectionStart"in i&&AS(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),ph&&Gh(ph,i)||(ph=i,i=fm(Dx,"onSelect"),0<i.length&&(e=new wS("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=uc)))}function Sf(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var hc={animationend:Sf("Animation","AnimationEnd"),animationiteration:Sf("Animation","AnimationIteration"),animationstart:Sf("Animation","AnimationStart"),transitionend:Sf("Transition","TransitionEnd")},Uy={},mI={};Os&&(mI=document.createElement("div").style,"AnimationEvent"in window||(delete hc.animationend.animation,delete hc.animationiteration.animation,delete hc.animationstart.animation),"TransitionEvent"in window||delete hc.transitionend.transition);function Xg(n){if(Uy[n])return Uy[n];if(!hc[n])return n;var e=hc[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in mI)return Uy[n]=e[t];return n}var gI=Xg("animationend"),yI=Xg("animationiteration"),_I=Xg("animationstart"),xI=Xg("transitionend"),vI=new Map,zT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ro(n,e){vI.set(n,e),fl(e,[n])}for(var Fy=0;Fy<zT.length;Fy++){var Vy=zT[Fy],JO=Vy.toLowerCase(),ZO=Vy[0].toUpperCase()+Vy.slice(1);ro(JO,"on"+ZO)}ro(gI,"onAnimationEnd");ro(yI,"onAnimationIteration");ro(_I,"onAnimationStart");ro("dblclick","onDoubleClick");ro("focusin","onFocus");ro("focusout","onBlur");ro(xI,"onTransitionEnd");Oc("onMouseEnter",["mouseout","mouseover"]);Oc("onMouseLeave",["mouseout","mouseover"]);Oc("onPointerEnter",["pointerout","pointerover"]);Oc("onPointerLeave",["pointerout","pointerover"]);fl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fl("onBeforeInput",["compositionend","keypress","textInput","paste"]);fl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QO=new Set("cancel close invalid load scroll toggle".split(" ").concat(nh));function HT(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,JN(i,e,void 0,n),n.currentTarget=null}function SI(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;HT(r,o,c),s=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;HT(r,o,c),s=l}}}if(lm)throw n=Ix,lm=!1,Ix=null,n}function Jt(n,e){var t=e[Vx];t===void 0&&(t=e[Vx]=new Set);var i=n+"__bubble";t.has(i)||(bI(e,n,2,!1),t.add(i))}function By(n,e,t){var i=0;e&&(i|=4),bI(t,n,i,e)}var bf="_reactListening"+Math.random().toString(36).slice(2);function Wh(n){if(!n[bf]){n[bf]=!0,IC.forEach(function(t){t!=="selectionchange"&&(QO.has(t)||By(t,!1,n),By(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[bf]||(e[bf]=!0,By("selectionchange",!1,e))}}function bI(n,e,t,i){switch(sI(e)){case 1:var r=fO;break;case 4:r=pO;break;default:r=SS}t=r.bind(null,e,t,n),r=void 0,!Cx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function zy(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;a=a.return}for(;o!==null;){if(a=ko(o),a===null)return;if(l=a.tag,l===5||l===6){i=s=a;continue e}o=o.parentNode}}i=i.return}$C(function(){var c=s,u=yS(t),h=[];e:{var d=vI.get(n);if(d!==void 0){var p=wS,g=n;switch(n){case"keypress":if(Up(t)===0)break e;case"keydown":case"keyup":p=IO;break;case"focusin":g="focus",p=Ny;break;case"focusout":g="blur",p=Ny;break;case"beforeblur":case"afterblur":p=Ny;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=RT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=yO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=LO;break;case gI:case yI:case _I:p=vO;break;case xI:p=NO;break;case"scroll":p=mO;break;case"wheel":p=kO;break;case"copy":case"cut":case"paste":p=bO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=LT}var _=(e&4)!==0,y=!_&&n==="scroll",m=_?d!==null?d+"Capture":null:d;_=[];for(var x=c,v;x!==null;){v=x;var T=v.stateNode;if(v.tag===5&&T!==null&&(v=T,m!==null&&(T=Fh(x,m),T!=null&&_.push($h(x,T,v)))),y)break;x=x.return}0<_.length&&(d=new p(d,g,null,t,u),h.push({event:d,listeners:_}))}}if(!(e&7)){e:{if(d=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",d&&t!==Ax&&(g=t.relatedTarget||t.fromElement)&&(ko(g)||g[ks]))break e;if((p||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,p?(g=t.relatedTarget||t.toElement,p=c,g=g?ko(g):null,g!==null&&(y=pl(g),g!==y||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=c),p!==g)){if(_=RT,T="onMouseLeave",m="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(_=LT,T="onPointerLeave",m="onPointerEnter",x="pointer"),y=p==null?d:dc(p),v=g==null?d:dc(g),d=new _(T,x+"leave",p,t,u),d.target=y,d.relatedTarget=v,T=null,ko(u)===c&&(_=new _(m,x+"enter",g,t,u),_.target=v,_.relatedTarget=y,T=_),y=T,p&&g)t:{for(_=p,m=g,x=0,v=_;v;v=Pl(v))x++;for(v=0,T=m;T;T=Pl(T))v++;for(;0<x-v;)_=Pl(_),x--;for(;0<v-x;)m=Pl(m),v--;for(;x--;){if(_===m||m!==null&&_===m.alternate)break t;_=Pl(_),m=Pl(m)}_=null}else _=null;p!==null&&GT(h,d,p,_,!1),g!==null&&y!==null&&GT(h,y,g,_,!0)}}e:{if(d=c?dc(c):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var R=GO;else if(OT(d))if(hI)R=jO;else{R=$O;var C=WO}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(R=qO);if(R&&(R=R(n,c))){uI(h,R,t,u);break e}C&&C(n,d,c),n==="focusout"&&(C=d._wrapperState)&&C.controlled&&d.type==="number"&&Sx(d,"number",d.value)}switch(C=c?dc(c):window,n){case"focusin":(OT(C)||C.contentEditable==="true")&&(uc=C,Dx=c,ph=null);break;case"focusout":ph=Dx=uc=null;break;case"mousedown":Nx=!0;break;case"contextmenu":case"mouseup":case"dragend":Nx=!1,BT(h,t,u);break;case"selectionchange":if(YO)break;case"keydown":case"keyup":BT(h,t,u)}var A;if(ES)e:{switch(n){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else cc?lI(n,t)&&(E="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(E="onCompositionStart");E&&(oI&&t.locale!=="ko"&&(cc||E!=="onCompositionStart"?E==="onCompositionEnd"&&cc&&(A=aI()):(wa=u,bS="value"in wa?wa.value:wa.textContent,cc=!0)),C=fm(c,E),0<C.length&&(E=new PT(E,n,null,t,u),h.push({event:E,listeners:C}),A?E.data=A:(A=cI(t),A!==null&&(E.data=A)))),(A=FO?VO(n,t):BO(n,t))&&(c=fm(c,"onBeforeInput"),0<c.length&&(u=new PT("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=A))}SI(h,e)})}function $h(n,e,t){return{instance:n,listener:e,currentTarget:t}}function fm(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Fh(n,t),s!=null&&i.unshift($h(n,s,r)),s=Fh(n,e),s!=null&&i.push($h(n,s,r))),n=n.return}return i}function Pl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function GT(n,e,t,i,r){for(var s=e._reactName,a=[];t!==null&&t!==i;){var o=t,l=o.alternate,c=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&c!==null&&(o=c,r?(l=Fh(t,s),l!=null&&a.unshift($h(t,l,o))):r||(l=Fh(t,s),l!=null&&a.push($h(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var ek=/\r\n?/g,tk=/\u0000|\uFFFD/g;function WT(n){return(typeof n=="string"?n:""+n).replace(ek,`
`).replace(tk,"")}function wf(n,e,t){if(e=WT(e),WT(n)!==e&&t)throw Error(ye(425))}function pm(){}var Ox=null,kx=null;function Ux(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Fx=typeof setTimeout=="function"?setTimeout:void 0,nk=typeof clearTimeout=="function"?clearTimeout:void 0,$T=typeof Promise=="function"?Promise:void 0,ik=typeof queueMicrotask=="function"?queueMicrotask:typeof $T<"u"?function(n){return $T.resolve(null).then(n).catch(rk)}:Fx;function rk(n){setTimeout(function(){throw n})}function Hy(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),zh(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);zh(e)}function Da(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function qT(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var ou=Math.random().toString(36).slice(2),qr="__reactFiber$"+ou,qh="__reactProps$"+ou,ks="__reactContainer$"+ou,Vx="__reactEvents$"+ou,sk="__reactListeners$"+ou,ak="__reactHandles$"+ou;function ko(n){var e=n[qr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ks]||t[qr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=qT(n);n!==null;){if(t=n[qr])return t;n=qT(n)}return e}n=t,t=n.parentNode}return null}function Ld(n){return n=n[qr]||n[ks],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function dc(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ye(33))}function Kg(n){return n[qh]||null}var Bx=[],fc=-1;function so(n){return{current:n}}function Qt(n){0>fc||(n.current=Bx[fc],Bx[fc]=null,fc--)}function Kt(n,e){fc++,Bx[fc]=n.current,n.current=e}var $a={},ui=so($a),Di=so(!1),Jo=$a;function kc(n,e){var t=n.type.contextTypes;if(!t)return $a;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function Ni(n){return n=n.childContextTypes,n!=null}function mm(){Qt(Di),Qt(ui)}function jT(n,e,t){if(ui.current!==$a)throw Error(ye(168));Kt(ui,e),Kt(Di,t)}function wI(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(ye(108,WN(n)||"Unknown",r));return on({},t,i)}function gm(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||$a,Jo=ui.current,Kt(ui,n),Kt(Di,Di.current),!0}function XT(n,e,t){var i=n.stateNode;if(!i)throw Error(ye(169));t?(n=wI(n,e,Jo),i.__reactInternalMemoizedMergedChildContext=n,Qt(Di),Qt(ui),Kt(ui,n)):Qt(Di),Kt(Di,t)}var bs=null,Yg=!1,Gy=!1;function TI(n){bs===null?bs=[n]:bs.push(n)}function ok(n){Yg=!0,TI(n)}function ao(){if(!Gy&&bs!==null){Gy=!0;var n=0,e=Gt;try{var t=bs;for(Gt=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}bs=null,Yg=!1}catch(r){throw bs!==null&&(bs=bs.slice(n+1)),KC(_S,ao),r}finally{Gt=e,Gy=!1}}return null}var pc=[],mc=0,ym=null,_m=0,sr=[],ar=0,Zo=null,As=1,Ms="";function Ro(n,e){pc[mc++]=_m,pc[mc++]=ym,ym=n,_m=e}function EI(n,e,t){sr[ar++]=As,sr[ar++]=Ms,sr[ar++]=Zo,Zo=n;var i=As;n=Ms;var r=32-Cr(i)-1;i&=~(1<<r),t+=1;var s=32-Cr(e)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,As=1<<32-Cr(e)+r|t<<r|i,Ms=s+n}else As=1<<s|t<<r|i,Ms=n}function MS(n){n.return!==null&&(Ro(n,1),EI(n,1,0))}function CS(n){for(;n===ym;)ym=pc[--mc],pc[mc]=null,_m=pc[--mc],pc[mc]=null;for(;n===Zo;)Zo=sr[--ar],sr[ar]=null,Ms=sr[--ar],sr[ar]=null,As=sr[--ar],sr[ar]=null}var Xi=null,$i=null,en=!1,wr=null;function AI(n,e){var t=cr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function KT(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Xi=n,$i=Da(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Xi=n,$i=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Zo!==null?{id:As,overflow:Ms}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=cr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Xi=n,$i=null,!0):!1;default:return!1}}function zx(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Hx(n){if(en){var e=$i;if(e){var t=e;if(!KT(n,e)){if(zx(n))throw Error(ye(418));e=Da(t.nextSibling);var i=Xi;e&&KT(n,e)?AI(i,t):(n.flags=n.flags&-4097|2,en=!1,Xi=n)}}else{if(zx(n))throw Error(ye(418));n.flags=n.flags&-4097|2,en=!1,Xi=n}}}function YT(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Xi=n}function Tf(n){if(n!==Xi)return!1;if(!en)return YT(n),en=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Ux(n.type,n.memoizedProps)),e&&(e=$i)){if(zx(n))throw MI(),Error(ye(418));for(;e;)AI(n,e),e=Da(e.nextSibling)}if(YT(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ye(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){$i=Da(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}$i=null}}else $i=Xi?Da(n.stateNode.nextSibling):null;return!0}function MI(){for(var n=$i;n;)n=Da(n.nextSibling)}function Uc(){$i=Xi=null,en=!1}function IS(n){wr===null?wr=[n]:wr.push(n)}var lk=js.ReactCurrentBatchConfig;function Nu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ye(309));var i=t.stateNode}if(!i)throw Error(ye(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=r.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof n!="string")throw Error(ye(284));if(!t._owner)throw Error(ye(290,n))}return n}function Ef(n,e){throw n=Object.prototype.toString.call(e),Error(ye(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function JT(n){var e=n._init;return e(n._payload)}function CI(n){function e(m,x){if(n){var v=m.deletions;v===null?(m.deletions=[x],m.flags|=16):v.push(x)}}function t(m,x){if(!n)return null;for(;x!==null;)e(m,x),x=x.sibling;return null}function i(m,x){for(m=new Map;x!==null;)x.key!==null?m.set(x.key,x):m.set(x.index,x),x=x.sibling;return m}function r(m,x){return m=Ua(m,x),m.index=0,m.sibling=null,m}function s(m,x,v){return m.index=v,n?(v=m.alternate,v!==null?(v=v.index,v<x?(m.flags|=2,x):v):(m.flags|=2,x)):(m.flags|=1048576,x)}function a(m){return n&&m.alternate===null&&(m.flags|=2),m}function o(m,x,v,T){return x===null||x.tag!==6?(x=Yy(v,m.mode,T),x.return=m,x):(x=r(x,v),x.return=m,x)}function l(m,x,v,T){var R=v.type;return R===lc?u(m,x,v.props.children,T,v.key):x!==null&&(x.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===fa&&JT(R)===x.type)?(T=r(x,v.props),T.ref=Nu(m,x,v),T.return=m,T):(T=Wp(v.type,v.key,v.props,null,m.mode,T),T.ref=Nu(m,x,v),T.return=m,T)}function c(m,x,v,T){return x===null||x.tag!==4||x.stateNode.containerInfo!==v.containerInfo||x.stateNode.implementation!==v.implementation?(x=Jy(v,m.mode,T),x.return=m,x):(x=r(x,v.children||[]),x.return=m,x)}function u(m,x,v,T,R){return x===null||x.tag!==7?(x=Wo(v,m.mode,T,R),x.return=m,x):(x=r(x,v),x.return=m,x)}function h(m,x,v){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Yy(""+x,m.mode,v),x.return=m,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case pf:return v=Wp(x.type,x.key,x.props,null,m.mode,v),v.ref=Nu(m,null,x),v.return=m,v;case oc:return x=Jy(x,m.mode,v),x.return=m,x;case fa:var T=x._init;return h(m,T(x._payload),v)}if(eh(x)||Iu(x))return x=Wo(x,m.mode,v,null),x.return=m,x;Ef(m,x)}return null}function d(m,x,v,T){var R=x!==null?x.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return R!==null?null:o(m,x,""+v,T);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case pf:return v.key===R?l(m,x,v,T):null;case oc:return v.key===R?c(m,x,v,T):null;case fa:return R=v._init,d(m,x,R(v._payload),T)}if(eh(v)||Iu(v))return R!==null?null:u(m,x,v,T,null);Ef(m,v)}return null}function p(m,x,v,T,R){if(typeof T=="string"&&T!==""||typeof T=="number")return m=m.get(v)||null,o(x,m,""+T,R);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case pf:return m=m.get(T.key===null?v:T.key)||null,l(x,m,T,R);case oc:return m=m.get(T.key===null?v:T.key)||null,c(x,m,T,R);case fa:var C=T._init;return p(m,x,v,C(T._payload),R)}if(eh(T)||Iu(T))return m=m.get(v)||null,u(x,m,T,R,null);Ef(x,T)}return null}function g(m,x,v,T){for(var R=null,C=null,A=x,E=x=0,b=null;A!==null&&E<v.length;E++){A.index>E?(b=A,A=null):b=A.sibling;var S=d(m,A,v[E],T);if(S===null){A===null&&(A=b);break}n&&A&&S.alternate===null&&e(m,A),x=s(S,x,E),C===null?R=S:C.sibling=S,C=S,A=b}if(E===v.length)return t(m,A),en&&Ro(m,E),R;if(A===null){for(;E<v.length;E++)A=h(m,v[E],T),A!==null&&(x=s(A,x,E),C===null?R=A:C.sibling=A,C=A);return en&&Ro(m,E),R}for(A=i(m,A);E<v.length;E++)b=p(A,m,E,v[E],T),b!==null&&(n&&b.alternate!==null&&A.delete(b.key===null?E:b.key),x=s(b,x,E),C===null?R=b:C.sibling=b,C=b);return n&&A.forEach(function(I){return e(m,I)}),en&&Ro(m,E),R}function _(m,x,v,T){var R=Iu(v);if(typeof R!="function")throw Error(ye(150));if(v=R.call(v),v==null)throw Error(ye(151));for(var C=R=null,A=x,E=x=0,b=null,S=v.next();A!==null&&!S.done;E++,S=v.next()){A.index>E?(b=A,A=null):b=A.sibling;var I=d(m,A,S.value,T);if(I===null){A===null&&(A=b);break}n&&A&&I.alternate===null&&e(m,A),x=s(I,x,E),C===null?R=I:C.sibling=I,C=I,A=b}if(S.done)return t(m,A),en&&Ro(m,E),R;if(A===null){for(;!S.done;E++,S=v.next())S=h(m,S.value,T),S!==null&&(x=s(S,x,E),C===null?R=S:C.sibling=S,C=S);return en&&Ro(m,E),R}for(A=i(m,A);!S.done;E++,S=v.next())S=p(A,m,E,S.value,T),S!==null&&(n&&S.alternate!==null&&A.delete(S.key===null?E:S.key),x=s(S,x,E),C===null?R=S:C.sibling=S,C=S);return n&&A.forEach(function(D){return e(m,D)}),en&&Ro(m,E),R}function y(m,x,v,T){if(typeof v=="object"&&v!==null&&v.type===lc&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case pf:e:{for(var R=v.key,C=x;C!==null;){if(C.key===R){if(R=v.type,R===lc){if(C.tag===7){t(m,C.sibling),x=r(C,v.props.children),x.return=m,m=x;break e}}else if(C.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===fa&&JT(R)===C.type){t(m,C.sibling),x=r(C,v.props),x.ref=Nu(m,C,v),x.return=m,m=x;break e}t(m,C);break}else e(m,C);C=C.sibling}v.type===lc?(x=Wo(v.props.children,m.mode,T,v.key),x.return=m,m=x):(T=Wp(v.type,v.key,v.props,null,m.mode,T),T.ref=Nu(m,x,v),T.return=m,m=T)}return a(m);case oc:e:{for(C=v.key;x!==null;){if(x.key===C)if(x.tag===4&&x.stateNode.containerInfo===v.containerInfo&&x.stateNode.implementation===v.implementation){t(m,x.sibling),x=r(x,v.children||[]),x.return=m,m=x;break e}else{t(m,x);break}else e(m,x);x=x.sibling}x=Jy(v,m.mode,T),x.return=m,m=x}return a(m);case fa:return C=v._init,y(m,x,C(v._payload),T)}if(eh(v))return g(m,x,v,T);if(Iu(v))return _(m,x,v,T);Ef(m,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,x!==null&&x.tag===6?(t(m,x.sibling),x=r(x,v),x.return=m,m=x):(t(m,x),x=Yy(v,m.mode,T),x.return=m,m=x),a(m)):t(m,x)}return y}var Fc=CI(!0),II=CI(!1),xm=so(null),vm=null,gc=null,RS=null;function PS(){RS=gc=vm=null}function LS(n){var e=xm.current;Qt(xm),n._currentValue=e}function Gx(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function Ac(n,e){vm=n,RS=gc=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Ri=!0),n.firstContext=null)}function hr(n){var e=n._currentValue;if(RS!==n)if(n={context:n,memoizedValue:e,next:null},gc===null){if(vm===null)throw Error(ye(308));gc=n,vm.dependencies={lanes:0,firstContext:n}}else gc=gc.next=n;return e}var Uo=null;function DS(n){Uo===null?Uo=[n]:Uo.push(n)}function RI(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,DS(e)):(t.next=r.next,r.next=t),e.interleaved=t,Us(n,i)}function Us(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var pa=!1;function NS(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function PI(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Rs(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Na(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,Ut&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Us(n,t)}return r=i.interleaved,r===null?(e.next=e,DS(i)):(e.next=r.next,r.next=e),i.interleaved=e,Us(n,t)}function Fp(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,xS(n,t)}}function ZT(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Sm(n,e,t,i){var r=n.updateQueue;pa=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?s=c:a.next=c,a=l;var u=n.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;a=0,u=c=l=null,o=s;do{var d=o.lane,p=o.eventTime;if((i&d)===d){u!==null&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=n,_=o;switch(d=e,p=t,_.tag){case 1:if(g=_.payload,typeof g=="function"){h=g.call(p,h,d);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=_.payload,d=typeof g=="function"?g.call(p,h,d):g,d==null)break e;h=on({},h,d);break e;case 2:pa=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,d=r.effects,d===null?r.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=p,l=h):u=u.next=p,a|=d;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;d=o,o=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(u===null&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);el|=a,n.lanes=a,n.memoizedState=h}}function QT(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(ye(191,r));r.call(i)}}}var Dd={},Qr=so(Dd),jh=so(Dd),Xh=so(Dd);function Fo(n){if(n===Dd)throw Error(ye(174));return n}function OS(n,e){switch(Kt(Xh,e),Kt(jh,n),Kt(Qr,Dd),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:wx(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=wx(e,n)}Qt(Qr),Kt(Qr,e)}function Vc(){Qt(Qr),Qt(jh),Qt(Xh)}function LI(n){Fo(Xh.current);var e=Fo(Qr.current),t=wx(e,n.type);e!==t&&(Kt(jh,n),Kt(Qr,t))}function kS(n){jh.current===n&&(Qt(Qr),Qt(jh))}var nn=so(0);function bm(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Wy=[];function US(){for(var n=0;n<Wy.length;n++)Wy[n]._workInProgressVersionPrimary=null;Wy.length=0}var Vp=js.ReactCurrentDispatcher,$y=js.ReactCurrentBatchConfig,Qo=0,an=null,Cn=null,Fn=null,wm=!1,mh=!1,Kh=0,ck=0;function Jn(){throw Error(ye(321))}function FS(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Dr(n[t],e[t]))return!1;return!0}function VS(n,e,t,i,r,s){if(Qo=s,an=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Vp.current=n===null||n.memoizedState===null?fk:pk,n=t(i,r),mh){s=0;do{if(mh=!1,Kh=0,25<=s)throw Error(ye(301));s+=1,Fn=Cn=null,e.updateQueue=null,Vp.current=mk,n=t(i,r)}while(mh)}if(Vp.current=Tm,e=Cn!==null&&Cn.next!==null,Qo=0,Fn=Cn=an=null,wm=!1,e)throw Error(ye(300));return n}function BS(){var n=Kh!==0;return Kh=0,n}function Gr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fn===null?an.memoizedState=Fn=n:Fn=Fn.next=n,Fn}function dr(){if(Cn===null){var n=an.alternate;n=n!==null?n.memoizedState:null}else n=Cn.next;var e=Fn===null?an.memoizedState:Fn.next;if(e!==null)Fn=e,Cn=n;else{if(n===null)throw Error(ye(310));Cn=n,n={memoizedState:Cn.memoizedState,baseState:Cn.baseState,baseQueue:Cn.baseQueue,queue:Cn.queue,next:null},Fn===null?an.memoizedState=Fn=n:Fn=Fn.next=n}return Fn}function Yh(n,e){return typeof e=="function"?e(n):e}function qy(n){var e=dr(),t=e.queue;if(t===null)throw Error(ye(311));t.lastRenderedReducer=n;var i=Cn,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var o=a=null,l=null,c=s;do{var u=c.lane;if((Qo&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:n(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=h,a=i):l=l.next=h,an.lanes|=u,el|=u}c=c.next}while(c!==null&&c!==s);l===null?a=i:l.next=o,Dr(i,e.memoizedState)||(Ri=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,an.lanes|=s,el|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function jy(n){var e=dr(),t=e.queue;if(t===null)throw Error(ye(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do s=n(s,a.action),a=a.next;while(a!==r);Dr(s,e.memoizedState)||(Ri=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function DI(){}function NI(n,e){var t=an,i=dr(),r=e(),s=!Dr(i.memoizedState,r);if(s&&(i.memoizedState=r,Ri=!0),i=i.queue,zS(UI.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||Fn!==null&&Fn.memoizedState.tag&1){if(t.flags|=2048,Jh(9,kI.bind(null,t,i,r,e),void 0,null),Vn===null)throw Error(ye(349));Qo&30||OI(t,e,r)}return r}function OI(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=an.updateQueue,e===null?(e={lastEffect:null,stores:null},an.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function kI(n,e,t,i){e.value=t,e.getSnapshot=i,FI(e)&&VI(n)}function UI(n,e,t){return t(function(){FI(e)&&VI(n)})}function FI(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Dr(n,t)}catch{return!0}}function VI(n){var e=Us(n,1);e!==null&&Ir(e,n,1,-1)}function eE(n){var e=Gr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Yh,lastRenderedState:n},e.queue=n,n=n.dispatch=dk.bind(null,an,n),[e.memoizedState,n]}function Jh(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=an.updateQueue,e===null?(e={lastEffect:null,stores:null},an.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function BI(){return dr().memoizedState}function Bp(n,e,t,i){var r=Gr();an.flags|=n,r.memoizedState=Jh(1|e,t,void 0,i===void 0?null:i)}function Jg(n,e,t,i){var r=dr();i=i===void 0?null:i;var s=void 0;if(Cn!==null){var a=Cn.memoizedState;if(s=a.destroy,i!==null&&FS(i,a.deps)){r.memoizedState=Jh(e,t,s,i);return}}an.flags|=n,r.memoizedState=Jh(1|e,t,s,i)}function tE(n,e){return Bp(8390656,8,n,e)}function zS(n,e){return Jg(2048,8,n,e)}function zI(n,e){return Jg(4,2,n,e)}function HI(n,e){return Jg(4,4,n,e)}function GI(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function WI(n,e,t){return t=t!=null?t.concat([n]):null,Jg(4,4,GI.bind(null,e,n),t)}function HS(){}function $I(n,e){var t=dr();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&FS(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function qI(n,e){var t=dr();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&FS(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function jI(n,e,t){return Qo&21?(Dr(t,e)||(t=ZC(),an.lanes|=t,el|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Ri=!0),n.memoizedState=t)}function uk(n,e){var t=Gt;Gt=t!==0&&4>t?t:4,n(!0);var i=$y.transition;$y.transition={};try{n(!1),e()}finally{Gt=t,$y.transition=i}}function XI(){return dr().memoizedState}function hk(n,e,t){var i=ka(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},KI(n))YI(e,t);else if(t=RI(n,e,t,i),t!==null){var r=xi();Ir(t,n,i,r),JI(t,e,i)}}function dk(n,e,t){var i=ka(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(KI(n))YI(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(r.hasEagerState=!0,r.eagerState=o,Dr(o,a)){var l=e.interleaved;l===null?(r.next=r,DS(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=RI(n,e,r,i),t!==null&&(r=xi(),Ir(t,n,i,r),JI(t,e,i))}}function KI(n){var e=n.alternate;return n===an||e!==null&&e===an}function YI(n,e){mh=wm=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function JI(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,xS(n,t)}}var Tm={readContext:hr,useCallback:Jn,useContext:Jn,useEffect:Jn,useImperativeHandle:Jn,useInsertionEffect:Jn,useLayoutEffect:Jn,useMemo:Jn,useReducer:Jn,useRef:Jn,useState:Jn,useDebugValue:Jn,useDeferredValue:Jn,useTransition:Jn,useMutableSource:Jn,useSyncExternalStore:Jn,useId:Jn,unstable_isNewReconciler:!1},fk={readContext:hr,useCallback:function(n,e){return Gr().memoizedState=[n,e===void 0?null:e],n},useContext:hr,useEffect:tE,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Bp(4194308,4,GI.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Bp(4194308,4,n,e)},useInsertionEffect:function(n,e){return Bp(4,2,n,e)},useMemo:function(n,e){var t=Gr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=Gr();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=hk.bind(null,an,n),[i.memoizedState,n]},useRef:function(n){var e=Gr();return n={current:n},e.memoizedState=n},useState:eE,useDebugValue:HS,useDeferredValue:function(n){return Gr().memoizedState=n},useTransition:function(){var n=eE(!1),e=n[0];return n=uk.bind(null,n[1]),Gr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=an,r=Gr();if(en){if(t===void 0)throw Error(ye(407));t=t()}else{if(t=e(),Vn===null)throw Error(ye(349));Qo&30||OI(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,tE(UI.bind(null,i,s,n),[n]),i.flags|=2048,Jh(9,kI.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=Gr(),e=Vn.identifierPrefix;if(en){var t=Ms,i=As;t=(i&~(1<<32-Cr(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=Kh++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=ck++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},pk={readContext:hr,useCallback:$I,useContext:hr,useEffect:zS,useImperativeHandle:WI,useInsertionEffect:zI,useLayoutEffect:HI,useMemo:qI,useReducer:qy,useRef:BI,useState:function(){return qy(Yh)},useDebugValue:HS,useDeferredValue:function(n){var e=dr();return jI(e,Cn.memoizedState,n)},useTransition:function(){var n=qy(Yh)[0],e=dr().memoizedState;return[n,e]},useMutableSource:DI,useSyncExternalStore:NI,useId:XI,unstable_isNewReconciler:!1},mk={readContext:hr,useCallback:$I,useContext:hr,useEffect:zS,useImperativeHandle:WI,useInsertionEffect:zI,useLayoutEffect:HI,useMemo:qI,useReducer:jy,useRef:BI,useState:function(){return jy(Yh)},useDebugValue:HS,useDeferredValue:function(n){var e=dr();return Cn===null?e.memoizedState=n:jI(e,Cn.memoizedState,n)},useTransition:function(){var n=jy(Yh)[0],e=dr().memoizedState;return[n,e]},useMutableSource:DI,useSyncExternalStore:NI,useId:XI,unstable_isNewReconciler:!1};function Sr(n,e){if(n&&n.defaultProps){e=on({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Wx(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:on({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Zg={isMounted:function(n){return(n=n._reactInternals)?pl(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=xi(),r=ka(n),s=Rs(i,r);s.payload=e,t!=null&&(s.callback=t),e=Na(n,s,r),e!==null&&(Ir(e,n,r,i),Fp(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=xi(),r=ka(n),s=Rs(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Na(n,s,r),e!==null&&(Ir(e,n,r,i),Fp(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=xi(),i=ka(n),r=Rs(t,i);r.tag=2,e!=null&&(r.callback=e),e=Na(n,r,i),e!==null&&(Ir(e,n,i,t),Fp(e,n,i))}};function nE(n,e,t,i,r,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,a):e.prototype&&e.prototype.isPureReactComponent?!Gh(t,i)||!Gh(r,s):!0}function ZI(n,e,t){var i=!1,r=$a,s=e.contextType;return typeof s=="object"&&s!==null?s=hr(s):(r=Ni(e)?Jo:ui.current,i=e.contextTypes,s=(i=i!=null)?kc(n,r):$a),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Zg,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function iE(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&Zg.enqueueReplaceState(e,e.state,null)}function $x(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},NS(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=hr(s):(s=Ni(e)?Jo:ui.current,r.context=kc(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Wx(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Zg.enqueueReplaceState(r,r.state,null),Sm(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function Bc(n,e){try{var t="",i=e;do t+=GN(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function Xy(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function qx(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var gk=typeof WeakMap=="function"?WeakMap:Map;function QI(n,e,t){t=Rs(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){Am||(Am=!0,nv=i),qx(n,e)},t}function eR(n,e,t){t=Rs(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){qx(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){qx(n,e),typeof i!="function"&&(Oa===null?Oa=new Set([this]):Oa.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function rE(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new gk;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=Rk.bind(null,n,e,t),e.then(n,n))}function sE(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function aE(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Rs(-1,1),e.tag=2,Na(t,e,1))),t.lanes|=1),n)}var yk=js.ReactCurrentOwner,Ri=!1;function yi(n,e,t,i){e.child=n===null?II(e,null,t,i):Fc(e,n.child,t,i)}function oE(n,e,t,i,r){t=t.render;var s=e.ref;return Ac(e,r),i=VS(n,e,t,i,s,r),t=BS(),n!==null&&!Ri?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Fs(n,e,r)):(en&&t&&MS(e),e.flags|=1,yi(n,e,i,r),e.child)}function lE(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!YS(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,tR(n,e,s,i,r)):(n=Wp(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:Gh,t(a,i)&&n.ref===e.ref)return Fs(n,e,r)}return e.flags|=1,n=Ua(s,i),n.ref=e.ref,n.return=e,e.child=n}function tR(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(Gh(s,i)&&n.ref===e.ref)if(Ri=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(Ri=!0);else return e.lanes=n.lanes,Fs(n,e,r)}return jx(n,e,t,i,r)}function nR(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kt(_c,Gi),Gi|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Kt(_c,Gi),Gi|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,Kt(_c,Gi),Gi|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,Kt(_c,Gi),Gi|=i;return yi(n,e,r,t),e.child}function iR(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function jx(n,e,t,i,r){var s=Ni(t)?Jo:ui.current;return s=kc(e,s),Ac(e,r),t=VS(n,e,t,i,s,r),i=BS(),n!==null&&!Ri?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Fs(n,e,r)):(en&&i&&MS(e),e.flags|=1,yi(n,e,t,r),e.child)}function cE(n,e,t,i,r){if(Ni(t)){var s=!0;gm(e)}else s=!1;if(Ac(e,r),e.stateNode===null)zp(n,e),ZI(e,t,i),$x(e,t,i,r),i=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,c=t.contextType;typeof c=="object"&&c!==null?c=hr(c):(c=Ni(t)?Jo:ui.current,c=kc(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||l!==c)&&iE(e,a,i,c),pa=!1;var d=e.memoizedState;a.state=d,Sm(e,i,a,r),l=e.memoizedState,o!==i||d!==l||Di.current||pa?(typeof u=="function"&&(Wx(e,t,u,i),l=e.memoizedState),(o=pa||nE(e,t,o,i,d,l,c))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,PI(n,e),o=e.memoizedProps,c=e.type===e.elementType?o:Sr(e.type,o),a.props=c,h=e.pendingProps,d=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=hr(l):(l=Ni(t)?Jo:ui.current,l=kc(e,l));var p=t.getDerivedStateFromProps;(u=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||d!==l)&&iE(e,a,i,l),pa=!1,d=e.memoizedState,a.state=d,Sm(e,i,a,r);var g=e.memoizedState;o!==h||d!==g||Di.current||pa?(typeof p=="function"&&(Wx(e,t,p,i),g=e.memoizedState),(c=pa||nE(e,t,c,i,d,g,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),a.props=i,a.state=g,a.context=l,i=c):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),i=!1)}return Xx(n,e,t,i,s,r)}function Xx(n,e,t,i,r,s){iR(n,e);var a=(e.flags&128)!==0;if(!i&&!a)return r&&XT(e,t,!1),Fs(n,e,s);i=e.stateNode,yk.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&a?(e.child=Fc(e,n.child,null,s),e.child=Fc(e,null,o,s)):yi(n,e,o,s),e.memoizedState=i.state,r&&XT(e,t,!0),e.child}function rR(n){var e=n.stateNode;e.pendingContext?jT(n,e.pendingContext,e.pendingContext!==e.context):e.context&&jT(n,e.context,!1),OS(n,e.containerInfo)}function uE(n,e,t,i,r){return Uc(),IS(r),e.flags|=256,yi(n,e,t,i),e.child}var Kx={dehydrated:null,treeContext:null,retryLane:0};function Yx(n){return{baseLanes:n,cachePool:null,transitions:null}}function sR(n,e,t){var i=e.pendingProps,r=nn.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(r&2)!==0),o?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),Kt(nn,r&1),n===null)return Hx(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,n=i.fallback,s?(i=e.mode,s=e.child,a={mode:"hidden",children:a},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=t0(a,i,0,null),n=Wo(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=Yx(t),e.memoizedState=Kx,n):GS(e,a));if(r=n.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return _k(n,e,a,i,o,r,t);if(s){s=i.fallback,a=e.mode,r=n.child,o=r.sibling;var l={mode:"hidden",children:i.children};return!(a&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Ua(r,l),i.subtreeFlags=r.subtreeFlags&14680064),o!==null?s=Ua(o,s):(s=Wo(s,a,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,a=n.child.memoizedState,a=a===null?Yx(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=n.childLanes&~t,e.memoizedState=Kx,i}return s=n.child,n=s.sibling,i=Ua(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function GS(n,e){return e=t0({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Af(n,e,t,i){return i!==null&&IS(i),Fc(e,n.child,null,t),n=GS(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function _k(n,e,t,i,r,s,a){if(t)return e.flags&256?(e.flags&=-257,i=Xy(Error(ye(422))),Af(n,e,a,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=t0({mode:"visible",children:i.children},r,0,null),s=Wo(s,r,a,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Fc(e,n.child,null,a),e.child.memoizedState=Yx(a),e.memoizedState=Kx,s);if(!(e.mode&1))return Af(n,e,a,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var o=i.dgst;return i=o,s=Error(ye(419)),i=Xy(s,i,void 0),Af(n,e,a,i)}if(o=(a&n.childLanes)!==0,Ri||o){if(i=Vn,i!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|a)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Us(n,r),Ir(i,n,r,-1))}return KS(),i=Xy(Error(ye(421))),Af(n,e,a,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=Pk.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,$i=Da(r.nextSibling),Xi=e,en=!0,wr=null,n!==null&&(sr[ar++]=As,sr[ar++]=Ms,sr[ar++]=Zo,As=n.id,Ms=n.overflow,Zo=e),e=GS(e,i.children),e.flags|=4096,e)}function hE(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),Gx(n.return,e,t)}function Ky(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function aR(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(yi(n,e,i.children,t),i=nn.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&hE(n,t,e);else if(n.tag===19)hE(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Kt(nn,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&bm(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Ky(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&bm(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}Ky(e,!0,t,null,s);break;case"together":Ky(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function zp(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Fs(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),el|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(ye(153));if(e.child!==null){for(n=e.child,t=Ua(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Ua(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function xk(n,e,t){switch(e.tag){case 3:rR(e),Uc();break;case 5:LI(e);break;case 1:Ni(e.type)&&gm(e);break;case 4:OS(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Kt(xm,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Kt(nn,nn.current&1),e.flags|=128,null):t&e.child.childLanes?sR(n,e,t):(Kt(nn,nn.current&1),n=Fs(n,e,t),n!==null?n.sibling:null);Kt(nn,nn.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return aR(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Kt(nn,nn.current),i)break;return null;case 22:case 23:return e.lanes=0,nR(n,e,t)}return Fs(n,e,t)}var oR,Jx,lR,cR;oR=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Jx=function(){};lR=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,Fo(Qr.current);var s=null;switch(t){case"input":r=xx(n,r),i=xx(n,i),s=[];break;case"select":r=on({},r,{value:void 0}),i=on({},i,{value:void 0}),s=[];break;case"textarea":r=bx(n,r),i=bx(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=pm)}Tx(t,i);var a;t=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var o=r[c];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(kh.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(o=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(kh.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Jt("scroll",n),s||o===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};cR=function(n,e,t,i){t!==i&&(e.flags|=4)};function Ou(n,e){if(!en)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function Zn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function vk(n,e,t){var i=e.pendingProps;switch(CS(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zn(e),null;case 1:return Ni(e.type)&&mm(),Zn(e),null;case 3:return i=e.stateNode,Vc(),Qt(Di),Qt(ui),US(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(Tf(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,wr!==null&&(sv(wr),wr=null))),Jx(n,e),Zn(e),null;case 5:kS(e);var r=Fo(Xh.current);if(t=e.type,n!==null&&e.stateNode!=null)lR(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(ye(166));return Zn(e),null}if(n=Fo(Qr.current),Tf(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[qr]=e,i[qh]=s,n=(e.mode&1)!==0,t){case"dialog":Jt("cancel",i),Jt("close",i);break;case"iframe":case"object":case"embed":Jt("load",i);break;case"video":case"audio":for(r=0;r<nh.length;r++)Jt(nh[r],i);break;case"source":Jt("error",i);break;case"img":case"image":case"link":Jt("error",i),Jt("load",i);break;case"details":Jt("toggle",i);break;case"input":vT(i,s),Jt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Jt("invalid",i);break;case"textarea":bT(i,s),Jt("invalid",i)}Tx(t,s),r=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?i.textContent!==o&&(s.suppressHydrationWarning!==!0&&wf(i.textContent,o,n),r=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&wf(i.textContent,o,n),r=["children",""+o]):kh.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Jt("scroll",i)}switch(t){case"input":mf(i),ST(i,s,!0);break;case"textarea":mf(i),wT(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=pm)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=UC(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=a.createElement(t,{is:i.is}):(n=a.createElement(t),t==="select"&&(a=n,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):n=a.createElementNS(n,t),n[qr]=e,n[qh]=i,oR(n,e,!1,!1),e.stateNode=n;e:{switch(a=Ex(t,i),t){case"dialog":Jt("cancel",n),Jt("close",n),r=i;break;case"iframe":case"object":case"embed":Jt("load",n),r=i;break;case"video":case"audio":for(r=0;r<nh.length;r++)Jt(nh[r],n);r=i;break;case"source":Jt("error",n),r=i;break;case"img":case"image":case"link":Jt("error",n),Jt("load",n),r=i;break;case"details":Jt("toggle",n),r=i;break;case"input":vT(n,i),r=xx(n,i),Jt("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=on({},i,{value:void 0}),Jt("invalid",n);break;case"textarea":bT(n,i),r=bx(n,i),Jt("invalid",n);break;default:r=i}Tx(t,r),o=r;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?BC(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&FC(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Uh(n,l):typeof l=="number"&&Uh(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(kh.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Jt("scroll",n):l!=null&&fS(n,s,l,a))}switch(t){case"input":mf(n),ST(n,i,!1);break;case"textarea":mf(n),wT(n);break;case"option":i.value!=null&&n.setAttribute("value",""+Wa(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?bc(n,!!i.multiple,s,!1):i.defaultValue!=null&&bc(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=pm)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Zn(e),null;case 6:if(n&&e.stateNode!=null)cR(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(ye(166));if(t=Fo(Xh.current),Fo(Qr.current),Tf(e)){if(i=e.stateNode,t=e.memoizedProps,i[qr]=e,(s=i.nodeValue!==t)&&(n=Xi,n!==null))switch(n.tag){case 3:wf(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&wf(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[qr]=e,e.stateNode=i}return Zn(e),null;case 13:if(Qt(nn),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(en&&$i!==null&&e.mode&1&&!(e.flags&128))MI(),Uc(),e.flags|=98560,s=!1;else if(s=Tf(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(ye(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ye(317));s[qr]=e}else Uc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Zn(e),s=!1}else wr!==null&&(sv(wr),wr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||nn.current&1?Rn===0&&(Rn=3):KS())),e.updateQueue!==null&&(e.flags|=4),Zn(e),null);case 4:return Vc(),Jx(n,e),n===null&&Wh(e.stateNode.containerInfo),Zn(e),null;case 10:return LS(e.type._context),Zn(e),null;case 17:return Ni(e.type)&&mm(),Zn(e),null;case 19:if(Qt(nn),s=e.memoizedState,s===null)return Zn(e),null;if(i=(e.flags&128)!==0,a=s.rendering,a===null)if(i)Ou(s,!1);else{if(Rn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=bm(n),a!==null){for(e.flags|=128,Ou(s,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Kt(nn,nn.current&1|2),e.child}n=n.sibling}s.tail!==null&&_n()>zc&&(e.flags|=128,i=!0,Ou(s,!1),e.lanes=4194304)}else{if(!i)if(n=bm(a),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Ou(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!en)return Zn(e),null}else 2*_n()-s.renderingStartTime>zc&&t!==1073741824&&(e.flags|=128,i=!0,Ou(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=_n(),e.sibling=null,t=nn.current,Kt(nn,i?t&1|2:t&1),e):(Zn(e),null);case 22:case 23:return XS(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Gi&1073741824&&(Zn(e),e.subtreeFlags&6&&(e.flags|=8192)):Zn(e),null;case 24:return null;case 25:return null}throw Error(ye(156,e.tag))}function Sk(n,e){switch(CS(e),e.tag){case 1:return Ni(e.type)&&mm(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Vc(),Qt(Di),Qt(ui),US(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return kS(e),null;case 13:if(Qt(nn),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(ye(340));Uc()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Qt(nn),null;case 4:return Vc(),null;case 10:return LS(e.type._context),null;case 22:case 23:return XS(),null;case 24:return null;default:return null}}var Mf=!1,ai=!1,bk=typeof WeakSet=="function"?WeakSet:Set,Ve=null;function yc(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){hn(n,e,i)}else t.current=null}function Zx(n,e,t){try{t()}catch(i){hn(n,e,i)}}var dE=!1;function wk(n,e){if(Ox=hm,n=pI(),AS(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,c=0,u=0,h=n,d=null;t:for(;;){for(var p;h!==t||r!==0&&h.nodeType!==3||(o=a+r),h!==s||i!==0&&h.nodeType!==3||(l=a+i),h.nodeType===3&&(a+=h.nodeValue.length),(p=h.firstChild)!==null;)d=h,h=p;for(;;){if(h===n)break t;if(d===t&&++c===r&&(o=a),d===s&&++u===i&&(l=a),(p=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=p}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(kx={focusedElem:n,selectionRange:t},hm=!1,Ve=e;Ve!==null;)if(e=Ve,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Ve=n;else for(;Ve!==null;){e=Ve;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var _=g.memoizedProps,y=g.memoizedState,m=e.stateNode,x=m.getSnapshotBeforeUpdate(e.elementType===e.type?_:Sr(e.type,_),y);m.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ye(163))}}catch(T){hn(e,e.return,T)}if(n=e.sibling,n!==null){n.return=e.return,Ve=n;break}Ve=e.return}return g=dE,dE=!1,g}function gh(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&Zx(e,t,s)}r=r.next}while(r!==i)}}function Qg(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function Qx(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function uR(n){var e=n.alternate;e!==null&&(n.alternate=null,uR(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[qr],delete e[qh],delete e[Vx],delete e[sk],delete e[ak])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function hR(n){return n.tag===5||n.tag===3||n.tag===4}function fE(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||hR(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function ev(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=pm));else if(i!==4&&(n=n.child,n!==null))for(ev(n,e,t),n=n.sibling;n!==null;)ev(n,e,t),n=n.sibling}function tv(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(tv(n,e,t),n=n.sibling;n!==null;)tv(n,e,t),n=n.sibling}var zn=null,br=!1;function na(n,e,t){for(t=t.child;t!==null;)dR(n,e,t),t=t.sibling}function dR(n,e,t){if(Zr&&typeof Zr.onCommitFiberUnmount=="function")try{Zr.onCommitFiberUnmount($g,t)}catch{}switch(t.tag){case 5:ai||yc(t,e);case 6:var i=zn,r=br;zn=null,na(n,e,t),zn=i,br=r,zn!==null&&(br?(n=zn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):zn.removeChild(t.stateNode));break;case 18:zn!==null&&(br?(n=zn,t=t.stateNode,n.nodeType===8?Hy(n.parentNode,t):n.nodeType===1&&Hy(n,t),zh(n)):Hy(zn,t.stateNode));break;case 4:i=zn,r=br,zn=t.stateNode.containerInfo,br=!0,na(n,e,t),zn=i,br=r;break;case 0:case 11:case 14:case 15:if(!ai&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&Zx(t,e,a),r=r.next}while(r!==i)}na(n,e,t);break;case 1:if(!ai&&(yc(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(o){hn(t,e,o)}na(n,e,t);break;case 21:na(n,e,t);break;case 22:t.mode&1?(ai=(i=ai)||t.memoizedState!==null,na(n,e,t),ai=i):na(n,e,t);break;default:na(n,e,t)}}function pE(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new bk),e.forEach(function(i){var r=Lk.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function yr(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:zn=o.stateNode,br=!1;break e;case 3:zn=o.stateNode.containerInfo,br=!0;break e;case 4:zn=o.stateNode.containerInfo,br=!0;break e}o=o.return}if(zn===null)throw Error(ye(160));dR(s,a,r),zn=null,br=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){hn(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)fR(e,n),e=e.sibling}function fR(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(yr(e,n),Br(n),i&4){try{gh(3,n,n.return),Qg(3,n)}catch(_){hn(n,n.return,_)}try{gh(5,n,n.return)}catch(_){hn(n,n.return,_)}}break;case 1:yr(e,n),Br(n),i&512&&t!==null&&yc(t,t.return);break;case 5:if(yr(e,n),Br(n),i&512&&t!==null&&yc(t,t.return),n.flags&32){var r=n.stateNode;try{Uh(r,"")}catch(_){hn(n,n.return,_)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,a=t!==null?t.memoizedProps:s,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&OC(r,s),Ex(o,a);var c=Ex(o,s);for(a=0;a<l.length;a+=2){var u=l[a],h=l[a+1];u==="style"?BC(r,h):u==="dangerouslySetInnerHTML"?FC(r,h):u==="children"?Uh(r,h):fS(r,u,h,c)}switch(o){case"input":vx(r,s);break;case"textarea":kC(r,s);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?bc(r,!!s.multiple,p,!1):d!==!!s.multiple&&(s.defaultValue!=null?bc(r,!!s.multiple,s.defaultValue,!0):bc(r,!!s.multiple,s.multiple?[]:"",!1))}r[qh]=s}catch(_){hn(n,n.return,_)}}break;case 6:if(yr(e,n),Br(n),i&4){if(n.stateNode===null)throw Error(ye(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(_){hn(n,n.return,_)}}break;case 3:if(yr(e,n),Br(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{zh(e.containerInfo)}catch(_){hn(n,n.return,_)}break;case 4:yr(e,n),Br(n);break;case 13:yr(e,n),Br(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(qS=_n())),i&4&&pE(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(ai=(c=ai)||u,yr(e,n),ai=c):yr(e,n),Br(n),i&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(Ve=n,u=n.child;u!==null;){for(h=Ve=u;Ve!==null;){switch(d=Ve,p=d.child,d.tag){case 0:case 11:case 14:case 15:gh(4,d,d.return);break;case 1:yc(d,d.return);var g=d.stateNode;if(typeof g.componentWillUnmount=="function"){i=d,t=d.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(_){hn(i,t,_)}}break;case 5:yc(d,d.return);break;case 22:if(d.memoizedState!==null){gE(h);continue}}p!==null?(p.return=d,Ve=p):gE(h)}u=u.sibling}e:for(u=null,h=n;;){if(h.tag===5){if(u===null){u=h;try{r=h.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=VC("display",a))}catch(_){hn(n,n.return,_)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(_){hn(n,n.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:yr(e,n),Br(n),i&4&&pE(n);break;case 21:break;default:yr(e,n),Br(n)}}function Br(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(hR(t)){var i=t;break e}t=t.return}throw Error(ye(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Uh(r,""),i.flags&=-33);var s=fE(n);tv(n,s,r);break;case 3:case 4:var a=i.stateNode.containerInfo,o=fE(n);ev(n,o,a);break;default:throw Error(ye(161))}}catch(l){hn(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Tk(n,e,t){Ve=n,pR(n)}function pR(n,e,t){for(var i=(n.mode&1)!==0;Ve!==null;){var r=Ve,s=r.child;if(r.tag===22&&i){var a=r.memoizedState!==null||Mf;if(!a){var o=r.alternate,l=o!==null&&o.memoizedState!==null||ai;o=Mf;var c=ai;if(Mf=a,(ai=l)&&!c)for(Ve=r;Ve!==null;)a=Ve,l=a.child,a.tag===22&&a.memoizedState!==null?yE(r):l!==null?(l.return=a,Ve=l):yE(r);for(;s!==null;)Ve=s,pR(s),s=s.sibling;Ve=r,Mf=o,ai=c}mE(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Ve=s):mE(n)}}function mE(n){for(;Ve!==null;){var e=Ve;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ai||Qg(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!ai)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Sr(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&QT(e,s,i);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}QT(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&zh(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ye(163))}ai||e.flags&512&&Qx(e)}catch(d){hn(e,e.return,d)}}if(e===n){Ve=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ve=t;break}Ve=e.return}}function gE(n){for(;Ve!==null;){var e=Ve;if(e===n){Ve=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ve=t;break}Ve=e.return}}function yE(n){for(;Ve!==null;){var e=Ve;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Qg(4,e)}catch(l){hn(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){hn(e,r,l)}}var s=e.return;try{Qx(e)}catch(l){hn(e,s,l)}break;case 5:var a=e.return;try{Qx(e)}catch(l){hn(e,a,l)}}}catch(l){hn(e,e.return,l)}if(e===n){Ve=null;break}var o=e.sibling;if(o!==null){o.return=e.return,Ve=o;break}Ve=e.return}}var Ek=Math.ceil,Em=js.ReactCurrentDispatcher,WS=js.ReactCurrentOwner,ur=js.ReactCurrentBatchConfig,Ut=0,Vn=null,bn=null,Wn=0,Gi=0,_c=so(0),Rn=0,Zh=null,el=0,e0=0,$S=0,yh=null,Ci=null,qS=0,zc=1/0,Ss=null,Am=!1,nv=null,Oa=null,Cf=!1,Ta=null,Mm=0,_h=0,iv=null,Hp=-1,Gp=0;function xi(){return Ut&6?_n():Hp!==-1?Hp:Hp=_n()}function ka(n){return n.mode&1?Ut&2&&Wn!==0?Wn&-Wn:lk.transition!==null?(Gp===0&&(Gp=ZC()),Gp):(n=Gt,n!==0||(n=window.event,n=n===void 0?16:sI(n.type)),n):1}function Ir(n,e,t,i){if(50<_h)throw _h=0,iv=null,Error(ye(185));Rd(n,t,i),(!(Ut&2)||n!==Vn)&&(n===Vn&&(!(Ut&2)&&(e0|=t),Rn===4&&ya(n,Wn)),Oi(n,i),t===1&&Ut===0&&!(e.mode&1)&&(zc=_n()+500,Yg&&ao()))}function Oi(n,e){var t=n.callbackNode;lO(n,e);var i=um(n,n===Vn?Wn:0);if(i===0)t!==null&&AT(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&AT(t),e===1)n.tag===0?ok(_E.bind(null,n)):TI(_E.bind(null,n)),ik(function(){!(Ut&6)&&ao()}),t=null;else{switch(QC(i)){case 1:t=_S;break;case 4:t=YC;break;case 16:t=cm;break;case 536870912:t=JC;break;default:t=cm}t=bR(t,mR.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function mR(n,e){if(Hp=-1,Gp=0,Ut&6)throw Error(ye(327));var t=n.callbackNode;if(Mc()&&n.callbackNode!==t)return null;var i=um(n,n===Vn?Wn:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=Cm(n,i);else{e=i;var r=Ut;Ut|=2;var s=yR();(Vn!==n||Wn!==e)&&(Ss=null,zc=_n()+500,Go(n,e));do try{Ck();break}catch(o){gR(n,o)}while(!0);PS(),Em.current=s,Ut=r,bn!==null?e=0:(Vn=null,Wn=0,e=Rn)}if(e!==0){if(e===2&&(r=Rx(n),r!==0&&(i=r,e=rv(n,r))),e===1)throw t=Zh,Go(n,0),ya(n,i),Oi(n,_n()),t;if(e===6)ya(n,i);else{if(r=n.current.alternate,!(i&30)&&!Ak(r)&&(e=Cm(n,i),e===2&&(s=Rx(n),s!==0&&(i=s,e=rv(n,s))),e===1))throw t=Zh,Go(n,0),ya(n,i),Oi(n,_n()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(ye(345));case 2:Po(n,Ci,Ss);break;case 3:if(ya(n,i),(i&130023424)===i&&(e=qS+500-_n(),10<e)){if(um(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){xi(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=Fx(Po.bind(null,n,Ci,Ss),e);break}Po(n,Ci,Ss);break;case 4:if(ya(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var a=31-Cr(i);s=1<<a,a=e[a],a>r&&(r=a),i&=~s}if(i=r,i=_n()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ek(i/1960))-i,10<i){n.timeoutHandle=Fx(Po.bind(null,n,Ci,Ss),i);break}Po(n,Ci,Ss);break;case 5:Po(n,Ci,Ss);break;default:throw Error(ye(329))}}}return Oi(n,_n()),n.callbackNode===t?mR.bind(null,n):null}function rv(n,e){var t=yh;return n.current.memoizedState.isDehydrated&&(Go(n,e).flags|=256),n=Cm(n,e),n!==2&&(e=Ci,Ci=t,e!==null&&sv(e)),n}function sv(n){Ci===null?Ci=n:Ci.push.apply(Ci,n)}function Ak(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!Dr(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ya(n,e){for(e&=~$S,e&=~e0,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Cr(e),i=1<<t;n[t]=-1,e&=~i}}function _E(n){if(Ut&6)throw Error(ye(327));Mc();var e=um(n,0);if(!(e&1))return Oi(n,_n()),null;var t=Cm(n,e);if(n.tag!==0&&t===2){var i=Rx(n);i!==0&&(e=i,t=rv(n,i))}if(t===1)throw t=Zh,Go(n,0),ya(n,e),Oi(n,_n()),t;if(t===6)throw Error(ye(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Po(n,Ci,Ss),Oi(n,_n()),null}function jS(n,e){var t=Ut;Ut|=1;try{return n(e)}finally{Ut=t,Ut===0&&(zc=_n()+500,Yg&&ao())}}function tl(n){Ta!==null&&Ta.tag===0&&!(Ut&6)&&Mc();var e=Ut;Ut|=1;var t=ur.transition,i=Gt;try{if(ur.transition=null,Gt=1,n)return n()}finally{Gt=i,ur.transition=t,Ut=e,!(Ut&6)&&ao()}}function XS(){Gi=_c.current,Qt(_c)}function Go(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,nk(t)),bn!==null)for(t=bn.return;t!==null;){var i=t;switch(CS(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&mm();break;case 3:Vc(),Qt(Di),Qt(ui),US();break;case 5:kS(i);break;case 4:Vc();break;case 13:Qt(nn);break;case 19:Qt(nn);break;case 10:LS(i.type._context);break;case 22:case 23:XS()}t=t.return}if(Vn=n,bn=n=Ua(n.current,null),Wn=Gi=e,Rn=0,Zh=null,$S=e0=el=0,Ci=yh=null,Uo!==null){for(e=0;e<Uo.length;e++)if(t=Uo[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var a=s.next;s.next=r,i.next=a}t.pending=i}Uo=null}return n}function gR(n,e){do{var t=bn;try{if(PS(),Vp.current=Tm,wm){for(var i=an.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}wm=!1}if(Qo=0,Fn=Cn=an=null,mh=!1,Kh=0,WS.current=null,t===null||t.return===null){Rn=1,Zh=e,bn=null;break}e:{var s=n,a=t.return,o=t,l=e;if(e=Wn,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=sE(a);if(p!==null){p.flags&=-257,aE(p,a,o,s,e),p.mode&1&&rE(s,c,e),e=p,l=c;var g=e.updateQueue;if(g===null){var _=new Set;_.add(l),e.updateQueue=_}else g.add(l);break e}else{if(!(e&1)){rE(s,c,e),KS();break e}l=Error(ye(426))}}else if(en&&o.mode&1){var y=sE(a);if(y!==null){!(y.flags&65536)&&(y.flags|=256),aE(y,a,o,s,e),IS(Bc(l,o));break e}}s=l=Bc(l,o),Rn!==4&&(Rn=2),yh===null?yh=[s]:yh.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=QI(s,l,e);ZT(s,m);break e;case 1:o=l;var x=s.type,v=s.stateNode;if(!(s.flags&128)&&(typeof x.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Oa===null||!Oa.has(v)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=eR(s,o,e);ZT(s,T);break e}}s=s.return}while(s!==null)}xR(t)}catch(R){e=R,bn===t&&t!==null&&(bn=t=t.return);continue}break}while(!0)}function yR(){var n=Em.current;return Em.current=Tm,n===null?Tm:n}function KS(){(Rn===0||Rn===3||Rn===2)&&(Rn=4),Vn===null||!(el&268435455)&&!(e0&268435455)||ya(Vn,Wn)}function Cm(n,e){var t=Ut;Ut|=2;var i=yR();(Vn!==n||Wn!==e)&&(Ss=null,Go(n,e));do try{Mk();break}catch(r){gR(n,r)}while(!0);if(PS(),Ut=t,Em.current=i,bn!==null)throw Error(ye(261));return Vn=null,Wn=0,Rn}function Mk(){for(;bn!==null;)_R(bn)}function Ck(){for(;bn!==null&&!QN();)_R(bn)}function _R(n){var e=SR(n.alternate,n,Gi);n.memoizedProps=n.pendingProps,e===null?xR(n):bn=e,WS.current=null}function xR(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Sk(t,e),t!==null){t.flags&=32767,bn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Rn=6,bn=null;return}}else if(t=vk(t,e,Gi),t!==null){bn=t;return}if(e=e.sibling,e!==null){bn=e;return}bn=e=n}while(e!==null);Rn===0&&(Rn=5)}function Po(n,e,t){var i=Gt,r=ur.transition;try{ur.transition=null,Gt=1,Ik(n,e,t,i)}finally{ur.transition=r,Gt=i}return null}function Ik(n,e,t,i){do Mc();while(Ta!==null);if(Ut&6)throw Error(ye(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(ye(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(cO(n,s),n===Vn&&(bn=Vn=null,Wn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Cf||(Cf=!0,bR(cm,function(){return Mc(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=ur.transition,ur.transition=null;var a=Gt;Gt=1;var o=Ut;Ut|=4,WS.current=null,wk(n,t),fR(t,n),KO(kx),hm=!!Ox,kx=Ox=null,n.current=t,Tk(t),eO(),Ut=o,Gt=a,ur.transition=s}else n.current=t;if(Cf&&(Cf=!1,Ta=n,Mm=r),s=n.pendingLanes,s===0&&(Oa=null),iO(t.stateNode),Oi(n,_n()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(Am)throw Am=!1,n=nv,nv=null,n;return Mm&1&&n.tag!==0&&Mc(),s=n.pendingLanes,s&1?n===iv?_h++:(_h=0,iv=n):_h=0,ao(),null}function Mc(){if(Ta!==null){var n=QC(Mm),e=ur.transition,t=Gt;try{if(ur.transition=null,Gt=16>n?16:n,Ta===null)var i=!1;else{if(n=Ta,Ta=null,Mm=0,Ut&6)throw Error(ye(331));var r=Ut;for(Ut|=4,Ve=n.current;Ve!==null;){var s=Ve,a=s.child;if(Ve.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(Ve=c;Ve!==null;){var u=Ve;switch(u.tag){case 0:case 11:case 15:gh(8,u,s)}var h=u.child;if(h!==null)h.return=u,Ve=h;else for(;Ve!==null;){u=Ve;var d=u.sibling,p=u.return;if(uR(u),u===c){Ve=null;break}if(d!==null){d.return=p,Ve=d;break}Ve=p}}}var g=s.alternate;if(g!==null){var _=g.child;if(_!==null){g.child=null;do{var y=_.sibling;_.sibling=null,_=y}while(_!==null)}}Ve=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,Ve=a;else e:for(;Ve!==null;){if(s=Ve,s.flags&2048)switch(s.tag){case 0:case 11:case 15:gh(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,Ve=m;break e}Ve=s.return}}var x=n.current;for(Ve=x;Ve!==null;){a=Ve;var v=a.child;if(a.subtreeFlags&2064&&v!==null)v.return=a,Ve=v;else e:for(a=x;Ve!==null;){if(o=Ve,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Qg(9,o)}}catch(R){hn(o,o.return,R)}if(o===a){Ve=null;break e}var T=o.sibling;if(T!==null){T.return=o.return,Ve=T;break e}Ve=o.return}}if(Ut=r,ao(),Zr&&typeof Zr.onPostCommitFiberRoot=="function")try{Zr.onPostCommitFiberRoot($g,n)}catch{}i=!0}return i}finally{Gt=t,ur.transition=e}}return!1}function xE(n,e,t){e=Bc(t,e),e=QI(n,e,1),n=Na(n,e,1),e=xi(),n!==null&&(Rd(n,1,e),Oi(n,e))}function hn(n,e,t){if(n.tag===3)xE(n,n,t);else for(;e!==null;){if(e.tag===3){xE(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Oa===null||!Oa.has(i))){n=Bc(t,n),n=eR(e,n,1),e=Na(e,n,1),n=xi(),e!==null&&(Rd(e,1,n),Oi(e,n));break}}e=e.return}}function Rk(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=xi(),n.pingedLanes|=n.suspendedLanes&t,Vn===n&&(Wn&t)===t&&(Rn===4||Rn===3&&(Wn&130023424)===Wn&&500>_n()-qS?Go(n,0):$S|=t),Oi(n,e)}function vR(n,e){e===0&&(n.mode&1?(e=_f,_f<<=1,!(_f&130023424)&&(_f=4194304)):e=1);var t=xi();n=Us(n,e),n!==null&&(Rd(n,e,t),Oi(n,t))}function Pk(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),vR(n,t)}function Lk(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(ye(314))}i!==null&&i.delete(e),vR(n,t)}var SR;SR=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Di.current)Ri=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Ri=!1,xk(n,e,t);Ri=!!(n.flags&131072)}else Ri=!1,en&&e.flags&1048576&&EI(e,_m,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;zp(n,e),n=e.pendingProps;var r=kc(e,ui.current);Ac(e,t),r=VS(null,e,i,n,r,t);var s=BS();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ni(i)?(s=!0,gm(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,NS(e),r.updater=Zg,e.stateNode=r,r._reactInternals=e,$x(e,i,n,t),e=Xx(null,e,i,!0,s,t)):(e.tag=0,en&&s&&MS(e),yi(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(zp(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Nk(i),n=Sr(i,n),r){case 0:e=jx(null,e,i,n,t);break e;case 1:e=cE(null,e,i,n,t);break e;case 11:e=oE(null,e,i,n,t);break e;case 14:e=lE(null,e,i,Sr(i.type,n),t);break e}throw Error(ye(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Sr(i,r),jx(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Sr(i,r),cE(n,e,i,r,t);case 3:e:{if(rR(e),n===null)throw Error(ye(387));i=e.pendingProps,s=e.memoizedState,r=s.element,PI(n,e),Sm(e,i,null,t);var a=e.memoizedState;if(i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Bc(Error(ye(423)),e),e=uE(n,e,i,t,r);break e}else if(i!==r){r=Bc(Error(ye(424)),e),e=uE(n,e,i,t,r);break e}else for($i=Da(e.stateNode.containerInfo.firstChild),Xi=e,en=!0,wr=null,t=II(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Uc(),i===r){e=Fs(n,e,t);break e}yi(n,e,i,t)}e=e.child}return e;case 5:return LI(e),n===null&&Hx(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,a=r.children,Ux(i,r)?a=null:s!==null&&Ux(i,s)&&(e.flags|=32),iR(n,e),yi(n,e,a,t),e.child;case 6:return n===null&&Hx(e),null;case 13:return sR(n,e,t);case 4:return OS(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=Fc(e,null,i,t):yi(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Sr(i,r),oE(n,e,i,r,t);case 7:return yi(n,e,e.pendingProps,t),e.child;case 8:return yi(n,e,e.pendingProps.children,t),e.child;case 12:return yi(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,a=r.value,Kt(xm,i._currentValue),i._currentValue=a,s!==null)if(Dr(s.value,a)){if(s.children===r.children&&!Di.current){e=Fs(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=Rs(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),Gx(s.return,t,e),o.lanes|=t;break}l=l.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(ye(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),Gx(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}yi(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Ac(e,t),r=hr(r),i=i(r),e.flags|=1,yi(n,e,i,t),e.child;case 14:return i=e.type,r=Sr(i,e.pendingProps),r=Sr(i.type,r),lE(n,e,i,r,t);case 15:return tR(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Sr(i,r),zp(n,e),e.tag=1,Ni(i)?(n=!0,gm(e)):n=!1,Ac(e,t),ZI(e,i,r),$x(e,i,r,t),Xx(null,e,i,!0,n,t);case 19:return aR(n,e,t);case 22:return nR(n,e,t)}throw Error(ye(156,e.tag))};function bR(n,e){return KC(n,e)}function Dk(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cr(n,e,t,i){return new Dk(n,e,t,i)}function YS(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Nk(n){if(typeof n=="function")return YS(n)?1:0;if(n!=null){if(n=n.$$typeof,n===mS)return 11;if(n===gS)return 14}return 2}function Ua(n,e){var t=n.alternate;return t===null?(t=cr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Wp(n,e,t,i,r,s){var a=2;if(i=n,typeof n=="function")YS(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case lc:return Wo(t.children,r,s,e);case pS:a=8,r|=8;break;case mx:return n=cr(12,t,e,r|2),n.elementType=mx,n.lanes=s,n;case gx:return n=cr(13,t,e,r),n.elementType=gx,n.lanes=s,n;case yx:return n=cr(19,t,e,r),n.elementType=yx,n.lanes=s,n;case LC:return t0(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case RC:a=10;break e;case PC:a=9;break e;case mS:a=11;break e;case gS:a=14;break e;case fa:a=16,i=null;break e}throw Error(ye(130,n==null?n:typeof n,""))}return e=cr(a,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Wo(n,e,t,i){return n=cr(7,n,i,e),n.lanes=t,n}function t0(n,e,t,i){return n=cr(22,n,i,e),n.elementType=LC,n.lanes=t,n.stateNode={isHidden:!1},n}function Yy(n,e,t){return n=cr(6,n,null,e),n.lanes=t,n}function Jy(n,e,t){return e=cr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Ok(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Py(0),this.expirationTimes=Py(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Py(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function JS(n,e,t,i,r,s,a,o,l){return n=new Ok(n,e,t,o,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=cr(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},NS(s),n}function kk(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:oc,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function wR(n){if(!n)return $a;n=n._reactInternals;e:{if(pl(n)!==n||n.tag!==1)throw Error(ye(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ni(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ye(171))}if(n.tag===1){var t=n.type;if(Ni(t))return wI(n,t,e)}return e}function TR(n,e,t,i,r,s,a,o,l){return n=JS(t,i,!0,n,r,s,a,o,l),n.context=wR(null),t=n.current,i=xi(),r=ka(t),s=Rs(i,r),s.callback=e??null,Na(t,s,r),n.current.lanes=r,Rd(n,r,i),Oi(n,i),n}function n0(n,e,t,i){var r=e.current,s=xi(),a=ka(r);return t=wR(t),e.context===null?e.context=t:e.pendingContext=t,e=Rs(s,a),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=Na(r,e,a),n!==null&&(Ir(n,r,a,s),Fp(n,r,a)),a}function Im(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function vE(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function ZS(n,e){vE(n,e),(n=n.alternate)&&vE(n,e)}function Uk(){return null}var ER=typeof reportError=="function"?reportError:function(n){console.error(n)};function QS(n){this._internalRoot=n}i0.prototype.render=QS.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(ye(409));n0(n,e,null,null)};i0.prototype.unmount=QS.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;tl(function(){n0(null,n,null,null)}),e[ks]=null}};function i0(n){this._internalRoot=n}i0.prototype.unstable_scheduleHydration=function(n){if(n){var e=nI();n={blockedOn:null,target:n,priority:e};for(var t=0;t<ga.length&&e!==0&&e<ga[t].priority;t++);ga.splice(t,0,n),t===0&&rI(n)}};function eb(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function r0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function SE(){}function Fk(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=Im(a);s.call(c)}}var a=TR(e,i,n,0,null,!1,!1,"",SE);return n._reactRootContainer=a,n[ks]=a.current,Wh(n.nodeType===8?n.parentNode:n),tl(),a}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var o=i;i=function(){var c=Im(l);o.call(c)}}var l=JS(n,0,!1,null,null,!1,!1,"",SE);return n._reactRootContainer=l,n[ks]=l.current,Wh(n.nodeType===8?n.parentNode:n),tl(function(){n0(e,l,t,i)}),l}function s0(n,e,t,i,r){var s=t._reactRootContainer;if(s){var a=s;if(typeof r=="function"){var o=r;r=function(){var l=Im(a);o.call(l)}}n0(e,a,n,r)}else a=Fk(t,e,n,r,i);return Im(a)}eI=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=th(e.pendingLanes);t!==0&&(xS(e,t|1),Oi(e,_n()),!(Ut&6)&&(zc=_n()+500,ao()))}break;case 13:tl(function(){var i=Us(n,1);if(i!==null){var r=xi();Ir(i,n,1,r)}}),ZS(n,1)}};vS=function(n){if(n.tag===13){var e=Us(n,134217728);if(e!==null){var t=xi();Ir(e,n,134217728,t)}ZS(n,134217728)}};tI=function(n){if(n.tag===13){var e=ka(n),t=Us(n,e);if(t!==null){var i=xi();Ir(t,n,e,i)}ZS(n,e)}};nI=function(){return Gt};iI=function(n,e){var t=Gt;try{return Gt=n,e()}finally{Gt=t}};Mx=function(n,e,t){switch(e){case"input":if(vx(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=Kg(i);if(!r)throw Error(ye(90));NC(i),vx(i,r)}}}break;case"textarea":kC(n,t);break;case"select":e=t.value,e!=null&&bc(n,!!t.multiple,e,!1)}};GC=jS;WC=tl;var Vk={usingClientEntryPoint:!1,Events:[Ld,dc,Kg,zC,HC,jS]},ku={findFiberByHostInstance:ko,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Bk={bundleType:ku.bundleType,version:ku.version,rendererPackageName:ku.rendererPackageName,rendererConfig:ku.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:js.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=jC(n),n===null?null:n.stateNode},findFiberByHostInstance:ku.findFiberByHostInstance||Uk,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var If=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!If.isDisabled&&If.supportsFiber)try{$g=If.inject(Bk),Zr=If}catch{}}Qi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vk;Qi.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!eb(e))throw Error(ye(200));return kk(n,e,null,t)};Qi.createRoot=function(n,e){if(!eb(n))throw Error(ye(299));var t=!1,i="",r=ER;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=JS(n,1,!1,null,null,t,!1,i,r),n[ks]=e.current,Wh(n.nodeType===8?n.parentNode:n),new QS(e)};Qi.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(ye(188)):(n=Object.keys(n).join(","),Error(ye(268,n)));return n=jC(e),n=n===null?null:n.stateNode,n};Qi.flushSync=function(n){return tl(n)};Qi.hydrate=function(n,e,t){if(!r0(e))throw Error(ye(200));return s0(null,n,e,!0,t)};Qi.hydrateRoot=function(n,e,t){if(!eb(n))throw Error(ye(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",a=ER;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=TR(e,null,n,1,t??null,r,!1,s,a),n[ks]=e.current,Wh(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new i0(e)};Qi.render=function(n,e,t){if(!r0(e))throw Error(ye(200));return s0(null,n,e,!1,t)};Qi.unmountComponentAtNode=function(n){if(!r0(n))throw Error(ye(40));return n._reactRootContainer?(tl(function(){s0(null,null,n,!1,function(){n._reactRootContainer=null,n[ks]=null})}),!0):!1};Qi.unstable_batchedUpdates=jS;Qi.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!r0(t))throw Error(ye(200));if(n==null||n._reactInternals===void 0)throw Error(ye(38));return s0(n,e,t,!1,i)};Qi.version="18.3.1-next-f1338f8080-20240426";function AR(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(AR)}catch(n){console.error(n)}}AR(),AC.exports=Qi;var zk=AC.exports,MR,bE=zk;MR=bE.createRoot,bE.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Qh(){return Qh=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Qh.apply(this,arguments)}var Ea;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Ea||(Ea={}));const wE="popstate";function Hk(n){n===void 0&&(n={});function e(r,s){let{pathname:a="/",search:o="",hash:l=""}=ml(r.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),av("",{pathname:a,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){let a=r.document.querySelector("base"),o="";if(a&&a.getAttribute("href")){let l=r.location.href,c=l.indexOf("#");o=c===-1?l:l.slice(0,c)}return o+"#"+(typeof s=="string"?s:Rm(s))}function i(r,s){a0(r.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(s)+")")}return Wk(e,t,i,n)}function dn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function a0(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Gk(){return Math.random().toString(36).substr(2,8)}function TE(n,e){return{usr:n.state,key:n.key,idx:e}}function av(n,e,t,i){return t===void 0&&(t=null),Qh({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?ml(e):e,{state:t,key:e&&e.key||i||Gk()})}function Rm(n){let{pathname:e="/",search:t="",hash:i=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function ml(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substr(i),n=n.substr(0,i)),n&&(e.pathname=n)}return e}function Wk(n,e,t,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,a=r.history,o=Ea.Pop,l=null,c=u();c==null&&(c=0,a.replaceState(Qh({},a.state,{idx:c}),""));function u(){return(a.state||{idx:null}).idx}function h(){o=Ea.Pop;let y=u(),m=y==null?null:y-c;c=y,l&&l({action:o,location:_.location,delta:m})}function d(y,m){o=Ea.Push;let x=av(_.location,y,m);t&&t(x,y),c=u()+1;let v=TE(x,c),T=_.createHref(x);try{a.pushState(v,"",T)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;r.location.assign(T)}s&&l&&l({action:o,location:_.location,delta:1})}function p(y,m){o=Ea.Replace;let x=av(_.location,y,m);t&&t(x,y),c=u();let v=TE(x,c),T=_.createHref(x);a.replaceState(v,"",T),s&&l&&l({action:o,location:_.location,delta:0})}function g(y){let m=r.location.origin!=="null"?r.location.origin:r.location.href,x=typeof y=="string"?y:Rm(y);return x=x.replace(/ $/,"%20"),dn(m,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,m)}let _={get action(){return o},get location(){return n(r,a)},listen(y){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(wE,h),l=y,()=>{r.removeEventListener(wE,h),l=null}},createHref(y){return e(r,y)},createURL:g,encodeLocation(y){let m=g(y);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:d,replace:p,go(y){return a.go(y)}};return _}var EE;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(EE||(EE={}));function $k(n,e,t){return t===void 0&&(t="/"),qk(n,e,t)}function qk(n,e,t,i){let r=typeof e=="string"?ml(e):e,s=Hc(r.pathname||"/",t);if(s==null)return null;let a=CR(n);jk(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=rU(s);o=nU(a[l],c)}return o}function CR(n,e,t,i){e===void 0&&(e=[]),t===void 0&&(t=[]),i===void 0&&(i="");let r=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(dn(l.relativePath.startsWith(i),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(i.length));let c=Fa([i,l.relativePath]),u=t.concat(l);s.children&&s.children.length>0&&(dn(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),CR(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:eU(c,s.index),routesMeta:u})};return n.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))r(s,a);else for(let l of IR(s.path))r(s,a,l)}),e}function IR(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let a=IR(i.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),r&&o.push(...a),o.map(l=>n.startsWith("/")&&l===""?"/":l)}function jk(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:tU(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}const Xk=/^:[\w-]+$/,Kk=3,Yk=2,Jk=1,Zk=10,Qk=-2,AE=n=>n==="*";function eU(n,e){let t=n.split("/"),i=t.length;return t.some(AE)&&(i+=Qk),e&&(i+=Yk),t.filter(r=>!AE(r)).reduce((r,s)=>r+(Xk.test(s)?Kk:s===""?Jk:Zk),i)}function tU(n,e){return n.length===e.length&&n.slice(0,-1).every((i,r)=>i===e[r])?n[n.length-1]-e[e.length-1]:0}function nU(n,e,t){let{routesMeta:i}=n,r={},s="/",a=[];for(let o=0;o<i.length;++o){let l=i[o],c=o===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",h=ov({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),d=l.route;if(!h)return null;Object.assign(r,h.params),a.push({params:r,pathname:Fa([s,h.pathname]),pathnameBase:cU(Fa([s,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(s=Fa([s,h.pathnameBase]))}return a}function ov(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=iU(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:i.reduce((c,u,h)=>{let{paramName:d,isOptional:p}=u;if(d==="*"){let _=o[h]||"";a=s.slice(0,s.length-_.length).replace(/(.)\/+$/,"$1")}const g=o[h];return p&&!g?c[d]=void 0:c[d]=(g||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:a,pattern:n}}function iU(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),a0(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let i=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(i.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(i.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function rU(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return a0(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function Hc(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}const sU=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,aU=n=>sU.test(n);function oU(n,e){e===void 0&&(e="/");let{pathname:t,search:i="",hash:r=""}=typeof n=="string"?ml(n):n,s;if(t)if(aU(t))s=t;else{if(t.includes("//")){let a=t;t=t.replace(/\/\/+/g,"/"),a0(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+t))}t.startsWith("/")?s=ME(t.substring(1),"/"):s=ME(t,e)}else s=e;return{pathname:s,search:uU(i),hash:hU(r)}}function ME(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function Zy(n,e,t,i){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function lU(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function RR(n,e){let t=lU(n);return e?t.map((i,r)=>r===t.length-1?i.pathname:i.pathnameBase):t.map(i=>i.pathnameBase)}function PR(n,e,t,i){i===void 0&&(i=!1);let r;typeof n=="string"?r=ml(n):(r=Qh({},n),dn(!r.pathname||!r.pathname.includes("?"),Zy("?","pathname","search",r)),dn(!r.pathname||!r.pathname.includes("#"),Zy("#","pathname","hash",r)),dn(!r.search||!r.search.includes("#"),Zy("#","search","hash",r)));let s=n===""||r.pathname==="",a=s?"/":r.pathname,o;if(a==null)o=t;else{let h=e.length-1;if(!i&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;r.pathname=d.join("/")}o=h>=0?e[h]:"/"}let l=oU(r,o),c=a&&a!=="/"&&a.endsWith("/"),u=(s||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const Fa=n=>n.join("/").replace(/\/\/+/g,"/"),cU=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),uU=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,hU=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function dU(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const LR=["post","put","patch","delete"];new Set(LR);const fU=["get",...LR];new Set(fU);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ed(){return ed=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},ed.apply(this,arguments)}const o0=te.createContext(null),DR=te.createContext(null),oo=te.createContext(null),l0=te.createContext(null),Xs=te.createContext({outlet:null,matches:[],isDataRoute:!1}),NR=te.createContext(null);function pU(n,e){let{relative:t}=e===void 0?{}:e;Nd()||dn(!1);let{basename:i,navigator:r}=te.useContext(oo),{hash:s,pathname:a,search:o}=c0(n,{relative:t}),l=a;return i!=="/"&&(l=a==="/"?i:Fa([i,a])),r.createHref({pathname:l,search:o,hash:s})}function Nd(){return te.useContext(l0)!=null}function lu(){return Nd()||dn(!1),te.useContext(l0).location}function OR(n){te.useContext(oo).static||te.useLayoutEffect(n)}function kR(){let{isDataRoute:n}=te.useContext(Xs);return n?IU():mU()}function mU(){Nd()||dn(!1);let n=te.useContext(o0),{basename:e,future:t,navigator:i}=te.useContext(oo),{matches:r}=te.useContext(Xs),{pathname:s}=lu(),a=JSON.stringify(RR(r,t.v7_relativeSplatPath)),o=te.useRef(!1);return OR(()=>{o.current=!0}),te.useCallback(function(c,u){if(u===void 0&&(u={}),!o.current)return;if(typeof c=="number"){i.go(c);return}let h=PR(c,JSON.parse(a),s,u.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Fa([e,h.pathname])),(u.replace?i.replace:i.push)(h,u.state,u)},[e,i,a,s,n])}const gU=te.createContext(null);function yU(n){let e=te.useContext(Xs).outlet;return e&&te.createElement(gU.Provider,{value:n},e)}function lJ(){let{matches:n}=te.useContext(Xs),e=n[n.length-1];return e?e.params:{}}function c0(n,e){let{relative:t}=e===void 0?{}:e,{future:i}=te.useContext(oo),{matches:r}=te.useContext(Xs),{pathname:s}=lu(),a=JSON.stringify(RR(r,i.v7_relativeSplatPath));return te.useMemo(()=>PR(n,JSON.parse(a),s,t==="path"),[n,a,s,t])}function _U(n,e){return xU(n,e)}function xU(n,e,t,i){Nd()||dn(!1);let{navigator:r}=te.useContext(oo),{matches:s}=te.useContext(Xs),a=s[s.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let c=lu(),u;if(e){var h;let y=typeof e=="string"?ml(e):e;l==="/"||(h=y.pathname)!=null&&h.startsWith(l)||dn(!1),u=y}else u=c;let d=u.pathname||"/",p=d;if(l!=="/"){let y=l.replace(/^\//,"").split("/");p="/"+d.replace(/^\//,"").split("/").slice(y.length).join("/")}let g=$k(n,{pathname:p}),_=TU(g&&g.map(y=>Object.assign({},y,{params:Object.assign({},o,y.params),pathname:Fa([l,r.encodeLocation?r.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?l:Fa([l,r.encodeLocation?r.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),s,t,i);return e&&_?te.createElement(l0.Provider,{value:{location:ed({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Ea.Pop}},_):_}function vU(){let n=CU(),e=dU(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return te.createElement(te.Fragment,null,te.createElement("h2",null,"Unexpected Application Error!"),te.createElement("h3",{style:{fontStyle:"italic"}},e),t?te.createElement("pre",{style:r},t):null,null)}const SU=te.createElement(vU,null);class bU extends te.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?te.createElement(Xs.Provider,{value:this.props.routeContext},te.createElement(NR.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function wU(n){let{routeContext:e,match:t,children:i}=n,r=te.useContext(o0);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),te.createElement(Xs.Provider,{value:e},i)}function TU(n,e,t,i){var r;if(e===void 0&&(e=[]),t===void 0&&(t=null),i===void 0&&(i=null),n==null){var s;if(!t)return null;if(t.errors)n=t.matches;else if((s=i)!=null&&s.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,o=(r=t)==null?void 0:r.errors;if(o!=null){let u=a.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);u>=0||dn(!1),a=a.slice(0,Math.min(a.length,u+1))}let l=!1,c=-1;if(t&&i&&i.v7_partialHydration)for(let u=0;u<a.length;u++){let h=a[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=u),h.route.id){let{loaderData:d,errors:p}=t,g=h.route.loader&&d[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||g){l=!0,c>=0?a=a.slice(0,c+1):a=[a[0]];break}}}return a.reduceRight((u,h,d)=>{let p,g=!1,_=null,y=null;t&&(p=o&&h.route.id?o[h.route.id]:void 0,_=h.route.errorElement||SU,l&&(c<0&&d===0?(RU("route-fallback"),g=!0,y=null):c===d&&(g=!0,y=h.route.hydrateFallbackElement||null)));let m=e.concat(a.slice(0,d+1)),x=()=>{let v;return p?v=_:g?v=y:h.route.Component?v=te.createElement(h.route.Component,null):h.route.element?v=h.route.element:v=u,te.createElement(wU,{match:h,routeContext:{outlet:u,matches:m,isDataRoute:t!=null},children:v})};return t&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?te.createElement(bU,{location:t.location,revalidation:t.revalidation,component:_,error:p,children:x(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):x()},null)}var UR=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(UR||{}),FR=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(FR||{});function EU(n){let e=te.useContext(o0);return e||dn(!1),e}function AU(n){let e=te.useContext(DR);return e||dn(!1),e}function MU(n){let e=te.useContext(Xs);return e||dn(!1),e}function VR(n){let e=MU(),t=e.matches[e.matches.length-1];return t.route.id||dn(!1),t.route.id}function CU(){var n;let e=te.useContext(NR),t=AU(),i=VR();return e!==void 0?e:(n=t.errors)==null?void 0:n[i]}function IU(){let{router:n}=EU(UR.UseNavigateStable),e=VR(FR.UseNavigateStable),t=te.useRef(!1);return OR(()=>{t.current=!0}),te.useCallback(function(r,s){s===void 0&&(s={}),t.current&&(typeof r=="number"?n.navigate(r):n.navigate(r,ed({fromRouteId:e},s)))},[n,e])}const CE={};function RU(n,e,t){CE[n]||(CE[n]=!0)}function PU(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function LU(n){return yU(n.context)}function lv(n){dn(!1)}function DU(n){let{basename:e="/",children:t=null,location:i,navigationType:r=Ea.Pop,navigator:s,static:a=!1,future:o}=n;Nd()&&dn(!1);let l=e.replace(/^\/*/,"/"),c=te.useMemo(()=>({basename:l,navigator:s,static:a,future:ed({v7_relativeSplatPath:!1},o)}),[l,o,s,a]);typeof i=="string"&&(i=ml(i));let{pathname:u="/",search:h="",hash:d="",state:p=null,key:g="default"}=i,_=te.useMemo(()=>{let y=Hc(u,l);return y==null?null:{location:{pathname:y,search:h,hash:d,state:p,key:g},navigationType:r}},[l,u,h,d,p,g,r]);return _==null?null:te.createElement(oo.Provider,{value:c},te.createElement(l0.Provider,{children:t,value:_}))}function NU(n){let{children:e,location:t}=n;return _U(cv(e),t)}new Promise(()=>{});function cv(n,e){e===void 0&&(e=[]);let t=[];return te.Children.forEach(n,(i,r)=>{if(!te.isValidElement(i))return;let s=[...e,r];if(i.type===te.Fragment){t.push.apply(t,cv(i.props.children,s));return}i.type!==lv&&dn(!1),!i.props.index||!i.props.children||dn(!1);let a={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(a.children=cv(i.props.children,s)),t.push(a)}),t}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Pm(){return Pm=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Pm.apply(this,arguments)}function BR(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function OU(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function kU(n,e){return n.button===0&&(!e||e==="_self")&&!OU(n)}function uv(n){return n===void 0&&(n=""),new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let i=n[t];return e.concat(Array.isArray(i)?i.map(r=>[t,r]):[[t,i]])},[]))}function UU(n,e){let t=uv(n);return e&&e.forEach((i,r)=>{t.has(r)||e.getAll(r).forEach(s=>{t.append(r,s)})}),t}const FU=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],VU=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],BU="6";try{window.__reactRouterVersion=BU}catch{}const zU=te.createContext({isTransitioning:!1}),HU="startTransition",IE=RN[HU];function GU(n){let{basename:e,children:t,future:i,window:r}=n,s=te.useRef();s.current==null&&(s.current=Hk({window:r,v5Compat:!0}));let a=s.current,[o,l]=te.useState({action:a.action,location:a.location}),{v7_startTransition:c}=i||{},u=te.useCallback(h=>{c&&IE?IE(()=>l(h)):l(h)},[l,c]);return te.useLayoutEffect(()=>a.listen(u),[a,u]),te.useEffect(()=>PU(i),[i]),te.createElement(DU,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:i})}const WU=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",$U=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qU=te.forwardRef(function(e,t){let{onClick:i,relative:r,reloadDocument:s,replace:a,state:o,target:l,to:c,preventScrollReset:u,viewTransition:h}=e,d=BR(e,FU),{basename:p}=te.useContext(oo),g,_=!1;if(typeof c=="string"&&$U.test(c)&&(g=c,WU))try{let v=new URL(window.location.href),T=c.startsWith("//")?new URL(v.protocol+c):new URL(c),R=Hc(T.pathname,p);T.origin===v.origin&&R!=null?c=R+T.search+T.hash:_=!0}catch{}let y=pU(c,{relative:r}),m=XU(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:r,viewTransition:h});function x(v){i&&i(v),v.defaultPrevented||m(v)}return te.createElement("a",Pm({},d,{href:g||y,onClick:_||s?i:x,ref:t,target:l}))}),Qy=te.forwardRef(function(e,t){let{"aria-current":i="page",caseSensitive:r=!1,className:s="",end:a=!1,style:o,to:l,viewTransition:c,children:u}=e,h=BR(e,VU),d=c0(l,{relative:h.relative}),p=lu(),g=te.useContext(DR),{navigator:_,basename:y}=te.useContext(oo),m=g!=null&&KU(d)&&c===!0,x=_.encodeLocation?_.encodeLocation(d).pathname:d.pathname,v=p.pathname,T=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;r||(v=v.toLowerCase(),T=T?T.toLowerCase():null,x=x.toLowerCase()),T&&y&&(T=Hc(T,y)||T);const R=x!=="/"&&x.endsWith("/")?x.length-1:x.length;let C=v===x||!a&&v.startsWith(x)&&v.charAt(R)==="/",A=T!=null&&(T===x||!a&&T.startsWith(x)&&T.charAt(x.length)==="/"),E={isActive:C,isPending:A,isTransitioning:m},b=C?i:void 0,S;typeof s=="function"?S=s(E):S=[s,C?"active":null,A?"pending":null,m?"transitioning":null].filter(Boolean).join(" ");let I=typeof o=="function"?o(E):o;return te.createElement(qU,Pm({},h,{"aria-current":b,className:S,ref:t,style:I,to:l,viewTransition:c}),typeof u=="function"?u(E):u)});var hv;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(hv||(hv={}));var RE;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(RE||(RE={}));function jU(n){let e=te.useContext(o0);return e||dn(!1),e}function XU(n,e){let{target:t,replace:i,state:r,preventScrollReset:s,relative:a,viewTransition:o}=e===void 0?{}:e,l=kR(),c=lu(),u=c0(n,{relative:a});return te.useCallback(h=>{if(kU(h,t)){h.preventDefault();let d=i!==void 0?i:Rm(c)===Rm(u);l(n,{replace:d,state:r,preventScrollReset:s,relative:a,viewTransition:o})}},[c,l,u,i,r,t,n,s,a,o])}function cJ(n){let e=te.useRef(uv(n)),t=te.useRef(!1),i=lu(),r=te.useMemo(()=>UU(i.search,t.current?null:e.current),[i.search]),s=kR(),a=te.useCallback((o,l)=>{const c=uv(typeof o=="function"?o(r):o);t.current=!0,s("?"+c,l)},[s,r]);return[r,a]}function KU(n,e){e===void 0&&(e={});let t=te.useContext(zU);t==null&&dn(!1);let{basename:i}=jU(hv.useViewTransitionState),r=c0(n,{relative:e.relative});if(!t.isTransitioning)return!1;let s=Hc(t.currentLocation.pathname,i)||t.currentLocation.pathname,a=Hc(t.nextLocation.pathname,i)||t.nextLocation.pathname;return ov(r.pathname,a)!=null||ov(r.pathname,s)!=null}const ht=n=>typeof n=="string",Uu=()=>{let n,e;const t=new Promise((i,r)=>{n=i,e=r});return t.resolve=n,t.reject=e,t},PE=n=>n==null?"":""+n,YU=(n,e,t)=>{n.forEach(i=>{e[i]&&(t[i]=e[i])})},JU=/###/g,LE=n=>n&&n.indexOf("###")>-1?n.replace(JU,"."):n,DE=n=>!n||ht(n),xh=(n,e,t)=>{const i=ht(e)?e.split("."):e;let r=0;for(;r<i.length-1;){if(DE(n))return{};const s=LE(i[r]);!n[s]&&t&&(n[s]=new t),Object.prototype.hasOwnProperty.call(n,s)?n=n[s]:n={},++r}return DE(n)?{}:{obj:n,k:LE(i[r])}},NE=(n,e,t)=>{const{obj:i,k:r}=xh(n,e,Object);if(i!==void 0||e.length===1){i[r]=t;return}let s=e[e.length-1],a=e.slice(0,e.length-1),o=xh(n,a,Object);for(;o.obj===void 0&&a.length;)s=`${a[a.length-1]}.${s}`,a=a.slice(0,a.length-1),o=xh(n,a,Object),o&&o.obj&&typeof o.obj[`${o.k}.${s}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=t},ZU=(n,e,t,i)=>{const{obj:r,k:s}=xh(n,e,Object);r[s]=r[s]||[],r[s].push(t)},Lm=(n,e)=>{const{obj:t,k:i}=xh(n,e);if(t)return t[i]},QU=(n,e,t)=>{const i=Lm(n,t);return i!==void 0?i:Lm(e,t)},zR=(n,e,t)=>{for(const i in e)i!=="__proto__"&&i!=="constructor"&&(i in n?ht(n[i])||n[i]instanceof String||ht(e[i])||e[i]instanceof String?t&&(n[i]=e[i]):zR(n[i],e[i],t):n[i]=e[i]);return n},Ll=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var eF={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const tF=n=>ht(n)?n.replace(/[&<>"'\/]/g,e=>eF[e]):n;class nF{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}const iF=[" ",",","?","!",";"],rF=new nF(20),sF=(n,e,t)=>{e=e||"",t=t||"";const i=iF.filter(a=>e.indexOf(a)<0&&t.indexOf(a)<0);if(i.length===0)return!0;const r=rF.getRegExp(`(${i.map(a=>a==="?"?"\\?":a).join("|")})`);let s=!r.test(n);if(!s){const a=n.indexOf(t);a>0&&!r.test(n.substring(0,a))&&(s=!0)}return s},dv=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!n)return;if(n[e])return n[e];const i=e.split(t);let r=n;for(let s=0;s<i.length;){if(!r||typeof r!="object")return;let a,o="";for(let l=s;l<i.length;++l)if(l!==s&&(o+=t),o+=i[l],a=r[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<i.length-1)continue;s+=l-s+1;break}r=a}return r},Dm=n=>n&&n.replace("_","-"),aF={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console&&console[n]&&console[n].apply(console,e)}};let oF=class fv{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||aF,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,r){return r&&!this.debug?null:(ht(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new fv(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new fv(this.logger,e)}};var Xr=new oF;class u0{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const r=this.observers[i].get(t)||0;this.observers[i].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(a=>{let[o,l]=a;for(let c=0;c<l;c++)o(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(a=>{let[o,l]=a;for(let c=0;c<l;c++)o.apply(o,[e,...i])})}}class OE extends u0{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,a=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,t],i&&(Array.isArray(i)?o.push(...i):ht(i)&&s?o.push(...i.split(s)):o.push(i)));const l=Lm(this.data,o);return!l&&!t&&!i&&e.indexOf(".")>-1&&(e=o[0],t=o[1],i=o.slice(2).join(".")),l||!a||!ht(i)?l:dv(this.data&&this.data[e]&&this.data[e][t],i,s)}addResource(e,t,i,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const a=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let o=[e,t];i&&(o=o.concat(a?i.split(a):i)),e.indexOf(".")>-1&&(o=e.split("."),r=t,t=o[1]),this.addNamespaces(t),NE(this.data,o,r),s.silent||this.emit("added",e,t,i,r)}addResources(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const s in i)(ht(i[s])||Array.isArray(i[s]))&&this.addResource(e,t,s,i[s],{silent:!0});r.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,r,s){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),r=i,i=t,t=o[1]),this.addNamespaces(t);let l=Lm(this.data,o)||{};a.skipCopy||(i=JSON.parse(JSON.stringify(i))),r?zR(l,i,s):l={...l,...i},NE(this.data,o,l),a.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var HR={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,i,r){return n.forEach(s=>{this.processors[s]&&(e=this.processors[s].process(e,t,i,r))}),e}};const kE={};class Nm extends u0{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),YU(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Xr.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const i=this.resolve(e,t);return i&&i.res!==void 0}extractFromKey(e,t){let i=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let s=t.ns||this.options.defaultNS||[];const a=i&&e.indexOf(i)>-1,o=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!sF(e,i,r);if(a&&!o){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:ht(s)?[s]:s};const c=e.split(i);(i!==r||i===r&&this.options.ns.indexOf(c[0])>-1)&&(s=c.shift()),e=c.join(r)}return{key:e,namespaces:ht(s)?[s]:s}}translate(e,t,i){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,s=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:a,namespaces:o}=this.extractFromKey(e[e.length-1],t),l=o[o.length-1],c=t.lng||this.language,u=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&c.toLowerCase()==="cimode"){if(u){const T=t.nsSeparator||this.options.nsSeparator;return r?{res:`${l}${T}${a}`,usedKey:a,exactUsedKey:a,usedLng:c,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:`${l}${T}${a}`}return r?{res:a,usedKey:a,exactUsedKey:a,usedLng:c,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:a}const h=this.resolve(e,t);let d=h&&h.res;const p=h&&h.usedKey||a,g=h&&h.exactUsedKey||a,_=Object.prototype.toString.apply(d),y=["[object Number]","[object Function]","[object RegExp]"],m=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,x=!this.i18nFormat||this.i18nFormat.handleAsObject,v=!ht(d)&&typeof d!="boolean"&&typeof d!="number";if(x&&d&&v&&y.indexOf(_)<0&&!(ht(m)&&Array.isArray(d))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const T=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,d,{...t,ns:o}):`key '${a} (${this.language})' returned an object instead of string.`;return r?(h.res=T,h.usedParams=this.getUsedParamsDetails(t),h):T}if(s){const T=Array.isArray(d),R=T?[]:{},C=T?g:p;for(const A in d)if(Object.prototype.hasOwnProperty.call(d,A)){const E=`${C}${s}${A}`;R[A]=this.translate(E,{...t,joinArrays:!1,ns:o}),R[A]===E&&(R[A]=d[A])}d=R}}else if(x&&ht(m)&&Array.isArray(d))d=d.join(m),d&&(d=this.extendTranslation(d,e,t,i));else{let T=!1,R=!1;const C=t.count!==void 0&&!ht(t.count),A=Nm.hasDefaultValue(t),E=C?this.pluralResolver.getSuffix(c,t.count,t):"",b=t.ordinal&&C?this.pluralResolver.getSuffix(c,t.count,{ordinal:!1}):"",S=C&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),I=S&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${E}`]||t[`defaultValue${b}`]||t.defaultValue;!this.isValidLookup(d)&&A&&(T=!0,d=I),this.isValidLookup(d)||(R=!0,d=a);const P=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&R?void 0:d,$=A&&I!==d&&this.options.updateMissing;if(R||T||$){if(this.logger.log($?"updateKey":"missingKey",c,l,a,$?I:d),s){const B=this.resolve(a,{...t,keySeparator:!1});B&&B.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let Y=[];const Z=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Z&&Z[0])for(let B=0;B<Z.length;B++)Y.push(Z[B]);else this.options.saveMissingTo==="all"?Y=this.languageUtils.toResolveHierarchy(t.lng||this.language):Y.push(t.lng||this.language);const fe=(B,X,ee)=>{const _e=A&&ee!==d?ee:P;this.options.missingKeyHandler?this.options.missingKeyHandler(B,l,X,_e,$,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(B,l,X,_e,$,t),this.emit("missingKey",B,l,X,d)};this.options.saveMissing&&(this.options.saveMissingPlurals&&C?Y.forEach(B=>{const X=this.pluralResolver.getSuffixes(B,t);S&&t[`defaultValue${this.options.pluralSeparator}zero`]&&X.indexOf(`${this.options.pluralSeparator}zero`)<0&&X.push(`${this.options.pluralSeparator}zero`),X.forEach(ee=>{fe([B],a+ee,t[`defaultValue${ee}`]||I)})}):fe(Y,a,I))}d=this.extendTranslation(d,e,t,h,i),R&&d===a&&this.options.appendNamespaceToMissingKey&&(d=`${l}:${a}`),(R||T)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?d=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${a}`:a,T?d:void 0):d=this.options.parseMissingKeyHandler(d))}return r?(h.res=d,h.usedParams=this.getUsedParamsDetails(t),h):d}extendTranslation(e,t,i,r,s){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const c=ht(e)&&(i&&i.interpolation&&i.interpolation.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let u;if(c){const d=e.match(this.interpolator.nestingRegexp);u=d&&d.length}let h=i.replace&&!ht(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(h={...this.options.interpolation.defaultVariables,...h}),e=this.interpolator.interpolate(e,h,i.lng||this.language||r.usedLng,i),c){const d=e.match(this.interpolator.nestingRegexp),p=d&&d.length;u<p&&(i.nest=!1)}!i.lng&&this.options.compatibilityAPI!=="v1"&&r&&r.res&&(i.lng=this.language||r.usedLng),i.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var d=arguments.length,p=new Array(d),g=0;g<d;g++)p[g]=arguments[g];return s&&s[0]===p[0]&&!i.context?(a.logger.warn(`It seems you are nesting recursively key: ${p[0]} in key: ${t[0]}`),null):a.translate(...p,t)},i)),i.interpolation&&this.interpolator.reset()}const o=i.postProcess||this.options.postProcess,l=ht(o)?[o]:o;return e!=null&&l&&l.length&&i.applyPostProcessor!==!1&&(e=HR.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i,r,s,a,o;return ht(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(i))return;const c=this.extractFromKey(l,t),u=c.key;r=u;let h=c.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));const d=t.count!==void 0&&!ht(t.count),p=d&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),g=t.context!==void 0&&(ht(t.context)||typeof t.context=="number")&&t.context!=="",_=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);h.forEach(y=>{this.isValidLookup(i)||(o=y,!kE[`${_[0]}-${y}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(o)&&(kE[`${_[0]}-${y}`]=!0,this.logger.warn(`key "${r}" for languages "${_.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),_.forEach(m=>{if(this.isValidLookup(i))return;a=m;const x=[u];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(x,u,m,y,t);else{let T;d&&(T=this.pluralResolver.getSuffix(m,t.count,t));const R=`${this.options.pluralSeparator}zero`,C=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(x.push(u+T),t.ordinal&&T.indexOf(C)===0&&x.push(u+T.replace(C,this.options.pluralSeparator)),p&&x.push(u+R)),g){const A=`${u}${this.options.contextSeparator}${t.context}`;x.push(A),d&&(x.push(A+T),t.ordinal&&T.indexOf(C)===0&&x.push(A+T.replace(C,this.options.pluralSeparator)),p&&x.push(A+R))}}let v;for(;v=x.pop();)this.isValidLookup(i)||(s=v,i=this.getResource(m,y,v,t))}))})}),{res:i,usedKey:r,exactUsedKey:s,usedLng:a,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,i,r):this.resourceStore.getResource(e,t,i,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!ht(e.replace);let r=i?e.replace:e;if(i&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!i){r={...r};for(const s of t)delete r[s]}return r}static hasDefaultValue(e){const t="defaultValue";for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&e[i]!==void 0)return!0;return!1}}const e_=n=>n.charAt(0).toUpperCase()+n.slice(1);class UE{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Xr.create("languageUtils")}getScriptPartFromCode(e){if(e=Dm(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=Dm(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(ht(e)&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let r=Intl.getCanonicalLocales(e)[0];if(r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r)return r}catch{}const t=["hans","hant","latn","cyrl","cans","mong","arab"];let i=e.split("-");return this.options.lowerCaseLng?i=i.map(r=>r.toLowerCase()):i.length===2?(i[0]=i[0].toLowerCase(),i[1]=i[1].toUpperCase(),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=e_(i[1].toLowerCase()))):i.length===3&&(i[0]=i[0].toLowerCase(),i[1].length===2&&(i[1]=i[1].toUpperCase()),i[0]!=="sgn"&&i[2].length===2&&(i[2]=i[2].toUpperCase()),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=e_(i[1].toLowerCase())),t.indexOf(i[2].toLowerCase())>-1&&(i[2]=e_(i[2].toLowerCase()))),i.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(i=>{if(t)return;const r=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(i=>{if(t)return;const r=this.getLanguagePartFromCode(i);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(s=>{if(s===r)return s;if(!(s.indexOf("-")<0&&r.indexOf("-")<0)&&(s.indexOf("-")>0&&r.indexOf("-")<0&&s.substring(0,s.indexOf("-"))===r||s.indexOf(r)===0&&r.length>1))return s})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),ht(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],s=a=>{a&&(this.isSupportedCode(a)?r.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return ht(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):ht(e)&&s(this.formatLanguageCode(e)),i.forEach(a=>{r.indexOf(a)<0&&s(this.formatLanguageCode(a))}),r}}let lF=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],cF={1:n=>+(n>1),2:n=>+(n!=1),3:n=>0,4:n=>n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,5:n=>n==0?0:n==1?1:n==2?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5,6:n=>n==1?0:n>=2&&n<=4?1:2,7:n=>n==1?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,8:n=>n==1?0:n==2?1:n!=8&&n!=11?2:3,9:n=>+(n>=2),10:n=>n==1?0:n==2?1:n<7?2:n<11?3:4,11:n=>n==1||n==11?0:n==2||n==12?1:n>2&&n<20?2:3,12:n=>+(n%10!=1||n%100==11),13:n=>+(n!==0),14:n=>n==1?0:n==2?1:n==3?2:3,15:n=>n%10==1&&n%100!=11?0:n%10>=2&&(n%100<10||n%100>=20)?1:2,16:n=>n%10==1&&n%100!=11?0:n!==0?1:2,17:n=>n==1||n%10==1&&n%100!=11?0:1,18:n=>n==0?0:n==1?1:2,19:n=>n==1?0:n==0||n%100>1&&n%100<11?1:n%100>10&&n%100<20?2:3,20:n=>n==1?0:n==0||n%100>0&&n%100<20?1:2,21:n=>n%100==1?1:n%100==2?2:n%100==3||n%100==4?3:0,22:n=>n==1?0:n==2?1:(n<0||n>10)&&n%10==0?2:3};const uF=["v1","v2","v3"],hF=["v4"],FE={zero:0,one:1,two:2,few:3,many:4,other:5},dF=()=>{const n={};return lF.forEach(e=>{e.lngs.forEach(t=>{n[t]={numbers:e.nr,plurals:cF[e.fc]}})}),n};class fF{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Xr.create("pluralResolver"),(!this.options.compatibilityJSON||hF.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=dF(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi()){const i=Dm(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:i,type:r});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let a;try{a=new Intl.PluralRules(i,{type:r})}catch{if(!e.match(/-|_/))return;const l=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(l,t)}return this.pluralRulesCache[s]=a,a}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.getRule(e,t);return this.shouldUseIntlApi()?i&&i.resolvedOptions().pluralCategories.length>1:i&&i.numbers.length>1}getPluralFormsOfKey(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,i).map(r=>`${t}${r}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.getRule(e,t);return i?this.shouldUseIntlApi()?i.resolvedOptions().pluralCategories.sort((r,s)=>FE[r]-FE[s]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):i.numbers.map(r=>this.getSuffix(e,r,t)):[]}getSuffix(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,i);return r?this.shouldUseIntlApi()?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:this.getSuffixRetroCompatible(r,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const i=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let r=e.numbers[i];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(r===2?r="plural":r===1&&(r=""));const s=()=>this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString();return this.options.compatibilityJSON==="v1"?r===1?"":typeof r=="number"?`_plural_${r.toString()}`:s():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?s():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}shouldUseIntlApi(){return!uF.includes(this.options.compatibilityJSON)}}const VE=function(n,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=QU(n,e,t);return!s&&r&&ht(t)&&(s=dv(n,t,i),s===void 0&&(s=dv(e,t,i))),s},t_=n=>n.replace(/\$/g,"$$$$");class pF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Xr.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:r,prefix:s,prefixEscaped:a,suffix:o,suffixEscaped:l,formatSeparator:c,unescapeSuffix:u,unescapePrefix:h,nestingPrefix:d,nestingPrefixEscaped:p,nestingSuffix:g,nestingSuffixEscaped:_,nestingOptionsSeparator:y,maxReplaces:m,alwaysFormat:x}=e.interpolation;this.escape=t!==void 0?t:tF,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=s?Ll(s):a||"{{",this.suffix=o?Ll(o):l||"}}",this.formatSeparator=c||",",this.unescapePrefix=u?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=d?Ll(d):p||Ll("$t("),this.nestingSuffix=g?Ll(g):_||Ll(")"),this.nestingOptionsSeparator=y||",",this.maxReplaces=m||1e3,this.alwaysFormat=x!==void 0?x:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,i)=>t&&t.source===i?(t.lastIndex=0,t):new RegExp(i,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,i,r){let s,a,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=p=>{if(p.indexOf(this.formatSeparator)<0){const m=VE(t,l,p,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(m,void 0,i,{...r,...t,interpolationkey:p}):m}const g=p.split(this.formatSeparator),_=g.shift().trim(),y=g.join(this.formatSeparator).trim();return this.format(VE(t,l,_,this.options.keySeparator,this.options.ignoreJSONStructure),y,i,{...r,...t,interpolationkey:_})};this.resetRegExp();const u=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,h=r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:p=>t_(p)},{regex:this.regexp,safeValue:p=>this.escapeValue?t_(this.escape(p)):t_(p)}].forEach(p=>{for(o=0;s=p.regex.exec(e);){const g=s[1].trim();if(a=c(g),a===void 0)if(typeof u=="function"){const y=u(e,s,r);a=ht(y)?y:""}else if(r&&Object.prototype.hasOwnProperty.call(r,g))a="";else if(h){a=s[0];continue}else this.logger.warn(`missed to pass in variable ${g} for interpolating ${e}`),a="";else!ht(a)&&!this.useRawValueToEscape&&(a=PE(a));const _=p.safeValue(a);if(e=e.replace(s[0],_),h?(p.regex.lastIndex+=a.length,p.regex.lastIndex-=s[0].length):p.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,s,a;const o=(l,c)=>{const u=this.nestingOptionsSeparator;if(l.indexOf(u)<0)return l;const h=l.split(new RegExp(`${u}[ ]*{`));let d=`{${h[1]}`;l=h[0],d=this.interpolate(d,a);const p=d.match(/'/g),g=d.match(/"/g);(p&&p.length%2===0&&!g||g.length%2!==0)&&(d=d.replace(/'/g,'"'));try{a=JSON.parse(d),c&&(a={...c,...a})}catch(_){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,_),`${l}${u}${d}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];a={...i},a=a.replace&&!ht(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let c=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const u=r[1].split(this.formatSeparator).map(h=>h.trim());r[1]=u.shift(),l=u,c=!0}if(s=t(o.call(this,r[1].trim(),a),a),s&&r[0]===e&&!ht(s))return s;ht(s)||(s=PE(s)),s||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),s=""),c&&(s=l.reduce((u,h)=>this.format(u,h,i.lng,{...i,interpolationkey:r[1].trim()}),s.trim())),e=e.replace(r[0],s),this.regexp.lastIndex=0}return e}}const mF=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const i=n.split("(");e=i[0].toLowerCase().trim();const r=i[1].substring(0,i[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(a=>{if(a){const[o,...l]=a.split(":"),c=l.join(":").trim().replace(/^'+|'+$/g,""),u=o.trim();t[u]||(t[u]=c),c==="false"&&(t[u]=!1),c==="true"&&(t[u]=!0),isNaN(c)||(t[u]=parseInt(c,10))}})}return{formatName:e,formatOptions:t}},Dl=n=>{const e={};return(t,i,r)=>{let s=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(s={...s,[r.interpolationkey]:void 0});const a=i+JSON.stringify(s);let o=e[a];return o||(o=n(Dm(i),r),e[a]=o),o(t)}};class gF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Xr.create("formatter"),this.options=e,this.formats={number:Dl((t,i)=>{const r=new Intl.NumberFormat(t,{...i});return s=>r.format(s)}),currency:Dl((t,i)=>{const r=new Intl.NumberFormat(t,{...i,style:"currency"});return s=>r.format(s)}),datetime:Dl((t,i)=>{const r=new Intl.DateTimeFormat(t,{...i});return s=>r.format(s)}),relativetime:Dl((t,i)=>{const r=new Intl.RelativeTimeFormat(t,{...i});return s=>r.format(s,i.range||"day")}),list:Dl((t,i)=>{const r=new Intl.ListFormat(t,{...i});return s=>r.format(s)})},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Dl(t)}format(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=t.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(o=>o.indexOf(")")>-1)){const o=s.findIndex(l=>l.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,o)].join(this.formatSeparator)}return s.reduce((o,l)=>{const{formatName:c,formatOptions:u}=mF(l);if(this.formats[c]){let h=o;try{const d=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},p=d.locale||d.lng||r.locale||r.lng||i;h=this.formats[c](o,p,{...u,...r,...d})}catch(d){this.logger.warn(d)}return h}else this.logger.warn(`there was no format function for ${c}`);return o},e)}}const yF=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class _F extends u0{constructor(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=r,this.logger=Xr.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(i,r.backend,r)}queueLoad(e,t,i,r){const s={},a={},o={},l={};return e.forEach(c=>{let u=!0;t.forEach(h=>{const d=`${c}|${h}`;!i.reload&&this.store.hasResourceBundle(c,h)?this.state[d]=2:this.state[d]<0||(this.state[d]===1?a[d]===void 0&&(a[d]=!0):(this.state[d]=1,u=!1,a[d]===void 0&&(a[d]=!0),s[d]===void 0&&(s[d]=!0),l[h]===void 0&&(l[h]=!0)))}),u||(o[c]=!0)}),(Object.keys(s).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(s),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(e,t,i){const r=e.split("|"),s=r[0],a=r[1];t&&this.emit("failedLoading",s,a,t),!t&&i&&this.store.addResourceBundle(s,a,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const o={};this.queue.forEach(l=>{ZU(l.loaded,[s],a),yF(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(c=>{o[c]||(o[c]={});const u=l.loaded[c];u.length&&u.forEach(h=>{o[c][h]===void 0&&(o[c][h]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:i,tried:r,wait:s,callback:a});return}this.readingCalls++;const o=(c,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const h=this.waitingReads.shift();this.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}if(c&&u&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,i,r+1,s*2,a)},s);return}a(c,u)},l=this.backend[i].bind(this.backend);if(l.length===2){try{const c=l(e,t);c&&typeof c.then=="function"?c.then(u=>o(null,u)).catch(o):o(null,c)}catch(c){o(c)}return}return l(e,t,o)}prepareLoading(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();ht(e)&&(e=this.languageUtils.toResolveHierarchy(e)),ht(t)&&(t=[t]);const s=this.queueLoad(e,t,i,r);if(!s.toLoad.length)return s.pending.length||r(),null;s.toLoad.forEach(a=>{this.loadOne(a)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=e.split("|"),r=i[0],s=i[1];this.read(r,s,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${t}loading namespace ${s} for language ${r} failed`,a),!a&&o&&this.logger.log(`${t}loaded namespace ${s} for language ${r}`,o),this.loaded(e,a,o)})}saveMissing(e,t,i,r,s){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend&&this.backend.create){const l={...a,isUpdate:s},c=this.backend.create.bind(this.backend);if(c.length<6)try{let u;c.length===5?u=c(e,t,i,r,l):u=c(e,t,i,r),u&&typeof u.then=="function"?u.then(h=>o(null,h)).catch(o):o(null,u)}catch(u){o(u)}else c(e,t,i,r,o,l)}!e||!e[0]||this.store.addResource(e[0],t,i,r)}}}const BE=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),ht(n[1])&&(e.defaultValue=n[1]),ht(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(i=>{e[i]=t[i]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),zE=n=>(ht(n.ns)&&(n.ns=[n.ns]),ht(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),ht(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs&&n.supportedLngs.indexOf("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),n),Rf=()=>{},xF=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class td extends u0{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=zE(e),this.services={},this.logger=Xr,this.modules={external:[]},xF(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(i=t,t={}),!t.defaultNS&&t.defaultNS!==!1&&t.ns&&(ht(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=BE();this.options={...r,...this.options,...zE(t)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...r.interpolation,...this.options.interpolation}),t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?Xr.init(s(this.modules.logger),this.options):Xr.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:typeof Intl<"u"&&(u=gF);const h=new UE(this.options);this.store=new OE(this.options.resources,this.options);const d=this.services;d.logger=Xr,d.resourceStore=this.store,d.languageUtils=h,d.pluralResolver=new fF(h,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),u&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(d.formatter=s(u),d.formatter.init(d,this.options),this.options.interpolation.format=d.formatter.format.bind(d.formatter)),d.interpolator=new pF(this.options),d.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},d.backendConnector=new _F(s(this.modules.backend),d.resourceStore,d,this.options),d.backendConnector.on("*",function(p){for(var g=arguments.length,_=new Array(g>1?g-1:0),y=1;y<g;y++)_[y-1]=arguments[y];e.emit(p,..._)}),this.modules.languageDetector&&(d.languageDetector=s(this.modules.languageDetector),d.languageDetector.init&&d.languageDetector.init(d,this.options.detection,this.options)),this.modules.i18nFormat&&(d.i18nFormat=s(this.modules.i18nFormat),d.i18nFormat.init&&d.i18nFormat.init(this)),this.translator=new Nm(this.services,this.options),this.translator.on("*",function(p){for(var g=arguments.length,_=new Array(g>1?g-1:0),y=1;y<g;y++)_[y-1]=arguments[y];e.emit(p,..._)}),this.modules.external.forEach(p=>{p.init&&p.init(this)})}if(this.format=this.options.interpolation.format,i||(i=Rf),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=function(){return e.store[u](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=function(){return e.store[u](...arguments),e}});const l=Uu(),c=()=>{const u=(h,d)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(d),i(h,d)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initImmediate?c():setTimeout(c,0),l}loadResources(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Rf;const r=ht(e)?e:this.language;if(typeof e=="function"&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&r.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const s=[],a=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(c=>{c!=="cimode"&&s.indexOf(c)<0&&s.push(c)})};r?a(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>a(l)),this.options.preload&&this.options.preload.forEach(o=>a(o)),this.services.backendConnector.load(s,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(o)})}else i(null)}reloadResources(e,t,i){const r=Uu();return typeof e=="function"&&(i=e,e=void 0),typeof t=="function"&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=Rf),this.services.backendConnector.reload(e,t,s=>{r.resolve(),i(s)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&HR.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const i=this.languages[t];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}}changeLanguage(e,t){var i=this;this.isLanguageChangingTo=e;const r=Uu();this.emit("languageChanging",e);const s=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,c)=>{c?(s(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,r.resolve(function(){return i.t(...arguments)}),t&&t(l,function(){return i.t(...arguments)})},o=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const c=ht(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);c&&(this.language||s(c),this.translator.language||this.translator.changeLanguage(c),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(c)),this.loadResources(c,u=>{a(u,c)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),r}getFixedT(e,t,i){var r=this;const s=function(a,o){let l;if(typeof o!="object"){for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];l=r.options.overloadTranslationOptionHandler([a,o].concat(u))}else l={...o};l.lng=l.lng||s.lng,l.lngs=l.lngs||s.lngs,l.ns=l.ns||s.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||i||s.keyPrefix);const d=r.options.keySeparator||".";let p;return l.keyPrefix&&Array.isArray(a)?p=a.map(g=>`${l.keyPrefix}${d}${g}`):p=l.keyPrefix?`${l.keyPrefix}${d}${a}`:a,r.t(p,l)};return ht(e)?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=i,s}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const a=(o,l)=>{const c=this.services.backendConnector.state[`${o}|${l}`];return c===-1||c===0||c===2};if(t.precheck){const o=t.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(i,e)&&(!r||a(s,e)))}loadNamespaces(e,t){const i=Uu();return this.options.ns?(ht(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{i.resolve(),t&&t(r)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=Uu();ht(e)&&(e=[e]);const r=this.options.preload||[],s=e.filter(a=>r.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return s.length?(this.options.preload=r.concat(s),this.loadResources(a=>{i.resolve(),t&&t(a)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services&&this.services.languageUtils||new UE(BE());return t.indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new td(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Rf;const i=e.forkResourceStore;i&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},s=new td(r);return(e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(o=>{s[o]=this[o]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},i&&(s.store=new OE(this.store.data,r),s.services.resourceStore=s.store),s.translator=new Nm(s.services,r),s.translator.on("*",function(o){for(var l=arguments.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=arguments[u];s.emit(o,...c)}),s.init(r,t),s.translator.options=r,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const di=td.createInstance();di.createInstance=td.createInstance;di.createInstance;di.dir;di.init;di.loadResources;di.reloadResources;di.use;di.changeLanguage;di.getFixedT;di.t;di.exists;di.setDefaultNamespace;di.hasLoadedNamespace;di.loadNamespaces;di.loadLanguages;const vF=(n,e,t,i)=>{var s,a,o,l;const r=[t,{code:e,...i||{}}];if((a=(s=n==null?void 0:n.services)==null?void 0:s.logger)!=null&&a.forward)return n.services.logger.forward(r,"warn","react-i18next::",!0);$o(r[0])&&(r[0]=`react-i18next:: ${r[0]}`),(l=(o=n==null?void 0:n.services)==null?void 0:o.logger)!=null&&l.warn?n.services.logger.warn(...r):console!=null&&console.warn&&console.warn(...r)},HE={},pv=(n,e,t,i)=>{$o(t)&&HE[t]||($o(t)&&(HE[t]=new Date),vF(n,e,t,i))},GR=(n,e)=>()=>{if(n.isInitialized)e();else{const t=()=>{setTimeout(()=>{n.off("initialized",t)},0),e()};n.on("initialized",t)}},mv=(n,e,t)=>{n.loadNamespaces(e,GR(n,t))},GE=(n,e,t,i)=>{if($o(t)&&(t=[t]),n.options.preload&&n.options.preload.indexOf(e)>-1)return mv(n,t,i);t.forEach(r=>{n.options.ns.indexOf(r)<0&&n.options.ns.push(r)}),n.loadLanguages(e,GR(n,i))},SF=(n,e,t={})=>!e.languages||!e.languages.length?(pv(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(n,{lng:t.lng,precheck:(i,r)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!r(i.isLanguageChangingTo,n))return!1}}),$o=n=>typeof n=="string",bF=n=>typeof n=="object"&&n!==null,wF=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,TF={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},EF=n=>TF[n],AF=n=>n.replace(wF,EF);let gv={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:AF};const MF=(n={})=>{gv={...gv,...n}},CF=()=>gv;let WR;const IF=n=>{WR=n},RF=()=>WR,PF={type:"3rdParty",init(n){MF(n.options.react),IF(n)}},LF=te.createContext();class DF{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const NF=(n,e)=>{const t=te.useRef();return te.useEffect(()=>{t.current=n},[n,e]),t.current},$R=(n,e,t,i)=>n.getFixedT(e,t,i),OF=(n,e,t,i)=>te.useCallback($R(n,e,t,i),[n,e,t,i]),h0=(n,e={})=>{var T,R,C,A;const{i18n:t}=e,{i18n:i,defaultNS:r}=te.useContext(LF)||{},s=t||i||RF();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new DF),!s){pv(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const E=(S,I)=>$o(I)?I:bF(I)&&$o(I.defaultValue)?I.defaultValue:Array.isArray(S)?S[S.length-1]:S,b=[E,{},!1];return b.t=E,b.i18n={},b.ready=!1,b}(T=s.options.react)!=null&&T.wait&&pv(s,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const a={...CF(),...s.options.react,...e},{useSuspense:o,keyPrefix:l}=a;let c=r||((R=s.options)==null?void 0:R.defaultNS);c=$o(c)?[c]:c||["translation"],(A=(C=s.reportNamespaces).addUsedNamespaces)==null||A.call(C,c);const u=(s.isInitialized||s.initializedStoreOnce)&&c.every(E=>SF(E,s,a)),h=OF(s,e.lng||null,a.nsMode==="fallback"?c:c[0],l),d=()=>h,p=()=>$R(s,e.lng||null,a.nsMode==="fallback"?c:c[0],l),[g,_]=te.useState(d);let y=c.join();e.lng&&(y=`${e.lng}${y}`);const m=NF(y),x=te.useRef(!0);te.useEffect(()=>{const{bindI18n:E,bindI18nStore:b}=a;x.current=!0,!u&&!o&&(e.lng?GE(s,e.lng,c,()=>{x.current&&_(p)}):mv(s,c,()=>{x.current&&_(p)})),u&&m&&m!==y&&x.current&&_(p);const S=()=>{x.current&&_(p)};return E&&(s==null||s.on(E,S)),b&&(s==null||s.store.on(b,S)),()=>{x.current=!1,s&&E&&(E==null||E.split(" ").forEach(I=>s.off(I,S))),b&&s&&b.split(" ").forEach(I=>s.store.off(I,S))}},[s,y]),te.useEffect(()=>{x.current&&u&&_(d)},[s,l,u]);const v=[g,s,u];if(v.t=g,v.i18n=s,v.ready=u,u||!u&&!o)return v;throw new Promise(E=>{e.lng?GE(s,e.lng,c,()=>E()):mv(s,c,()=>E())})},kF={home:"Home",stars:"Stars",planets:"Planets",habitability:"Habitability",vote:"Vote",apod:"Pic of the Day",about:"About"},UF={home:{title:"Home",infoCard:{title:"Welcome to the Exoplanets",description:"You're viewing the night sky from Earth, but these aren't ordinary stars. Each point of light represents a confirmed exoplanet host star from NASA's archive.",stats:"Over {{starCount}} stellar systems harboring {{planetCount}}+ confirmed worlds",hint:"Click any star to explore its planetary system",dismiss:"Got it"}},stars:{title:"Stars",loading:"Loading stars...",errorTitle:"Error Loading Stars",searchPlaceholder:"Search stars by name...",filters:{starClass:"Star Class:",systemType:"System Type:",allSystems:"All",binarySystems:"Binary ",singleSystems:"Single ",sortBy:"Sort by:",clearFilters:"Clear Filters"},sort:{name:"Name",distance:"Distance",planets:"Planet Count",temperature:"Temperature"},results:{showing:"Showing {{start}}{{end}} of {{filtered}} star",showing_plural:"Showing {{start}}{{end}} of {{filtered}} stars",total:"({{total}} total)",noResults:"No stars match your filters. Try adjusting your search."},pagination:{previous:" Previous",next:"Next ",pageOf:"Page {{current}} of {{total}}"}},starCard:{properties:{temperature:"Temperature",radius:"Radius",mass:"Mass",distance:"Distance",planets:"Planets",vMagnitude:"V Magnitude"},viewSystem:"View system ",binary:"Binary"},star:{title:"Star Details",loading:"Loading...",notFound:{title:"Star Not Found",message:'The star "{{starId}}" could not be found.',returnToStarfield:" Return to starfield"},backToStarfield:" Back to Starfield",showInfo:"Show star information",hideInfo:"Hide star information",distance:"Distance",planets:"Planets",spectralType:"Spectral Type"},starSystem:{info:{type:"Type",temperature:"Temperature",radius:"Radius",mass:"Mass",distance:"Distance",age:"Age",planet:"Planet",planets:"Planets",stars:"Stars",planetaryBodies:"Planetary Bodies",star:"Star",primaryStar:"Primary Star",companionStar:"Companion Star",binarySystem:"Binary System",circumbinary:"Circumbinary",unknown:"Unknown"},hint:"Drag to rotate  Scroll to zoom  Hover planets for info",showBodies:"Show planetary bodies",hideBodies:"Hide planetary bodies",systemOverview:{button:"System Overview",starComparison:"Star Comparison",systemStats:"System Statistics",habitableCandidates:"Habitable Candidates",lightYears:"Light Years",planetaryData:"Planetary Data",planetSizes:"Planet Sizes",orbitalDistances:"Orbital Distances",skyPosition:"Sky Position",rightAscension:"Right Ascension",declination:"Declination",galacticLat:"Galactic Latitude",galacticLon:"Galactic Longitude",discoveryInfo:"Discovery Information",firstDiscovery:"First Discovery",latestDiscovery:"Latest Discovery",methods:"Discovery Methods",stellarProperties:"Stellar Properties",luminosity:"Luminosity",surfaceGravity:"Surface Gravity",metallicity:"Metallicity",rotationPeriod:"Rotation Period",sun:"Sun",sunStats:"1.0 R  5,778 K",largerThanSun:"This star is {{times}}x larger than the Sun",smallerThanSun:"{{pct}}% smaller than the Sun",similarToSun:"Similar in size to the Sun",travelTime:{title:"Interstellar Travel Time",unreachable:"Unreachable in human terms",lightYearsAway:"light-years away",reachableAt:"Reachable at",orFaster:"or faster",withinLifetime:" Within your lifetime",lifetimes:"{{count}} lifetimes",replay:" Replay Race",walking:"Walking",car:"Car",jet:"Jetliner",voyager:"Voyager 1",newHorizons:"New Horizons",parkerProbe:"Parker Solar Probe",onePercentC:"1% Light Speed",tenPercentC:"10% Light Speed",lightSpeed:"Light Speed",instant:"Instant",generationNote:"1 generation = 25 years",lifetimeNote:"1 lifetime = 80 years"},starFeatures:{title:"Notable Star Features",solarAnalog:"Solar Analog",solarAnalogDesc:"Most similar to our Sun in temperature, mass, and luminosity",sunLike:"Sun-like Star",sunLikeDesc:"F, G, or K spectral class, stable and long-lived",redDwarf:"Red Dwarf Host",redDwarfDesc:"M-class star, the most common type in the galaxy",youngSystem:"Young System",youngSystemDesc:"Less than 1 billion years old, still in cosmic youth",matureSystem:"Mature System",matureSystemDesc:"1-8 billion years old, similar age to our solar system",ancientSystem:"Ancient System",ancientSystemDesc:"Over 10 billion years old, older than most stars",metalRich:"Metal-Rich Star",metalRichDesc:"High heavy element content, favorable for planet formation",metalPoor:"Metal-Poor Star",metalPoorDesc:"Low metallicity, formed from primordial gas",binarySystem:"Binary Star System",binarySystemDesc:"Two stars orbiting each other",circumbinary:"Circumbinary Planets",circumbinaryDesc:"Planets orbiting both stars, like Tatooine"},habitability:{title:"System Habitability",avgScore:"System Average",bestCandidate:"Best Candidate",score:"Score",breakdown:"Habitability Breakdown",topCandidates:"Top Candidates",earthLike:"Earth-like",conservativeHz:"Conservative HZ",optimisticHz:"Optimistic HZ",potentiallyRocky:"Potentially Rocky",other:"Other",habitableZone:"In Habitable Zone",noData:"Insufficient data for habitability analysis"},orbitalView:{title:"Orbital Architecture",habitableZone:"Habitable Zone",scale:"Scale",au:"AU",innerHz:"Inner HZ",outerHz:"Outer HZ"},tempSizeChart:{title:"Temperature vs Size",xAxis:"Equilibrium Temperature (K)",yAxis:"Planet Radius (Earth radii)",tooHot:"Too Hot",habitable:"Habitable",tooCold:"Too Cold",earth:"Earth"}}},planets:{title:"Planets",loading:"Loading planets...",errorTitle:"Error Loading Planets",searchPlaceholder:"Search planets by name or host star...",filters:{planetType:"Planet Type:",starClass:"Star Class:",discoveryMethod:"Discovery Method:",sortBy:"Sort by:",discoveryMethods:{all:"All Methods",transit:"Transit Only",rv:"Radial Velocity Only",both:"Both (RV + Transit)"},habitableOnly:"Habitable Zone Only",earthLikeOnly:"Earth-like Only",eccentricOnly:"Eccentric Orbit",circumbinaryOnly:"Circumbinary System",clearFilters:"Clear Filters"},sort:{name:"Name",distance:"Distance",mass:"Mass",radius:"Radius",discoveryYear:"Discovery Date",habitability:"Habitability Score"},results:{showing:"Showing {{start}}{{end}} of {{filtered}} planet",showing_plural:"Showing {{start}}{{end}} of {{filtered}} planets",total:"({{total}} total)",noResults:"No planets match your filters. Try adjusting your search."},pagination:{previous:" Previous",next:"Next ",pageOf:"Page {{current}} of {{total}}"}},planet:{title:"Planet Details",loading:"Loading planet data...",notFound:{title:"Planet Not Found",message:"Could not find planet: {{planetId}}",browseAll:" Browse all planets"},back:" Back",exoplanet:"Exoplanet",viewSystem:"View {{hostname}} System ",viewStats:"View planet statistics",sections:{earthComparison:"Compared to Earth",habitability:"Habitability Score",temperature:"Temperature Zone",orbitalPosition:"Orbital Position",radialVelocity:"Radial Velocity Analysis",transitDetection:"Transit Detection",travelTime:"Travel Time"},comparison:{earth:"Earth",radius:"Radius",mass:"Mass",density:"Density",gravity:"Surface Gravity",temperature:"Temperature",largerThanEarth:"{{times}} larger than Earth",smallerThanEarth:"{{pct}}% smaller than Earth",similarToEarth:"Similar size to Earth",timesLarger:"{{times}} larger",timesSmaller:"{{times}} smaller",similar:"Similar"},habitability:{breakdown:"Score Breakdown",temperature:"Temperature",size:"Size",starType:"Star Type",insolation:"Insolation",inHabitableZone:"In Habitable Zone",earthLikeSize:"Earth-like Size",potentiallyRocky:"Potentially Rocky",topCandidate:"Top Candidate",tiers:{excellent:"Excellent Habitability",good:"Good Habitability",moderate:"Moderate Habitability",low:"Low Habitability",minimal:"Minimal Habitability"}},temperature:{title:"Temperature Zone",unknown:"Temperature Unknown",habitableZone:"Habitable Zone (200-320K)",frozen:"Frozen",habitable:"Habitable",scorching:"Scorching",zones:{unknown:"Unknown",frozen:"Frozen",cold:"Cold",cool:"Cool",habitable:"Habitable",warm:"Warm",hot:"Hot",scorching:"Scorching"},descriptions:{unknown:"Temperature data is not available for this planet.",frozen:"Cryogenic conditions - far colder than any natural environment on Earth.",cold:"Extremely cold - water would be permanently frozen on the surface.",cool:"Cool temperatures - liquid water unlikely without a thick atmosphere.",habitable:"Within the temperature range where liquid water could exist on the surface.",warm:"Too warm for liquid water without special conditions.",hot:"Very hot - surface temperatures would be extremely hostile to life.",scorching:"Extreme heat - metals and rocks may vaporize in the atmosphere."}},orbital:{title:"Position in System",noData:"Orbital data not available",habitableZone:"Habitable Zone",distance:"Distance from Star",period:"Orbital Period",eccentricity:"Eccentricity"},rv:{title:"Radial Velocity Detection",intro:"The radial velocity method revolutionized astrobiology by enabling us to detect planets orbiting distant stars including potentially habitable worlds we could never see directly. This visualization uses real measurements from this planet's host star to simulate the subtle stellar wobble that revealed its existence. Watch as the synchronized views show how astronomers decode tiny Doppler shifts in starlight to discover new worlds across the galaxy.",curveTitle:"Radial Velocity Over Time",xAxisLabel:"Time (days)",yAxisLabel:"Radial Velocity (m/s)",legendRedshift:"Redshift (away)",legendBlueshift:"Blueshift (toward)",legendBaseline:"Baseline",comparisonTitle:"RV Amplitude Comparison",comparisonDescription:"The RV amplitude (semi-amplitude K) indicates how much the star wobbles due to each planet. Larger amplitudes mean the planet has a stronger gravitational pull on its star, either because it's more massive, orbits closer, or both. Planets with amplitudes below ~1 m/s are extremely difficult to detect with current technology. This chart compares all planets in this system to show which ones create the most detectable stellar wobble.",detectionThreshold:"Modern Detection Limit (~1 m/s)",dataDisplay:{currentRV:"Current RV",amplitude:"Amplitude (K)",baseline:"Baseline"},visualizations:{orbitalMotion:"Orbital Motion",spectralDoppler:"Spectral Doppler Shift"},noData:{title:"No Radial Velocity Data Available",message:"This planet was discovered using {{method}}, which doesn't provide RV measurements.",example:"For comparison, in our Solar System:",jupiterExample:"Jupiter causes the Sun to wobble at ~12 m/s",earthExample:"Earth causes ~0.09 m/s (undetectable with current technology)",detectionLimit:"Detection limit for modern spectrographs: ~1 m/s"},explanation:{dopplerTitle:"What is the Doppler Shift?",dopplerContent:"Just like an ambulance siren sounds higher-pitched as it approaches and lower as it moves away, light from a star shifts to bluer wavelengths when moving toward us and redder when moving away. Astronomers measure these tiny wavelength shifts in the star's spectral lines to detect its motion.",dopplerImageCaption:"Radial velocity detection: As a planet orbits, it causes its host star to wobble. This motion produces a Doppler shift in the star's spectrum that we can measure from Earth.",wobbleTitle:"How Does Stellar Wobble Work?",wobbleContent:"Planets and their host stars orbit around a common center of mass (barycenter). As a planet orbits, it tugs on the star, causing the star to 'wobble' back and forth. Larger planets or those closer to their stars cause more noticeable wobbles. For example, Jupiter causes our Sun to wobble at about 12 m/s, while Earth's effect is only 0.09 m/s; too small to detect with current technology.",discoveryTitle:"The 51 Pegasi Discovery (1995)",discoveryContent:"51 Pegasi b was the first exoplanet discovered around a Sun-like star using the radial velocity method. Its RV amplitude of ~50 m/s and 4.2-day orbital period shocked astronomers, revealing a Jupiter-mass planet orbiting closer to its star than Mercury is to our Sun. This discovery introduced the 'Hot Jupiter' class of exoplanets and revolutionized our understanding of planetary systems."},technical:{title:"Technical Details",amplitude:"RV Amplitude",period:"Orbital Period",baseline:"Baseline Velocity",eccentricity:"Eccentricity",stellarRotation:"Stellar Rotation",stellarRotationNote:"Stellar rotation adds noise to RV measurements"}},transit:{title:"Transit Detection",intro:"The transit method is the most successful planet detection technique, responsible for discovering thousands of exoplanets including Earth-sized worlds. When a planet passes in front of its star from our viewpoint, it blocks a tiny fraction of the star's light. By measuring these periodic dips in brightness, astronomers can determine the planet's size, orbital period, and atmospheric composition.",curveTitle:"Transit Light Curve",xAxisLabel:"Orbital Phase",yAxisLabel:"Relative Flux",comparisonTitle:"Transit Depth Comparison",comparisonDescription:"Transit depth directly reveals the planet's radius relative to its star. Deeper transits mean larger planets. This chart compares all transiting planets in this system.",dataDisplay:{currentFlux:"Current Flux",transitDepth:"Transit Depth",planetRadius:"Planet Radius",phase:"Phase"},visualizations:{orbitalGeometry:"Orbital Geometry",topView:"Top View (Orbital Plane)",sideView:"Side View (From Earth)",whatWeLearn:"What We Learn From Transits"},noData:{title:"No Transit Data Available",message:"This planet was discovered using {{method}}, which doesn't provide transit measurements.",example:"For comparison, from a distant viewpoint:",jupiterExample:"Jupiter transiting the Sun: 0.01% depth",earthExample:"Earth transiting the Sun: 0.008% depth",detectionLimit:"Detection limit: ~0.001% with Kepler/TESS"},explanation:{geometryTitle:"Why Does Geometry Matter?",geometryContent:"Transit detection requires precise orbital alignment. The planet's orbit must be nearly edge-on from Earth's perspective. Only about 0.5-1% of randomly oriented planetary systems will transit as seen from Earth.",depthTitle:"What Does Transit Depth Tell Us?",depthContent:"The transit depth directly reveals the planet's size. It's proportional to (planet radius / star radius). A Jupiter-sized planet blocks ~1% of light, while Earth blocks only ~0.008%.",timingTitle:"Transit Timing Variations",timingContent:"By measuring transits repeatedly, astronomers can detect gravitational tugs from other planets. These tiny timing variations reveal additional planets that might not transit themselves."},legend:{duringTransit:"DURING TRANSIT:",duringTransitItem1:"Planet crosses in front of star",duringTransitItem2:"Flux drops as light is blocked",duringTransitItem3:"Depth reveals planet size",outsideTransit:"OUTSIDE TRANSIT:",outsideTransitItem1:"Full starlight reaches us",outsideTransitItem2:"Flux returns to baseline (1.0)",whatWeLearn:"WHAT WE LEARN:",whatWeLearnItem1:"Planet radius from depth",whatWeLearnItem2:"Orbital period from timing",whatWeLearnItem3:"Atmosphere from spectra"},technical:{depth:"Transit Depth",duration:"Transit Duration",period:"Orbital Period",radiusRatio:"Radius Ratio (Rp/R)",semiMajorRatio:"a/R Ratio",impactParameter:"Impact Parameter",planetRadius:"Planet Radius"}},siblings:{title:"Other Planets in {{system}}",count:"{{count}} other planet in this system",count_plural:"{{count}} other planets in this system",earthLikeHabitable:"Earth-like, Habitable Zone",habitable:"Habitable Zone",hotJupiter:"Hot Jupiter",frozen:"Frozen World",exoplanet:"Exoplanet"},visualization:{title:"How We Visualize This Planet",intro:"Our planet visualizations are generated procedurally using real scientific data from NASA's Exoplanet Archive. Here's how different properties influence what you see:",density:{title:"Density",description:'Determines surface texture and composition. High-density worlds appear more rugged with retained impact craters (strong gravity holds surface features). Low-density "puffy" planets have smoother, more volatile-rich appearances.'},insolation:{title:"Insolation Flux",description:"The energy received from the host star. High insolation creates volcanic surfaces, lava glow, and active atmospheres. Low insolation produces ice coverage and frozen landscapes."},starTemp:{title:"Star Temperature",description:"Affects the lighting color. Planets around red dwarf stars have a warm orange tint, while those orbiting hot blue stars appear cooler and bluer."},planetType:{title:"Planet Type",description:"Determines the base shader: Gas Giants show banded atmospheres with storms, Ice Giants have smooth blue-green methane atmospheres, and Rocky planets display terrain, craters, and possible atmospheres."},disclaimer:"Note: These visualizations are artistic interpretations based on scientific data, not actual photographs. Each planet's unique seed ensures consistent appearance across sessions."},info:{sections:{properties:"Planet Properties",hostStar:"Host Star",discovery:"Discovery",reviews:"Reviews"},earthComparison:" = hover for Earth comparison",flags:{habitableZone:"In Habitable Zone",earthLike:"Earth-like",topCandidate:"Top Habitability Candidate",potentiallyRocky:"Potentially Rocky",earthLikeInsolation:"Earth-like Insolation",hotJupiter:"Hot Jupiter",hotNeptune:"Hot Neptune",ultraHot:"Ultra Hot (>2000K)",frozenWorld:"Frozen World",ultraDense:"Ultra Dense",puffy:"Puffy (Low Density)",superMassive:"Super Massive",lightweight:"Lightweight (<0.5 M)",ultraShortPeriod:"Ultra-Short Period (<1 day)",longPeriod:"Long Period (>1000 days)",eccentricOrbit:"Eccentric Orbit",circularOrbit:"Circular Orbit",tidallyLocked:"Likely Tidally Locked",circumbinary:"Circumbinary (Tatooine)",multiPlanet:"Multi-Planet System",richSystem:"Rich System (4+ planets)",multiStar:"Multi-Star System",veryNearby:"Very Nearby (<65 ly)",nearby:"Nearby (<163 ly)",solarAnalog:"Solar Analog Host",redDwarfHost:"Red Dwarf Host",youngSystem:"Young System (<1 Gyr)",ancientSystem:"Ancient System (>10 Gyr)",metalRich:"Metal-Rich Star",metalPoor:"Metal-Poor Star",transiting:"Transiting",hasRvData:"Has RV Data",hasTtv:"Has TTV",controversial:"Controversial Detection"},flagDescriptions:{habitableZone:"This planet orbits within the habitable zone, the region around a star where liquid water could exist on the surface.",earthLike:"This planet has characteristics similar to Earth: rocky composition, similar size, and potentially habitable conditions.",topCandidate:"Among the best candidates for potential habitability based on multiple factors including temperature, size, and stellar environment.",potentiallyRocky:"Based on its mass and radius, this planet likely has a rocky composition similar to Earth, Mars, or Venus.",earthLikeInsolation:"This planet receives a similar amount of energy from its star as Earth does from the Sun (0.5-2.0 Earth's insolation).",hotJupiter:"A gas giant orbiting very close to its star, resulting in extreme surface temperatures and rapid orbital periods.",hotNeptune:"A Neptune-sized planet orbiting close to its star, experiencing intense stellar radiation.",ultraHot:"Surface temperature exceeds 2000K hot enough to vaporize most metals and rocks.",frozenWorld:"An extremely cold world where surface temperatures are too low for liquid water, likely covered in ice.",ultraDense:"This planet has exceptionally high density, suggesting a composition dominated by heavy elements like iron.",puffy:"A low-density planet with an extended atmosphere, likely inflated by intense stellar heating.",superMassive:"An exceptionally massive planet, significantly larger than Jupiter.",lightweight:"A very low-mass planet (less than half Earth's mass), possibly with a thin atmosphere or none at all.",ultraShortPeriod:"Completes an orbit in less than one Earth day, experiencing extreme tidal forces and stellar radiation.",longPeriod:"Takes over 1000 days to complete one orbit, existing far from its host star.",eccentricOrbit:"Follows a highly elliptical orbit, experiencing significant variations in distance from its star.",circularOrbit:"Follows a nearly circular orbit, maintaining a consistent distance from its star.",tidallyLocked:"One side of this planet likely always faces its star, creating permanent day and night hemispheres.",circumbinary:"Orbits around two stars, like Tatooine in Star Wars. Experiences complex gravitational dynamics.",multiPlanet:"Part of a system with multiple confirmed planets orbiting the same star.",richSystem:"Belongs to a planetary system with 4 or more confirmed planets.",multiStar:"Located in a system with multiple stars (binary, triple, or more).",veryNearby:"Less than 65 light-years from Earth, one of our closest exoplanet neighbors.",nearby:"Within 163 light-years of Earth, making it a relatively close interstellar neighbor.",solarAnalog:"Orbits a star very similar to our Sun in temperature, size, and luminosity.",redDwarfHost:"Orbits a red dwarf (M-type star), the most common type of star in the galaxy.",youngSystem:"Part of a stellar system less than 1 billion years old, still in its cosmic youth.",ancientSystem:"Part of a stellar system over 10 billion years old, older than most stars in our galaxy.",metalRich:"Host star has high metallicity, which correlates with increased planet formation.",metalPoor:"Host star has low metallicity, suggesting the system formed from primordial gas.",transiting:"This planet passes in front of its star from our viewpoint, enabling detailed atmospheric studies.",hasRvData:"Detected or confirmed using radial velocity measurements, which track the star's wobble caused by the planet.",hasTtv:"Shows Transit Timing Variations, changes in transit timing that reveal gravitational interactions with other bodies.",controversial:"The existence or properties of this planet are debated among astronomers."},reviews:{empty:"No reviews yet. Be the first to share your experience!",writeReview:"Write a Review",form:{title:"Share Your Experience",ratingLabel:"How would you rate this planet?",titleLabel:"Review Title",titlePlaceholder:"Give your review a title",textLabel:"Your Review",textPlaceholder:"What was your experience like on this distant world?",submit:"Post Review",errorTitleMin:"Title must be at least 3 characters",errorTextMin:"Review must be at least 10 characters"},userPrompt:{title:"Before you continue...",subtitle:"Tell us your name, space traveler",placeholder:"Enter your name",continue:"Continue as {{name}}",errorMinLength:"Name must be at least 2 characters",errorMaxLength:"Name must be 30 characters or less"}},unknown:"Unknown",fields:{hostStar:"Host Star",planetType:"Planet Type",radius:"Radius",mass:"Mass",density:"Density",insolationFlux:"Insolation Flux",eqTemperature:"Eq. Temperature",orbitalPeriod:"Orbital Period",semiMajorAxis:"Semi-major Axis",orbitalEccentricity:"Orbital Eccentricity",starTemperature:"Star Temperature",starMetallicity:"Star Metallicity",starAge:"Star Age",discoveryYear:"Discovery Year",discoveryMethod:"Discovery Method",facility:"Facility"},earthRef:{earthRadius:"Earth radius",earthMass:"Earth mass",earthDensity:"Earth density",earthEqTemp:"Earth equilibrium temp",earthInsolation:"Earth insolation",earthOrbitalPeriod:"Earth orbital period",earthSemiMajorAxis:"Earth semi-major axis",earthOrbitalEccentricity:"Earth orbital eccentricity",sunTemperature:"Sun temperature",sunMetallicity:"Sun metallicity",sunAge:"Sun age"}}},planetCard:{properties:{radius:"Radius",mass:"Mass",period:"Period",temp:"Temp",distance:"Distance",discovered:"Discovered"},flags:{habitableZone:"Habitable Zone",earthLike:"Earth-like",circumbinary:"Circumbinary",topCandidate:"Top Candidate",potentiallyRocky:"Potentially Rocky",hotJupiter:"Hot Jupiter",hotNeptune:"Hot Neptune",ultraHot:"Ultra Hot",frozenWorld:"Frozen World",ultraDense:"Ultra Dense",puffy:"Puffy",ultraShortPeriod:"Ultra-Short Period",eccentricOrbit:"Eccentric Orbit",tidallyLocked:"Tidally Locked",richSystem:"Rich System",veryNearby:"Very Nearby",solarAnalog:"Solar Analog",redDwarfHost:"Red Dwarf Host",controversial:"Controversial",hasRvData:"RV Data"},viewDetails:"View details "},apod:{title:"Astronomy Picture of the Day",loading:"Loading today's cosmic wonder...",yesterday:"Yesterday",tomorrow:"Tomorrow",error:"Could not load the picture",videoNotSupported:"Your browser does not support the video tag.",viewFullSize:"Click to view full size"},about:{title:"About",subtitle:"Exploring 6,000+ confirmed worlds beyond our solar system",exploration:{title:"The Story of Exoplanet Exploration",timeline:{1992:{title:"First Exoplanets",desc:"Wolszczan & Frail discover the first confirmed exoplanets orbiting a pulsar, proving planets exist beyond our solar system."},1995:{title:"51 Pegasi b",desc:"Mayor & Queloz detect the first exoplanet around a Sun-like star, earning them the 2019 Nobel Prize in Physics."},2009:{title:"Kepler Launches",desc:"NASA's Kepler space telescope begins its mission, eventually discovering over 2,700 confirmed exoplanets."},2016:{title:"Proxima Centauri b",desc:"Discovery of an Earth-sized planet in the habitable zone of our nearest stellar neighbor, just 4.2 light-years away."},2018:{title:"TESS Mission",desc:"The Transiting Exoplanet Survey Satellite begins an all-sky survey, finding planets around the brightest nearby stars."},today:{title:"5,700+ Worlds",desc:"We've now confirmed thousands of exoplanets, with many more candidates awaiting verification. The search continues."}}},project:{title:"Project Evolution",author_message:"Greetings, Travelers! Guinetik here , your guide to the stars and beyond. I'm a software engineer and space enthusiast, and this project is a labor of love. It started as a way to learn Firebase, I thought, why not use NASA's exoplanet dataset to build a TripAdvisor for the stars, where future space travelers could leave reviews about the planets they visit? We began with TESS data and a simple catalog. Then I wanted to learn Three.js, so I gave this old project a complete makeover, adding 3D procedural planets, custom shaders, habitability scoring, and much more. Welcome aboard!",legacy:{name:"TESS Explorer (2022)",features:["227 confirmed TESS exoplanets","Basic planetary catalog","Firebase for reviews","Simple React + Vite setup"]},current:{name:"NASA Exoplanet Explorer (2025)",features:["6,000+ exoplanets from NASA archive","4,500+ host stars with classifications","3D WebGL + custom GLSL shaders","Procedural planet visualization","Habitability scoring algorithm","Firebase Auth + Firestore","Binary star system support","Bilingual (EN/PT)"]}},tech:{title:"Built With"},credits:{builtBy:"Built by",dataFrom:"Data from",year:"2024"}},habitability:{title:"Habitability Analysis",subtitle:"Where are the potentially habitable worlds?",loading:"Analyzing habitability data...",stats:{total:"Planets Analyzed",habitableZone:"In Habitable Zone",earthLike:"Earth-like Candidates",topScore:"Highest Score",avgScore:"Average Score",nearest:"Nearest Habitable"},galaxy:{title:"Habitable Worlds Galaxy Map",hint:"Drag to rotate  Scroll to zoom  Click planets for details",filters:{all:"All Planets",habitable:"Habitable Zone",earthLike:"Earth-like",top20:"Top 20"},legend:{top:"Top Candidates",habitableEarthLike:"Habitable + Earth-like",habitable:"Habitable Zone",other:"Other Planets"},distance:"{{distance}} light-years"},insights:{title:"Data Insights",scoreDistribution:{title:"Habitability Score Distribution",description:"Most planets score below 40, with only {{pct}}% scoring above 60"},temperature:{title:"Temperature Sweet Spot",description:"Planets in the 200-320K range have the highest habitability scores",zone:"Goldilocks Zone"},starType:{title:"Best Star Types",description:"G and K-type stars host the most promising habitable candidates"},discovery:{title:"Discovery Timeline",description:"Habitable zone discoveries accelerated after the Kepler mission",kepler:"Kepler Launch",tess:"TESS Launch"}},deepDive:{title:"Deep Dive Analysis",planetStarHeatmap:"Planet Types by Star Class",starClass:"Star Class",planetType:"Planet Type",featureCooccurrence:"Feature Co-occurrence (%)",featurePrevalence:"Feature Prevalence",habitabilityBreakdown:"Habitability Classification"},candidates:{title:"Top Habitability Candidates",description:"The most promising worlds for potential habitability",rank:"#{{rank}}",score:"Score: {{score}}",distance:"{{distance}} ly",viewDetails:"View Details"},methodology:{title:"Scoring Methodology",description:"Our habitability score (0-100) is calculated from four key factors:",temperature:"Temperature (40 pts): Ideal range 200-320K for liquid water",size:"Size (30 pts): Earth-like radius 0.8-1.5 R for rocky surface",starType:"Star Type (20 pts): G-type stars score highest (stable, long-lived)",insolation:"Insolation (10 pts): Energy flux 0.5-2.0 Earth's for moderate climate"},charts:{badges:{habitableZone:"Habitable Zone",earthLike:"Earth-like"},legend:{allDiscoveries:"All Discoveries",habitableZone:"Habitable Zone"},breakdown:{total:"Total",planets:"planets"},axes:{percentOfPlanets:"% of planets",avgHabitabilityScore:"Average Habitability Score",temperature:"Temperature (K)",habitabilityScore:"Habitability Score"},goldilocksZone:"Goldilocks Zone",score:"Score: {{score}}",lightYears:"light-years"}},vote:{title:"Vote for Earth 2.0",subtitle:"Which exoplanet will become humanity's next home? Cast your vote!",loading:"Loading candidates...",totalVotes:"{{count}} votes cast",yourPick:"Your pick: {{planet}}",lightYears:"ly",votes:"vote",votes_plural:"votes",voteButton:"Vote",voted:"Voted ",yourChoice:"Your Choice"}},FF={loading:"Loading...",error:"An error occurred",notFound:"Page not found"},VF={travelTime:{lightYearsAway:"light-years away",reachableAt:"Reachable at {{speed}} or faster",reachableInLifetime:" Reachable in your lifetime",withinLifetime:"Within your lifetime",lifetimes:"{{count}} lifetime",lifetimes_plural:"{{count}} lifetimes",unknownDistance:"Distance unknown",replayRace:"Replay Race",speeds:{walking:"Walking",car:"Car",jet:"Commercial Jet",voyager:"Voyager 1",newHorizons:"New Horizons",parkerProbe:"Parker Solar Probe",onePercentC:"1% Light Speed",tenPercentC:"10% Light Speed",lightSpeed:"Light Speed"}}},BF={nav:kF,pages:UF,common:FF,components:VF},zF={home:"Incio",stars:"Estrelas",planets:"Planetas",habitability:"Habitabilidade",vote:"Votar",apod:"Foto do Dia",about:"Sobre"},HF={home:{title:"Incio",infoCard:{title:"Bem-vindo ao Cosmos",description:"Voc est vendo o cu noturno da Terra  mas essas no so estrelas comuns. Cada ponto de luz representa uma estrela hospedeira de exoplanetas confirmada pelo arquivo da NASA.",stats:"Mais de {{starCount}} sistemas estelares abrigando {{planetCount}}+ mundos confirmados",hint:"Clique em qualquer estrela para explorar seu sistema planetrio",dismiss:"Entendi"}},stars:{title:"Estrelas",loading:"Carregando estrelas...",errorTitle:"Erro ao Carregar Estrelas",searchPlaceholder:"Buscar estrelas por nome...",filters:{starClass:"Classe Estelar:",systemType:"Tipo de Sistema:",allSystems:"Todos",binarySystems:"Binrio ",singleSystems:"nico ",sortBy:"Ordenar por:",clearFilters:"Limpar Filtros"},sort:{name:"Nome",distance:"Distncia",planets:"Nmero de Planetas",temperature:"Temperatura"},results:{showing:"Mostrando {{start}}{{end}} de {{filtered}} estrela",showing_plural:"Mostrando {{start}}{{end}} de {{filtered}} estrelas",total:"({{total}} no total)",noResults:"Nenhuma estrela corresponde aos seus filtros. Tente ajustar sua busca."},pagination:{previous:" Anterior",next:"Prximo ",pageOf:"Pgina {{current}} de {{total}}"}},starCard:{properties:{temperature:"Temperatura",radius:"Raio",mass:"Massa",distance:"Distncia",planets:"Planetas",vMagnitude:"Magnitude V"},viewSystem:"Ver sistema ",binary:"Binrio"},star:{title:"Detalhes da Estrela",loading:"Carregando...",notFound:{title:"Estrela No Encontrada",message:'A estrela "{{starId}}" no foi encontrada.',returnToStarfield:" Voltar ao campo estelar"},backToStarfield:" Voltar ao Campo Estelar",showInfo:"Mostrar informaes da estrela",hideInfo:"Ocultar informaes da estrela",distance:"Distncia",planets:"Planetas",spectralType:"Tipo Espectral"},starSystem:{info:{type:"Tipo",temperature:"Temperatura",radius:"Raio",mass:"Massa",distance:"Distncia",age:"Idade",planet:"Planeta",planets:"Planetas",stars:"Estrelas",planetaryBodies:"Corpos Planetrios",star:"Estrela",primaryStar:"Estrela Primria",companionStar:"Estrela Companheira",binarySystem:"Sistema Binrio",circumbinary:"Circumbinrio",unknown:"Desconhecido"},hint:"Arraste para girar  Role para zoom  Passe o mouse nos planetas para informaes",showBodies:"Mostrar corpos planetrios",hideBodies:"Ocultar corpos planetrios",systemOverview:{button:"Viso do Sistema",starComparison:"Comparao Estelar",systemStats:"Estatsticas do Sistema",habitableCandidates:"Candidatos Habitveis",lightYears:"Anos-Luz",planetaryData:"Dados Planetrios",planetSizes:"Tamanhos dos Planetas",orbitalDistances:"Distncias Orbitais",skyPosition:"Posio no Cu",rightAscension:"Ascenso Reta",declination:"Declinao",galacticLat:"Latitude Galctica",galacticLon:"Longitude Galctica",discoveryInfo:"Informaes de Descoberta",firstDiscovery:"Primeira Descoberta",latestDiscovery:"ltima Descoberta",methods:"Mtodos de Descoberta",stellarProperties:"Propriedades Estelares",luminosity:"Luminosidade",surfaceGravity:"Gravidade Superficial",metallicity:"Metalicidade",rotationPeriod:"Perodo de Rotao",sun:"Sol",sunStats:"1.0 R  5,778 K",largerThanSun:"Esta estrela  {{times}}x maior que o Sol",smallerThanSun:"{{pct}}% menor que o Sol",similarToSun:"Tamanho semelhante ao do Sol",travelTime:{title:"Tempo de Viagem Interestelar",unreachable:"Inatingvel em termos humanos",lightYearsAway:"anos-luz de distncia",reachableAt:"Alcanvel em",orFaster:"ou mais rpido",withinLifetime:" Dentro da sua vida",lifetimes:"{{count}} vidas",replay:" Repetir Corrida",walking:"Andando",car:"Carro",jet:"Avio a Jato",voyager:"Voyager 1",newHorizons:"New Horizons",parkerProbe:"Sonda Parker Solar",onePercentC:"1% Veloc. da Luz",tenPercentC:"10% Veloc. da Luz",lightSpeed:"Velocidade da Luz",instant:"Instantneo",generationNote:"1 gerao = 25 anos",lifetimeNote:"1 vida = 80 anos"},starFeatures:{title:"Caractersticas Estelares Notveis",solarAnalog:"Anlogo Solar",solarAnalogDesc:"Mais similar ao nosso Sol em temperatura, massa e luminosidade",sunLike:"Estrela Tipo Solar",sunLikeDesc:"Classe espectral F, G ou K  estvel e longeva",redDwarf:"An Vermelha",redDwarfDesc:"Estrela classe M  o tipo mais comum na galxia",youngSystem:"Sistema Jovem",youngSystemDesc:"Menos de 1 bilho de anos  ainda na juventude csmica",matureSystem:"Sistema Maduro",matureSystemDesc:"1-8 bilhes de anos  idade similar ao nosso sistema solar",ancientSystem:"Sistema Antigo",ancientSystemDesc:"Mais de 10 bilhes de anos  mais velho que a maioria das estrelas",metalRich:"Estrela Rica em Metais",metalRichDesc:"Alto teor de elementos pesados  favorvel para formao planetria",metalPoor:"Estrela Pobre em Metais",metalPoorDesc:"Baixa metalicidade  formada de gs primordial",binarySystem:"Sistema Estelar Binrio",binarySystemDesc:"Duas estrelas orbitando uma  outra",circumbinary:"Planetas Circumbinrios",circumbinaryDesc:"Planetas orbitando ambas as estrelas  como Tatooine"},habitability:{title:"Habitabilidade do Sistema",avgScore:"Mdia do Sistema",bestCandidate:"Melhor Candidato",score:"Pontuao",breakdown:"Anlise de Habitabilidade",topCandidates:"Melhores Candidatos",earthLike:"Tipo Terra",conservativeHz:"ZH Conservadora",optimisticHz:"ZH Otimista",potentiallyRocky:"Potenc. Rochoso",other:"Outros",habitableZone:"Na Zona Habitvel",noData:"Dados insuficientes para anlise de habitabilidade"},orbitalView:{title:"Arquitetura Orbital",habitableZone:"Zona Habitvel",scale:"Escala",au:"UA",innerHz:"ZH Interna",outerHz:"ZH Externa"},tempSizeChart:{title:"Temperatura vs Tamanho",xAxis:"Temperatura de Equilbrio (K)",yAxis:"Raio do Planeta (raios terrestres)",tooHot:"Muito Quente",habitable:"Habitvel",tooCold:"Muito Frio",earth:"Terra"}}},planets:{title:"Planetas",loading:"Carregando planetas...",errorTitle:"Erro ao Carregar Planetas",searchPlaceholder:"Buscar planetas por nome ou estrela hospedeira...",filters:{planetType:"Tipo de Planeta:",starClass:"Classe Estelar:",discoveryMethod:"Mtodo de Descoberta:",sortBy:"Ordenar por:",discoveryMethods:{all:"Todos os Mtodos",transit:"Apenas Trnsito",rv:"Apenas Velocidade Radial",both:"Ambos (RV + Trnsito)"},habitableOnly:"Apenas Zona Habitvel",earthLikeOnly:"Apenas Semelhantes  Terra",eccentricOnly:"rbita Excntrica",circumbinaryOnly:"Sistema Circumbinrio",clearFilters:"Limpar Filtros"},sort:{name:"Nome",distance:"Distncia",mass:"Massa",radius:"Raio",discoveryYear:"Data de Descoberta",habitability:"Pontuao de Habitabilidade"},results:{showing:"Mostrando {{start}}{{end}} de {{filtered}} planeta",showing_plural:"Mostrando {{start}}{{end}} de {{filtered}} planetas",total:"({{total}} no total)",noResults:"Nenhum planeta corresponde aos seus filtros. Tente ajustar sua busca."},pagination:{previous:" Anterior",next:"Prximo ",pageOf:"Pgina {{current}} de {{total}}"}},planet:{title:"Detalhes do Planeta",loading:"Carregando dados do planeta...",notFound:{title:"Planeta No Encontrado",message:"No foi possvel encontrar o planeta: {{planetId}}",browseAll:" Ver todos os planetas"},back:" Voltar",exoplanet:"Exoplaneta",viewSystem:"Ver Sistema {{hostname}} ",viewStats:"Ver estatsticas do planeta",sections:{earthComparison:"Comparado  Terra",habitability:"Pontuao de Habitabilidade",temperature:"Zona de Temperatura",orbitalPosition:"Posio Orbital",radialVelocity:"Anlise de Velocidade Radial",transitDetection:"Deteco por Trnsito",travelTime:"Tempo de Viagem"},comparison:{earth:"Terra",radius:"Raio",mass:"Massa",density:"Densidade",gravity:"Gravidade Superficial",temperature:"Temperatura",largerThanEarth:"{{times}} maior que a Terra",smallerThanEarth:"{{pct}}% menor que a Terra",similarToEarth:"Tamanho similar  Terra",timesLarger:"{{times}} maior",timesSmaller:"{{times}} menor",similar:"Similar"},habitability:{breakdown:"Detalhamento da Pontuao",temperature:"Temperatura",size:"Tamanho",starType:"Tipo de Estrela",insolation:"Insolao",inHabitableZone:"Na Zona Habitvel",earthLikeSize:"Tamanho Tipo Terra",potentiallyRocky:"Potencialmente Rochoso",topCandidate:"Top Candidato",tiers:{excellent:"Habitabilidade Excelente",good:"Boa Habitabilidade",moderate:"Habitabilidade Moderada",low:"Baixa Habitabilidade",minimal:"Habitabilidade Mnima"}},temperature:{title:"Zona de Temperatura",unknown:"Temperatura Desconhecida",habitableZone:"Zona Habitvel (200-320K)",frozen:"Congelado",habitable:"Habitvel",scorching:"Escaldante",zones:{unknown:"Desconhecido",frozen:"Congelado",cold:"Frio",cool:"Fresco",habitable:"Habitvel",warm:"Morno",hot:"Quente",scorching:"Escaldante"},descriptions:{unknown:"Dados de temperatura no disponveis para este planeta.",frozen:"Condies criognicas - muito mais frio que qualquer ambiente natural na Terra.",cold:"Extremamente frio - gua estaria permanentemente congelada na superfcie.",cool:"Temperaturas frias - gua lquida improvvel sem atmosfera espessa.",habitable:"Dentro da faixa de temperatura onde gua lquida pode existir na superfcie.",warm:"Muito quente para gua lquida sem condies especiais.",hot:"Muito quente - temperaturas da superfcie seriam extremamente hostis  vida.",scorching:"Calor extremo - metais e rochas podem vaporizar na atmosfera."}},orbital:{title:"Posio no Sistema",noData:"Dados orbitais no disponveis",habitableZone:"Zona Habitvel",distance:"Distncia da Estrela",period:"Perodo Orbital",eccentricity:"Excentricidade"},rv:{title:"Deteco por Velocidade Radial",intro:"O mtodo de velocidade radial revolucionou a astrobiologia ao permitir detectar planetas orbitando estrelas distantesincluindo mundos potencialmente habitveis que nunca poderamos ver diretamente. Esta visualizao usa medies reais da estrela hospedeira deste planeta para simular a sutil oscilao estelar que revelou sua existncia. Observe como as visualizaes sincronizadas mostram como os astrnomos decodificam pequenos desvios Doppler na luz das estrelas para descobrir novos mundos pela galxia.",curveTitle:"Velocidade Radial ao Longo do Tempo",xAxisLabel:"Tempo (dias)",yAxisLabel:"Velocidade Radial (m/s)",comparisonTitle:"Comparao de Amplitude RV",comparisonDescription:"A amplitude RV (semi-amplitude K) indica quanto a estrela oscila devido a cada planeta. Amplitudes maiores significam que o planeta tem uma atrao gravitacional mais forte sobre sua estrelaseja porque  mais massivo, orbita mais perto, ou ambos. Planetas com amplitudes abaixo de ~1 m/s so extremamente difceis de detectar com a tecnologia atual. Este grfico compara todos os planetas neste sistema para mostrar quais criam a oscilao estelar mais detectvel.",detectionThreshold:"Limite de Deteco Moderno (~1 m/s)",dataDisplay:{currentRV:"RV Atual",amplitude:"Amplitude (K)",baseline:"Linha de Base"},visualizations:{orbitalMotion:"Movimento Orbital",spectralDoppler:"Desvio Doppler Espectral"},noData:{title:"Dados de Velocidade Radial No Disponveis",message:"Este planeta foi descoberto usando {{method}}, que no fornece medies RV.",example:"Para comparao, no nosso Sistema Solar:",jupiterExample:"Jpiter faz o Sol oscilar a ~12 m/s",earthExample:"A Terra causa ~0,09 m/s (indetectvel com a tecnologia atual)",detectionLimit:"Limite de deteco para espectrgrafos modernos: ~1 m/s"},explanation:{dopplerTitle:"O que  o Efeito Doppler?",dopplerContent:"Assim como uma sirene de ambulncia soa mais aguda quando se aproxima e mais grave quando se afasta, a luz de uma estrela muda para comprimentos de onda mais azuis quando se move em nossa direo e mais vermelhos quando se afasta. Os astrnomos medem essas pequenas mudanas de comprimento de onda nas linhas espectrais da estrela para detectar seu movimento.",dopplerImageCaption:"Deteco por velocidade radial:  medida que um planeta orbita, ele faz sua estrela hospedeira oscilar. Este movimento produz um desvio Doppler no espectro da estrela que podemos medir da Terra.",wobbleTitle:"Como Funciona a Oscilao Estelar?",wobbleContent:"Planetas e suas estrelas hospedeiras orbitam em torno de um centro de massa comum (baricentro).  medida que um planeta orbita, ele puxa a estrela, fazendo com que a estrela 'oscile' para frente e para trs. Planetas maiores ou aqueles mais prximos de suas estrelas causam oscilaes mais perceptveis. Por exemplo, Jpiter faz o nosso Sol oscilar a cerca de 12 m/s, enquanto o efeito da Terra  apenas 0,09 m/spequeno demais para detectar com a tecnologia atual.",discoveryTitle:"A Descoberta de 51 Pegasi (1995)",discoveryContent:"51 Pegasi b foi o primeiro exoplaneta descoberto em torno de uma estrela semelhante ao Sol usando o mtodo de velocidade radial. Sua amplitude RV de ~50 m/s e perodo orbital de 4,2 dias chocou os astrnomos, revelando um planeta da massa de Jpiter orbitando mais perto de sua estrela do que Mercrio est do nosso Sol. Esta descoberta introduziu a classe de exoplanetas 'Jpiter Quente' e revolucionou nossa compreenso dos sistemas planetrios."},technical:{title:"Detalhes Tcnicos",amplitude:"Amplitude RV",period:"Perodo Orbital",baseline:"Velocidade Basal",eccentricity:"Excentricidade",stellarRotation:"Rotao Estelar",stellarRotationNote:"A rotao estelar adiciona rudo s medies RV"}},transit:{title:"Deteco por Trnsito",intro:"O mtodo de trnsito  a tcnica de deteco de exoplanetas mais bem-sucedida, responsvel por descobrir milhares de exoplanetas, incluindo mundos do tamanho da Terra. Quando um planeta passa em frente da sua estrela do nosso ponto de vista, bloqueia uma pequena frao da luz da estrela. Medindo essas quedas peridicas no brilho, os astrnomos podem determinar o tamanho do planeta, seu perodo orbital e a composio atmosfrica.",curveTitle:"Curva de Luz do Trnsito",xAxisLabel:"Fase Orbital",yAxisLabel:"Fluxo Relativo",comparisonTitle:"Comparao de Profundidade de Trnsito",comparisonDescription:"A profundidade do trnsito revela diretamente o raio do planeta em relao  sua estrela. Trnsitos mais profundos significam planetas maiores. Este grfico compara todos os planetas em trnsito neste sistema.",dataDisplay:{currentFlux:"Fluxo Atual",transitDepth:"Profundidade do Trnsito",planetRadius:"Raio do Planeta",phase:"Fase"},visualizations:{orbitalGeometry:"Geometria Orbital",topView:"Vista de Cima (Plano Orbital)",sideView:"Vista Lateral (Da Terra)",whatWeLearn:"O que Aprendemos com Trnsitos"},noData:{title:"Nenhum Dado de Trnsito Disponvel",message:"Este planeta foi descoberto usando {{method}}, que no fornece medies de trnsito.",example:"Para comparao, de um ponto de vista distante:",jupiterExample:"Jpiter em trnsito do Sol: profundidade de 0,01%",earthExample:"Terra em trnsito do Sol: profundidade de 0,008%",detectionLimit:"Limite de deteco: ~0,001% com Kepler/TESS"},explanation:{geometryTitle:"Por que a Geometria Importa?",geometryContent:"A deteco por trnsito requer um alinhamento orbital preciso. A rbita do planeta deve estar quase perpendicular do ponto de vista da Terra. Apenas cerca de 0,5-1% dos sistemas planetrios orientados aleatoriamente estaro em trnsito como visto da Terra.",depthTitle:"O que a Profundidade do Trnsito nos Diz?",depthContent:"A profundidade do trnsito revela diretamente o tamanho do planeta.  proporcional a (raio do planeta / raio da estrela). Um planeta do tamanho de Jpiter bloqueia ~1% da luz, enquanto a Terra bloqueia apenas ~0,008%.",timingTitle:"Variaes de Tempo de Trnsito",timingContent:"Medindo trnsitos repetidamente, os astrnomos podem detectar puxes gravitacionais de outros planetas. Essas pequenas variaes de tempo revelam planetas adicionais que podem no estar em trnsito por si s."},legend:{duringTransit:"DURANTE O TRNSITO:",duringTransitItem1:"O planeta passa em frente da estrela",duringTransitItem2:"O fluxo cai conforme a luz  bloqueada",duringTransitItem3:"A profundidade revela o tamanho do planeta",outsideTransit:"FORA DO TRNSITO:",outsideTransitItem1:"Toda a luz da estrela nos alcana",outsideTransitItem2:"O fluxo retorna  linha de base (1,0)",whatWeLearn:"O QUE APRENDEMOS:",whatWeLearnItem1:"Raio do planeta pela profundidade",whatWeLearnItem2:"Perodo orbital pelo tempo",whatWeLearnItem3:"Atmosfera pelo espectro"},technical:{depth:"Profundidade do Trnsito",duration:"Durao do Trnsito",period:"Perodo Orbital",radiusRatio:"Razo de Raio (Rp/R)",semiMajorRatio:"Razo a/R",impactParameter:"Parmetro de Impacto",planetRadius:"Raio do Planeta"}},siblings:{title:"Outros Planetas em {{system}}",count:"{{count}} outro planeta neste sistema",count_plural:"{{count}} outros planetas neste sistema",earthLikeHabitable:"Tipo Terra, Zona Habitvel",habitable:"Zona Habitvel",hotJupiter:"Jpiter Quente",frozen:"Mundo Congelado",exoplanet:"Exoplaneta"},visualization:{title:"Como Visualizamos Este Planeta",intro:"Nossas visualizaes de planetas so geradas proceduralmente usando dados cientficos reais do Arquivo de Exoplanetas da NASA. Veja como diferentes propriedades influenciam o que voc v:",density:{title:"Densidade",description:'Determina a textura e composio da superfcie. Mundos de alta densidade parecem mais acidentados com crateras de impacto retidas (gravidade forte mantm caractersticas da superfcie). Planetas "inchados" de baixa densidade tm aparncias mais suaves e ricas em volteis.'},insolation:{title:"Fluxo de Insolao",description:"A energia recebida da estrela hospedeira. Alta insolao cria superfcies vulcnicas, brilho de lava e atmosferas ativas. Baixa insolao produz cobertura de gelo e paisagens congeladas."},starTemp:{title:"Temperatura Estelar",description:"Afeta a cor da iluminao. Planetas ao redor de ans vermelhas tm um tom laranja quente, enquanto aqueles orbitando estrelas azuis quentes parecem mais frios e azulados."},planetType:{title:"Tipo de Planeta",description:"Determina o shader base: Gigantes Gasosos mostram atmosferas em faixas com tempestades, Gigantes de Gelo tm atmosferas suaves de metano azul-esverdeado, e planetas Rochosos exibem terreno, crateras e possveis atmosferas."},disclaimer:"Nota: Estas visualizaes so interpretaes artsticas baseadas em dados cientficos, no fotografias reais. A semente nica de cada planeta garante aparncia consistente entre sesses."},info:{sections:{properties:"Propriedades do Planeta",hostStar:"Estrela Hospedeira",discovery:"Descoberta",reviews:"Avaliaes"},earthComparison:" = passe o mouse para comparao com a Terra",flags:{habitableZone:"Na Zona Habitvel",earthLike:"Tipo Terrestre",topCandidate:"Top Candidato Habitvel",potentiallyRocky:"Potencialmente Rochoso",earthLikeInsolation:"Insolao Tipo Terra",hotJupiter:"Jpiter Quente",hotNeptune:"Netuno Quente",ultraHot:"Ultra Quente (>2000K)",frozenWorld:"Mundo Congelado",ultraDense:"Ultra Denso",puffy:"Inflado (Baixa Dens.)",superMassive:"Super Massivo",lightweight:"Leve (<0.5 M)",ultraShortPeriod:"Perodo Ultra-Curto (<1 dia)",longPeriod:"Perodo Longo (>1000 dias)",eccentricOrbit:"rbita Excntrica",circularOrbit:"rbita Circular",tidallyLocked:"Provvel Travamento de Mars",circumbinary:"Circumbinrio (Tatooine)",multiPlanet:"Sistema Multi-Planetrio",richSystem:"Sistema Rico (4+ planetas)",multiStar:"Sistema Multi-Estelar",veryNearby:"Muito Prximo (<65 al)",nearby:"Prximo (<163 al)",solarAnalog:"Estrela Anloga ao Sol",redDwarfHost:"Estrela An Vermelha",youngSystem:"Sistema Jovem (<1 Ga)",ancientSystem:"Sistema Antigo (>10 Ga)",metalRich:"Estrela Rica em Metais",metalPoor:"Estrela Pobre em Metais",transiting:"Em Trnsito",hasRvData:"Dados de VR",hasTtv:"Possui TTV",controversial:"Deteco Controversa"},flagDescriptions:{habitableZone:"Orbita dentro da zona onde gua lquida pode existir na superfcie, nem muito quente nem muito frio.",earthLike:"Tamanho e composio semelhantes  Terra, tornando-o um potencial anlogo ao nosso planeta natal.",topCandidate:"Classificado entre os mundos mais promissores para potencial habitabilidade com base em mltiplos fatores.",potentiallyRocky:"Densidade sugere uma composio rochosa semelhante  Terra, Marte ou Vnus.",earthLikeInsolation:"Recebe energia estelar semelhante ao que a Terra recebe do Sol.",hotJupiter:"Gigante gasoso orbitando extremamente perto de sua estrela, com temperaturas escaldantes.",hotNeptune:"Planeta do tamanho de Netuno em uma rbita prxima com atmosfera aquecida.",ultraHot:"Temperaturas da superfcie excedem 2000K, quente o suficiente para vaporizar metais.",frozenWorld:"Temperaturas extremamente frias, provavelmente coberto de gelos de vrios compostos.",ultraDense:"Densidade excepcionalmente alta, possivelmente indicando ncleo rico em metais ou composio extica.",puffy:"Densidade anormalmente baixa para seu tamanho, com atmosfera estendida e inflada.",superMassive:"Massa extremamente alta, potencialmente na fronteira entre planeta e an marrom.",lightweight:"Menos de metade da massa da Terra, possivelmente com gravidade fraca e atmosfera fina.",ultraShortPeriod:"Completa uma rbita em menos de um dia, experimentando intensa radiao estelar.",longPeriod:"Leva mais de 1000 dias para orbitar, experimentando variaes sazonais extremas.",eccentricOrbit:"rbita altamente elptica, causando variaes drsticas de temperatura ao longo do ano.",circularOrbit:"rbita quase perfeitamente circular, fornecendo condies climticas estveis.",tidallyLocked:"Um lado sempre voltado para a estrela, criando lados permanentes de dia e noite.",circumbinary:"Orbita duas estrelas como o planeta ficcional Tatooine de Star Wars.",multiPlanet:"Parte de um sistema com mltiplos planetas confirmados.",richSystem:"Em um sistema com 4 ou mais planetas conhecidos, indicando dinmica complexa.",multiStar:"Sistema hospedeiro contm mltiplas estrelas, criando padres complexos de iluminao.",veryNearby:"Dentro de 65 anos-luz da Terra, tornando-o um alvo potencial para estudo futuro.",nearby:"Dentro de 163 anos-luz, relativamente prximo em termos astronmicos.",solarAnalog:"Orbita uma estrela semelhante ao nosso Sol em temperatura, tamanho e idade.",redDwarfHost:"Orbita uma estrela an vermelha, o tipo mais comum de estrela em nossa galxia.",youngSystem:"Sistema tem menos de 1 bilho de anos, potencialmente ainda evoluindo.",ancientSystem:"Sistema tem mais de 10 bilhes de anos, mais antigo que nosso sistema solar.",metalRich:"Estrela hospedeira rica em elementos pesados, o que pode indicar formao planetria rica.",metalPoor:"Estrela hospedeira pobre em elementos pesados, formada no incio da histria csmica.",transiting:"Passa na frente de sua estrela visto da Terra, permitindo estudo atmosfrico.",hasRvData:"Detectado usando medies de velocidade radial da oscilao estelar.",hasTtv:"Mostra variaes no tempo de trnsito, indicando influncia gravitacional de outros planetas.",controversial:"Deteco ou parmetros so debatidos na comunidade cientfica."},reviews:{empty:"Nenhuma avaliao ainda. Seja o primeiro a compartilhar sua experincia!",writeReview:"Escrever Avaliao",form:{title:"Compartilhe Sua Experincia",ratingLabel:"Como voc avaliaria este planeta?",titleLabel:"Ttulo da Avaliao",titlePlaceholder:"D um ttulo  sua avaliao",textLabel:"Sua Avaliao",textPlaceholder:"Como foi sua experincia neste mundo distante?",submit:"Publicar Avaliao",errorTitleMin:"O ttulo deve ter pelo menos 3 caracteres",errorTextMin:"A avaliao deve ter pelo menos 10 caracteres"},userPrompt:{title:"Antes de continuar...",subtitle:"Diga-nos seu nome, viajante espacial",placeholder:"Digite seu nome",continue:"Continuar como {{name}}",errorMinLength:"O nome deve ter pelo menos 2 caracteres",errorMaxLength:"O nome deve ter no mximo 30 caracteres"}},unknown:"Desconhecido",fields:{hostStar:"Estrela Hospedeira",planetType:"Tipo de Planeta",radius:"Raio",mass:"Massa",density:"Densidade",insolationFlux:"Fluxo de Insolao",eqTemperature:"Temp. de Equilbrio",orbitalPeriod:"Perodo Orbital",semiMajorAxis:"Semieixo Maior",orbitalEccentricity:"Excentricidade Orbital",starTemperature:"Temperatura Estelar",starMetallicity:"Metalicidade Estelar",starAge:"Idade da Estrela",discoveryYear:"Ano de Descoberta",discoveryMethod:"Mtodo de Descoberta",facility:"Instalao"},earthRef:{earthRadius:"Raio da Terra",earthMass:"Massa da Terra",earthDensity:"Densidade da Terra",earthEqTemp:"Temp. de equilbrio da Terra",earthInsolation:"Insolao da Terra",earthOrbitalPeriod:"Perodo orbital da Terra",earthSemiMajorAxis:"Semieixo maior da Terra",earthOrbitalEccentricity:"Excentricidade orbital da Terra",sunTemperature:"Temperatura do Sol",sunMetallicity:"Metalicidade do Sol",sunAge:"Idade do Sol"}}},planetCard:{properties:{radius:"Raio",mass:"Massa",period:"Perodo",temp:"Temp",distance:"Distncia",discovered:"Descoberto"},flags:{habitableZone:"Zona Habitvel",earthLike:"Tipo Terrestre",circumbinary:"Circumbinrio",topCandidate:"Top Candidato",potentiallyRocky:"Potenc. Rochoso",hotJupiter:"Jpiter Quente",hotNeptune:"Netuno Quente",ultraHot:"Ultra Quente",frozenWorld:"Mundo Congelado",ultraDense:"Ultra Denso",puffy:"Inflado",ultraShortPeriod:"Perodo Ultra-Curto",eccentricOrbit:"rbita Excntrica",tidallyLocked:"Travado Mars",richSystem:"Sistema Rico",veryNearby:"Muito Prximo",solarAnalog:"Anlogo Solar",redDwarfHost:"An Vermelha",controversial:"Controverso",hasRvData:"Dados RV"},viewDetails:"Ver detalhes "},apod:{title:"Foto Astronmica do Dia",loading:"Carregando a maravilha csmica de hoje...",yesterday:"Ontem",tomorrow:"Amanh",error:"No foi possvel carregar a imagem",videoNotSupported:"Seu navegador no suporta a tag de vdeo.",viewFullSize:"Clique para ver em tamanho real"},about:{title:"Sobre",subtitle:"Explorando mais de 6.000 mundos confirmados alm do nosso sistema solar",exploration:{title:"A Histria da Explorao de Exoplanetas",timeline:{1992:{title:"Primeiros Exoplanetas",desc:"Wolszczan & Frail descobrem os primeiros exoplanetas confirmados orbitando um pulsar, provando que planetas existem alm do nosso sistema solar."},1995:{title:"51 Pegasi b",desc:"Mayor & Queloz detectam o primeiro exoplaneta ao redor de uma estrela similar ao Sol, ganhando o Prmio Nobel de Fsica de 2019."},2009:{title:"Lanamento do Kepler",desc:"O telescpio espacial Kepler da NASA inicia sua misso, eventualmente descobrindo mais de 2.700 exoplanetas confirmados."},2016:{title:"Proxima Centauri b",desc:"Descoberta de um planeta do tamanho da Terra na zona habitvel de nossa vizinha estelar mais prxima, a apenas 4,2 anos-luz de distncia."},2018:{title:"Misso TESS",desc:"O Transiting Exoplanet Survey Satellite inicia uma varredura de todo o cu, encontrando planetas ao redor das estrelas mais brilhantes prximas."},today:{title:"5.700+ Mundos",desc:"J confirmamos milhares de exoplanetas, com muitos mais candidatos aguardando verificao. A busca continua."}}},project:{title:"Evoluo do Projeto",author_message:"Saudaes, Viajantes! Guinetik aqui , seu guia para as estrelas e alm. Sou engenheiro de software e entusiasta do espao, e este projeto  um trabalho feito com carinho. Tudo comeou como uma forma de aprender Firebase  pensei, por que no usar o banco de dados de exoplanetas da NASA para criar um TripAdvisor das estrelas, onde futuros viajantes espaciais poderiam deixar avaliaes sobre os planetas que visitam? Comeamos com dados do TESS e um catlogo simples. Depois quis aprender Three.js, ento dei uma repaginada completa neste projeto antigo  adicionando planetas 3D procedurais, shaders customizados, pontuao de habitabilidade e muito mais. Bem-vindos a bordo!",legacy:{name:"TESS Explorer (2022)",features:["227 exoplanetas TESS confirmados","Catlogo planetrio bsico","Firebase para avaliaes","Setup simples React + Vite"]},current:{name:"NASA Exoplanet Explorer (2025)",features:["6.000+ exoplanetas do arquivo NASA","4.500+ estrelas hospedeiras classificadas","3D WebGL + shaders GLSL customizados","Visualizao procedural de planetas","Algoritmo de pontuao de habitabilidade","Firebase Auth + Firestore","Suporte a sistemas estelares binrios","Bilngue (EN/PT)"]}},tech:{title:"Construdo Com"},credits:{builtBy:"Desenvolvido por",dataFrom:"Dados de",year:"2024"}},habitability:{title:"Anlise de Habitabilidade",subtitle:"Onde esto os mundos potencialmente habitveis?",loading:"Analisando dados de habitabilidade...",stats:{total:"Planetas Analisados",habitableZone:"Na Zona Habitvel",earthLike:"Candidatos Tipo Terra",topScore:"Maior Pontuao",avgScore:"Pontuao Mdia",nearest:"Habitvel Mais Prximo"},galaxy:{title:"Mapa Galctico de Mundos Habitveis",hint:"Arraste para girar  Role para zoom  Clique nos planetas para detalhes",filters:{all:"Todos os Planetas",habitable:"Zona Habitvel",earthLike:"Tipo Terra",top20:"Top 20"},legend:{top:"Melhores Candidatos",habitableEarthLike:"Habitvel + Tipo Terra",habitable:"Zona Habitvel",other:"Outros Planetas"},distance:"{{distance}} anos-luz"},insights:{title:"Insights dos Dados",scoreDistribution:{title:"Distribuio de Pontuao de Habitabilidade",description:"A maioria dos planetas pontua abaixo de 40, com apenas {{pct}}% pontuando acima de 60"},temperature:{title:"Faixa Ideal de Temperatura",description:"Planetas na faixa de 200-320K tm as maiores pontuaes de habitabilidade",zone:"Zona Cachinhos Dourados"},starType:{title:"Melhores Tipos de Estrela",description:"Estrelas tipo G e K hospedam os candidatos habitveis mais promissores"},discovery:{title:"Linha do Tempo de Descobertas",description:"Descobertas na zona habitvel aceleraram aps a misso Kepler",kepler:"Lanamento Kepler",tess:"Lanamento TESS"}},deepDive:{title:"Anlise Aprofundada",planetStarHeatmap:"Tipos de Planetas por Classe Estelar",starClass:"Classe Estelar",planetType:"Tipo de Planeta",featureCooccurrence:"Co-ocorrncia de Caractersticas (%)",featurePrevalence:"Prevalncia de Caractersticas",habitabilityBreakdown:"Classificao de Habitabilidade"},candidates:{title:"Principais Candidatos  Habitabilidade",description:"Os mundos mais promissores para potencial habitabilidade",rank:"#{{rank}}",score:"Pontuao: {{score}}",distance:"{{distance}} al",viewDetails:"Ver Detalhes"},methodology:{title:"Metodologia de Pontuao",description:"Nossa pontuao de habitabilidade (0-100)  calculada a partir de quatro fatores principais:",temperature:"Temperatura (40 pts): Faixa ideal 200-320K para gua lquida",size:"Tamanho (30 pts): Raio tipo Terra 0.8-1.5 R para superfcie rochosa",starType:"Tipo de Estrela (20 pts): Estrelas tipo G pontuam mais (estveis, longevas)",insolation:"Insolao (10 pts): Fluxo de energia 0.5-2.0 da Terra para clima moderado"},charts:{badges:{habitableZone:"Zona Habitvel",earthLike:"Tipo Terra"},legend:{allDiscoveries:"Todas as Descobertas",habitableZone:"Zona Habitvel"},breakdown:{total:"Total",planets:"planetas"},axes:{percentOfPlanets:"% dos planetas",avgHabitabilityScore:"Pontuao Mdia de Habitabilidade",temperature:"Temperatura (K)",habitabilityScore:"Pontuao de Habitabilidade"},goldilocksZone:"Zona Cachinhos Dourados",score:"Pontuao: {{score}}",lightYears:"anos-luz"}},vote:{title:"Vote na Terra 2.0",subtitle:"Qual exoplaneta ser o prximo lar da humanidade? Vote agora!",loading:"Carregando candidatos...",totalVotes:"{{count}} votos registrados",yourPick:"Sua escolha: {{planet}}",lightYears:"al",votes:"voto",votes_plural:"votos",voteButton:"Votar",voted:"Votado ",yourChoice:"Sua Escolha"}},GF={loading:"Carregando...",error:"Ocorreu um erro",notFound:"Pgina no encontrada"},WF={travelTime:{lightYearsAway:"anos-luz de distncia",reachableAt:"Alcanvel a {{speed}} ou mais rpido",reachableInLifetime:" Alcanvel em sua vida",withinLifetime:"Dentro da sua vida",lifetimes:"{{count}} vida",lifetimes_plural:"{{count}} vidas",unknownDistance:"Distncia desconhecida",replayRace:"Repetir Corrida",speeds:{walking:"Caminhando",car:"Carro",jet:"Avio Comercial",voyager:"Voyager 1",newHorizons:"New Horizons",parkerProbe:"Sonda Parker Solar",onePercentC:"1% Veloc. da Luz",tenPercentC:"10% Veloc. da Luz",lightSpeed:"Velocidade da Luz"}}},$F={nav:zF,pages:HF,common:GF,components:WF},qF={en:{translation:BF},pt:{translation:$F}},jF=()=>{const n=localStorage.getItem("language");if(n)return n;const e=navigator.language.split("-")[0];return e==="pt"||e==="en"?e:"en"};di.use(PF).init({resources:qF,lng:jF(),fallbackLng:"en",interpolation:{escapeValue:!1}});const XF="modulepreload",KF=function(n,e){return new URL(n,e).href},WE={},Ks=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(t.map(c=>{if(c=KF(c,i),c in WE)return;WE[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(!!i)for(let g=a.length-1;g>=0;g--){const _=a[g];if(_.href===c&&(!u||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${h}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":XF,u||(p.as="script"),p.crossOrigin="",p.href=c,l&&p.setAttribute("nonce",l),document.head.appendChild(p),u)return new Promise((g,_)=>{p.addEventListener("load",g),p.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})},YF=te.lazy(()=>Ks(()=>import("./Home-CN5rAcvG.js"),__vite__mapDeps([0,1]),import.meta.url)),JF=te.lazy(()=>Ks(()=>import("./Stars-2mzUB61I.js"),[],import.meta.url)),ZF=te.lazy(()=>Ks(()=>import("./Star--aomLzGS.js"),__vite__mapDeps([2,1,3,4,5]),import.meta.url)),QF=te.lazy(()=>Ks(()=>import("./Planets-D4aPs_p4.js"),[],import.meta.url)),eV=te.lazy(()=>Ks(()=>import("./Planet-DhMVUK9t.js"),__vite__mapDeps([6,1,3,4,7,8,9]),import.meta.url)),tV=te.lazy(()=>Ks(()=>import("./Habitability-Z8PBx89T.js"),__vite__mapDeps([10,1,5,4,9]),import.meta.url)),nV=te.lazy(()=>Ks(()=>import("./Vote-C_SUivCz.js"),__vite__mapDeps([11,7,12,8]),import.meta.url)),iV=te.lazy(()=>Ks(()=>import("./Apod-DNF68BGz.js"),__vite__mapDeps([13,7,12]),import.meta.url)),rV=te.lazy(()=>Ks(()=>import("./About-C1xa4HWT.js"),[],import.meta.url)),qR=[{path:"/",element:YF,labelKey:"nav.home",showInNav:!0},{path:"/stars",element:JF,labelKey:"nav.stars",showInNav:!0},{path:"/stars/:starId",element:ZF,labelKey:"nav.stars",showInNav:!1},{path:"/planets",element:QF,labelKey:"nav.planets",showInNav:!0},{path:"/planets/:planetId",element:eV,labelKey:"nav.planets",showInNav:!1},{path:"/habitability",element:tV,labelKey:"nav.habitability",showInNav:!0},{path:"/vote",element:nV,labelKey:"nav.vote",showInNav:!0},{path:"/apod",element:iV,labelKey:"nav.apod",showInNav:!0},{path:"/about",element:rV,labelKey:"nav.about",showInNav:!0}],$E=qR.filter(n=>n.showInNav),sV=[{code:"en",label:"EN"},{code:"pt",label:"PT"}];function aV(){const{i18n:n}=h0(),e=t=>{n.changeLanguage(t),localStorage.setItem("language",t)};return je.jsx("div",{className:"lang-picker",children:sV.map(t=>je.jsx("button",{onClick:()=>e(t.code),className:n.language===t.code?"lang-button lang-button-active":"lang-button","aria-label":`Switch to ${t.label}`,children:t.label},t.code))})}function oV(){const{t:n}=h0(),[e,t]=te.useState(!1),i=()=>t(!e),r=()=>t(!1);return je.jsxs("nav",{className:"navbar",children:[je.jsxs("div",{className:"navbar-inner",children:[je.jsx(Qy,{to:"/",className:"navbar-brand",onClick:r,children:"Exoplanets"}),je.jsx("div",{className:"navbar-menu",children:$E.map(s=>je.jsx(Qy,{to:s.path,className:({isActive:a})=>a?"navbar-link navbar-link-active":"navbar-link",children:n(s.labelKey)},s.path))}),je.jsxs("div",{className:"navbar-actions",children:[je.jsx(aV,{}),je.jsx("button",{className:"mobile-menu-button",onClick:i,"aria-label":"Toggle menu","aria-expanded":e,children:e?je.jsx(cV,{}):je.jsx(lV,{})})]})]}),e&&je.jsx("div",{className:"mobile-menu",children:je.jsx("div",{className:"mobile-menu-inner",children:$E.map(s=>je.jsx(Qy,{to:s.path,className:({isActive:a})=>a?"mobile-menu-link navbar-link-active":"mobile-menu-link",onClick:r,children:n(s.labelKey)},s.path))})})]})}function lV(){return je.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[je.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),je.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),je.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}function cV(){return je.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[je.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),je.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function qE({message:n}){const{t:e}=h0();return je.jsx("div",{className:"spinner-container",children:je.jsxs("div",{className:"spinner-content",children:[je.jsx("div",{className:"spinner-orbit",children:je.jsx("div",{className:"spinner-planet"})}),je.jsx("p",{className:"spinner-text",children:n??e("common.loading")})]})})}function yv(n){return n?n.trim().toLowerCase().replace(/\s+/g,"-").replace(/--+/g,"-").replace(/^-+|-+$/g,""):""}const uV=()=>{};var jE={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},hV=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=n[t++],a=n[t++],o=n[t++],l=((r&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const s=n[t++],a=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|a&63)}}return e.join("")},XR={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){const s=n[r],a=r+1<n.length,o=a?n[r+1]:0,l=r+2<n.length,c=l?n[r+2]:0,u=s>>2,h=(s&3)<<4|o>>4;let d=(o&15)<<2|c>>6,p=c&63;l||(p=64,a||(d=64)),i.push(t[u],t[h],t[d],t[p])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(jR(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):hV(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){const s=t[n.charAt(r++)],o=r<n.length?t[n.charAt(r)]:0;++r;const c=r<n.length?t[n.charAt(r)]:64;++r;const h=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||o==null||c==null||h==null)throw new dV;const d=s<<2|o>>4;if(i.push(d),c!==64){const p=o<<4&240|c>>2;if(i.push(p),h!==64){const g=c<<6&192|h;i.push(g)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class dV extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const fV=function(n){const e=jR(n);return XR.encodeByteArray(e,!0)},Om=function(n){return fV(n).replace(/\./g,"")},KR=function(n){try{return XR.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pV(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mV=()=>pV().__FIREBASE_DEFAULTS__,gV=()=>{if(typeof process>"u"||typeof jE>"u")return;const n=jE.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},yV=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&KR(n[1]);return e&&JSON.parse(e)},d0=()=>{try{return uV()||mV()||gV()||yV()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},YR=n=>{var e,t;return(t=(e=d0())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},JR=n=>{const e=YR(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},ZR=()=>{var n;return(n=d0())==null?void 0:n.config},QR=n=>{var e;return(e=d0())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lo(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function tb(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eP(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Om(JSON.stringify(t)),Om(JSON.stringify(a)),""].join(".")}const vh={};function xV(){const n={prod:[],emulator:[]};for(const e of Object.keys(vh))vh[e]?n.emulator.push(e):n.prod.push(e);return n}function vV(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let XE=!1;function nb(n,e){if(typeof window>"u"||typeof document>"u"||!lo(window.location.host)||vh[n]===e||vh[n]||XE)return;vh[n]=e;function t(d){return`__firebase__banner__${d}`}const i="__firebase__banner",s=xV().prod.length>0;function a(){const d=document.getElementById(i);d&&d.remove()}function o(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function l(d,p){d.setAttribute("width","24"),d.setAttribute("id",p),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function c(){const d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{XE=!0,a()},d}function u(d,p){d.setAttribute("id",p),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function h(){const d=vV(i),p=t("text"),g=document.getElementById(p)||document.createElement("span"),_=t("learnmore"),y=document.getElementById(_)||document.createElement("a"),m=t("preprendIcon"),x=document.getElementById(m)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){const v=d.element;o(v),u(y,_);const T=c();l(x,m),v.append(x,g,y,T),document.body.appendChild(v)}s?(g.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hi(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function SV(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(hi())}function bV(){var e;const n=(e=d0())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function wV(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function TV(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function EV(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function AV(){const n=hi();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function MV(){return!bV()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function CV(){try{return typeof indexedDB=="object"}catch{return!1}}function IV(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)==null?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RV="FirebaseError";class us extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=RV,Object.setPrototypeOf(this,us.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Od.prototype.create)}}class Od{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],a=s?PV(s,i):"Error",o=`${this.serviceName}: ${a} (${r}).`;return new us(r,o,i)}}function PV(n,e){return n.replace(LV,(t,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const LV=/\{\$([^}]+)}/g;function DV(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function nl(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const r of t){if(!i.includes(r))return!1;const s=n[r],a=e[r];if(KE(s)&&KE(a)){if(!nl(s,a))return!1}else if(s!==a)return!1}for(const r of i)if(!t.includes(r))return!1;return!0}function KE(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kd(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function NV(n,e){const t=new OV(n,e);return t.subscribe.bind(t)}class OV{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");kV(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=n_),r.error===void 0&&(r.error=n_),r.complete===void 0&&(r.complete=n_);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function kV(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function n_(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(n){return n&&n._delegate?n._delegate:n}class qa{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UV{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new _V;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(VV(e))try{this.getOrInitializeService({instanceIdentifier:Lo})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=Lo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Lo){return this.instances.has(e)}getOptions(e=Lo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);i===o&&a.resolve(r)}return r}onInit(e,t){const i=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(i)??new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:FV(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Lo){return this.component?this.component.multipleInstances?e:Lo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function FV(n){return n===Lo?void 0:n}function VV(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BV{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new UV(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Mt||(Mt={}));const zV={debug:Mt.DEBUG,verbose:Mt.VERBOSE,info:Mt.INFO,warn:Mt.WARN,error:Mt.ERROR,silent:Mt.SILENT},HV=Mt.INFO,GV={[Mt.DEBUG]:"log",[Mt.VERBOSE]:"log",[Mt.INFO]:"info",[Mt.WARN]:"warn",[Mt.ERROR]:"error"},WV=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),r=GV[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ib{constructor(e){this.name=e,this._logLevel=HV,this._logHandler=WV,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Mt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?zV[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Mt.DEBUG,...e),this._logHandler(this,Mt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Mt.VERBOSE,...e),this._logHandler(this,Mt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Mt.INFO,...e),this._logHandler(this,Mt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Mt.WARN,...e),this._logHandler(this,Mt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Mt.ERROR,...e),this._logHandler(this,Mt.ERROR,...e)}}const $V=(n,e)=>e.some(t=>n instanceof t);let YE,JE;function qV(){return YE||(YE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function jV(){return JE||(JE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tP=new WeakMap,_v=new WeakMap,nP=new WeakMap,i_=new WeakMap,rb=new WeakMap;function XV(n){const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(Va(n.result)),r()},a=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&tP.set(t,n)}).catch(()=>{}),rb.set(e,n),e}function KV(n){if(_v.has(n))return;const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),r()},a=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});_v.set(n,e)}let xv={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return _v.get(n);if(e==="objectStoreNames")return n.objectStoreNames||nP.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Va(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function YV(n){xv=n(xv)}function JV(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(r_(this),e,...t);return nP.set(i,e.sort?e.sort():[e]),Va(i)}:jV().includes(n)?function(...e){return n.apply(r_(this),e),Va(tP.get(this))}:function(...e){return Va(n.apply(r_(this),e))}}function ZV(n){return typeof n=="function"?JV(n):(n instanceof IDBTransaction&&KV(n),$V(n,qV())?new Proxy(n,xv):n)}function Va(n){if(n instanceof IDBRequest)return XV(n);if(i_.has(n))return i_.get(n);const e=ZV(n);return e!==n&&(i_.set(n,e),rb.set(e,n)),e}const r_=n=>rb.get(n);function QV(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){const a=indexedDB.open(n,e),o=Va(a);return i&&a.addEventListener("upgradeneeded",l=>{i(Va(a.result),l.oldVersion,l.newVersion,Va(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{s&&l.addEventListener("close",()=>s()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const e4=["get","getKey","getAll","getAllKeys","count"],t4=["put","add","delete","clear"],s_=new Map;function ZE(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(s_.get(e))return s_.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,r=t4.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||e4.includes(t)))return;const s=async function(a,...o){const l=this.transaction(a,r?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(o.shift())),(await Promise.all([c[t](...o),r&&l.done]))[0]};return s_.set(e,s),s}YV(n=>({...n,get:(e,t,i)=>ZE(e,t)||n.get(e,t,i),has:(e,t)=>!!ZE(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(i4(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function i4(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const vv="@firebase/app",QE="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vs=new ib("@firebase/app"),r4="@firebase/app-compat",s4="@firebase/analytics-compat",a4="@firebase/analytics",o4="@firebase/app-check-compat",l4="@firebase/app-check",c4="@firebase/auth",u4="@firebase/auth-compat",h4="@firebase/database",d4="@firebase/data-connect",f4="@firebase/database-compat",p4="@firebase/functions",m4="@firebase/functions-compat",g4="@firebase/installations",y4="@firebase/installations-compat",_4="@firebase/messaging",x4="@firebase/messaging-compat",v4="@firebase/performance",S4="@firebase/performance-compat",b4="@firebase/remote-config",w4="@firebase/remote-config-compat",T4="@firebase/storage",E4="@firebase/storage-compat",A4="@firebase/firestore",M4="@firebase/ai",C4="@firebase/firestore-compat",I4="firebase",R4="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sv="[DEFAULT]",P4={[vv]:"fire-core",[r4]:"fire-core-compat",[a4]:"fire-analytics",[s4]:"fire-analytics-compat",[l4]:"fire-app-check",[o4]:"fire-app-check-compat",[c4]:"fire-auth",[u4]:"fire-auth-compat",[h4]:"fire-rtdb",[d4]:"fire-data-connect",[f4]:"fire-rtdb-compat",[p4]:"fire-fn",[m4]:"fire-fn-compat",[g4]:"fire-iid",[y4]:"fire-iid-compat",[_4]:"fire-fcm",[x4]:"fire-fcm-compat",[v4]:"fire-perf",[S4]:"fire-perf-compat",[b4]:"fire-rc",[w4]:"fire-rc-compat",[T4]:"fire-gcs",[E4]:"fire-gcs-compat",[A4]:"fire-fst",[C4]:"fire-fst-compat",[M4]:"fire-vertex","fire-js":"fire-js",[I4]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const km=new Map,L4=new Map,bv=new Map;function e1(n,e){try{n.container.addComponent(e)}catch(t){Vs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function il(n){const e=n.name;if(bv.has(e))return Vs.debug(`There were multiple attempts to register component ${e}.`),!1;bv.set(e,n);for(const t of km.values())e1(t,n);for(const t of L4.values())e1(t,n);return!0}function f0(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Wi(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ba=new Od("app","Firebase",D4);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4{constructor(e,t,i){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new qa("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ba.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gl=R4;function iP(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i={name:Sv,automaticDataCollectionEnabled:!0,...e},r=i.name;if(typeof r!="string"||!r)throw Ba.create("bad-app-name",{appName:String(r)});if(t||(t=ZR()),!t)throw Ba.create("no-options");const s=km.get(r);if(s){if(nl(t,s.options)&&nl(i,s.config))return s;throw Ba.create("duplicate-app",{appName:r})}const a=new BV(r);for(const l of bv.values())a.addComponent(l);const o=new N4(t,i,a);return km.set(r,o),o}function sb(n=Sv){const e=km.get(n);if(!e&&n===Sv&&ZR())return iP();if(!e)throw Ba.create("no-app",{appName:n});return e}function es(n,e,t){let i=P4[n]??n;t&&(i+=`-${t}`);const r=i.match(/\s|\//),s=e.match(/\s|\//);if(r||s){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Vs.warn(a.join(" "));return}il(new qa(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O4="firebase-heartbeat-database",k4=1,nd="firebase-heartbeat-store";let a_=null;function rP(){return a_||(a_=QV(O4,k4,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(nd)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ba.create("idb-open",{originalErrorMessage:n.message})})),a_}async function U4(n){try{const t=(await rP()).transaction(nd),i=await t.objectStore(nd).get(sP(n));return await t.done,i}catch(e){if(e instanceof us)Vs.warn(e.message);else{const t=Ba.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Vs.warn(t.message)}}}async function t1(n,e){try{const i=(await rP()).transaction(nd,"readwrite");await i.objectStore(nd).put(e,sP(n)),await i.done}catch(t){if(t instanceof us)Vs.warn(t.message);else{const i=Ba.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Vs.warn(i.message)}}}function sP(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F4=1024,V4=30;class B4{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new H4(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=n1();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats.length>V4){const a=G4(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){Vs.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=n1(),{heartbeatsToSend:i,unsentEntries:r}=z4(this._heartbeatsCache.heartbeats),s=Om(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Vs.warn(t),""}}}function n1(){return new Date().toISOString().substring(0,10)}function z4(n,e=F4){const t=[];let i=n.slice();for(const r of n){const s=t.find(a=>a.agent===r.agent);if(s){if(s.dates.push(r.date),i1(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),i1(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class H4{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return CV()?IV().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await U4(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return t1(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return t1(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function i1(n){return Om(JSON.stringify({version:2,heartbeats:n})).length}function G4(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W4(n){il(new qa("platform-logger",e=>new n4(e),"PRIVATE")),il(new qa("heartbeat",e=>new B4(e),"PRIVATE")),es(vv,QE,n),es(vv,QE,"esm2020"),es("fire-js","")}W4("");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aP="firebasestorage.googleapis.com",oP="storageBucket",$4=2*60*1e3,q4=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn extends us{constructor(e,t,i=0){super(o_(e),`Firebase Storage: ${t} (${o_(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,mn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return o_(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var pn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(pn||(pn={}));function o_(n){return"storage/"+n}function ab(){const n="An unknown error occurred, please check the error payload for server response.";return new mn(pn.UNKNOWN,n)}function j4(n){return new mn(pn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function X4(n){return new mn(pn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function K4(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new mn(pn.UNAUTHENTICATED,n)}function Y4(){return new mn(pn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function J4(n){return new mn(pn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function Z4(){return new mn(pn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Q4(){return new mn(pn.CANCELED,"User canceled the upload/download.")}function eB(n){return new mn(pn.INVALID_URL,"Invalid URL '"+n+"'.")}function tB(n){return new mn(pn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function nB(){return new mn(pn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+oP+"' property when initializing the app?")}function iB(){return new mn(pn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function rB(){return new mn(pn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function sB(n){return new mn(pn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function wv(n){return new mn(pn.INVALID_ARGUMENT,n)}function lP(){return new mn(pn.APP_DELETED,"The Firebase app was deleted.")}function aB(n){return new mn(pn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Sh(n,e){return new mn(pn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Fu(n){throw new mn(pn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=qi.makeFromUrl(e,t)}catch{return new qi(e,"")}if(i.path==="")return i;throw tB(e)}static makeFromUrl(e,t){let i=null;const r="([A-Za-z0-9.\\-_]+)";function s(T){T.path.charAt(T.path.length-1)==="/"&&(T.path_=T.path_.slice(0,-1))}const a="(/(.*))?$",o=new RegExp("^gs://"+r+a,"i"),l={bucket:1,path:3};function c(T){T.path_=decodeURIComponent(T.path)}const u="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",p=new RegExp(`^https?://${h}/${u}/b/${r}/o${d}`,"i"),g={bucket:1,path:3},_=t===aP?"(?:storage.googleapis.com|storage.cloud.google.com)":t,y="([^?#]*)",m=new RegExp(`^https?://${_}/${r}/${y}`,"i"),v=[{regex:o,indices:l,postModify:s},{regex:p,indices:g,postModify:c},{regex:m,indices:{bucket:1,path:2},postModify:c}];for(let T=0;T<v.length;T++){const R=v[T],C=R.regex.exec(e);if(C){const A=C[R.indices.bucket];let E=C[R.indices.path];E||(E=""),i=new qi(A,E),R.postModify(i);break}}if(i==null)throw eB(e);return i}}class oB{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lB(n,e,t){let i=1,r=null,s=null,a=!1,o=0;function l(){return o===2}let c=!1;function u(...y){c||(c=!0,e.apply(null,y))}function h(y){r=setTimeout(()=>{r=null,n(p,l())},y)}function d(){s&&clearTimeout(s)}function p(y,...m){if(c){d();return}if(y){d(),u.call(null,y,...m);return}if(l()||a){d(),u.call(null,y,...m);return}i<64&&(i*=2);let v;o===1?(o=2,v=0):v=(i+Math.random())*1e3,h(v)}let g=!1;function _(y){g||(g=!0,d(),!c&&(r!==null?(y||(o=2),clearTimeout(r),h(0)):y||(o=1)))}return h(0),s=setTimeout(()=>{a=!0,_(!0)},t),_}function cB(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uB(n){return n!==void 0}function hB(n){return typeof n=="object"&&!Array.isArray(n)}function ob(n){return typeof n=="string"||n instanceof String}function r1(n){return lb()&&n instanceof Blob}function lb(){return typeof Blob<"u"}function s1(n,e,t,i){if(i<e)throw wv(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw wv(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cb(n,e,t){let i=e;return t==null&&(i=`https://${e}`),`${t}://${i}/v0${n}`}function cP(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const r=e(i)+"="+e(n[i]);t=t+r+"&"}return t=t.slice(0,-1),t}var qo;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(qo||(qo={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dB(n,e){const t=n>=500&&n<600,r=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||r||s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fB{constructor(e,t,i,r,s,a,o,l,c,u,h,d=!0,p=!1){this.url_=e,this.method_=t,this.headers_=i,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=a,this.callback_=o,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=d,this.isUsingEmulator=p,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((g,_)=>{this.resolve_=g,this.reject_=_,this.start_()})}start_(){const e=(i,r)=>{if(r){i(!1,new Pf(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const a=o=>{const l=o.loaded,c=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&s.addUploadProgressListener(a),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(a),this.pendingConnection_=null;const o=s.getErrorCode()===qo.NO_ERROR,l=s.getStatus();if(!o||dB(l,this.additionalRetryCodes_)&&this.retry){const u=s.getErrorCode()===qo.ABORT;i(!1,new Pf(!1,null,u));return}const c=this.successCodes_.indexOf(l)!==-1;i(!0,new Pf(c,s))})},t=(i,r)=>{const s=this.resolve_,a=this.reject_,o=r.connection;if(r.wasSuccessCode)try{const l=this.callback_(o,o.getResponse());uB(l)?s(l):s()}catch(l){a(l)}else if(o!==null){const l=ab();l.serverResponse=o.getErrorText(),this.errorCallback_?a(this.errorCallback_(o,l)):a(l)}else if(r.canceled){const l=this.appDelete_?lP():Q4();a(l)}else{const l=Z4();a(l)}};this.canceled_?t(!1,new Pf(!1,null,!0)):this.backoffId_=lB(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&cB(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Pf{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function pB(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function mB(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function gB(n,e){e&&(n["X-Firebase-GMPID"]=e)}function yB(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function _B(n,e,t,i,r,s,a=!0,o=!1){const l=cP(n.urlParams),c=n.url+l,u=Object.assign({},n.headers);return gB(u,e),pB(u,t),mB(u,s),yB(u,i),new fB(c,n.method,u,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,r,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xB(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function vB(...n){const e=xB();if(e!==void 0){const t=new e;for(let i=0;i<n.length;i++)t.append(n[i]);return t.getBlob()}else{if(lb())return new Blob(n);throw new mn(pn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function SB(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bB(n){if(typeof atob>"u")throw sB("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kr={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class l_{constructor(e,t){this.data=e,this.contentType=t||null}}function wB(n,e){switch(n){case Kr.RAW:return new l_(uP(e));case Kr.BASE64:case Kr.BASE64URL:return new l_(hP(n,e));case Kr.DATA_URL:return new l_(EB(e),AB(e))}throw ab()}function uP(n){const e=[];for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);if(i<=127)e.push(i);else if(i<=2047)e.push(192|i>>6,128|i&63);else if((i&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const s=i,a=n.charCodeAt(++t);i=65536|(s&1023)<<10|a&1023,e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}else(i&64512)===56320?e.push(239,191,189):e.push(224|i>>12,128|i>>6&63,128|i&63)}return new Uint8Array(e)}function TB(n){let e;try{e=decodeURIComponent(n)}catch{throw Sh(Kr.DATA_URL,"Malformed data URL.")}return uP(e)}function hP(n,e){switch(n){case Kr.BASE64:{const r=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(r||s)throw Sh(n,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case Kr.BASE64URL:{const r=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(r||s)throw Sh(n,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=bB(e)}catch(r){throw r.message.includes("polyfill")?r:Sh(n,"Invalid character found")}const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}class dP{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Sh(Kr.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=t[1]||null;i!=null&&(this.base64=MB(i,";base64"),this.contentType=this.base64?i.substring(0,i.length-7):i),this.rest=e.substring(e.indexOf(",")+1)}}function EB(n){const e=new dP(n);return e.base64?hP(Kr.BASE64,e.rest):TB(e.rest)}function AB(n){return new dP(n).contentType}function MB(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e,t){let i=0,r="";r1(e)?(this.data_=e,i=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),i=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),i=e.length),this.size_=i,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(r1(this.data_)){const i=this.data_,r=SB(i,e,t);return r===null?null:new _a(r)}else{const i=new Uint8Array(this.data_.buffer,e,t-e);return new _a(i,!0)}}static getBlob(...e){if(lb()){const t=e.map(i=>i instanceof _a?i.data_:i);return new _a(vB.apply(null,t))}else{const t=e.map(a=>ob(a)?wB(Kr.RAW,a).data:a.data_);let i=0;t.forEach(a=>{i+=a.byteLength});const r=new Uint8Array(i);let s=0;return t.forEach(a=>{for(let o=0;o<a.length;o++)r[s++]=a[o]}),new _a(r,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fP(n){let e;try{e=JSON.parse(n)}catch{return null}return hB(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CB(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function IB(n,e){const t=e.split("/").filter(i=>i.length>0).join("/");return n.length===0?t:n+"/"+t}function pP(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RB(n,e){return e}class pi{constructor(e,t,i,r){this.server=e,this.local=t||e,this.writable=!!i,this.xform=r||RB}}let Lf=null;function PB(n){return!ob(n)||n.length<2?n:pP(n)}function mP(){if(Lf)return Lf;const n=[];n.push(new pi("bucket")),n.push(new pi("generation")),n.push(new pi("metageneration")),n.push(new pi("name","fullPath",!0));function e(s,a){return PB(a)}const t=new pi("name");t.xform=e,n.push(t);function i(s,a){return a!==void 0?Number(a):a}const r=new pi("size");return r.xform=i,n.push(r),n.push(new pi("timeCreated")),n.push(new pi("updated")),n.push(new pi("md5Hash",null,!0)),n.push(new pi("cacheControl",null,!0)),n.push(new pi("contentDisposition",null,!0)),n.push(new pi("contentEncoding",null,!0)),n.push(new pi("contentLanguage",null,!0)),n.push(new pi("contentType",null,!0)),n.push(new pi("metadata","customMetadata",!0)),Lf=n,Lf}function LB(n,e){function t(){const i=n.bucket,r=n.fullPath,s=new qi(i,r);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function DB(n,e,t){const i={};i.type="file";const r=t.length;for(let s=0;s<r;s++){const a=t[s];i[a.local]=a.xform(i,e[a.server])}return LB(i,n),i}function gP(n,e,t){const i=fP(e);return i===null?null:DB(n,i,t)}function NB(n,e,t,i){const r=fP(e);if(r===null||!ob(r.downloadTokens))return null;const s=r.downloadTokens;if(s.length===0)return null;const a=encodeURIComponent;return s.split(",").map(c=>{const u=n.bucket,h=n.fullPath,d="/b/"+a(u)+"/o/"+a(h),p=cb(d,t,i),g=cP({alt:"media",token:c});return p+g})[0]}function OB(n,e){const t={},i=e.length;for(let r=0;r<i;r++){const s=e[r];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}class yP{constructor(e,t,i,r){this.url=e,this.method=t,this.handler=i,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _P(n){if(!n)throw ab()}function kB(n,e){function t(i,r){const s=gP(n,r,e);return _P(s!==null),s}return t}function UB(n,e){function t(i,r){const s=gP(n,r,e);return _P(s!==null),NB(s,r,n.host,n._protocol)}return t}function xP(n){function e(t,i){let r;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?r=Y4():r=K4():t.getStatus()===402?r=X4(n.bucket):t.getStatus()===403?r=J4(n.path):r=i,r.status=t.getStatus(),r.serverResponse=i.serverResponse,r}return e}function FB(n){const e=xP(n);function t(i,r){let s=e(i,r);return i.getStatus()===404&&(s=j4(n.path)),s.serverResponse=r.serverResponse,s}return t}function VB(n,e,t){const i=e.fullServerUrl(),r=cb(i,n.host,n._protocol),s="GET",a=n.maxOperationRetryTime,o=new yP(r,s,UB(n,t),a);return o.errorHandler=FB(e),o}function BB(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function zB(n,e,t){const i=Object.assign({},t);return i.fullPath=n.path,i.size=e.size(),i.contentType||(i.contentType=BB(null,e)),i}function HB(n,e,t,i,r){const s=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function o(){let v="";for(let T=0;T<2;T++)v=v+Math.random().toString().slice(2);return v}const l=o();a["Content-Type"]="multipart/related; boundary="+l;const c=zB(e,i,r),u=OB(c,t),h="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,d=`\r
--`+l+"--",p=_a.getBlob(h,i,d);if(p===null)throw iB();const g={name:c.fullPath},_=cb(s,n.host,n._protocol),y="POST",m=n.maxUploadRetryTime,x=new yP(_,y,kB(n,t),m);return x.urlParams=g,x.headers=a,x.body=p.uploadData(),x.errorHandler=xP(e),x}class GB{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=qo.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=qo.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=qo.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,i,r,s){if(this.sent_)throw Fu("cannot .send() more than once");if(lo(e)&&i&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const a in s)s.hasOwnProperty(a)&&this.xhr_.setRequestHeader(a,s[a].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Fu("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Fu("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Fu("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Fu("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class WB extends GB{initXhr(){this.xhr_.responseType="text"}}function vP(){return new WB}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl{constructor(e,t){this._service=e,t instanceof qi?this._location=t:this._location=qi.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new rl(e,t)}get root(){const e=new qi(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return pP(this._location.path)}get storage(){return this._service}get parent(){const e=CB(this._location.path);if(e===null)return null;const t=new qi(this._location.bucket,e);return new rl(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw aB(e)}}function $B(n,e,t){n._throwIfRoot("uploadBytes");const i=HB(n.storage,n._location,mP(),new _a(e,!0),t);return n.storage.makeRequestWithTokens(i,vP).then(r=>({metadata:r,ref:n}))}function qB(n){n._throwIfRoot("getDownloadURL");const e=VB(n.storage,n._location,mP());return n.storage.makeRequestWithTokens(e,vP).then(t=>{if(t===null)throw rB();return t})}function jB(n,e){const t=IB(n._location.path,e),i=new qi(n._location.bucket,t);return new rl(n.storage,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XB(n){return/^[A-Za-z]+:\/\//.test(n)}function KB(n,e){return new rl(n,e)}function SP(n,e){if(n instanceof ub){const t=n;if(t._bucket==null)throw nB();const i=new rl(t,t._bucket);return e!=null?SP(i,e):i}else return e!==void 0?jB(n,e):n}function YB(n,e){if(e&&XB(e)){if(n instanceof ub)return KB(n,e);throw wv("To use ref(service, url), the first argument must be a Storage instance.")}else return SP(n,e)}function a1(n,e){const t=e==null?void 0:e[oP];return t==null?null:qi.makeFromBucketSpec(t,n)}function JB(n,e,t,i={}){n.host=`${e}:${t}`;const r=lo(e);r&&(tb(`https://${n.host}/b`),nb("Storage",!0)),n._isUsingEmulator=!0,n._protocol=r?"https":"http";const{mockUserToken:s}=i;s&&(n._overrideAuthToken=typeof s=="string"?s:eP(s,n.app.options.projectId))}class ub{constructor(e,t,i,r,s,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=r,this._firebaseVersion=s,this._isUsingEmulator=a,this._bucket=null,this._host=aP,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=$4,this._maxUploadRetryTime=q4,this._requests=new Set,r!=null?this._bucket=qi.makeFromBucketSpec(r,this._host):this._bucket=a1(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=qi.makeFromBucketSpec(this._url,e):this._bucket=a1(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){s1("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){s1("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Wi(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new rl(this,e)}_makeRequest(e,t,i,r,s=!0){if(this._deleted)return new oB(lP());{const a=_B(e,this._appId,i,r,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[i,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,r).getPromise()}}const o1="@firebase/storage",l1="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP="storage";function ZB(n,e,t){return n=Ln(n),$B(n,e,t)}function wP(n){return n=Ln(n),qB(n)}function TP(n,e){return n=Ln(n),YB(n,e)}function QB(n=sb(),e){n=Ln(n);const i=f0(n,bP).getImmediate({identifier:e}),r=JR("storage");return r&&ez(i,...r),i}function ez(n,e,t,i={}){JB(n,e,t,i)}function tz(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),r=n.getProvider("app-check-internal");return new ub(t,i,r,e,gl)}function nz(){il(new qa(bP,tz,"PUBLIC").setMultipleInstances(!0)),es(o1,l1,""),es(o1,l1,"esm2020")}nz();var iz="firebase",rz="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */es(iz,rz,"app");function EP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const sz=EP,AP=new Od("auth","Firebase",EP());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Um=new ib("@firebase/auth");function az(n,...e){Um.logLevel<=Mt.WARN&&Um.warn(`Auth (${gl}): ${n}`,...e)}function $p(n,...e){Um.logLevel<=Mt.ERROR&&Um.error(`Auth (${gl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ls(n,...e){throw db(n,...e)}function Rr(n,...e){return db(n,...e)}function hb(n,e,t){const i={...sz(),[e]:t};return new Od("auth","Firebase",i).create(e,{appName:n.name})}function za(n){return hb(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function MP(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&ls(n,"argument-error"),hb(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function db(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return AP.create(n,...e)}function ct(n,e,...t){if(!n)throw db(e,...t)}function Cs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw $p(e),new Error(e)}function Bs(n,e){n||Cs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tv(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function oz(){return c1()==="http:"||c1()==="https:"}function c1(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lz(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(oz()||TV()||"connection"in navigator)?navigator.onLine:!0}function cz(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(e,t){this.shortDelay=e,this.longDelay=t,Bs(t>e,"Short delay should be less than long delay!"),this.isMobile=SV()||EV()}get(){return lz()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fb(n,e){Bs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Cs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Cs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Cs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uz={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hz=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],dz=new Ud(3e4,6e4);function p0(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function cu(n,e,t,i,r={}){return IP(n,r,async()=>{let s={},a={};i&&(e==="GET"?a=i:s={body:JSON.stringify(i)});const o=kd({key:n.config.apiKey,...a}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c={method:e,headers:l,...s};return wV()||(c.referrerPolicy="no-referrer"),n.emulatorConfig&&lo(n.emulatorConfig.host)&&(c.credentials="include"),CP.fetch()(await PP(n,n.config.apiHost,t,o),c)})}async function IP(n,e,t){n._canInitEmulator=!1;const i={...uz,...e};try{const r=new fz(n),s=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw Df(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const o=s.ok?a.errorMessage:a.error.message,[l,c]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Df(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Df(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw Df(n,"user-disabled",a);const u=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw hb(n,u,c);ls(n,u)}}catch(r){if(r instanceof us)throw r;ls(n,"network-request-failed",{message:String(r)})}}async function RP(n,e,t,i,r={}){const s=await cu(n,e,t,i,r);return"mfaPendingCredential"in s&&ls(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function PP(n,e,t,i){const r=`${e}${t}?${i}`,s=n,a=s.config.emulator?fb(n.config,r):`${n.config.apiScheme}://${r}`;return hz.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}class fz{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Rr(this.auth,"network-request-failed")),dz.get())})}}function Df(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=Rr(n,e,i);return r.customData._tokenResponse=t,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pz(n,e){return cu(n,"POST","/v1/accounts:delete",e)}async function Fm(n,e){return cu(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bh(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function mz(n,e=!1){const t=Ln(n),i=await t.getIdToken(e),r=pb(i);ct(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,a=s==null?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:bh(c_(r.auth_time)),issuedAtTime:bh(c_(r.iat)),expirationTime:bh(c_(r.exp)),signInProvider:a||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function c_(n){return Number(n)*1e3}function pb(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return $p("JWT malformed, contained fewer than 3 sections"),null;try{const r=KR(t);return r?JSON.parse(r):($p("Failed to decode base64 JWT payload"),null)}catch(r){return $p("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function u1(n){const e=pb(n);return ct(e,"internal-error"),ct(typeof e.exp<"u","internal-error"),ct(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function id(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof us&&gz(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function gz({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yz{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=bh(this.lastLoginAt),this.creationTime=bh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vm(n){var h;const e=n.auth,t=await n.getIdToken(),i=await id(n,Fm(e,{idToken:t}));ct(i==null?void 0:i.users.length,e,"internal-error");const r=i.users[0];n._notifyReloadListener(r);const s=(h=r.providerUserInfo)!=null&&h.length?LP(r.providerUserInfo):[],a=xz(n.providerData,s),o=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!(a!=null&&a.length),c=o?l:!1,u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Ev(r.createdAt,r.lastLoginAt),isAnonymous:c};Object.assign(n,u)}async function _z(n){const e=Ln(n);await Vm(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function xz(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function LP(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vz(n,e){const t=await IP(n,{},async()=>{const i=kd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,a=await PP(n,r,"/v1/token",`key=${s}`),o=await n._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:i};return n.emulatorConfig&&lo(n.emulatorConfig.host)&&(l.credentials="include"),CP.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Sz(n,e){return cu(n,"POST","/v2/accounts:revokeToken",p0(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ct(e.idToken,"internal-error"),ct(typeof e.idToken<"u","internal-error"),ct(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):u1(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ct(e.length!==0,"internal-error");const t=u1(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ct(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:r,expiresIn:s}=await vz(e,t);this.updateTokensAndExpiration(i,r,Number(s))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:s}=t,a=new Cc;return i&&(ct(typeof i=="string","internal-error",{appName:e}),a.refreshToken=i),r&&(ct(typeof r=="string","internal-error",{appName:e}),a.accessToken=r),s&&(ct(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Cc,this.toJSON())}_performRefresh(){return Cs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ia(n,e){ct(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Er{constructor({uid:e,auth:t,stsTokenManager:i,...r}){this.providerId="firebase",this.proactiveRefresh=new yz(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Ev(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await id(this,this.stsTokenManager.getToken(this.auth,e));return ct(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return mz(this,e)}reload(){return _z(this)}_assign(e){this!==e&&(ct(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Er({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ct(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await Vm(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Wi(this.auth.app))return Promise.reject(za(this.auth));const e=await this.getIdToken();return await id(this,pz(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const i=t.displayName??void 0,r=t.email??void 0,s=t.phoneNumber??void 0,a=t.photoURL??void 0,o=t.tenantId??void 0,l=t._redirectEventId??void 0,c=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:d,isAnonymous:p,providerData:g,stsTokenManager:_}=t;ct(h&&_,e,"internal-error");const y=Cc.fromJSON(this.name,_);ct(typeof h=="string",e,"internal-error"),ia(i,e.name),ia(r,e.name),ct(typeof d=="boolean",e,"internal-error"),ct(typeof p=="boolean",e,"internal-error"),ia(s,e.name),ia(a,e.name),ia(o,e.name),ia(l,e.name),ia(c,e.name),ia(u,e.name);const m=new Er({uid:h,auth:e,email:r,emailVerified:d,displayName:i,isAnonymous:p,photoURL:a,phoneNumber:s,tenantId:o,stsTokenManager:y,createdAt:c,lastLoginAt:u});return g&&Array.isArray(g)&&(m.providerData=g.map(x=>({...x}))),l&&(m._redirectEventId=l),m}static async _fromIdTokenResponse(e,t,i=!1){const r=new Cc;r.updateFromServerResponse(t);const s=new Er({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return await Vm(s),s}static async _fromGetAccountInfoResponse(e,t,i){const r=t.users[0];ct(r.localId!==void 0,"internal-error");const s=r.providerUserInfo!==void 0?LP(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!(s!=null&&s.length),o=new Cc;o.updateFromIdToken(i);const l=new Er({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:a}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Ev(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(s!=null&&s.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h1=new Map;function Is(n){Bs(n instanceof Function,"Expected a class definition");let e=h1.get(n);return e?(Bs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,h1.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}DP.type="NONE";const d1=DP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qp(n,e,t){return`firebase:${n}:${e}:${t}`}class Ic{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=qp(this.userKey,r.apiKey,s),this.fullPersistenceKey=qp("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Fm(this.auth,{idToken:e}).catch(()=>{});return t?Er._fromGetAccountInfoResponse(this.auth,t,e):null}return Er._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new Ic(Is(d1),e,i);const r=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let s=r[0]||Is(d1);const a=qp(i,e.config.apiKey,e.name);let o=null;for(const c of t)try{const u=await c._get(a);if(u){let h;if(typeof u=="string"){const d=await Fm(e,{idToken:u}).catch(()=>{});if(!d)break;h=await Er._fromGetAccountInfoResponse(e,d,u)}else h=Er._fromJSON(e,u);c!==s&&(o=h),s=c;break}}catch{}const l=r.filter(c=>c._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new Ic(s,e,i):(s=l[0],o&&await s._set(a,o.toJSON()),await Promise.all(t.map(async c=>{if(c!==s)try{await c._remove(a)}catch{}})),new Ic(s,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f1(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(UP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(NP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(VP(e))return"Blackberry";if(BP(e))return"Webos";if(OP(e))return"Safari";if((e.includes("chrome/")||kP(e))&&!e.includes("edge/"))return"Chrome";if(FP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function NP(n=hi()){return/firefox\//i.test(n)}function OP(n=hi()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function kP(n=hi()){return/crios\//i.test(n)}function UP(n=hi()){return/iemobile/i.test(n)}function FP(n=hi()){return/android/i.test(n)}function VP(n=hi()){return/blackberry/i.test(n)}function BP(n=hi()){return/webos/i.test(n)}function mb(n=hi()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function bz(n=hi()){var e;return mb(n)&&!!((e=window.navigator)!=null&&e.standalone)}function wz(){return AV()&&document.documentMode===10}function zP(n=hi()){return mb(n)||FP(n)||BP(n)||VP(n)||/windows phone/i.test(n)||UP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HP(n,e=[]){let t;switch(n){case"Browser":t=f1(hi());break;case"Worker":t=`${f1(hi())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${gl}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tz{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((a,o)=>{try{const l=e(s);a(l)}catch(l){o(l)}});i.onAbort=t,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ez(n,e={}){return cu(n,"GET","/v2/passwordPolicy",p0(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Az=6;class Mz{constructor(e){var i;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Az,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((i=e.allowedNonAlphanumericCharacters)==null?void 0:i.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cz{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new p1(this),this.idTokenSubscription=new p1(this),this.beforeStateQueue=new Tz(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=AP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Is(t)),this._initializationPromise=this.queue(async()=>{var i,r,s;if(!this._deleted&&(this.persistenceManager=await Ic.create(this,e),(i=this._resolvePersistenceManagerAvailable)==null||i.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)==null?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Fm(this,{idToken:e}),i=await Er._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(Wi(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let i=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)==null?void 0:s._redirectEventId,o=i==null?void 0:i._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&(l!=null&&l.user)&&(i=l.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ct(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Vm(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=cz()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Wi(this.app))return Promise.reject(za(this));const t=e?Ln(e):null;return t&&ct(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ct(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Wi(this.app)?Promise.reject(za(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Wi(this.app)?Promise.reject(za(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Is(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Ez(this),t=new Mz(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Od("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await Sz(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Is(e)||this._popupRedirectResolver;ct(t,this,"argument-error"),this.redirectPersistenceManager=await Ic.create(this,[Is(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)==null?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(ct(o,this,"internal-error"),o.then(()=>{a||s(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,i,r);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ct(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=HP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;if(Wi(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&az(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Fd(n){return Ln(n)}class p1{constructor(e){this.auth=e,this.observer=null,this.addObserver=NV(t=>this.observer=t)}get next(){return ct(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gb={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Iz(n){gb=n}function Rz(n){return gb.loadJS(n)}function Pz(){return gb.gapiScript}function Lz(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dz(n,e){const t=f0(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(nl(s,e??{}))return r;ls(r,"already-initialized")}return t.initialize({options:e})}function Nz(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(Is);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function Oz(n,e,t){const i=Fd(n);ct(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!1,s=GP(e),{host:a,port:o}=kz(e),l=o===null?"":`:${o}`,c={url:`${s}//${a}${l}/`},u=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){ct(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),ct(nl(c,i.config.emulator)&&nl(u,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=c,i.emulatorConfig=u,i.settings.appVerificationDisabledForTesting=!0,lo(a)?(tb(`${s}//${a}${l}`),nb("Auth",!0)):Uz()}function GP(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function kz(n){const e=GP(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:m1(i.substr(s.length+1))}}else{const[s,a]=i.split(":");return{host:s,port:m1(a)}}}function m1(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Uz(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Cs("not implemented")}_getIdTokenResponse(e){return Cs("not implemented")}_linkToIdToken(e,t){return Cs("not implemented")}_getReauthenticationResolver(e){return Cs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rc(n,e){return RP(n,"POST","/v1/accounts:signInWithIdp",p0(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fz="http://localhost";class sl extends WP{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new sl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ls("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r,...s}=t;if(!i||!r)return null;const a=new sl(i,r);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Rc(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Rc(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Rc(e,t)}buildRequest(){const e={requestUri:Fz,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=kd(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vd extends m0{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa extends Vd{constructor(){super("facebook.com")}static credential(e){return sl._fromParams({providerId:xa.PROVIDER_ID,signInMethod:xa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xa.credentialFromTaggedObject(e)}static credentialFromError(e){return xa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xa.credential(e.oauthAccessToken)}catch{return null}}}xa.FACEBOOK_SIGN_IN_METHOD="facebook.com";xa.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Vd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return sl._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return ws.credential(t,i)}catch{return null}}}ws.GOOGLE_SIGN_IN_METHOD="google.com";ws.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va extends Vd{constructor(){super("github.com")}static credential(e){return sl._fromParams({providerId:va.PROVIDER_ID,signInMethod:va.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return va.credentialFromTaggedObject(e)}static credentialFromError(e){return va.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return va.credential(e.oauthAccessToken)}catch{return null}}}va.GITHUB_SIGN_IN_METHOD="github.com";va.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa extends Vd{constructor(){super("twitter.com")}static credential(e,t){return sl._fromParams({providerId:Sa.PROVIDER_ID,signInMethod:Sa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Sa.credentialFromTaggedObject(e)}static credentialFromError(e){return Sa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return Sa.credential(t,i)}catch{return null}}}Sa.TWITTER_SIGN_IN_METHOD="twitter.com";Sa.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vz(n,e){return RP(n,"POST","/v1/accounts:signUp",p0(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,r=!1){const s=await Er._fromIdTokenResponse(e,i,r),a=g1(i);return new ja({user:s,providerId:a,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const r=g1(i);return new ja({user:e,providerId:r,_tokenResponse:i,operationType:t})}}function g1(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bz(n){var r;if(Wi(n.app))return Promise.reject(za(n));const e=Fd(n);if(await e._initializationPromise,(r=e.currentUser)!=null&&r.isAnonymous)return new ja({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await Vz(e,{returnSecureToken:!0}),i=await ja._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(i.user),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm extends us{constructor(e,t,i,r){super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,Bm.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new Bm(e,t,i,r)}}function $P(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Bm._fromErrorAndOperation(n,s,e,i):s})}async function zz(n,e,t=!1){const i=await id(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ja._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hz(n,e,t=!1){const{auth:i}=n;if(Wi(i.app))return Promise.reject(za(i));const r="reauthenticate";try{const s=await id(n,$P(i,r,e,n),t);ct(s.idToken,i,"internal-error");const a=pb(s.idToken);ct(a,i,"internal-error");const{sub:o}=a;return ct(n.uid===o,i,"user-mismatch"),ja._forOperation(n,r,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&ls(i,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gz(n,e,t=!1){if(Wi(n.app))return Promise.reject(za(n));const i="signIn",r=await $P(n,i,e),s=await ja._fromIdTokenResponse(n,i,r);return t||await n._updateCurrentUser(s.user),s}function Wz(n,e,t,i){return Ln(n).onIdTokenChanged(e,t,i)}function $z(n,e,t){return Ln(n).beforeAuthStateChanged(e,t)}function qz(n,e,t,i){return Ln(n).onAuthStateChanged(e,t,i)}function jz(n){return Ln(n).signOut()}const zm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qP{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(zm,"1"),this.storage.removeItem(zm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xz=1e3,Kz=10;class jP extends qP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),r=this.localCache[t];i!==r&&e(t,r,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const i=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const a=this.storage.getItem(i);!t&&this.localCache[i]===a||this.notifyListeners(i,a)},s=this.storage.getItem(i);wz()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,Kz):r()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},Xz)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}jP.type="LOCAL";const Yz=jP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP extends qP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}XP.type="SESSION";const KP=XP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jz(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const i=new g0(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:r,data:s}=t.data,a=this.handlersMap[r];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const o=Array.from(a).map(async c=>c(t.origin,s)),l=await Jz(o);t.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}g0.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yb(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zz{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,a;return new Promise((o,l)=>{const c=yb("",20);r.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},i);a={messageChannel:r,onMessage(h){const d=h;if(d.data.eventId===c)switch(d.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(d.data.response);break;default:clearTimeout(u),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ts(){return window}function Qz(n){ts().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YP(){return typeof ts().WorkerGlobalScope<"u"&&typeof ts().importScripts=="function"}async function e5(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function t5(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function n5(){return YP()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JP="firebaseLocalStorageDb",i5=1,Hm="firebaseLocalStorage",ZP="fbase_key";class Bd{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function y0(n,e){return n.transaction([Hm],e?"readwrite":"readonly").objectStore(Hm)}function r5(){const n=indexedDB.deleteDatabase(JP);return new Bd(n).toPromise()}function Av(){const n=indexedDB.open(JP,i5);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Hm,{keyPath:ZP})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Hm)?e(i):(i.close(),await r5(),e(await Av()))})})}async function y1(n,e,t){const i=y0(n,!0).put({[ZP]:e,value:t});return new Bd(i).toPromise()}async function s5(n,e){const t=y0(n,!1).get(e),i=await new Bd(t).toPromise();return i===void 0?null:i.value}function _1(n,e){const t=y0(n,!0).delete(e);return new Bd(t).toPromise()}const a5=800,o5=3;class QP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Av(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>o5)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return YP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=g0._getInstance(n5()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await e5(),!this.activeServiceWorker)return;this.sender=new Zz(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(i=e[0])!=null&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||t5()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Av();return await y1(e,zm,"1"),await _1(e,zm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>y1(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>s5(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>_1(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=y0(r,!1).getAll();return new Bd(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:r,value:s}of e)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!i.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),a5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}QP.type="LOCAL";const l5=QP;new Ud(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _b(n,e){return e?Is(e):(ct(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb extends WP{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Rc(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Rc(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Rc(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function c5(n){return Gz(n.auth,new xb(n),n.bypassAuthState)}function u5(n){const{auth:e,user:t}=n;return ct(t,e,"internal-error"),Hz(t,new xb(n),n.bypassAuthState)}async function h5(n){const{auth:e,user:t}=n;return ct(t,e,"internal-error"),zz(t,new xb(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e2{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return c5;case"linkViaPopup":case"linkViaRedirect":return h5;case"reauthViaPopup":case"reauthViaRedirect":return u5;default:ls(this.auth,"internal-error")}}resolve(e){Bs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Bs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d5=new Ud(2e3,1e4);async function x1(n,e,t){if(Wi(n.app))return Promise.reject(Rr(n,"operation-not-supported-in-this-environment"));const i=Fd(n);MP(n,e,m0);const r=_b(i,t);return new Aa(i,"signInViaPopup",e,r).executeNotNull()}async function f5(n,e,t){const i=Ln(n);MP(i.auth,e,m0);const r=_b(i.auth,t);return new Aa(i.auth,"linkViaPopup",e,r,i).executeNotNull()}class Aa extends e2{constructor(e,t,i,r,s){super(e,t,r,s),this.provider=i,this.authWindow=null,this.pollId=null,Aa.currentPopupAction&&Aa.currentPopupAction.cancel(),Aa.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ct(e,this.auth,"internal-error"),e}async onExecution(){Bs(this.filter.length===1,"Popup operations only handle one event");const e=yb();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Rr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Rr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Aa.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if((i=(t=this.authWindow)==null?void 0:t.window)!=null&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Rr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,d5.get())};e()}}Aa.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p5="pendingRedirect",jp=new Map;class m5 extends e2{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=jp.get(this.auth._key());if(!e){try{const i=await g5(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}jp.set(this.auth._key(),e)}return this.bypassAuthState||jp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function g5(n,e){const t=x5(e),i=_5(n);if(!await i._isAvailable())return!1;const r=await i._get(t)==="true";return await i._remove(t),r}function y5(n,e){jp.set(n._key(),e)}function _5(n){return Is(n._redirectPersistence)}function x5(n){return qp(p5,n.config.apiKey,n.name)}async function v5(n,e,t=!1){if(Wi(n.app))return Promise.reject(za(n));const i=Fd(n),r=_b(i,e),a=await new m5(i,r,t).execute();return a&&!t&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S5=10*60*1e3;class b5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!w5(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!t2(e)){const r=((i=e.error.code)==null?void 0:i.split("auth/")[1])||"internal-error";t.onError(Rr(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=S5&&this.cachedEventUids.clear(),this.cachedEventUids.has(v1(e))}saveEventToCache(e){this.cachedEventUids.add(v1(e)),this.lastProcessedEventTime=Date.now()}}function v1(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function t2({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function w5(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return t2(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T5(n,e={}){return cu(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,A5=/^https?/;async function M5(n){if(n.config.emulator)return;const{authorizedDomains:e}=await T5(n);for(const t of e)try{if(C5(t))return}catch{}ls(n,"unauthorized-domain")}function C5(n){const e=Tv(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===i}if(!A5.test(t))return!1;if(E5.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I5=new Ud(3e4,6e4);function S1(){const n=ts().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function R5(n){return new Promise((e,t)=>{var r,s,a;function i(){S1(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{S1(),t(Rr(n,"network-request-failed"))},timeout:I5.get()})}if((s=(r=ts().gapi)==null?void 0:r.iframes)!=null&&s.Iframe)e(gapi.iframes.getContext());else if((a=ts().gapi)!=null&&a.load)i();else{const o=Lz("iframefcb");return ts()[o]=()=>{gapi.load?i():t(Rr(n,"network-request-failed"))},Rz(`${Pz()}?onload=${o}`).catch(l=>t(l))}}).catch(e=>{throw Xp=null,e})}let Xp=null;function P5(n){return Xp=Xp||R5(n),Xp}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L5=new Ud(5e3,15e3),D5="__/auth/iframe",N5="emulator/auth/iframe",O5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},k5=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function U5(n){const e=n.config;ct(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?fb(e,N5):`https://${n.config.authDomain}/${D5}`,i={apiKey:e.apiKey,appName:n.name,v:gl},r=k5.get(n.config.apiHost);r&&(i.eid=r);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${kd(i).slice(1)}`}async function F5(n){const e=await P5(n),t=ts().gapi;return ct(t,n,"internal-error"),e.open({where:document.body,url:U5(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:O5,dontclear:!0},i=>new Promise(async(r,s)=>{await i.restyle({setHideOnLeave:!1});const a=Rr(n,"network-request-failed"),o=ts().setTimeout(()=>{s(a)},L5.get());function l(){ts().clearTimeout(o),r(i)}i.ping(l).then(l,()=>{s(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},B5=500,z5=600,H5="_blank",G5="http://localhost";class b1{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function W5(n,e,t,i=B5,r=z5){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let o="";const l={...V5,width:i.toString(),height:r.toString(),top:s,left:a},c=hi().toLowerCase();t&&(o=kP(c)?H5:t),NP(c)&&(e=e||G5,l.scrollbars="yes");const u=Object.entries(l).reduce((d,[p,g])=>`${d}${p}=${g},`,"");if(bz(c)&&o!=="_self")return $5(e||"",o),new b1(null);const h=window.open(e||"",o,u);ct(h,n,"popup-blocked");try{h.focus()}catch{}return new b1(h)}function $5(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q5="__/auth/handler",j5="emulator/auth/handler",X5=encodeURIComponent("fac");async function w1(n,e,t,i,r,s){ct(n.config.authDomain,n,"auth-domain-config-required"),ct(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:gl,eventId:r};if(e instanceof m0){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",DV(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))a[u]=h}if(e instanceof Vd){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(a.scopes=u.join(","))}n.tenantId&&(a.tid=n.tenantId);const o=a;for(const u of Object.keys(o))o[u]===void 0&&delete o[u];const l=await n._getAppCheckToken(),c=l?`#${X5}=${encodeURIComponent(l)}`:"";return`${K5(n)}?${kd(o).slice(1)}${c}`}function K5({config:n}){return n.emulator?fb(n,j5):`https://${n.authDomain}/${q5}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u_="webStorageSupport";class Y5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=KP,this._completeRedirectFn=v5,this._overrideRedirectResult=y5}async _openPopup(e,t,i,r){var a;Bs((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const s=await w1(e,t,i,Tv(),r);return W5(e,s,yb())}async _openRedirect(e,t,i,r){await this._originValidation(e);const s=await w1(e,t,i,Tv(),r);return Qz(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Bs(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await F5(e),i=new b5(e);return t.register("authEvent",r=>(ct(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(u_,{type:u_},r=>{var a;const s=(a=r==null?void 0:r[0])==null?void 0:a[u_];s!==void 0&&t(!!s),ls(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=M5(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return zP()||OP()||mb()}}const J5=Y5;var T1="@firebase/auth",E1="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ct(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q5(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function e6(n){il(new qa("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=i.options;ct(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:a,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:HP(n)},c=new Cz(i,r,s,l);return Nz(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),il(new qa("auth-internal",e=>{const t=Fd(e.getProvider("auth").getImmediate());return(i=>new Z5(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),es(T1,E1,Q5(n)),es(T1,E1,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t6=5*60,n6=QR("authIdTokenMaxAge")||t6;let A1=null;const i6=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>n6)return;const r=t==null?void 0:t.token;A1!==r&&(A1=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function r6(n=sb()){const e=f0(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Dz(n,{popupRedirectResolver:J5,persistence:[l5,Yz,KP]}),i=QR("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(i,location.origin);if(location.origin===s.origin){const a=i6(s.toString());$z(t,a,()=>a(t.currentUser)),Wz(t,o=>a(o))}}const r=YR("auth");return r&&Oz(t,`http://${r}`),t}function s6(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}Iz({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const s=Rr("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",s6().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});e6("Browser");var M1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ha,n2;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,E){function b(){}b.prototype=E.prototype,A.F=E.prototype,A.prototype=new b,A.prototype.constructor=A,A.D=function(S,I,D){for(var P=Array(arguments.length-2),$=2;$<arguments.length;$++)P[$-2]=arguments[$];return E.prototype[I].apply(S,P)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,t),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(A,E,b){b||(b=0);const S=Array(16);if(typeof E=="string")for(var I=0;I<16;++I)S[I]=E.charCodeAt(b++)|E.charCodeAt(b++)<<8|E.charCodeAt(b++)<<16|E.charCodeAt(b++)<<24;else for(I=0;I<16;++I)S[I]=E[b++]|E[b++]<<8|E[b++]<<16|E[b++]<<24;E=A.g[0],b=A.g[1],I=A.g[2];let D=A.g[3],P;P=E+(D^b&(I^D))+S[0]+3614090360&4294967295,E=b+(P<<7&4294967295|P>>>25),P=D+(I^E&(b^I))+S[1]+3905402710&4294967295,D=E+(P<<12&4294967295|P>>>20),P=I+(b^D&(E^b))+S[2]+606105819&4294967295,I=D+(P<<17&4294967295|P>>>15),P=b+(E^I&(D^E))+S[3]+3250441966&4294967295,b=I+(P<<22&4294967295|P>>>10),P=E+(D^b&(I^D))+S[4]+4118548399&4294967295,E=b+(P<<7&4294967295|P>>>25),P=D+(I^E&(b^I))+S[5]+1200080426&4294967295,D=E+(P<<12&4294967295|P>>>20),P=I+(b^D&(E^b))+S[6]+2821735955&4294967295,I=D+(P<<17&4294967295|P>>>15),P=b+(E^I&(D^E))+S[7]+4249261313&4294967295,b=I+(P<<22&4294967295|P>>>10),P=E+(D^b&(I^D))+S[8]+1770035416&4294967295,E=b+(P<<7&4294967295|P>>>25),P=D+(I^E&(b^I))+S[9]+2336552879&4294967295,D=E+(P<<12&4294967295|P>>>20),P=I+(b^D&(E^b))+S[10]+4294925233&4294967295,I=D+(P<<17&4294967295|P>>>15),P=b+(E^I&(D^E))+S[11]+2304563134&4294967295,b=I+(P<<22&4294967295|P>>>10),P=E+(D^b&(I^D))+S[12]+1804603682&4294967295,E=b+(P<<7&4294967295|P>>>25),P=D+(I^E&(b^I))+S[13]+4254626195&4294967295,D=E+(P<<12&4294967295|P>>>20),P=I+(b^D&(E^b))+S[14]+2792965006&4294967295,I=D+(P<<17&4294967295|P>>>15),P=b+(E^I&(D^E))+S[15]+1236535329&4294967295,b=I+(P<<22&4294967295|P>>>10),P=E+(I^D&(b^I))+S[1]+4129170786&4294967295,E=b+(P<<5&4294967295|P>>>27),P=D+(b^I&(E^b))+S[6]+3225465664&4294967295,D=E+(P<<9&4294967295|P>>>23),P=I+(E^b&(D^E))+S[11]+643717713&4294967295,I=D+(P<<14&4294967295|P>>>18),P=b+(D^E&(I^D))+S[0]+3921069994&4294967295,b=I+(P<<20&4294967295|P>>>12),P=E+(I^D&(b^I))+S[5]+3593408605&4294967295,E=b+(P<<5&4294967295|P>>>27),P=D+(b^I&(E^b))+S[10]+38016083&4294967295,D=E+(P<<9&4294967295|P>>>23),P=I+(E^b&(D^E))+S[15]+3634488961&4294967295,I=D+(P<<14&4294967295|P>>>18),P=b+(D^E&(I^D))+S[4]+3889429448&4294967295,b=I+(P<<20&4294967295|P>>>12),P=E+(I^D&(b^I))+S[9]+568446438&4294967295,E=b+(P<<5&4294967295|P>>>27),P=D+(b^I&(E^b))+S[14]+3275163606&4294967295,D=E+(P<<9&4294967295|P>>>23),P=I+(E^b&(D^E))+S[3]+4107603335&4294967295,I=D+(P<<14&4294967295|P>>>18),P=b+(D^E&(I^D))+S[8]+1163531501&4294967295,b=I+(P<<20&4294967295|P>>>12),P=E+(I^D&(b^I))+S[13]+2850285829&4294967295,E=b+(P<<5&4294967295|P>>>27),P=D+(b^I&(E^b))+S[2]+4243563512&4294967295,D=E+(P<<9&4294967295|P>>>23),P=I+(E^b&(D^E))+S[7]+1735328473&4294967295,I=D+(P<<14&4294967295|P>>>18),P=b+(D^E&(I^D))+S[12]+2368359562&4294967295,b=I+(P<<20&4294967295|P>>>12),P=E+(b^I^D)+S[5]+4294588738&4294967295,E=b+(P<<4&4294967295|P>>>28),P=D+(E^b^I)+S[8]+2272392833&4294967295,D=E+(P<<11&4294967295|P>>>21),P=I+(D^E^b)+S[11]+1839030562&4294967295,I=D+(P<<16&4294967295|P>>>16),P=b+(I^D^E)+S[14]+4259657740&4294967295,b=I+(P<<23&4294967295|P>>>9),P=E+(b^I^D)+S[1]+2763975236&4294967295,E=b+(P<<4&4294967295|P>>>28),P=D+(E^b^I)+S[4]+1272893353&4294967295,D=E+(P<<11&4294967295|P>>>21),P=I+(D^E^b)+S[7]+4139469664&4294967295,I=D+(P<<16&4294967295|P>>>16),P=b+(I^D^E)+S[10]+3200236656&4294967295,b=I+(P<<23&4294967295|P>>>9),P=E+(b^I^D)+S[13]+681279174&4294967295,E=b+(P<<4&4294967295|P>>>28),P=D+(E^b^I)+S[0]+3936430074&4294967295,D=E+(P<<11&4294967295|P>>>21),P=I+(D^E^b)+S[3]+3572445317&4294967295,I=D+(P<<16&4294967295|P>>>16),P=b+(I^D^E)+S[6]+76029189&4294967295,b=I+(P<<23&4294967295|P>>>9),P=E+(b^I^D)+S[9]+3654602809&4294967295,E=b+(P<<4&4294967295|P>>>28),P=D+(E^b^I)+S[12]+3873151461&4294967295,D=E+(P<<11&4294967295|P>>>21),P=I+(D^E^b)+S[15]+530742520&4294967295,I=D+(P<<16&4294967295|P>>>16),P=b+(I^D^E)+S[2]+3299628645&4294967295,b=I+(P<<23&4294967295|P>>>9),P=E+(I^(b|~D))+S[0]+4096336452&4294967295,E=b+(P<<6&4294967295|P>>>26),P=D+(b^(E|~I))+S[7]+1126891415&4294967295,D=E+(P<<10&4294967295|P>>>22),P=I+(E^(D|~b))+S[14]+2878612391&4294967295,I=D+(P<<15&4294967295|P>>>17),P=b+(D^(I|~E))+S[5]+4237533241&4294967295,b=I+(P<<21&4294967295|P>>>11),P=E+(I^(b|~D))+S[12]+1700485571&4294967295,E=b+(P<<6&4294967295|P>>>26),P=D+(b^(E|~I))+S[3]+2399980690&4294967295,D=E+(P<<10&4294967295|P>>>22),P=I+(E^(D|~b))+S[10]+4293915773&4294967295,I=D+(P<<15&4294967295|P>>>17),P=b+(D^(I|~E))+S[1]+2240044497&4294967295,b=I+(P<<21&4294967295|P>>>11),P=E+(I^(b|~D))+S[8]+1873313359&4294967295,E=b+(P<<6&4294967295|P>>>26),P=D+(b^(E|~I))+S[15]+4264355552&4294967295,D=E+(P<<10&4294967295|P>>>22),P=I+(E^(D|~b))+S[6]+2734768916&4294967295,I=D+(P<<15&4294967295|P>>>17),P=b+(D^(I|~E))+S[13]+1309151649&4294967295,b=I+(P<<21&4294967295|P>>>11),P=E+(I^(b|~D))+S[4]+4149444226&4294967295,E=b+(P<<6&4294967295|P>>>26),P=D+(b^(E|~I))+S[11]+3174756917&4294967295,D=E+(P<<10&4294967295|P>>>22),P=I+(E^(D|~b))+S[2]+718787259&4294967295,I=D+(P<<15&4294967295|P>>>17),P=b+(D^(I|~E))+S[9]+3951481745&4294967295,A.g[0]=A.g[0]+E&4294967295,A.g[1]=A.g[1]+(I+(P<<21&4294967295|P>>>11))&4294967295,A.g[2]=A.g[2]+I&4294967295,A.g[3]=A.g[3]+D&4294967295}i.prototype.v=function(A,E){E===void 0&&(E=A.length);const b=E-this.blockSize,S=this.C;let I=this.h,D=0;for(;D<E;){if(I==0)for(;D<=b;)r(this,A,D),D+=this.blockSize;if(typeof A=="string"){for(;D<E;)if(S[I++]=A.charCodeAt(D++),I==this.blockSize){r(this,S),I=0;break}}else for(;D<E;)if(S[I++]=A[D++],I==this.blockSize){r(this,S),I=0;break}}this.h=I,this.o+=E},i.prototype.A=function(){var A=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);A[0]=128;for(var E=1;E<A.length-8;++E)A[E]=0;E=this.o*8;for(var b=A.length-8;b<A.length;++b)A[b]=E&255,E/=256;for(this.v(A),A=Array(16),E=0,b=0;b<4;++b)for(let S=0;S<32;S+=8)A[E++]=this.g[b]>>>S&255;return A};function s(A,E){var b=o;return Object.prototype.hasOwnProperty.call(b,A)?b[A]:b[A]=E(A)}function a(A,E){this.h=E;const b=[];let S=!0;for(let I=A.length-1;I>=0;I--){const D=A[I]|0;S&&D==E||(b[I]=D,S=!1)}this.g=b}var o={};function l(A){return-128<=A&&A<128?s(A,function(E){return new a([E|0],E<0?-1:0)}):new a([A|0],A<0?-1:0)}function c(A){if(isNaN(A)||!isFinite(A))return h;if(A<0)return y(c(-A));const E=[];let b=1;for(let S=0;A>=b;S++)E[S]=A/b|0,b*=4294967296;return new a(E,0)}function u(A,E){if(A.length==0)throw Error("number format error: empty string");if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(A.charAt(0)=="-")return y(u(A.substring(1),E));if(A.indexOf("-")>=0)throw Error('number format error: interior "-" character');const b=c(Math.pow(E,8));let S=h;for(let D=0;D<A.length;D+=8){var I=Math.min(8,A.length-D);const P=parseInt(A.substring(D,D+I),E);I<8?(I=c(Math.pow(E,I)),S=S.j(I).add(c(P))):(S=S.j(b),S=S.add(c(P)))}return S}var h=l(0),d=l(1),p=l(16777216);n=a.prototype,n.m=function(){if(_(this))return-y(this).m();let A=0,E=1;for(let b=0;b<this.g.length;b++){const S=this.i(b);A+=(S>=0?S:4294967296+S)*E,E*=4294967296}return A},n.toString=function(A){if(A=A||10,A<2||36<A)throw Error("radix out of range: "+A);if(g(this))return"0";if(_(this))return"-"+y(this).toString(A);const E=c(Math.pow(A,6));var b=this;let S="";for(;;){const I=T(b,E).g;b=m(b,I.j(E));let D=((b.g.length>0?b.g[0]:b.h)>>>0).toString(A);if(b=I,g(b))return D+S;for(;D.length<6;)D="0"+D;S=D+S}},n.i=function(A){return A<0?0:A<this.g.length?this.g[A]:this.h};function g(A){if(A.h!=0)return!1;for(let E=0;E<A.g.length;E++)if(A.g[E]!=0)return!1;return!0}function _(A){return A.h==-1}n.l=function(A){return A=m(this,A),_(A)?-1:g(A)?0:1};function y(A){const E=A.g.length,b=[];for(let S=0;S<E;S++)b[S]=~A.g[S];return new a(b,~A.h).add(d)}n.abs=function(){return _(this)?y(this):this},n.add=function(A){const E=Math.max(this.g.length,A.g.length),b=[];let S=0;for(let I=0;I<=E;I++){let D=S+(this.i(I)&65535)+(A.i(I)&65535),P=(D>>>16)+(this.i(I)>>>16)+(A.i(I)>>>16);S=P>>>16,D&=65535,P&=65535,b[I]=P<<16|D}return new a(b,b[b.length-1]&-2147483648?-1:0)};function m(A,E){return A.add(y(E))}n.j=function(A){if(g(this)||g(A))return h;if(_(this))return _(A)?y(this).j(y(A)):y(y(this).j(A));if(_(A))return y(this.j(y(A)));if(this.l(p)<0&&A.l(p)<0)return c(this.m()*A.m());const E=this.g.length+A.g.length,b=[];for(var S=0;S<2*E;S++)b[S]=0;for(S=0;S<this.g.length;S++)for(let I=0;I<A.g.length;I++){const D=this.i(S)>>>16,P=this.i(S)&65535,$=A.i(I)>>>16,Y=A.i(I)&65535;b[2*S+2*I]+=P*Y,x(b,2*S+2*I),b[2*S+2*I+1]+=D*Y,x(b,2*S+2*I+1),b[2*S+2*I+1]+=P*$,x(b,2*S+2*I+1),b[2*S+2*I+2]+=D*$,x(b,2*S+2*I+2)}for(A=0;A<E;A++)b[A]=b[2*A+1]<<16|b[2*A];for(A=E;A<2*E;A++)b[A]=0;return new a(b,0)};function x(A,E){for(;(A[E]&65535)!=A[E];)A[E+1]+=A[E]>>>16,A[E]&=65535,E++}function v(A,E){this.g=A,this.h=E}function T(A,E){if(g(E))throw Error("division by zero");if(g(A))return new v(h,h);if(_(A))return E=T(y(A),E),new v(y(E.g),y(E.h));if(_(E))return E=T(A,y(E)),new v(y(E.g),E.h);if(A.g.length>30){if(_(A)||_(E))throw Error("slowDivide_ only works with positive integers.");for(var b=d,S=E;S.l(A)<=0;)b=R(b),S=R(S);var I=C(b,1),D=C(S,1);for(S=C(S,2),b=C(b,2);!g(S);){var P=D.add(S);P.l(A)<=0&&(I=I.add(b),D=P),S=C(S,1),b=C(b,1)}return E=m(A,I.j(E)),new v(I,E)}for(I=h;A.l(E)>=0;){for(b=Math.max(1,Math.floor(A.m()/E.m())),S=Math.ceil(Math.log(b)/Math.LN2),S=S<=48?1:Math.pow(2,S-48),D=c(b),P=D.j(E);_(P)||P.l(A)>0;)b-=S,D=c(b),P=D.j(E);g(D)&&(D=d),I=I.add(D),A=m(A,P)}return new v(I,A)}n.B=function(A){return T(this,A).h},n.and=function(A){const E=Math.max(this.g.length,A.g.length),b=[];for(let S=0;S<E;S++)b[S]=this.i(S)&A.i(S);return new a(b,this.h&A.h)},n.or=function(A){const E=Math.max(this.g.length,A.g.length),b=[];for(let S=0;S<E;S++)b[S]=this.i(S)|A.i(S);return new a(b,this.h|A.h)},n.xor=function(A){const E=Math.max(this.g.length,A.g.length),b=[];for(let S=0;S<E;S++)b[S]=this.i(S)^A.i(S);return new a(b,this.h^A.h)};function R(A){const E=A.g.length+1,b=[];for(let S=0;S<E;S++)b[S]=A.i(S)<<1|A.i(S-1)>>>31;return new a(b,A.h)}function C(A,E){const b=E>>5;E%=32;const S=A.g.length-b,I=[];for(let D=0;D<S;D++)I[D]=E>0?A.i(D+b)>>>E|A.i(D+b+1)<<32-E:A.i(D+b);return new a(I,A.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,n2=i,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=c,a.fromString=u,Ha=a}).apply(typeof M1<"u"?M1:typeof self<"u"?self:typeof window<"u"?window:{});var Nf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var i2,ih,r2,Kp,Mv,s2,a2,o2;(function(){var n,e=Object.defineProperty;function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Nf=="object"&&Nf];for(var w=0;w<f.length;++w){var M=f[w];if(M&&M.Math==Math)return M}throw Error("Cannot find global object")}var i=t(this);function r(f,w){if(w)e:{var M=i;f=f.split(".");for(var O=0;O<f.length-1;O++){var W=f[O];if(!(W in M))break e;M=M[W]}f=f[f.length-1],O=M[f],w=w(O),w!=O&&w!=null&&e(M,f,{configurable:!0,writable:!0,value:w})}}r("Symbol.dispose",function(f){return f||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(f){return f||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(f){return f||function(w){var M=[],O;for(O in w)Object.prototype.hasOwnProperty.call(w,O)&&M.push([O,w[O]]);return M}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},a=this||self;function o(f){var w=typeof f;return w=="object"&&f!=null||w=="function"}function l(f,w,M){return f.call.apply(f.bind,arguments)}function c(f,w,M){return c=l,c.apply(null,arguments)}function u(f,w){var M=Array.prototype.slice.call(arguments,1);return function(){var O=M.slice();return O.push.apply(O,arguments),f.apply(this,O)}}function h(f,w){function M(){}M.prototype=w.prototype,f.Z=w.prototype,f.prototype=new M,f.prototype.constructor=f,f.Ob=function(O,W,j){for(var Te=Array(arguments.length-2),St=2;St<arguments.length;St++)Te[St-2]=arguments[St];return w.prototype[W].apply(O,Te)}}var d=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?f=>f&&AsyncContext.Snapshot.wrap(f):f=>f;function p(f){const w=f.length;if(w>0){const M=Array(w);for(let O=0;O<w;O++)M[O]=f[O];return M}return[]}function g(f,w){for(let O=1;O<arguments.length;O++){const W=arguments[O];var M=typeof W;if(M=M!="object"?M:W?Array.isArray(W)?"array":M:"null",M=="array"||M=="object"&&typeof W.length=="number"){M=f.length||0;const j=W.length||0;f.length=M+j;for(let Te=0;Te<j;Te++)f[M+Te]=W[Te]}else f.push(W)}}class _{constructor(w,M){this.i=w,this.j=M,this.h=0,this.g=null}get(){let w;return this.h>0?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function y(f){a.setTimeout(()=>{throw f},0)}function m(){var f=A;let w=null;return f.g&&(w=f.g,f.g=f.g.next,f.g||(f.h=null),w.next=null),w}class x{constructor(){this.h=this.g=null}add(w,M){const O=v.get();O.set(w,M),this.h?this.h.next=O:this.g=O,this.h=O}}var v=new _(()=>new T,f=>f.reset());class T{constructor(){this.next=this.g=this.h=null}set(w,M){this.h=w,this.g=M,this.next=null}reset(){this.next=this.g=this.h=null}}let R,C=!1,A=new x,E=()=>{const f=Promise.resolve(void 0);R=()=>{f.then(b)}};function b(){for(var f;f=m();){try{f.h.call(f.g)}catch(M){y(M)}var w=v;w.j(f),w.h<100&&(w.h++,f.next=w.g,w.g=f)}C=!1}function S(){this.u=this.u,this.C=this.C}S.prototype.u=!1,S.prototype.dispose=function(){this.u||(this.u=!0,this.N())},S.prototype[Symbol.dispose]=function(){this.dispose()},S.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(f,w){this.type=f,this.g=this.target=w,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var f=!1,w=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const M=()=>{};a.addEventListener("test",M,w),a.removeEventListener("test",M,w)}catch{}return f}();function P(f){return/^[\s\xa0]*$/.test(f)}function $(f,w){I.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f&&this.init(f,w)}h($,I),$.prototype.init=function(f,w){const M=this.type=f.type,O=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;this.target=f.target||f.srcElement,this.g=w,w=f.relatedTarget,w||(M=="mouseover"?w=f.fromElement:M=="mouseout"&&(w=f.toElement)),this.relatedTarget=w,O?(this.clientX=O.clientX!==void 0?O.clientX:O.pageX,this.clientY=O.clientY!==void 0?O.clientY:O.pageY,this.screenX=O.screenX||0,this.screenY=O.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=f.pointerType,this.state=f.state,this.i=f,f.defaultPrevented&&$.Z.h.call(this)},$.prototype.h=function(){$.Z.h.call(this);const f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var Y="closure_listenable_"+(Math.random()*1e6|0),Z=0;function fe(f,w,M,O,W){this.listener=f,this.proxy=null,this.src=w,this.type=M,this.capture=!!O,this.ha=W,this.key=++Z,this.da=this.fa=!1}function B(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function X(f,w,M){for(const O in f)w.call(M,f[O],O,f)}function ee(f,w){for(const M in f)w.call(void 0,f[M],M,f)}function _e(f){const w={};for(const M in f)w[M]=f[M];return w}const Ge="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ft(f,w){let M,O;for(let W=1;W<arguments.length;W++){O=arguments[W];for(M in O)f[M]=O[M];for(let j=0;j<Ge.length;j++)M=Ge[j],Object.prototype.hasOwnProperty.call(O,M)&&(f[M]=O[M])}}function pt(f){this.src=f,this.g={},this.h=0}pt.prototype.add=function(f,w,M,O,W){const j=f.toString();f=this.g[j],f||(f=this.g[j]=[],this.h++);const Te=ne(f,w,O,W);return Te>-1?(w=f[Te],M||(w.fa=!1)):(w=new fe(w,this.src,j,!!O,W),w.fa=M,f.push(w)),w};function wt(f,w){const M=w.type;if(M in f.g){var O=f.g[M],W=Array.prototype.indexOf.call(O,w,void 0),j;(j=W>=0)&&Array.prototype.splice.call(O,W,1),j&&(B(w),f.g[M].length==0&&(delete f.g[M],f.h--))}}function ne(f,w,M,O){for(let W=0;W<f.length;++W){const j=f[W];if(!j.da&&j.listener==w&&j.capture==!!M&&j.ha==O)return W}return-1}var se="closure_lm_"+(Math.random()*1e6|0),Ne={};function Ye(f,w,M,O,W){if(Array.isArray(w)){for(let j=0;j<w.length;j++)Ye(f,w[j],M,O,W);return null}return M=ve(M),f&&f[Y]?f.J(w,M,o(O)?!!O.capture:!1,W):We(f,w,M,!1,O,W)}function We(f,w,M,O,W,j){if(!w)throw Error("Invalid event type");const Te=o(W)?!!W.capture:!!W;let St=he(f);if(St||(f[se]=St=new pt(f)),M=St.add(w,M,O,Te,j),M.proxy)return M;if(O=vt(),M.proxy=O,O.src=f,O.listener=M,f.addEventListener)D||(W=Te),W===void 0&&(W=!1),f.addEventListener(w.toString(),O,W);else if(f.attachEvent)f.attachEvent(de(w.toString()),O);else if(f.addListener&&f.removeListener)f.addListener(O);else throw Error("addEventListener and attachEvent are unavailable.");return M}function vt(){function f(M){return w.call(f.src,f.listener,M)}const w=U;return f}function Bt(f,w,M,O,W){if(Array.isArray(w))for(var j=0;j<w.length;j++)Bt(f,w[j],M,O,W);else O=o(O)?!!O.capture:!!O,M=ve(M),f&&f[Y]?(f=f.i,j=String(w).toString(),j in f.g&&(w=f.g[j],M=ne(w,M,O,W),M>-1&&(B(w[M]),Array.prototype.splice.call(w,M,1),w.length==0&&(delete f.g[j],f.h--)))):f&&(f=he(f))&&(w=f.g[w.toString()],f=-1,w&&(f=ne(w,M,O,W)),(M=f>-1?w[f]:null)&&tt(M))}function tt(f){if(typeof f!="number"&&f&&!f.da){var w=f.src;if(w&&w[Y])wt(w.i,f);else{var M=f.type,O=f.proxy;w.removeEventListener?w.removeEventListener(M,O,f.capture):w.detachEvent?w.detachEvent(de(M),O):w.addListener&&w.removeListener&&w.removeListener(O),(M=he(w))?(wt(M,f),M.h==0&&(M.src=null,w[se]=null)):B(f)}}}function de(f){return f in Ne?Ne[f]:Ne[f]="on"+f}function U(f,w){if(f.da)f=!0;else{w=new $(w,this);const M=f.listener,O=f.ha||f.src;f.fa&&tt(f),f=M.call(O,w)}return f}function he(f){return f=f[se],f instanceof pt?f:null}var me="__closure_events_fn_"+(Math.random()*1e9>>>0);function ve(f){return typeof f=="function"?f:(f[me]||(f[me]=function(w){return f.handleEvent(w)}),f[me])}function oe(){S.call(this),this.i=new pt(this),this.M=this,this.G=null}h(oe,S),oe.prototype[Y]=!0,oe.prototype.removeEventListener=function(f,w,M,O){Bt(this,f,w,M,O)};function Ae(f,w){var M,O=f.G;if(O)for(M=[];O;O=O.G)M.push(O);if(f=f.M,O=w.type||w,typeof w=="string")w=new I(w,f);else if(w instanceof I)w.target=w.target||f;else{var W=w;w=new I(O,f),ft(w,W)}W=!0;let j,Te;if(M)for(Te=M.length-1;Te>=0;Te--)j=w.g=M[Te],W=be(j,O,!0,w)&&W;if(j=w.g=f,W=be(j,O,!0,w)&&W,W=be(j,O,!1,w)&&W,M)for(Te=0;Te<M.length;Te++)j=w.g=M[Te],W=be(j,O,!1,w)&&W}oe.prototype.N=function(){if(oe.Z.N.call(this),this.i){var f=this.i;for(const w in f.g){const M=f.g[w];for(let O=0;O<M.length;O++)B(M[O]);delete f.g[w],f.h--}}this.G=null},oe.prototype.J=function(f,w,M,O){return this.i.add(String(f),w,!1,M,O)},oe.prototype.K=function(f,w,M,O){return this.i.add(String(f),w,!0,M,O)};function be(f,w,M,O){if(w=f.i.g[String(w)],!w)return!0;w=w.concat();let W=!0;for(let j=0;j<w.length;++j){const Te=w[j];if(Te&&!Te.da&&Te.capture==M){const St=Te.listener,Mn=Te.ha||Te.src;Te.fa&&wt(f.i,Te),W=St.call(Mn,O)!==!1&&W}}return W&&!O.defaultPrevented}function Oe(f,w){if(typeof f!="function")if(f&&typeof f.handleEvent=="function")f=c(f.handleEvent,f);else throw Error("Invalid listener argument");return Number(w)>2147483647?-1:a.setTimeout(f,w||0)}function k(f){f.g=Oe(()=>{f.g=null,f.i&&(f.i=!1,k(f))},f.l);const w=f.h;f.h=null,f.m.apply(null,w)}class L extends S{constructor(w,M){super(),this.m=w,this.l=M,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:k(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function G(f){S.call(this),this.h=f,this.g={}}h(G,S);var Q=[];function le(f){X(f.g,function(w,M){this.g.hasOwnProperty(M)&&tt(w)},f),f.g={}}G.prototype.N=function(){G.Z.N.call(this),le(this)},G.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var J=a.JSON.stringify,$e=a.JSON.parse,Me=class{stringify(f){return a.JSON.stringify(f,void 0)}parse(f){return a.JSON.parse(f,void 0)}};function Xe(){}function He(){}var ue={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Se(){I.call(this,"d")}h(Se,I);function Qe(){I.call(this,"c")}h(Qe,I);var qe={},Le=null;function nt(){return Le=Le||new oe}qe.Ia="serverreachability";function V(f){I.call(this,qe.Ia,f)}h(V,I);function Ee(f){const w=nt();Ae(w,new V(w))}qe.STAT_EVENT="statevent";function we(f,w){I.call(this,qe.STAT_EVENT,f),this.stat=w}h(we,I);function pe(f){const w=nt();Ae(w,new we(w,f))}qe.Ja="timingevent";function ge(f,w){I.call(this,qe.Ja,f),this.size=w}h(ge,I);function re(f,w){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){f()},w)}function Fe(){this.g=!0}Fe.prototype.ua=function(){this.g=!1};function ut(f,w,M,O,W,j){f.info(function(){if(f.g)if(j){var Te="",St=j.split("&");for(let jt=0;jt<St.length;jt++){var Mn=St[jt].split("=");if(Mn.length>1){const On=Mn[0];Mn=Mn[1];const Vr=On.split("_");Te=Vr.length>=2&&Vr[1]=="type"?Te+(On+"="+Mn+"&"):Te+(On+"=redacted&")}}}else Te=null;else Te=j;return"XMLHTTP REQ ("+O+") [attempt "+W+"]: "+w+`
`+M+`
`+Te})}function qt(f,w,M,O,W,j,Te){f.info(function(){return"XMLHTTP RESP ("+O+") [ attempt "+W+"]: "+w+`
`+M+`
`+j+" "+Te})}function Rt(f,w,M,O){f.info(function(){return"XMLHTTP TEXT ("+w+"): "+Fi(f,M)+(O?" "+O:"")})}function tr(f,w){f.info(function(){return"TIMEOUT: "+w})}Fe.prototype.info=function(){};function Fi(f,w){if(!f.g)return w;if(!w)return null;try{const j=JSON.parse(w);if(j){for(f=0;f<j.length;f++)if(Array.isArray(j[f])){var M=j[f];if(!(M.length<2)){var O=M[1];if(Array.isArray(O)&&!(O.length<1)){var W=O[0];if(W!="noop"&&W!="stop"&&W!="close")for(let Te=1;Te<O.length;Te++)O[Te]=""}}}}return J(j)}catch{return w}}var Al={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},vu={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Su;function pr(){}h(pr,Xe),pr.prototype.g=function(){return new XMLHttpRequest},Su=new pr;function fs(f){return encodeURIComponent(String(f))}function nf(f){var w=1;f=f.split(":");const M=[];for(;w>0&&f.length;)M.push(f.shift()),w--;return f.length&&M.push(f.join(":")),M}function mr(f,w,M,O){this.j=f,this.i=w,this.l=M,this.S=O||1,this.V=new G(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new fo}function fo(){this.i=null,this.g="",this.h=!1}var bu={},Ys={};function Ml(f,w,M){f.M=1,f.A=Et(Dt(w)),f.u=M,f.R=!0,wu(f,null)}function wu(f,w){f.F=Date.now(),Cl(f),f.B=Dt(f.A);var M=f.B,O=f.S;Array.isArray(O)||(O=[String(O)]),qw(M.i,"t",O),f.C=0,M=f.j.L,f.h=new fo,f.g=uT(f.j,M?w:null,!f.u),f.P>0&&(f.O=new L(c(f.Y,f,f.g),f.P)),w=f.V,M=f.g,O=f.ba;var W="readystatechange";Array.isArray(W)||(W&&(Q[0]=W.toString()),W=Q);for(let j=0;j<W.length;j++){const Te=Ye(M,W[j],O||w.handleEvent,!1,w.h||w);if(!Te)break;w.g[Te.key]=Te}w=f.J?_e(f.J):{},f.u?(f.v||(f.v="POST"),w["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.B,f.v,f.u,w)):(f.v="GET",f.g.ea(f.B,f.v,null,w)),Ee(),ut(f.i,f.v,f.B,f.l,f.S,f.u)}mr.prototype.ba=function(f){f=f.target;const w=this.O;w&&Qs(f)==3?w.j():this.Y(f)},mr.prototype.Y=function(f){try{if(f==this.g)e:{const St=Qs(this.g),Mn=this.g.ya(),jt=this.g.ca();if(!(St<3)&&(St!=3||this.g&&(this.h.h||this.g.la()||Qw(this.g)))){this.K||St!=4||Mn==7||(Mn==8||jt<=0?Ee(3):Ee(2)),Tu(this);var w=this.g.ca();this.X=w;var M=_y(this);if(this.o=w==200,qt(this.i,this.v,this.B,this.l,this.S,St,w),this.o){if(this.U&&!this.L){t:{if(this.g){var O,W=this.g;if((O=W.g?W.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(O)){var j=O;break t}}j=null}if(f=j)Rt(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,q(this,f);else{this.o=!1,this.m=3,pe(12),z(this),N(this);break e}}if(this.R){f=!0;let On;for(;!this.K&&this.C<M.length;)if(On=xy(this,M),On==Ys){St==4&&(this.m=4,pe(14),f=!1),Rt(this.i,this.l,null,"[Incomplete Response]");break}else if(On==bu){this.m=4,pe(15),Rt(this.i,this.l,M,"[Invalid Chunk]"),f=!1;break}else Rt(this.i,this.l,On,null),q(this,On);if(rf(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),St!=4||M.length!=0||this.h.h||(this.m=1,pe(16),f=!1),this.o=this.o&&f,!f)Rt(this.i,this.l,M,"[Invalid Chunked Response]"),z(this),N(this);else if(M.length>0&&!this.W){this.W=!0;var Te=this.j;Te.g==this&&Te.aa&&!Te.P&&(Te.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Ty(Te),Te.P=!0,pe(11))}}else Rt(this.i,this.l,M,null),q(this,M);St==4&&z(this),this.o&&!this.K&&(St==4?aT(this.j,this):(this.o=!1,Cl(this)))}else lN(this.g),w==400&&M.indexOf("Unknown SID")>0?(this.m=3,pe(12)):(this.m=0,pe(13)),z(this),N(this)}}}catch{}finally{}};function _y(f){if(!rf(f))return f.g.la();const w=Qw(f.g);if(w==="")return"";let M="";const O=w.length,W=Qs(f.g)==4;if(!f.h.i){if(typeof TextDecoder>"u")return z(f),N(f),"";f.h.i=new a.TextDecoder}for(let j=0;j<O;j++)f.h.h=!0,M+=f.h.i.decode(w[j],{stream:!(W&&j==O-1)});return w.length=0,f.h.g+=M,f.C=0,f.h.g}function rf(f){return f.g?f.v=="GET"&&f.M!=2&&f.j.Aa:!1}function xy(f,w){var M=f.C,O=w.indexOf(`
`,M);return O==-1?Ys:(M=Number(w.substring(M,O)),isNaN(M)?bu:(O+=1,O+M>w.length?Ys:(w=w.slice(O,O+M),f.C=O+M,w)))}mr.prototype.cancel=function(){this.K=!0,z(this)};function Cl(f){f.T=Date.now()+f.H,sf(f,f.H)}function sf(f,w){if(f.D!=null)throw Error("WatchDog timer not null");f.D=re(c(f.aa,f),w)}function Tu(f){f.D&&(a.clearTimeout(f.D),f.D=null)}mr.prototype.aa=function(){this.D=null;const f=Date.now();f-this.T>=0?(tr(this.i,this.B),this.M!=2&&(Ee(),pe(17)),z(this),this.m=2,N(this)):sf(this,this.T-f)};function N(f){f.j.I==0||f.K||aT(f.j,f)}function z(f){Tu(f);var w=f.O;w&&typeof w.dispose=="function"&&w.dispose(),f.O=null,le(f.V),f.g&&(w=f.g,f.g=null,w.abort(),w.dispose())}function q(f,w){try{var M=f.j;if(M.I!=0&&(M.g==f||Be(M.h,f))){if(!f.L&&Be(M.h,f)&&M.I==3){try{var O=M.Ba.g.parse(w)}catch{O=null}if(Array.isArray(O)&&O.length==3){var W=O;if(W[0]==0){e:if(!M.v){if(M.g)if(M.g.F+3e3<f.F)uf(M),lf(M);else break e;wy(M),pe(18)}}else M.xa=W[1],0<M.xa-M.K&&W[2]<37500&&M.F&&M.A==0&&!M.C&&(M.C=re(c(M.Va,M),6e3));Re(M.h)<=1&&M.ta&&(M.ta=void 0)}else po(M,11)}else if((f.L||M.g==f)&&uf(M),!P(w))for(W=M.Ba.g.parse(w),w=0;w<W.length;w++){let jt=W[w];const On=jt[0];if(!(On<=M.K))if(M.K=On,jt=jt[1],M.I==2)if(jt[0]=="c"){M.M=jt[1],M.ba=jt[2];const Vr=jt[3];Vr!=null&&(M.ka=Vr,M.j.info("VER="+M.ka));const mo=jt[4];mo!=null&&(M.za=mo,M.j.info("SVER="+M.za));const ea=jt[5];ea!=null&&typeof ea=="number"&&ea>0&&(O=1.5*ea,M.O=O,M.j.info("backChannelRequestTimeoutMs_="+O)),O=M;const ta=f.g;if(ta){const df=ta.g?ta.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(df){var j=O.h;j.g||df.indexOf("spdy")==-1&&df.indexOf("quic")==-1&&df.indexOf("h2")==-1||(j.j=j.l,j.g=new Set,j.h&&(ke(j,j.h),j.h=null))}if(O.G){const Ey=ta.g?ta.g.getResponseHeader("X-HTTP-Session-Id"):null;Ey&&(O.wa=Ey,rt(O.J,O.G,Ey))}}M.I=3,M.l&&M.l.ra(),M.aa&&(M.T=Date.now()-f.F,M.j.info("Handshake RTT: "+M.T+"ms")),O=M;var Te=f;if(O.na=cT(O,O.L?O.ba:null,O.W),Te.L){et(O.h,Te);var St=Te,Mn=O.O;Mn&&(St.H=Mn),St.D&&(Tu(St),Cl(St)),O.g=Te}else rT(O);M.i.length>0&&cf(M)}else jt[0]!="stop"&&jt[0]!="close"||po(M,7);else M.I==3&&(jt[0]=="stop"||jt[0]=="close"?jt[0]=="stop"?po(M,7):by(M):jt[0]!="noop"&&M.l&&M.l.qa(jt),M.A=0)}}Ee(4)}catch{}}var K=class{constructor(f,w){this.g=f,this.map=w}};function H(f){this.l=f||10,a.PerformanceNavigationTiming?(f=a.performance.getEntriesByType("navigation"),f=f.length>0&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function xe(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function Re(f){return f.h?1:f.g?f.g.size:0}function Be(f,w){return f.h?f.h==w:f.g?f.g.has(w):!1}function ke(f,w){f.g?f.g.add(w):f.h=w}function et(f,w){f.h&&f.h==w?f.h=null:f.g&&f.g.has(w)&&f.g.delete(w)}H.prototype.cancel=function(){if(this.i=it(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function it(f){if(f.h!=null)return f.i.concat(f.h.G);if(f.g!=null&&f.g.size!==0){let w=f.i;for(const M of f.g.values())w=w.concat(M.G);return w}return p(f.i)}var Ke=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bt(f,w){if(f){f=f.split("&");for(let M=0;M<f.length;M++){const O=f[M].indexOf("=");let W,j=null;O>=0?(W=f[M].substring(0,O),j=f[M].substring(O+1)):W=f[M],w(W,j?decodeURIComponent(j.replace(/\+/g," ")):"")}}}function Tt(f){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let w;f instanceof Tt?(this.l=f.l,Wt(this,f.j),this.o=f.o,this.g=f.g,Nt(this,f.u),this.h=f.h,Je(this,jw(f.i)),this.m=f.m):f&&(w=String(f).match(Ke))?(this.l=!1,Wt(this,w[1]||"",!0),this.o=An(w[2]||""),this.g=An(w[3]||"",!0),Nt(this,w[4]),this.h=An(w[5]||"",!0),Je(this,w[6]||"",!0),this.m=An(w[7]||"")):(this.l=!1,this.i=new xn(null,this.l))}Tt.prototype.toString=function(){const f=[];var w=this.j;w&&f.push(nr(w,Js,!0),":");var M=this.g;return(M||w=="file")&&(f.push("//"),(w=this.o)&&f.push(nr(w,Js,!0),"@"),f.push(fs(M).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),M=this.u,M!=null&&f.push(":",String(M))),(M=this.h)&&(this.g&&M.charAt(0)!="/"&&f.push("/"),f.push(nr(M,M.charAt(0)=="/"?Yn:Yt,!0))),(M=this.i.toString())&&f.push("?",M),(M=this.m)&&f.push("#",nr(M,Bn)),f.join("")},Tt.prototype.resolve=function(f){const w=Dt(this);let M=!!f.j;M?Wt(w,f.j):M=!!f.o,M?w.o=f.o:M=!!f.g,M?w.g=f.g:M=f.u!=null;var O=f.h;if(M)Nt(w,f.u);else if(M=!!f.h){if(O.charAt(0)!="/")if(this.g&&!this.h)O="/"+O;else{var W=w.h.lastIndexOf("/");W!=-1&&(O=w.h.slice(0,W+1)+O)}if(W=O,W==".."||W==".")O="";else if(W.indexOf("./")!=-1||W.indexOf("/.")!=-1){O=W.lastIndexOf("/",0)==0,W=W.split("/");const j=[];for(let Te=0;Te<W.length;){const St=W[Te++];St=="."?O&&Te==W.length&&j.push(""):St==".."?((j.length>1||j.length==1&&j[0]!="")&&j.pop(),O&&Te==W.length&&j.push("")):(j.push(St),O=!0)}O=j.join("/")}else O=W}return M?w.h=O:M=f.i.toString()!=="",M?Je(w,jw(f.i)):M=!!f.m,M&&(w.m=f.m),w};function Dt(f){return new Tt(f)}function Wt(f,w,M){f.j=M?An(w,!0):w,f.j&&(f.j=f.j.replace(/:$/,""))}function Nt(f,w){if(w){if(w=Number(w),isNaN(w)||w<0)throw Error("Bad port number "+w);f.u=w}else f.u=null}function Je(f,w,M){w instanceof xn?(f.i=w,nN(f.i,f.l)):(M||(w=nr(w,Ti)),f.i=new xn(w,f.l))}function rt(f,w,M){f.i.set(w,M)}function Et(f){return rt(f,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),f}function An(f,w){return f?w?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function nr(f,w,M){return typeof f=="string"?(f=encodeURI(f).replace(w,fi),M&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function fi(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var Js=/[#\/\?@]/g,Yt=/[#\?:]/g,Yn=/[#\?]/g,Ti=/[#\?@]/g,Bn=/#/g;function xn(f,w){this.h=this.g=null,this.i=f||null,this.j=!!w}function gr(f){f.g||(f.g=new Map,f.h=0,f.i&&bt(f.i,function(w,M){f.add(decodeURIComponent(w.replace(/\+/g," ")),M)}))}n=xn.prototype,n.add=function(f,w){gr(this),this.i=null,f=Il(this,f);let M=this.g.get(f);return M||this.g.set(f,M=[]),M.push(w),this.h+=1,this};function Fr(f,w){gr(f),w=Il(f,w),f.g.has(w)&&(f.i=null,f.h-=f.g.get(w).length,f.g.delete(w))}function Ww(f,w){return gr(f),w=Il(f,w),f.g.has(w)}n.forEach=function(f,w){gr(this),this.g.forEach(function(M,O){M.forEach(function(W){f.call(w,W,O,this)},this)},this)};function $w(f,w){gr(f);let M=[];if(typeof w=="string")Ww(f,w)&&(M=M.concat(f.g.get(Il(f,w))));else for(f=Array.from(f.g.values()),w=0;w<f.length;w++)M=M.concat(f[w]);return M}n.set=function(f,w){return gr(this),this.i=null,f=Il(this,f),Ww(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[w]),this.h+=1,this},n.get=function(f,w){return f?(f=$w(this,f),f.length>0?String(f[0]):w):w};function qw(f,w,M){Fr(f,w),M.length>0&&(f.i=null,f.g.set(Il(f,w),p(M)),f.h+=M.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],w=Array.from(this.g.keys());for(let O=0;O<w.length;O++){var M=w[O];const W=fs(M);M=$w(this,M);for(let j=0;j<M.length;j++){let Te=W;M[j]!==""&&(Te+="="+fs(M[j])),f.push(Te)}}return this.i=f.join("&")};function jw(f){const w=new xn;return w.i=f.i,f.g&&(w.g=new Map(f.g),w.h=f.h),w}function Il(f,w){return w=String(w),f.j&&(w=w.toLowerCase()),w}function nN(f,w){w&&!f.j&&(gr(f),f.i=null,f.g.forEach(function(M,O){const W=O.toLowerCase();O!=W&&(Fr(this,O),qw(this,W,M))},f)),f.j=w}function iN(f,w){const M=new Fe;if(a.Image){const O=new Image;O.onload=u(Zs,M,"TestLoadImage: loaded",!0,w,O),O.onerror=u(Zs,M,"TestLoadImage: error",!1,w,O),O.onabort=u(Zs,M,"TestLoadImage: abort",!1,w,O),O.ontimeout=u(Zs,M,"TestLoadImage: timeout",!1,w,O),a.setTimeout(function(){O.ontimeout&&O.ontimeout()},1e4),O.src=f}else w(!1)}function rN(f,w){const M=new Fe,O=new AbortController,W=setTimeout(()=>{O.abort(),Zs(M,"TestPingServer: timeout",!1,w)},1e4);fetch(f,{signal:O.signal}).then(j=>{clearTimeout(W),j.ok?Zs(M,"TestPingServer: ok",!0,w):Zs(M,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(W),Zs(M,"TestPingServer: error",!1,w)})}function Zs(f,w,M,O,W){try{W&&(W.onload=null,W.onerror=null,W.onabort=null,W.ontimeout=null),O(M)}catch{}}function sN(){this.g=new Me}function vy(f){this.i=f.Sb||null,this.h=f.ab||!1}h(vy,Xe),vy.prototype.g=function(){return new af(this.i,this.h)};function af(f,w){oe.call(this),this.H=f,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(af,oe),n=af.prototype,n.open=function(f,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=f,this.D=w,this.readyState=1,Au(this)},n.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const w={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};f&&(w.body=f),(this.H||a).fetch(new Request(this.D,w)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Eu(this)),this.readyState=0},n.Pa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,Au(this)),this.g&&(this.readyState=3,Au(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Xw(this)}else f.text().then(this.Oa.bind(this),this.ga.bind(this))};function Xw(f){f.j.read().then(f.Ma.bind(f)).catch(f.ga.bind(f))}n.Ma=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var w=f.value?f.value:new Uint8Array(0);(w=this.B.decode(w,{stream:!f.done}))&&(this.response=this.responseText+=w)}f.done?Eu(this):Au(this),this.readyState==3&&Xw(this)}},n.Oa=function(f){this.g&&(this.response=this.responseText=f,Eu(this))},n.Na=function(f){this.g&&(this.response=f,Eu(this))},n.ga=function(){this.g&&Eu(this)};function Eu(f){f.readyState=4,f.l=null,f.j=null,f.B=null,Au(f)}n.setRequestHeader=function(f,w){this.A.append(f,w)},n.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],w=this.h.entries();for(var M=w.next();!M.done;)M=M.value,f.push(M[0]+": "+M[1]),M=w.next();return f.join(`\r
`)};function Au(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(af.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function Kw(f){let w="";return X(f,function(M,O){w+=O,w+=":",w+=M,w+=`\r
`}),w}function Sy(f,w,M){e:{for(O in M){var O=!1;break e}O=!0}O||(M=Kw(M),typeof f=="string"?M!=null&&fs(M):rt(f,w,M))}function cn(f){oe.call(this),this.headers=new Map,this.L=f||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(cn,oe);var aN=/^https?$/i,oN=["POST","PUT"];n=cn.prototype,n.Fa=function(f){this.H=f},n.ea=function(f,w,M,O){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);w=w?w.toUpperCase():"GET",this.D=f,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Su.g(),this.g.onreadystatechange=d(c(this.Ca,this));try{this.B=!0,this.g.open(w,String(f),!0),this.B=!1}catch(j){Yw(this,j);return}if(f=M||"",M=new Map(this.headers),O)if(Object.getPrototypeOf(O)===Object.prototype)for(var W in O)M.set(W,O[W]);else if(typeof O.keys=="function"&&typeof O.get=="function")for(const j of O.keys())M.set(j,O.get(j));else throw Error("Unknown input type for opt_headers: "+String(O));O=Array.from(M.keys()).find(j=>j.toLowerCase()=="content-type"),W=a.FormData&&f instanceof a.FormData,!(Array.prototype.indexOf.call(oN,w,void 0)>=0)||O||W||M.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[j,Te]of M)this.g.setRequestHeader(j,Te);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(f),this.v=!1}catch(j){Yw(this,j)}};function Yw(f,w){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=w,f.o=5,Jw(f),of(f)}function Jw(f){f.A||(f.A=!0,Ae(f,"complete"),Ae(f,"error"))}n.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=f||7,Ae(this,"complete"),Ae(this,"abort"),of(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),of(this,!0)),cn.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Zw(this):this.Xa())},n.Xa=function(){Zw(this)};function Zw(f){if(f.h&&typeof s<"u"){if(f.v&&Qs(f)==4)setTimeout(f.Ca.bind(f),0);else if(Ae(f,"readystatechange"),Qs(f)==4){f.h=!1;try{const j=f.ca();e:switch(j){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break e;default:w=!1}var M;if(!(M=w)){var O;if(O=j===0){let Te=String(f.D).match(Ke)[1]||null;!Te&&a.self&&a.self.location&&(Te=a.self.location.protocol.slice(0,-1)),O=!aN.test(Te?Te.toLowerCase():"")}M=O}if(M)Ae(f,"complete"),Ae(f,"success");else{f.o=6;try{var W=Qs(f)>2?f.g.statusText:""}catch{W=""}f.l=W+" ["+f.ca()+"]",Jw(f)}}finally{of(f)}}}}function of(f,w){if(f.g){f.m&&(clearTimeout(f.m),f.m=null);const M=f.g;f.g=null,w||Ae(f,"ready");try{M.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Qs(f){return f.g?f.g.readyState:0}n.ca=function(){try{return Qs(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(f){if(this.g){var w=this.g.responseText;return f&&w.indexOf(f)==0&&(w=w.substring(f.length)),$e(w)}};function Qw(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.F){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function lN(f){const w={};f=(f.g&&Qs(f)>=2&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let O=0;O<f.length;O++){if(P(f[O]))continue;var M=nf(f[O]);const W=M[0];if(M=M[1],typeof M!="string")continue;M=M.trim();const j=w[W]||[];w[W]=j,j.push(M)}ee(w,function(O){return O.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Mu(f,w,M){return M&&M.internalChannelParams&&M.internalChannelParams[f]||w}function eT(f){this.za=0,this.i=[],this.j=new Fe,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Mu("failFast",!1,f),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Mu("baseRetryDelayMs",5e3,f),this.Za=Mu("retryDelaySeedMs",1e4,f),this.Ta=Mu("forwardChannelMaxRetries",2,f),this.va=Mu("forwardChannelRequestTimeoutMs",2e4,f),this.ma=f&&f.xmlHttpFactory||void 0,this.Ua=f&&f.Rb||void 0,this.Aa=f&&f.useFetchStreams||!1,this.O=void 0,this.L=f&&f.supportsCrossDomainXhr||!1,this.M="",this.h=new H(f&&f.concurrentRequestLimit),this.Ba=new sN,this.S=f&&f.fastHandshake||!1,this.R=f&&f.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=f&&f.Pb||!1,f&&f.ua&&this.j.ua(),f&&f.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&f&&f.detectBufferingProxy||!1,this.ia=void 0,f&&f.longPollingTimeout&&f.longPollingTimeout>0&&(this.ia=f.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=eT.prototype,n.ka=8,n.I=1,n.connect=function(f,w,M,O){pe(0),this.W=f,this.H=w||{},M&&O!==void 0&&(this.H.OSID=M,this.H.OAID=O),this.F=this.X,this.J=cT(this,null,this.W),cf(this)};function by(f){if(tT(f),f.I==3){var w=f.V++,M=Dt(f.J);if(rt(M,"SID",f.M),rt(M,"RID",w),rt(M,"TYPE","terminate"),Cu(f,M),w=new mr(f,f.j,w),w.M=2,w.A=Et(Dt(M)),M=!1,a.navigator&&a.navigator.sendBeacon)try{M=a.navigator.sendBeacon(w.A.toString(),"")}catch{}!M&&a.Image&&(new Image().src=w.A,M=!0),M||(w.g=uT(w.j,null),w.g.ea(w.A)),w.F=Date.now(),Cl(w)}lT(f)}function lf(f){f.g&&(Ty(f),f.g.cancel(),f.g=null)}function tT(f){lf(f),f.v&&(a.clearTimeout(f.v),f.v=null),uf(f),f.h.cancel(),f.m&&(typeof f.m=="number"&&a.clearTimeout(f.m),f.m=null)}function cf(f){if(!xe(f.h)&&!f.m){f.m=!0;var w=f.Ea;R||E(),C||(R(),C=!0),A.add(w,f),f.D=0}}function cN(f,w){return Re(f.h)>=f.h.j-(f.m?1:0)?!1:f.m?(f.i=w.G.concat(f.i),!0):f.I==1||f.I==2||f.D>=(f.Sa?0:f.Ta)?!1:(f.m=re(c(f.Ea,f,w),oT(f,f.D)),f.D++,!0)}n.Ea=function(f){if(this.m)if(this.m=null,this.I==1){if(!f){this.V=Math.floor(Math.random()*1e5),f=this.V++;const W=new mr(this,this.j,f);let j=this.o;if(this.U&&(j?(j=_e(j),ft(j,this.U)):j=this.U),this.u!==null||this.R||(W.J=j,j=null),this.S)e:{for(var w=0,M=0;M<this.i.length;M++){t:{var O=this.i[M];if("__data__"in O.map&&(O=O.map.__data__,typeof O=="string")){O=O.length;break t}O=void 0}if(O===void 0)break;if(w+=O,w>4096){w=M;break e}if(w===4096||M===this.i.length-1){w=M+1;break e}}w=1e3}else w=1e3;w=iT(this,W,w),M=Dt(this.J),rt(M,"RID",f),rt(M,"CVER",22),this.G&&rt(M,"X-HTTP-Session-Id",this.G),Cu(this,M),j&&(this.R?w="headers="+fs(Kw(j))+"&"+w:this.u&&Sy(M,this.u,j)),ke(this.h,W),this.Ra&&rt(M,"TYPE","init"),this.S?(rt(M,"$req",w),rt(M,"SID","null"),W.U=!0,Ml(W,M,null)):Ml(W,M,w),this.I=2}}else this.I==3&&(f?nT(this,f):this.i.length==0||xe(this.h)||nT(this))};function nT(f,w){var M;w?M=w.l:M=f.V++;const O=Dt(f.J);rt(O,"SID",f.M),rt(O,"RID",M),rt(O,"AID",f.K),Cu(f,O),f.u&&f.o&&Sy(O,f.u,f.o),M=new mr(f,f.j,M,f.D+1),f.u===null&&(M.J=f.o),w&&(f.i=w.G.concat(f.i)),w=iT(f,M,1e3),M.H=Math.round(f.va*.5)+Math.round(f.va*.5*Math.random()),ke(f.h,M),Ml(M,O,w)}function Cu(f,w){f.H&&X(f.H,function(M,O){rt(w,O,M)}),f.l&&X({},function(M,O){rt(w,O,M)})}function iT(f,w,M){M=Math.min(f.i.length,M);const O=f.l?c(f.l.Ka,f.l,f):null;e:{var W=f.i;let St=-1;for(;;){const Mn=["count="+M];St==-1?M>0?(St=W[0].g,Mn.push("ofs="+St)):St=0:Mn.push("ofs="+St);let jt=!0;for(let On=0;On<M;On++){var j=W[On].g;const Vr=W[On].map;if(j-=St,j<0)St=Math.max(0,W[On].g-100),jt=!1;else try{j="req"+j+"_"||"";try{var Te=Vr instanceof Map?Vr:Object.entries(Vr);for(const[mo,ea]of Te){let ta=ea;o(ea)&&(ta=J(ea)),Mn.push(j+mo+"="+encodeURIComponent(ta))}}catch(mo){throw Mn.push(j+"type="+encodeURIComponent("_badmap")),mo}}catch{O&&O(Vr)}}if(jt){Te=Mn.join("&");break e}}Te=void 0}return f=f.i.splice(0,M),w.G=f,Te}function rT(f){if(!f.g&&!f.v){f.Y=1;var w=f.Da;R||E(),C||(R(),C=!0),A.add(w,f),f.A=0}}function wy(f){return f.g||f.v||f.A>=3?!1:(f.Y++,f.v=re(c(f.Da,f),oT(f,f.A)),f.A++,!0)}n.Da=function(){if(this.v=null,sT(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var f=4*this.T;this.j.info("BP detection timer enabled: "+f),this.B=re(c(this.Wa,this),f)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,pe(10),lf(this),sT(this))};function Ty(f){f.B!=null&&(a.clearTimeout(f.B),f.B=null)}function sT(f){f.g=new mr(f,f.j,"rpc",f.Y),f.u===null&&(f.g.J=f.o),f.g.P=0;var w=Dt(f.na);rt(w,"RID","rpc"),rt(w,"SID",f.M),rt(w,"AID",f.K),rt(w,"CI",f.F?"0":"1"),!f.F&&f.ia&&rt(w,"TO",f.ia),rt(w,"TYPE","xmlhttp"),Cu(f,w),f.u&&f.o&&Sy(w,f.u,f.o),f.O&&(f.g.H=f.O);var M=f.g;f=f.ba,M.M=1,M.A=Et(Dt(w)),M.u=null,M.R=!0,wu(M,f)}n.Va=function(){this.C!=null&&(this.C=null,lf(this),wy(this),pe(19))};function uf(f){f.C!=null&&(a.clearTimeout(f.C),f.C=null)}function aT(f,w){var M=null;if(f.g==w){uf(f),Ty(f),f.g=null;var O=2}else if(Be(f.h,w))M=w.G,et(f.h,w),O=1;else return;if(f.I!=0){if(w.o)if(O==1){M=w.u?w.u.length:0,w=Date.now()-w.F;var W=f.D;O=nt(),Ae(O,new ge(O,M)),cf(f)}else rT(f);else if(W=w.m,W==3||W==0&&w.X>0||!(O==1&&cN(f,w)||O==2&&wy(f)))switch(M&&M.length>0&&(w=f.h,w.i=w.i.concat(M)),W){case 1:po(f,5);break;case 4:po(f,10);break;case 3:po(f,6);break;default:po(f,2)}}}function oT(f,w){let M=f.Qa+Math.floor(Math.random()*f.Za);return f.isActive()||(M*=2),M*w}function po(f,w){if(f.j.info("Error code "+w),w==2){var M=c(f.bb,f),O=f.Ua;const W=!O;O=new Tt(O||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Wt(O,"https"),Et(O),W?iN(O.toString(),M):rN(O.toString(),M)}else pe(2);f.I=0,f.l&&f.l.pa(w),lT(f),tT(f)}n.bb=function(f){f?(this.j.info("Successfully pinged google.com"),pe(2)):(this.j.info("Failed to ping google.com"),pe(1))};function lT(f){if(f.I=0,f.ja=[],f.l){const w=it(f.h);(w.length!=0||f.i.length!=0)&&(g(f.ja,w),g(f.ja,f.i),f.h.i.length=0,p(f.i),f.i.length=0),f.l.oa()}}function cT(f,w,M){var O=M instanceof Tt?Dt(M):new Tt(M);if(O.g!="")w&&(O.g=w+"."+O.g),Nt(O,O.u);else{var W=a.location;O=W.protocol,w=w?w+"."+W.hostname:W.hostname,W=+W.port;const j=new Tt(null);O&&Wt(j,O),w&&(j.g=w),W&&Nt(j,W),M&&(j.h=M),O=j}return M=f.G,w=f.wa,M&&w&&rt(O,M,w),rt(O,"VER",f.ka),Cu(f,O),O}function uT(f,w,M){if(w&&!f.L)throw Error("Can't create secondary domain capable XhrIo object.");return w=f.Aa&&!f.ma?new cn(new vy({ab:M})):new cn(f.ma),w.Fa(f.L),w}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function hT(){}n=hT.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function hf(){}hf.prototype.g=function(f,w){return new Vi(f,w)};function Vi(f,w){oe.call(this),this.g=new eT(w),this.l=f,this.h=w&&w.messageUrlParams||null,f=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(f?f["X-WebChannel-Content-Type"]=w.messageContentType:f={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.sa&&(f?f["X-WebChannel-Client-Profile"]=w.sa:f={"X-WebChannel-Client-Profile":w.sa}),this.g.U=f,(f=w&&w.Qb)&&!P(f)&&(this.g.u=f),this.A=w&&w.supportsCrossDomainXhr||!1,this.v=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!P(w)&&(this.g.G=w,f=this.h,f!==null&&w in f&&(f=this.h,w in f&&delete f[w])),this.j=new Rl(this)}h(Vi,oe),Vi.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Vi.prototype.close=function(){by(this.g)},Vi.prototype.o=function(f){var w=this.g;if(typeof f=="string"){var M={};M.__data__=f,f=M}else this.v&&(M={},M.__data__=J(f),f=M);w.i.push(new K(w.Ya++,f)),w.I==3&&cf(w)},Vi.prototype.N=function(){this.g.l=null,delete this.j,by(this.g),delete this.g,Vi.Z.N.call(this)};function dT(f){Se.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var w=f.__sm__;if(w){e:{for(const M in w){f=M;break e}f=void 0}(this.i=f)&&(f=this.i,w=w!==null&&f in w?w[f]:void 0),this.data=w}else this.data=f}h(dT,Se);function fT(){Qe.call(this),this.status=1}h(fT,Qe);function Rl(f){this.g=f}h(Rl,hT),Rl.prototype.ra=function(){Ae(this.g,"a")},Rl.prototype.qa=function(f){Ae(this.g,new dT(f))},Rl.prototype.pa=function(f){Ae(this.g,new fT)},Rl.prototype.oa=function(){Ae(this.g,"b")},hf.prototype.createWebChannel=hf.prototype.g,Vi.prototype.send=Vi.prototype.o,Vi.prototype.open=Vi.prototype.m,Vi.prototype.close=Vi.prototype.close,o2=function(){return new hf},a2=function(){return nt()},s2=qe,Mv={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Al.NO_ERROR=0,Al.TIMEOUT=8,Al.HTTP_ERROR=6,Kp=Al,vu.COMPLETE="complete",r2=vu,He.EventType=ue,ue.OPEN="a",ue.CLOSE="b",ue.ERROR="c",ue.MESSAGE="d",oe.prototype.listen=oe.prototype.J,ih=He,cn.prototype.listenOnce=cn.prototype.K,cn.prototype.getLastError=cn.prototype.Ha,cn.prototype.getLastErrorCode=cn.prototype.ya,cn.prototype.getStatus=cn.prototype.ca,cn.prototype.getResponseJson=cn.prototype.La,cn.prototype.getResponseText=cn.prototype.la,cn.prototype.send=cn.prototype.ea,cn.prototype.setWithCredentials=cn.prototype.Fa,i2=cn}).apply(typeof Nf<"u"?Nf:typeof self<"u"?self:typeof window<"u"?window:{});const C1="@firebase/firestore",I1="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ri.UNAUTHENTICATED=new ri(null),ri.GOOGLE_CREDENTIALS=new ri("google-credentials-uid"),ri.FIRST_PARTY=new ri("first-party-uid"),ri.MOCK_USER=new ri("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uu="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const al=new ib("@firebase/firestore");function ic(){return al.logLevel}function Ue(n,...e){if(al.logLevel<=Mt.DEBUG){const t=e.map(vb);al.debug(`Firestore (${uu}): ${n}`,...t)}}function zs(n,...e){if(al.logLevel<=Mt.ERROR){const t=e.map(vb);al.error(`Firestore (${uu}): ${n}`,...t)}}function Gc(n,...e){if(al.logLevel<=Mt.WARN){const t=e.map(vb);al.warn(`Firestore (${uu}): ${n}`,...t)}}function vb(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function at(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,l2(n,i,t)}function l2(n,e,t){let i=`FIRESTORE (${uu}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw zs(i),new Error(i)}function zt(n,e,t,i){let r="Unexpected state";typeof t=="string"?r=t:i=t,n||l2(e,r,i)}function mt(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ie={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pe extends us{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c2{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class a6{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ri.UNAUTHENTICATED))}shutdown(){}}class o6{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class l6{constructor(e){this.t=e,this.currentUser=ri.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){zt(this.o===void 0,42304);let i=this.i;const r=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve();let s=new Ps;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ps,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},o=l=>{Ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(Ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ps)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(Ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(zt(typeof i.accessToken=="string",31837,{l:i}),new c2(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return zt(e===null||typeof e=="string",2055,{h:e}),new ri(e)}}class c6{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=ri.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class u6{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new c6(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ri.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class R1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class h6{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Wi(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){zt(this.o===void 0,3512);const i=s=>{s.error!=null&&Ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,Ue("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{Ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?r(s):Ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new R1(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(zt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new R1(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d6(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const r=d6(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%62))}return i}}function Ct(n,e){return n<e?-1:n>e?1:0}function Cv(n,e){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++){const r=n.charAt(i),s=e.charAt(i);if(r!==s)return h_(r)===h_(s)?Ct(r,s):h_(r)?1:-1}return Ct(n.length,e.length)}const f6=55296,p6=57343;function h_(n){const e=n.charCodeAt(0);return e>=f6&&e<=p6}function Wc(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P1="__name__";class $r{constructor(e,t,i){t===void 0?t=0:t>e.length&&at(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&at(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return $r.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $r?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=$r.compareSegments(e.get(r),t.get(r));if(s!==0)return s}return Ct(e.length,t.length)}static compareSegments(e,t){const i=$r.isNumericId(e),r=$r.isNumericId(t);return i&&!r?-1:!i&&r?1:i&&r?$r.extractNumericId(e).compare($r.extractNumericId(t)):Cv(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ha.fromString(e.substring(4,e.length-2))}}class Xt extends $r{construct(e,t,i){return new Xt(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new Pe(ie.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new Xt(t)}static emptyPath(){return new Xt([])}}const m6=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Gn extends $r{construct(e,t,i){return new Gn(e,t,i)}static isValidIdentifier(e){return m6.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Gn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===P1}static keyField(){return new Gn([P1])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(i.length===0)throw new Pe(ie.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let a=!1;for(;r<e.length;){const o=e[r];if(o==="\\"){if(r+1===e.length)throw new Pe(ie.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Pe(ie.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else o==="`"?(a=!a,r++):o!=="."||a?(i+=o,r++):(s(),r++)}if(s(),a)throw new Pe(ie.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Gn(t)}static emptyPath(){return new Gn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(e){this.path=e}static fromPath(e){return new Ze(Xt.fromString(e))}static fromName(e){return new Ze(Xt.fromString(e).popFirst(5))}static empty(){return new Ze(Xt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Xt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Xt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ze(new Xt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u2(n,e,t){if(!t)throw new Pe(ie.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function g6(n,e,t,i){if(e===!0&&i===!0)throw new Pe(ie.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function L1(n){if(!Ze.isDocumentKey(n))throw new Pe(ie.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function D1(n){if(Ze.isDocumentKey(n))throw new Pe(ie.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function h2(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function _0(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":at(12329,{type:typeof n})}function Xa(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Pe(ie.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=_0(n);throw new Pe(ie.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(n,e){const t={typeString:n};return e&&(t.value=e),t}function zd(n,e){if(!h2(n))throw new Pe(ie.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const r=e[i].typeString,s="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const a=n[i];if(r&&typeof a!==r){t=`JSON field '${i}' must be a ${r}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${i}' field to equal '${s.value}'`;break}}if(t)throw new Pe(ie.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N1=-62135596800,O1=1e6;class Zt{static now(){return Zt.fromMillis(Date.now())}static fromDate(e){return Zt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*O1);return new Zt(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Pe(ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Pe(ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<N1)throw new Pe(ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Pe(ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/O1}_compareTo(e){return this.seconds===e.seconds?Ct(this.nanoseconds,e.nanoseconds):Ct(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Zt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(zd(e,Zt._jsonSchema))return new Zt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-N1;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Zt._jsonSchemaVersion="firestore/timestamp/1.0",Zt._jsonSchema={type:Tn("string",Zt._jsonSchemaVersion),seconds:Tn("number"),nanoseconds:Tn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dt{static fromTimestamp(e){return new dt(e)}static min(){return new dt(new Zt(0,0))}static max(){return new dt(new Zt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rd=-1;function y6(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=dt.fromTimestamp(i===1e9?new Zt(t+1,0):new Zt(t,i));return new Ka(r,Ze.empty(),e)}function _6(n){return new Ka(n.readTime,n.key,rd)}class Ka{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Ka(dt.min(),Ze.empty(),rd)}static max(){return new Ka(dt.max(),Ze.empty(),rd)}}function x6(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ze.comparator(n.documentKey,e.documentKey),t!==0?t:Ct(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v6="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class S6{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hu(n){if(n.code!==ie.FAILED_PRECONDITION||n.message!==v6)throw n;Ue("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ae{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&at(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ae((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ae?t:ae.resolve(t)}catch(t){return ae.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ae.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ae.reject(t)}static resolve(e){return new ae((t,i)=>{t(e)})}static reject(e){return new ae((t,i)=>{i(e)})}static waitFor(e){return new ae((t,i)=>{let r=0,s=0,a=!1;e.forEach(o=>{++r,o.next(()=>{++s,a&&s===r&&t()},l=>i(l))}),a=!0,s===r&&t()})}static or(e){let t=ae.resolve(!1);for(const i of e)t=t.next(r=>r?ae.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new ae((i,r)=>{const s=e.length,a=new Array(s);let o=0;for(let l=0;l<s;l++){const c=l;t(e[c]).next(u=>{a[c]=u,++o,o===s&&i(a)},u=>r(u))}})}static doWhile(e,t){return new ae((i,r)=>{const s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}}function b6(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function du(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>t.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}x0.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bb=-1;function v0(n){return n==null}function Gm(n){return n===0&&1/n==-1/0}function w6(n){return typeof n=="number"&&Number.isInteger(n)&&!Gm(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d2="";function T6(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=k1(e)),e=E6(n.get(t),e);return k1(e)}function E6(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="";break;case d2:t+="";break;default:t+=s}}return t}function k1(n){return n+d2+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U1(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function yl(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function f2(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e,t){this.comparator=e,this.root=t||Hn.EMPTY}insert(e,t){return new ln(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Hn.BLACK,null,null))}remove(e){return new ln(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Hn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Of(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Of(this.root,e,this.comparator,!1)}getReverseIterator(){return new Of(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Of(this.root,e,this.comparator,!0)}}class Of{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Hn{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??Hn.RED,this.left=r??Hn.EMPTY,this.right=s??Hn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new Hn(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Hn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Hn.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Hn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Hn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw at(43730,{key:this.key,value:this.value});if(this.right.isRed())throw at(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw at(27949);return e+(this.isRed()?0:1)}}Hn.EMPTY=null,Hn.RED=!0,Hn.BLACK=!1;Hn.EMPTY=new class{constructor(){this.size=0}get key(){throw at(57766)}get value(){throw at(16141)}get color(){throw at(16727)}get left(){throw at(29726)}get right(){throw at(36894)}copy(e,t,i,r,s){return this}insert(e,t,i){return new Hn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e){this.comparator=e,this.data=new ln(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new F1(this.data.getIterator())}getIteratorFrom(e){return new F1(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof Pn)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Pn(this.comparator);return t.data=e,t}}class F1{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.fields=e,e.sort(Gn.comparator)}static empty(){return new Ar([])}unionWith(e){let t=new Pn(Gn.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Ar(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Wc(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p2 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new p2("Invalid base64 string: "+s):s}}(e);return new Xn(t)}static fromUint8Array(e){const t=function(r){let s="";for(let a=0;a<r.length;++a)s+=String.fromCharCode(r[a]);return s}(e);return new Xn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ct(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xn.EMPTY_BYTE_STRING=new Xn("");const A6=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ya(n){if(zt(!!n,39018),typeof n=="string"){let e=0;const t=A6.exec(n);if(zt(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:yn(n.seconds),nanos:yn(n.nanos)}}function yn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ja(n){return typeof n=="string"?Xn.fromBase64String(n):Xn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m2="server_timestamp",g2="__type__",y2="__previous_value__",_2="__local_write_time__";function wb(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[g2])==null?void 0:i.stringValue)===m2}function S0(n){const e=n.mapValue.fields[y2];return wb(e)?S0(e):e}function sd(n){const e=Ya(n.mapValue.fields[_2].timestampValue);return new Zt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M6{constructor(e,t,i,r,s,a,o,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=u}}const Wm="(default)";class ad{constructor(e,t){this.projectId=e,this.database=t||Wm}static empty(){return new ad("","")}get isDefaultDatabase(){return this.database===Wm}isEqual(e){return e instanceof ad&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x2="__type__",C6="__max__",kf={mapValue:{}},v2="__vector__",$m="value";function Za(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?wb(n)?4:R6(n)?9007199254740991:I6(n)?10:11:at(28295,{value:n})}function cs(n,e){if(n===e)return!0;const t=Za(n);if(t!==Za(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return sd(n).isEqual(sd(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const a=Ya(r.timestampValue),o=Ya(s.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return Ja(r.bytesValue).isEqual(Ja(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return yn(r.geoPointValue.latitude)===yn(s.geoPointValue.latitude)&&yn(r.geoPointValue.longitude)===yn(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return yn(r.integerValue)===yn(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const a=yn(r.doubleValue),o=yn(s.doubleValue);return a===o?Gm(a)===Gm(o):isNaN(a)&&isNaN(o)}return!1}(n,e);case 9:return Wc(n.arrayValue.values||[],e.arrayValue.values||[],cs);case 10:case 11:return function(r,s){const a=r.mapValue.fields||{},o=s.mapValue.fields||{};if(U1(a)!==U1(o))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(o[l]===void 0||!cs(a[l],o[l])))return!1;return!0}(n,e);default:return at(52216,{left:n})}}function od(n,e){return(n.values||[]).find(t=>cs(t,e))!==void 0}function $c(n,e){if(n===e)return 0;const t=Za(n),i=Za(e);if(t!==i)return Ct(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ct(n.booleanValue,e.booleanValue);case 2:return function(s,a){const o=yn(s.integerValue||s.doubleValue),l=yn(a.integerValue||a.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1}(n,e);case 3:return V1(n.timestampValue,e.timestampValue);case 4:return V1(sd(n),sd(e));case 5:return Cv(n.stringValue,e.stringValue);case 6:return function(s,a){const o=Ja(s),l=Ja(a);return o.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const o=s.split("/"),l=a.split("/");for(let c=0;c<o.length&&c<l.length;c++){const u=Ct(o[c],l[c]);if(u!==0)return u}return Ct(o.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const o=Ct(yn(s.latitude),yn(a.latitude));return o!==0?o:Ct(yn(s.longitude),yn(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return B1(n.arrayValue,e.arrayValue);case 10:return function(s,a){var d,p,g,_;const o=s.fields||{},l=a.fields||{},c=(d=o[$m])==null?void 0:d.arrayValue,u=(p=l[$m])==null?void 0:p.arrayValue,h=Ct(((g=c==null?void 0:c.values)==null?void 0:g.length)||0,((_=u==null?void 0:u.values)==null?void 0:_.length)||0);return h!==0?h:B1(c,u)}(n.mapValue,e.mapValue);case 11:return function(s,a){if(s===kf.mapValue&&a===kf.mapValue)return 0;if(s===kf.mapValue)return 1;if(a===kf.mapValue)return-1;const o=s.fields||{},l=Object.keys(o),c=a.fields||{},u=Object.keys(c);l.sort(),u.sort();for(let h=0;h<l.length&&h<u.length;++h){const d=Cv(l[h],u[h]);if(d!==0)return d;const p=$c(o[l[h]],c[u[h]]);if(p!==0)return p}return Ct(l.length,u.length)}(n.mapValue,e.mapValue);default:throw at(23264,{he:t})}}function V1(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ct(n,e);const t=Ya(n),i=Ya(e),r=Ct(t.seconds,i.seconds);return r!==0?r:Ct(t.nanos,i.nanos)}function B1(n,e){const t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){const s=$c(t[r],i[r]);if(s)return s}return Ct(t.length,i.length)}function qc(n){return Iv(n)}function Iv(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const i=Ya(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ja(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ze.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(const s of t.values||[])r?r=!1:i+=",",i+=Iv(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){const i=Object.keys(t.fields||{}).sort();let r="{",s=!0;for(const a of i)s?s=!1:r+=",",r+=`${a}:${Iv(t.fields[a])}`;return r+"}"}(n.mapValue):at(61005,{value:n})}function Yp(n){switch(Za(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=S0(n);return e?16+Yp(e):16;case 5:return 2*n.stringValue.length;case 6:return Ja(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((r,s)=>r+Yp(s),0)}(n.arrayValue);case 10:case 11:return function(i){let r=0;return yl(i.fields,(s,a)=>{r+=s.length+Yp(a)}),r}(n.mapValue);default:throw at(13486,{value:n})}}function z1(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Rv(n){return!!n&&"integerValue"in n}function Tb(n){return!!n&&"arrayValue"in n}function H1(n){return!!n&&"nullValue"in n}function G1(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Jp(n){return!!n&&"mapValue"in n}function I6(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[x2])==null?void 0:i.stringValue)===v2}function wh(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return yl(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=wh(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=wh(n.arrayValue.values[t]);return e}return{...n}}function R6(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===C6}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e){this.value=e}static empty(){return new or({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Jp(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wh(t)}setAll(e){let t=Gn.emptyPath(),i={},r=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){const l=this.getFieldsMap(t);this.applyChanges(l,i,r),i={},r=[],t=o.popLast()}a?i[o.lastSegment()]=wh(a):r.push(o.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());Jp(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return cs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Jp(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){yl(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new or(wh(this.value))}}function S2(n){const e=[];return yl(n.fields,(t,i)=>{const r=new Gn([t]);if(Jp(i)){const s=S2(i.mapValue).fields;if(s.length===0)e.push(r);else for(const a of s)e.push(r.child(a))}else e.push(r)}),new Ar(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(e,t,i,r,s,a,o){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new oi(e,0,dt.min(),dt.min(),dt.min(),or.empty(),0)}static newFoundDocument(e,t,i,r){return new oi(e,1,t,dt.min(),i,r,0)}static newNoDocument(e,t){return new oi(e,2,t,dt.min(),dt.min(),or.empty(),0)}static newUnknownDocument(e,t){return new oi(e,3,t,dt.min(),dt.min(),or.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(dt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=or.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=or.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=dt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof oi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new oi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{constructor(e,t){this.position=e,this.inclusive=t}}function W1(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],a=n.position[r];if(s.field.isKeyField()?i=Ze.comparator(Ze.fromName(a.referenceValue),t.key):i=$c(a,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function $1(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!cs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld{constructor(e,t="asc"){this.field=e,this.dir=t}}function P6(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b2{}class wn extends b2{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new D6(e,t,i):t==="array-contains"?new k6(e,i):t==="in"?new U6(e,i):t==="not-in"?new F6(e,i):t==="array-contains-any"?new V6(e,i):new wn(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new N6(e,i):new O6(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison($c(t,this.value)):t!==null&&Za(this.value)===Za(t)&&this.matchesComparison($c(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return at(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Nr extends b2{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Nr(e,t)}matches(e){return w2(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function w2(n){return n.op==="and"}function T2(n){return L6(n)&&w2(n)}function L6(n){for(const e of n.filters)if(e instanceof Nr)return!1;return!0}function Pv(n){if(n instanceof wn)return n.field.canonicalString()+n.op.toString()+qc(n.value);if(T2(n))return n.filters.map(e=>Pv(e)).join(",");{const e=n.filters.map(t=>Pv(t)).join(",");return`${n.op}(${e})`}}function E2(n,e){return n instanceof wn?function(i,r){return r instanceof wn&&i.op===r.op&&i.field.isEqual(r.field)&&cs(i.value,r.value)}(n,e):n instanceof Nr?function(i,r){return r instanceof Nr&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,a,o)=>s&&E2(a,r.filters[o]),!0):!1}(n,e):void at(19439)}function A2(n){return n instanceof wn?function(t){return`${t.field.canonicalString()} ${t.op} ${qc(t.value)}`}(n):n instanceof Nr?function(t){return t.op.toString()+" {"+t.getFilters().map(A2).join(" ,")+"}"}(n):"Filter"}class D6 extends wn{constructor(e,t,i){super(e,t,i),this.key=Ze.fromName(i.referenceValue)}matches(e){const t=Ze.comparator(e.key,this.key);return this.matchesComparison(t)}}class N6 extends wn{constructor(e,t){super(e,"in",t),this.keys=M2("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class O6 extends wn{constructor(e,t){super(e,"not-in",t),this.keys=M2("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function M2(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(i=>Ze.fromName(i.referenceValue))}class k6 extends wn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Tb(t)&&od(t.arrayValue,this.value)}}class U6 extends wn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&od(this.value.arrayValue,t)}}class F6 extends wn{constructor(e,t){super(e,"not-in",t)}matches(e){if(od(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!od(this.value.arrayValue,t)}}class V6 extends wn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Tb(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>od(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B6{constructor(e,t=null,i=[],r=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=a,this.endAt=o,this.Te=null}}function q1(n,e=null,t=[],i=[],r=null,s=null,a=null){return new B6(n,e,t,i,r,s,a)}function Eb(n){const e=mt(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>Pv(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),v0(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>qc(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>qc(i)).join(",")),e.Te=t}return e.Te}function Ab(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!P6(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!E2(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$1(n.startAt,e.startAt)&&$1(n.endAt,e.endAt)}function Lv(n){return Ze.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e,t=null,i=[],r=[],s=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function z6(n,e,t,i,r,s,a,o){return new fu(n,e,t,i,r,s,a,o)}function Mb(n){return new fu(n)}function j1(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function C2(n){return n.collectionGroup!==null}function Th(n){const e=mt(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new Pn(Gn.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(o=o.add(c.field))})}),o})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new ld(s,i))}),t.has(Gn.keyField().canonicalString())||e.Ie.push(new ld(Gn.keyField(),i))}return e.Ie}function ns(n){const e=mt(n);return e.Ee||(e.Ee=H6(e,Th(n))),e.Ee}function H6(n,e){if(n.limitType==="F")return q1(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const s=r.dir==="desc"?"asc":"desc";return new ld(r.field,s)});const t=n.endAt?new qm(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new qm(n.startAt.position,n.startAt.inclusive):null;return q1(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function Dv(n,e){const t=n.filters.concat([e]);return new fu(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Nv(n,e,t){return new fu(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function b0(n,e){return Ab(ns(n),ns(e))&&n.limitType===e.limitType}function I2(n){return`${Eb(ns(n))}|lt:${n.limitType}`}function rc(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>A2(r)).join(", ")}]`),v0(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>qc(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>qc(r)).join(",")),`Target(${i})`}(ns(n))}; limitType=${n.limitType})`}function w0(n,e){return e.isFoundDocument()&&function(i,r){const s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):Ze.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(const s of Th(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(const s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(a,o,l){const c=W1(a,o,l);return a.inclusive?c<=0:c<0}(i.startAt,Th(i),r)||i.endAt&&!function(a,o,l){const c=W1(a,o,l);return a.inclusive?c>=0:c>0}(i.endAt,Th(i),r))}(n,e)}function G6(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function R2(n){return(e,t)=>{let i=!1;for(const r of Th(n)){const s=W6(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function W6(n,e,t){const i=n.field.isKeyField()?Ze.comparator(e.key,t.key):function(s,a,o){const l=a.data.field(s),c=o.data.field(s);return l!==null&&c!==null?$c(l,c):at(42886)}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return at(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){yl(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return f2(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $6=new ln(Ze.comparator);function Hs(){return $6}const P2=new ln(Ze.comparator);function rh(...n){let e=P2;for(const t of n)e=e.insert(t.key,t);return e}function L2(n){let e=P2;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Vo(){return Eh()}function D2(){return Eh()}function Eh(){return new _l(n=>n.toString(),(n,e)=>n.isEqual(e))}const q6=new ln(Ze.comparator),j6=new Pn(Ze.comparator);function It(...n){let e=j6;for(const t of n)e=e.add(t);return e}const X6=new Pn(Ct);function K6(){return X6}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cb(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Gm(e)?"-0":e}}function N2(n){return{integerValue:""+n}}function Y6(n,e){return w6(e)?N2(e):Cb(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(){this._=void 0}}function J6(n,e,t){return n instanceof jm?function(r,s){const a={fields:{[g2]:{stringValue:m2},[_2]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&wb(s)&&(s=S0(s)),s&&(a.fields[y2]=s),{mapValue:a}}(t,e):n instanceof cd?k2(n,e):n instanceof ud?U2(n,e):function(r,s){const a=O2(r,s),o=X1(a)+X1(r.Ae);return Rv(a)&&Rv(r.Ae)?N2(o):Cb(r.serializer,o)}(n,e)}function Z6(n,e,t){return n instanceof cd?k2(n,e):n instanceof ud?U2(n,e):t}function O2(n,e){return n instanceof Xm?function(i){return Rv(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}class jm extends T0{}class cd extends T0{constructor(e){super(),this.elements=e}}function k2(n,e){const t=F2(e);for(const i of n.elements)t.some(r=>cs(r,i))||t.push(i);return{arrayValue:{values:t}}}class ud extends T0{constructor(e){super(),this.elements=e}}function U2(n,e){let t=F2(e);for(const i of n.elements)t=t.filter(r=>!cs(r,i));return{arrayValue:{values:t}}}class Xm extends T0{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function X1(n){return yn(n.integerValue||n.doubleValue)}function F2(n){return Tb(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Q6(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof cd&&r instanceof cd||i instanceof ud&&r instanceof ud?Wc(i.elements,r.elements,cs):i instanceof Xm&&r instanceof Xm?cs(i.Ae,r.Ae):i instanceof jm&&r instanceof jm}(n.transform,e.transform)}class e9{constructor(e,t){this.version=e,this.transformResults=t}}class is{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new is}static exists(e){return new is(void 0,e)}static updateTime(e){return new is(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Zp(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class E0{}function V2(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new z2(n.key,is.none()):new Hd(n.key,n.data,is.none());{const t=n.data,i=or.empty();let r=new Pn(Gn.comparator);for(let s of e.fields)if(!r.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?i.delete(s):i.set(s,a),r=r.add(s)}return new xl(n.key,i,new Ar(r.toArray()),is.none())}}function t9(n,e,t){n instanceof Hd?function(r,s,a){const o=r.value.clone(),l=Y1(r.fieldTransforms,s,a.transformResults);o.setAll(l),s.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(n,e,t):n instanceof xl?function(r,s,a){if(!Zp(r.precondition,s))return void s.convertToUnknownDocument(a.version);const o=Y1(r.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(B2(r)),l.setAll(o),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):function(r,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Ah(n,e,t,i){return n instanceof Hd?function(s,a,o,l){if(!Zp(s.precondition,a))return o;const c=s.value.clone(),u=J1(s.fieldTransforms,l,a);return c.setAll(u),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),null}(n,e,t,i):n instanceof xl?function(s,a,o,l){if(!Zp(s.precondition,a))return o;const c=J1(s.fieldTransforms,l,a),u=a.data;return u.setAll(B2(s)),u.setAll(c),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,i):function(s,a,o){return Zp(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(n,e,t)}function n9(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=O2(i.transform,r||null);s!=null&&(t===null&&(t=or.empty()),t.set(i.field,s))}return t||null}function K1(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&Wc(i,r,(s,a)=>Q6(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Hd extends E0{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class xl extends E0{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function B2(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function Y1(n,e,t){const i=new Map;zt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const s=n[r],a=s.transform,o=e.data.field(s.field);i.set(s.field,Z6(a,o,t[r]))}return i}function J1(n,e,t){const i=new Map;for(const r of n){const s=r.transform,a=t.data.field(r.field);i.set(r.field,J6(s,a,e))}return i}class z2 extends E0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class i9 extends E0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r9{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&t9(s,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Ah(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Ah(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=D2();return this.mutations.forEach(r=>{const s=e.get(r.key),a=s.overlayedDocument;let o=this.applyToLocalView(a,s.mutatedFields);o=t.has(r.key)?null:o;const l=V2(a,o);l!==null&&i.set(r.key,l),a.isValidDocument()||a.convertToNoDocument(dt.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),It())}isEqual(e){return this.batchId===e.batchId&&Wc(this.mutations,e.mutations,(t,i)=>K1(t,i))&&Wc(this.baseMutations,e.baseMutations,(t,i)=>K1(t,i))}}class Ib{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){zt(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let r=function(){return q6}();const s=e.mutations;for(let a=0;a<s.length;a++)r=r.insert(s[a].key,i[a].version);return new Ib(e,t,i,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s9{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a9{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sn,Pt;function o9(n){switch(n){case ie.OK:return at(64938);case ie.CANCELLED:case ie.UNKNOWN:case ie.DEADLINE_EXCEEDED:case ie.RESOURCE_EXHAUSTED:case ie.INTERNAL:case ie.UNAVAILABLE:case ie.UNAUTHENTICATED:return!1;case ie.INVALID_ARGUMENT:case ie.NOT_FOUND:case ie.ALREADY_EXISTS:case ie.PERMISSION_DENIED:case ie.FAILED_PRECONDITION:case ie.ABORTED:case ie.OUT_OF_RANGE:case ie.UNIMPLEMENTED:case ie.DATA_LOSS:return!0;default:return at(15467,{code:n})}}function H2(n){if(n===void 0)return zs("GRPC error has no .code"),ie.UNKNOWN;switch(n){case Sn.OK:return ie.OK;case Sn.CANCELLED:return ie.CANCELLED;case Sn.UNKNOWN:return ie.UNKNOWN;case Sn.DEADLINE_EXCEEDED:return ie.DEADLINE_EXCEEDED;case Sn.RESOURCE_EXHAUSTED:return ie.RESOURCE_EXHAUSTED;case Sn.INTERNAL:return ie.INTERNAL;case Sn.UNAVAILABLE:return ie.UNAVAILABLE;case Sn.UNAUTHENTICATED:return ie.UNAUTHENTICATED;case Sn.INVALID_ARGUMENT:return ie.INVALID_ARGUMENT;case Sn.NOT_FOUND:return ie.NOT_FOUND;case Sn.ALREADY_EXISTS:return ie.ALREADY_EXISTS;case Sn.PERMISSION_DENIED:return ie.PERMISSION_DENIED;case Sn.FAILED_PRECONDITION:return ie.FAILED_PRECONDITION;case Sn.ABORTED:return ie.ABORTED;case Sn.OUT_OF_RANGE:return ie.OUT_OF_RANGE;case Sn.UNIMPLEMENTED:return ie.UNIMPLEMENTED;case Sn.DATA_LOSS:return ie.DATA_LOSS;default:return at(39323,{code:n})}}(Pt=Sn||(Sn={}))[Pt.OK=0]="OK",Pt[Pt.CANCELLED=1]="CANCELLED",Pt[Pt.UNKNOWN=2]="UNKNOWN",Pt[Pt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Pt[Pt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Pt[Pt.NOT_FOUND=5]="NOT_FOUND",Pt[Pt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Pt[Pt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Pt[Pt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Pt[Pt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Pt[Pt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Pt[Pt.ABORTED=10]="ABORTED",Pt[Pt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Pt[Pt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Pt[Pt.INTERNAL=13]="INTERNAL",Pt[Pt.UNAVAILABLE=14]="UNAVAILABLE",Pt[Pt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l9(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c9=new Ha([4294967295,4294967295],0);function Z1(n){const e=l9().encode(n),t=new n2;return t.update(e),new Uint8Array(t.digest())}function Q1(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ha([t,i],0),new Ha([r,s],0)]}class Rb{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new sh(`Invalid padding: ${t}`);if(i<0)throw new sh(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new sh(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new sh(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ha.fromNumber(this.ge)}ye(e,t,i){let r=e.add(t.multiply(Ha.fromNumber(i)));return r.compare(c9)===1&&(r=new Ha([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Z1(e),[i,r]=Q1(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(i,r,s);if(!this.we(a))return!1}return!0}static create(e,t,i){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Rb(s,r,t);return i.forEach(o=>a.insert(o)),a}insert(e){if(this.ge===0)return;const t=Z1(e),[i,r]=Q1(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(i,r,s);this.Se(a)}}Se(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class sh extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const r=new Map;return r.set(e,Gd.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new A0(dt.min(),r,new ln(Ct),Hs(),It())}}class Gd{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new Gd(i,t,It(),It(),It())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,t,i,r){this.be=e,this.removedTargetIds=t,this.key=i,this.De=r}}class G2{constructor(e,t){this.targetId=e,this.Ce=t}}class W2{constructor(e,t,i=Xn.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class eA{constructor(){this.ve=0,this.Fe=tA(),this.Me=Xn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=It(),t=It(),i=It();return this.Fe.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:at(38017,{changeType:s})}}),new Gd(this.Me,this.xe,e,t,i)}qe(){this.Oe=!1,this.Fe=tA()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,zt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class u9{constructor(e){this.Ge=e,this.ze=new Map,this.je=Hs(),this.Je=Uf(),this.He=Uf(),this.Ye=new ln(Ct)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const i=this.nt(t);switch(e.state){case 0:this.rt(t)&&i.Le(e.resumeToken);break;case 1:i.Ke(),i.Ne||i.qe(),i.Le(e.resumeToken);break;case 2:i.Ke(),i.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(i.We(),i.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),i.Le(e.resumeToken));break;default:at(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((i,r)=>{this.rt(r)&&t(r)})}st(e){const t=e.targetId,i=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if(Lv(s))if(i===0){const a=new Ze(s.path);this.et(t,a,oi.newNoDocument(a,dt.min()))}else zt(i===1,20013,{expectedCount:i});else{const a=this._t(t);if(a!==i){const o=this.ut(e),l=o?this.ct(o,e,a):1;if(l!==0){this.it(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,c)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t;let a,o;try{a=Ja(i).toUint8Array()}catch(l){if(l instanceof p2)return Gc("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new Rb(a,r,s)}catch(l){return Gc(l instanceof sh?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.ge===0?null:o}ct(e,t,i){return t.Ce.count===i-this.Pt(e,t.targetId)?0:2}Pt(e,t){const i=this.Ge.getRemoteKeysForTarget(t);let r=0;return i.forEach(s=>{const a=this.Ge.ht(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(o)||(this.et(t,s,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((s,a)=>{const o=this.ot(a);if(o){if(s.current&&Lv(o.target)){const l=new Ze(o.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,oi.newNoDocument(l,e))}s.Be&&(t.set(a,s.ke()),s.qe())}});let i=It();this.He.forEach((s,a)=>{let o=!0;a.forEachWhile(l=>{const c=this.ot(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(i=i.add(s))}),this.je.forEach((s,a)=>a.setReadTime(e));const r=new A0(e,t,this.Ye,this.je,i);return this.je=Hs(),this.Je=Uf(),this.He=Uf(),this.Ye=new ln(Ct),r}Xe(e,t){if(!this.rt(e))return;const i=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,i),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,i){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),i&&(this.je=this.je.insert(t,i))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new eA,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Pn(Ct),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Pn(Ct),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ue("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new eA),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Uf(){return new ln(Ze.comparator)}function tA(){return new ln(Ze.comparator)}const h9={asc:"ASCENDING",desc:"DESCENDING"},d9={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},f9={and:"AND",or:"OR"};class p9{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ov(n,e){return n.useProto3Json||v0(e)?e:{value:e}}function Km(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function $2(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function m9(n,e){return Km(n,e.toTimestamp())}function rs(n){return zt(!!n,49232),dt.fromTimestamp(function(t){const i=Ya(t);return new Zt(i.seconds,i.nanos)}(n))}function Pb(n,e){return kv(n,e).canonicalString()}function kv(n,e){const t=function(r){return new Xt(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function q2(n){const e=Xt.fromString(n);return zt(J2(e),10190,{key:e.toString()}),e}function Uv(n,e){return Pb(n.databaseId,e.path)}function d_(n,e){const t=q2(e);if(t.get(1)!==n.databaseId.projectId)throw new Pe(ie.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Pe(ie.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ze(X2(t))}function j2(n,e){return Pb(n.databaseId,e)}function g9(n){const e=q2(n);return e.length===4?Xt.emptyPath():X2(e)}function Fv(n){return new Xt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function X2(n){return zt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function nA(n,e,t){return{name:Uv(n,e),fields:t.value.mapValue.fields}}function y9(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:at(39313,{state:c})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(c,u){return c.useProto3Json?(zt(u===void 0||typeof u=="string",58123),Xn.fromBase64String(u||"")):(zt(u===void 0||u instanceof Buffer||u instanceof Uint8Array,16193),Xn.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(c){const u=c.code===void 0?ie.UNKNOWN:H2(c.code);return new Pe(u,c.message||"")}(a);t=new W2(i,r,s,o||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=d_(n,i.document.name),s=rs(i.document.updateTime),a=i.document.createTime?rs(i.document.createTime):dt.min(),o=new or({mapValue:{fields:i.document.fields}}),l=oi.newFoundDocument(r,s,a,o),c=i.targetIds||[],u=i.removedTargetIds||[];t=new Qp(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=d_(n,i.document),s=i.readTime?rs(i.readTime):dt.min(),a=oi.newNoDocument(r,s),o=i.removedTargetIds||[];t=new Qp([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=d_(n,i.document),s=i.removedTargetIds||[];t=new Qp([],s,r,null)}else{if(!("filter"in e))return at(11601,{Rt:e});{e.filter;const i=e.filter;i.targetId;const{count:r=0,unchangedNames:s}=i,a=new a9(r,s),o=i.targetId;t=new G2(o,a)}}return t}function _9(n,e){let t;if(e instanceof Hd)t={update:nA(n,e.key,e.value)};else if(e instanceof z2)t={delete:Uv(n,e.key)};else if(e instanceof xl)t={update:nA(n,e.key,e.data),updateMask:M9(e.fieldMask)};else{if(!(e instanceof i9))return at(16599,{Vt:e.type});t={verify:Uv(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,a){const o=a.transform;if(o instanceof jm)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof cd)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof ud)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Xm)return{fieldPath:a.field.canonicalString(),increment:o.Ae};throw at(20930,{transform:a.transform})}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:m9(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:at(27497)}(n,e.precondition)),t}function x9(n,e){return n&&n.length>0?(zt(e!==void 0,14353),n.map(t=>function(r,s){let a=r.updateTime?rs(r.updateTime):rs(s);return a.isEqual(dt.min())&&(a=rs(s)),new e9(a,r.transformResults||[])}(t,e))):[]}function v9(n,e){return{documents:[j2(n,e.path)]}}function S9(n,e){const t={structuredQuery:{}},i=e.path;let r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=j2(n,r);const s=function(c){if(c.length!==0)return Y2(Nr.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(c){if(c.length!==0)return c.map(u=>function(d){return{field:sc(d.field),direction:T9(d.dir)}}(u))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const o=Ov(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ft:t,parent:r}}function b9(n){let e=g9(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){zt(i===1,65062);const u=t.from[0];u.allDescendants?r=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=function(h){const d=K2(h);return d instanceof Nr&&T2(d)?d.getFilters():[d]}(t.where));let a=[];t.orderBy&&(a=function(h){return h.map(d=>function(g){return new ld(ac(g.field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(d))}(t.orderBy));let o=null;t.limit&&(o=function(h){let d;return d=typeof h=="object"?h.value:h,v0(d)?null:d}(t.limit));let l=null;t.startAt&&(l=function(h){const d=!!h.before,p=h.values||[];return new qm(p,d)}(t.startAt));let c=null;return t.endAt&&(c=function(h){const d=!h.before,p=h.values||[];return new qm(p,d)}(t.endAt)),z6(e,r,a,s,o,"F",l,c)}function w9(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return at(28987,{purpose:r})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function K2(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=ac(t.unaryFilter.field);return wn.create(i,"==",{doubleValue:NaN});case"IS_NULL":const r=ac(t.unaryFilter.field);return wn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=ac(t.unaryFilter.field);return wn.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=ac(t.unaryFilter.field);return wn.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return at(61313);default:return at(60726)}}(n):n.fieldFilter!==void 0?function(t){return wn.create(ac(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return at(58110);default:return at(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Nr.create(t.compositeFilter.filters.map(i=>K2(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return at(1026)}}(t.compositeFilter.op))}(n):at(30097,{filter:n})}function T9(n){return h9[n]}function E9(n){return d9[n]}function A9(n){return f9[n]}function sc(n){return{fieldPath:n.canonicalString()}}function ac(n){return Gn.fromServerFormat(n.fieldPath)}function Y2(n){return n instanceof wn?function(t){if(t.op==="=="){if(G1(t.value))return{unaryFilter:{field:sc(t.field),op:"IS_NAN"}};if(H1(t.value))return{unaryFilter:{field:sc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(G1(t.value))return{unaryFilter:{field:sc(t.field),op:"IS_NOT_NAN"}};if(H1(t.value))return{unaryFilter:{field:sc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:sc(t.field),op:E9(t.op),value:t.value}}}(n):n instanceof Nr?function(t){const i=t.getFilters().map(r=>Y2(r));return i.length===1?i[0]:{compositeFilter:{op:A9(t.op),filters:i}}}(n):at(54877,{filter:n})}function M9(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function J2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,t,i,r,s=dt.min(),a=dt.min(),o=Xn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new Ma(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ma(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ma(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ma(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C9{constructor(e){this.yt=e}}function I9(n){const e=b9({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Nv(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R9{constructor(){this.Cn=new P9}addToCollectionParentIndex(e,t){return this.Cn.add(t),ae.resolve()}getCollectionParents(e,t){return ae.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ae.resolve()}deleteFieldIndex(e,t){return ae.resolve()}deleteAllFieldIndexes(e){return ae.resolve()}createTargetIndexes(e,t){return ae.resolve()}getDocumentsMatchingTarget(e,t){return ae.resolve(null)}getIndexType(e,t){return ae.resolve(0)}getFieldIndexes(e,t){return ae.resolve([])}getNextCollectionGroupToUpdate(e){return ae.resolve(null)}getMinOffset(e,t){return ae.resolve(Ka.min())}getMinOffsetFromCollectionGroup(e,t){return ae.resolve(Ka.min())}updateCollectionGroup(e,t,i){return ae.resolve()}updateIndexEntries(e,t){return ae.resolve()}}class P9{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new Pn(Xt.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new Pn(Xt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iA={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Z2=41943040;class Mi{static withCacheSize(e){return new Mi(e,Mi.DEFAULT_COLLECTION_PERCENTILE,Mi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Mi.DEFAULT_COLLECTION_PERCENTILE=10,Mi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mi.DEFAULT=new Mi(Z2,Mi.DEFAULT_COLLECTION_PERCENTILE,Mi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mi.DISABLED=new Mi(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new jc(0)}static cr(){return new jc(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rA="LruGarbageCollector",L9=1048576;function sA([n,e],[t,i]){const r=Ct(n,t);return r===0?Ct(e,i):r}class D9{constructor(e){this.Ir=e,this.buffer=new Pn(sA),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();sA(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class N9{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ue(rA,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){du(t)?Ue(rA,"Ignoring IndexedDB error during garbage collection: ",t):await hu(t)}await this.Vr(3e5)})}}class O9{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return ae.resolve(x0.ce);const i=new D9(t);return this.mr.forEachTarget(e,r=>i.Ar(r.sequenceNumber)).next(()=>this.mr.pr(e,r=>i.Ar(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.mr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ue("LruGarbageCollector","Garbage collection skipped; disabled"),ae.resolve(iA)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(Ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),iA):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let i,r,s,a,o,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(Ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,a=Date.now(),this.nthSequenceNumber(e,r))).next(h=>(i=h,o=Date.now(),this.removeTargets(e,i,t))).next(h=>(s=h,l=Date.now(),this.removeOrphanedDocuments(e,i))).next(h=>(c=Date.now(),ic()<=Mt.DEBUG&&Ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${r} in `+(o-a)+`ms
	Removed ${s} targets in `+(l-o)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),ae.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:h})))}}function k9(n,e){return new O9(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U9{constructor(){this.changes=new _l(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,oi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?ae.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F9{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V9{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&Ah(i.mutation,r,Ar.empty(),Zt.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,It()).next(()=>i))}getLocalViewOfDocuments(e,t,i=It()){const r=Vo();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let a=rh();return s.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const i=Vo();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,It()))}populateOverlays(e,t,i){const r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,i,r){let s=Hs();const a=Eh(),o=function(){return Eh()}();return t.forEach((l,c)=>{const u=i.get(c.key);r.has(c.key)&&(u===void 0||u.mutation instanceof xl)?s=s.insert(c.key,c):u!==void 0?(a.set(c.key,u.mutation.getFieldMask()),Ah(u.mutation,c,u.mutation.getFieldMask(),Zt.now())):a.set(c.key,Ar.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>a.set(c,u)),t.forEach((c,u)=>o.set(c,new F9(u,a.get(c)??null))),o))}recalculateAndSaveOverlays(e,t){const i=Eh();let r=new ln((a,o)=>a-o),s=It();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const o of a)o.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let u=i.get(l)||Ar.empty();u=o.applyToLocalView(c,u),i.set(l,u);const h=(r.get(o.batchId)||It()).add(l);r=r.insert(o.batchId,h)})}).next(()=>{const a=[],o=r.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),c=l.key,u=l.value,h=D2();u.forEach(d=>{if(!s.has(d)){const p=V2(t.get(d),i.get(d));p!==null&&h.set(d,p),s=s.add(d)}}),a.push(this.documentOverlayCache.saveOverlays(e,c,h))}return ae.waitFor(a)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return function(a){return Ze.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):C2(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{const a=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):ae.resolve(Vo());let o=rd,l=s;return a.next(c=>ae.forEach(c,(u,h)=>(o<h.largestBatchId&&(o=h.largestBatchId),s.get(u)?ae.resolve():this.remoteDocumentCache.getEntry(e,u).next(d=>{l=l.insert(u,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,It())).next(u=>({batchId:o,changes:L2(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ze(t)).next(i=>{let r=rh();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){const s=t.collectionGroup;let a=rh();return this.indexManager.getCollectionParents(e,s).next(o=>ae.forEach(o,l=>{const c=function(h,d){return new fu(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,i,r).next(u=>{u.forEach((h,d)=>{a=a.insert(h,d)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(a=>{s.forEach((l,c)=>{const u=c.getKey();a.get(u)===null&&(a=a.insert(u,oi.newInvalidDocument(u)))});let o=rh();return a.forEach((l,c)=>{const u=s.get(l);u!==void 0&&Ah(u.mutation,c,Ar.empty(),Zt.now()),w0(t,c)&&(o=o.insert(l,c))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B9{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ae.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:rs(r.createTime)}}(t)),ae.resolve()}getNamedQuery(e,t){return ae.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(r){return{name:r.name,query:I9(r.bundledQuery),readTime:rs(r.readTime)}}(t)),ae.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z9{constructor(){this.overlays=new ln(Ze.comparator),this.qr=new Map}getOverlay(e,t){return ae.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Vo();return ae.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.St(e,t,s)}),ae.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.qr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.qr.delete(i)),ae.resolve()}getOverlaysForCollection(e,t,i){const r=Vo(),s=t.length+1,a=new Ze(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const l=o.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&l.largestBatchId>i&&r.set(l.getKey(),l)}return ae.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new ln((c,u)=>c-u);const a=this.overlays.getIterator();for(;a.hasNext();){const c=a.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>i){let u=s.get(c.largestBatchId);u===null&&(u=Vo(),s=s.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const o=Vo(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>o.set(c,u)),!(o.size()>=r)););return ae.resolve(o)}St(e,t,i){const r=this.overlays.get(i.key);if(r!==null){const a=this.qr.get(r.largestBatchId).delete(i.key);this.qr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(i.key,new s9(t,i));let s=this.qr.get(t);s===void 0&&(s=It(),this.qr.set(t,s)),this.qr.set(t,s.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H9{constructor(){this.sessionToken=Xn.EMPTY_BYTE_STRING}getSessionToken(e){return ae.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ae.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb{constructor(){this.Qr=new Pn(Un.$r),this.Ur=new Pn(Un.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const i=new Un(e,t);this.Qr=this.Qr.add(i),this.Ur=this.Ur.add(i)}Wr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.Gr(new Un(e,t))}zr(e,t){e.forEach(i=>this.removeReference(i,t))}jr(e){const t=new Ze(new Xt([])),i=new Un(t,e),r=new Un(t,e+1),s=[];return this.Ur.forEachInRange([i,r],a=>{this.Gr(a),s.push(a.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Ze(new Xt([])),i=new Un(t,e),r=new Un(t,e+1);let s=It();return this.Ur.forEachInRange([i,r],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Un(e,0),i=this.Qr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Un{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Ze.comparator(e.key,t.key)||Ct(e.Yr,t.Yr)}static Kr(e,t){return Ct(e.Yr,t.Yr)||Ze.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G9{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Pn(Un.$r)}checkEmpty(e){return ae.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new r9(s,t,i,r);this.mutationQueue.push(a);for(const o of r)this.Zr=this.Zr.add(new Un(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return ae.resolve(a)}lookupMutationBatch(e,t){return ae.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=this.ei(i),s=r<0?0:r;return ae.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ae.resolve(this.mutationQueue.length===0?bb:this.tr-1)}getAllMutationBatches(e){return ae.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Un(t,0),r=new Un(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([i,r],a=>{const o=this.Xr(a.Yr);s.push(o)}),ae.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Pn(Ct);return t.forEach(r=>{const s=new Un(r,0),a=new Un(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,a],o=>{i=i.add(o.Yr)})}),ae.resolve(this.ti(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;Ze.isDocumentKey(s)||(s=s.child(""));const a=new Un(new Ze(s),0);let o=new Pn(Ct);return this.Zr.forEachWhile(l=>{const c=l.key.path;return!!i.isPrefixOf(c)&&(c.length===r&&(o=o.add(l.Yr)),!0)},a),ae.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(i=>{const r=this.Xr(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){zt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Zr;return ae.forEach(t.mutations,r=>{const s=new Un(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=i})}ir(e){}containsKey(e,t){const i=new Un(t,0),r=this.Zr.firstAfterOrEqual(i);return ae.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ae.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W9{constructor(e){this.ri=e,this.docs=function(){return new ln(Ze.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,a=this.ri(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return ae.resolve(i?i.document.mutableCopy():oi.newInvalidDocument(t))}getEntries(e,t){let i=Hs();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():oi.newInvalidDocument(r))}),ae.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=Hs();const a=t.path,o=new Ze(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:c,value:{document:u}}=l.getNext();if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||x6(_6(u),i)<=0||(r.has(u.key)||w0(t,u))&&(s=s.insert(u.key,u.mutableCopy()))}return ae.resolve(s)}getAllFromCollectionGroup(e,t,i,r){at(9500)}ii(e,t){return ae.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new $9(this)}getSize(e){return ae.resolve(this.size)}}class $9 extends U9{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(i)}),ae.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q9{constructor(e){this.persistence=e,this.si=new _l(t=>Eb(t),Ab),this.lastRemoteSnapshotVersion=dt.min(),this.highestTargetId=0,this.oi=0,this._i=new Lb,this.targetCount=0,this.ai=jc.ur()}forEachTarget(e,t){return this.si.forEach((i,r)=>t(r)),ae.resolve()}getLastRemoteSnapshotVersion(e){return ae.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ae.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ae.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.oi&&(this.oi=t),ae.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new jc(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ae.resolve()}updateTargetData(e,t){return this.Pr(t),ae.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ae.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.si.forEach((a,o)=>{o.sequenceNumber<=t&&i.get(o.targetId)===null&&(this.si.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),ae.waitFor(s).next(()=>r)}getTargetCount(e){return ae.resolve(this.targetCount)}getTargetData(e,t){const i=this.si.get(t)||null;return ae.resolve(i)}addMatchingKeys(e,t,i){return this._i.Wr(t,i),ae.resolve()}removeMatchingKeys(e,t,i){this._i.zr(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(a=>{s.push(r.markPotentiallyOrphaned(e,a))}),ae.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ae.resolve()}getMatchingKeysForTargetId(e,t){const i=this._i.Hr(t);return ae.resolve(i)}containsKey(e,t){return ae.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(e,t){this.ui={},this.overlays={},this.ci=new x0(0),this.li=!1,this.li=!0,this.hi=new H9,this.referenceDelegate=e(this),this.Pi=new q9(this),this.indexManager=new R9,this.remoteDocumentCache=function(r){return new W9(r)}(i=>this.referenceDelegate.Ti(i)),this.serializer=new C9(t),this.Ii=new B9(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new z9,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ui[e.toKey()];return i||(i=new G9(t,this.referenceDelegate),this.ui[e.toKey()]=i),i}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,i){Ue("MemoryPersistence","Starting transaction:",e);const r=new j9(this.ci.next());return this.referenceDelegate.Ei(),i(r).next(s=>this.referenceDelegate.di(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ai(e,t){return ae.or(Object.values(this.ui).map(i=>()=>i.containsKey(e,t)))}}class j9 extends S6{constructor(e){super(),this.currentSequenceNumber=e}}class Db{constructor(e){this.persistence=e,this.Ri=new Lb,this.Vi=null}static mi(e){return new Db(e)}get fi(){if(this.Vi)return this.Vi;throw at(60996)}addReference(e,t,i){return this.Ri.addReference(i,t),this.fi.delete(i.toString()),ae.resolve()}removeReference(e,t,i){return this.Ri.removeReference(i,t),this.fi.add(i.toString()),ae.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ae.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(r=>this.fi.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.fi.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ae.forEach(this.fi,i=>{const r=Ze.fromPath(i);return this.gi(e,r).next(s=>{s||t.removeEntry(r,dt.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(i=>{i?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return ae.or([()=>ae.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Ym{constructor(e,t){this.persistence=e,this.pi=new _l(i=>T6(i.path),(i,r)=>i.isEqual(r)),this.garbageCollector=k9(this,t)}static mi(e,t){return new Ym(e,t)}Ei(){}di(e){return ae.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}wr(e){let t=0;return this.pr(e,i=>{t++}).next(()=>t)}pr(e,t){return ae.forEach(this.pi,(i,r)=>this.br(e,i,r).next(s=>s?ae.resolve():t(r)))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ii(e,a=>this.br(e,a,t).next(o=>{o||(i++,s.removeEntry(a,dt.min()))})).next(()=>s.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ae.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),ae.resolve()}removeReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),ae.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ae.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Yp(e.data.value)),t}br(e,t,i){return ae.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return ae.resolve(r!==void 0&&r>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nb{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Es=i,this.ds=r}static As(e,t){let i=It(),r=It();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Nb(e,t.fromCache,i,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X9{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K9{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return MV()?8:b6(hi())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,i,r){const s={result:null};return this.ys(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ws(e,t,r,i).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new X9;return this.Ss(e,t,a).next(o=>{if(s.result=o,this.Vs)return this.bs(e,t,a,o.size)})}).next(()=>s.result)}bs(e,t,i,r){return i.documentReadCount<this.fs?(ic()<=Mt.DEBUG&&Ue("QueryEngine","SDK will not create cache indexes for query:",rc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ae.resolve()):(ic()<=Mt.DEBUG&&Ue("QueryEngine","Query:",rc(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.gs*r?(ic()<=Mt.DEBUG&&Ue("QueryEngine","The SDK decides to create cache indexes for query:",rc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ns(t))):ae.resolve())}ys(e,t){if(j1(t))return ae.resolve(null);let i=ns(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Nv(t,null,"F"),i=ns(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const a=It(...s);return this.ps.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,i).next(l=>{const c=this.Ds(t,o);return this.Cs(t,c,a,l.readTime)?this.ys(e,Nv(t,null,"F")):this.vs(e,c,t,l)}))})))}ws(e,t,i,r){return j1(t)||r.isEqual(dt.min())?ae.resolve(null):this.ps.getDocuments(e,i).next(s=>{const a=this.Ds(t,s);return this.Cs(t,a,i,r)?ae.resolve(null):(ic()<=Mt.DEBUG&&Ue("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),rc(t)),this.vs(e,a,t,y6(r,rd)).next(o=>o))})}Ds(e,t){let i=new Pn(R2(e));return t.forEach((r,s)=>{w0(e,s)&&(i=i.add(s))}),i}Cs(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ss(e,t,i){return ic()<=Mt.DEBUG&&Ue("QueryEngine","Using full collection scan to execute query:",rc(t)),this.ps.getDocumentsMatchingQuery(e,t,Ka.min(),i)}vs(e,t,i,r){return this.ps.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ob="LocalStore",Y9=3e8;class J9{constructor(e,t,i,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new ln(Ct),this.xs=new _l(s=>Eb(s),Ab),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(i)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new V9(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Z9(n,e,t,i){return new J9(n,e,t,i)}async function e3(n,e){const t=mt(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{const a=[],o=[];let l=It();for(const c of r){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of s){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return t.localDocuments.getDocuments(i,l).next(c=>({Ls:c,removedBatchIds:a,addedBatchIds:o}))})})}function Q9(n,e){const t=mt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return function(o,l,c,u){const h=c.batch,d=h.keys();let p=ae.resolve();return d.forEach(g=>{p=p.next(()=>u.getEntry(l,g)).next(_=>{const y=c.docVersions.get(g);zt(y!==null,48541),_.version.compareTo(y)<0&&(h.applyToRemoteDocument(_,c),_.isValidDocument()&&(_.setReadTime(c.commitVersion),u.addEntry(_)))})}),p.next(()=>o.mutationQueue.removeMutationBatch(l,h))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(o){let l=It();for(let c=0;c<o.mutationResults.length;++c)o.mutationResults[c].transformResults.length>0&&(l=l.add(o.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function t3(n){const e=mt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function e8(n,e){const t=mt(n),i=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const o=[];e.targetChanges.forEach((u,h)=>{const d=r.get(h);if(!d)return;o.push(t.Pi.removeMatchingKeys(s,u.removedDocuments,h).next(()=>t.Pi.addMatchingKeys(s,u.addedDocuments,h)));let p=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?p=p.withResumeToken(Xn.EMPTY_BYTE_STRING,dt.min()).withLastLimboFreeSnapshotVersion(dt.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,i)),r=r.insert(h,p),function(_,y,m){return _.resumeToken.approximateByteSize()===0||y.snapshotVersion.toMicroseconds()-_.snapshotVersion.toMicroseconds()>=Y9?!0:m.addedDocuments.size+m.modifiedDocuments.size+m.removedDocuments.size>0}(d,p,u)&&o.push(t.Pi.updateTargetData(s,p))});let l=Hs(),c=It();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),o.push(t8(s,a,e.documentUpdates).next(u=>{l=u.ks,c=u.qs})),!i.isEqual(dt.min())){const u=t.Pi.getLastRemoteSnapshotVersion(s).next(h=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,i));o.push(u)}return ae.waitFor(o).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.Ms=r,s))}function t8(n,e,t){let i=It(),r=It();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let a=Hs();return t.forEach((o,l)=>{const c=s.get(o);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(o)),l.isNoDocument()&&l.version.isEqual(dt.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):Ue(Ob,"Ignoring outdated watch update for ",o,". Current version:",c.version," Watch version:",l.version)}),{ks:a,qs:r}})}function n8(n,e){const t=mt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=bb),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function i8(n,e){const t=mt(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Pi.getTargetData(i,e).next(s=>s?(r=s,ae.resolve(r)):t.Pi.allocateTargetId(i).next(a=>(r=new Ma(e,a,"TargetPurposeListen",i.currentSequenceNumber),t.Pi.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.Ms.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(i.targetId,i),t.xs.set(e,i.targetId)),i})}async function Vv(n,e,t){const i=mt(n),r=i.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",s,a=>i.persistence.referenceDelegate.removeTarget(a,r))}catch(a){if(!du(a))throw a;Ue(Ob,`Failed to update sequence numbers for target ${e}: ${a}`)}i.Ms=i.Ms.remove(e),i.xs.delete(r.target)}function aA(n,e,t){const i=mt(n);let r=dt.min(),s=It();return i.persistence.runTransaction("Execute query","readwrite",a=>function(l,c,u){const h=mt(l),d=h.xs.get(u);return d!==void 0?ae.resolve(h.Ms.get(d)):h.Pi.getTargetData(c,u)}(i,a,ns(e)).next(o=>{if(o)return r=o.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(a,o.targetId).next(l=>{s=l})}).next(()=>i.Fs.getDocumentsMatchingQuery(a,e,t?r:dt.min(),t?s:It())).next(o=>(r8(i,G6(e),o),{documents:o,Qs:s})))}function r8(n,e,t){let i=n.Os.get(e)||dt.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.Os.set(e,i)}class oA{constructor(){this.activeTargetIds=K6()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class s8{constructor(){this.Mo=new oA,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,i){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new oA,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a8{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lA="ConnectivityMonitor";class cA{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ue(lA,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ue(lA,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ff=null;function Bv(){return Ff===null?Ff=function(){return 268435456+Math.round(2147483648*Math.random())}():Ff++,"0x"+Ff.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f_="RestConnection",o8={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class l8{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${i}/databases/${r}`,this.Wo=this.databaseId.database===Wm?`project_id=${i}`:`project_id=${i}&database_id=${r}`}Go(e,t,i,r,s){const a=Bv(),o=this.zo(e,t.toUriEncodedString());Ue(f_,`Sending RPC '${e}' ${a}:`,o,i);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,s);const{host:c}=new URL(o),u=lo(c);return this.Jo(e,o,l,i,u).then(h=>(Ue(f_,`Received RPC '${e}' ${a}: `,h),h),h=>{throw Gc(f_,`RPC '${e}' ${a} failed with error: `,h,"url: ",o,"request:",i),h})}Ho(e,t,i,r,s,a){return this.Go(e,t,i,r,s)}jo(e,t,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+uu}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}zo(e,t){const i=o8[e];return`${this.Uo}/v1/${t}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c8{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qn="WebChannelConnection";class u8 extends l8{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,i,r,s){const a=Bv();return new Promise((o,l)=>{const c=new i2;c.setWithCredentials(!0),c.listenOnce(r2.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Kp.NO_ERROR:const h=c.getResponseJson();Ue(Qn,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(h)),o(h);break;case Kp.TIMEOUT:Ue(Qn,`RPC '${e}' ${a} timed out`),l(new Pe(ie.DEADLINE_EXCEEDED,"Request time out"));break;case Kp.HTTP_ERROR:const d=c.getStatus();if(Ue(Qn,`RPC '${e}' ${a} failed with status:`,d,"response text:",c.getResponseText()),d>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);const g=p==null?void 0:p.error;if(g&&g.status&&g.message){const _=function(m){const x=m.toLowerCase().replace(/_/g,"-");return Object.values(ie).indexOf(x)>=0?x:ie.UNKNOWN}(g.status);l(new Pe(_,g.message))}else l(new Pe(ie.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new Pe(ie.UNAVAILABLE,"Connection failed."));break;default:at(9055,{l_:e,streamId:a,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{Ue(Qn,`RPC '${e}' ${a} completed.`)}});const u=JSON.stringify(r);Ue(Qn,`RPC '${e}' ${a} sending request:`,r),c.send(t,"POST",u,i,15)})}T_(e,t,i){const r=Bv(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=o2(),o=a2(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,i),l.encodeInitMessageHeaders=!0;const u=s.join("");Ue(Qn,`Creating RPC '${e}' stream ${r}: ${u}`,l);const h=a.createWebChannel(u,l);this.I_(h);let d=!1,p=!1;const g=new c8({Yo:y=>{p?Ue(Qn,`Not sending because RPC '${e}' stream ${r} is closed:`,y):(d||(Ue(Qn,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),Ue(Qn,`RPC '${e}' stream ${r} sending:`,y),h.send(y))},Zo:()=>h.close()}),_=(y,m,x)=>{y.listen(m,v=>{try{x(v)}catch(T){setTimeout(()=>{throw T},0)}})};return _(h,ih.EventType.OPEN,()=>{p||(Ue(Qn,`RPC '${e}' stream ${r} transport opened.`),g.o_())}),_(h,ih.EventType.CLOSE,()=>{p||(p=!0,Ue(Qn,`RPC '${e}' stream ${r} transport closed`),g.a_(),this.E_(h))}),_(h,ih.EventType.ERROR,y=>{p||(p=!0,Gc(Qn,`RPC '${e}' stream ${r} transport errored. Name:`,y.name,"Message:",y.message),g.a_(new Pe(ie.UNAVAILABLE,"The operation could not be completed")))}),_(h,ih.EventType.MESSAGE,y=>{var m;if(!p){const x=y.data[0];zt(!!x,16349);const v=x,T=(v==null?void 0:v.error)||((m=v[0])==null?void 0:m.error);if(T){Ue(Qn,`RPC '${e}' stream ${r} received error:`,T);const R=T.status;let C=function(b){const S=Sn[b];if(S!==void 0)return H2(S)}(R),A=T.message;C===void 0&&(C=ie.INTERNAL,A="Unknown error status: "+R+" with message "+T.message),p=!0,g.a_(new Pe(C,A)),h.close()}else Ue(Qn,`RPC '${e}' stream ${r} received:`,x),g.u_(x)}}),_(o,s2.STAT_EVENT,y=>{y.stat===Mv.PROXY?Ue(Qn,`RPC '${e}' stream ${r} detected buffering proxy`):y.stat===Mv.NOPROXY&&Ue(Qn,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{g.__()},0),g}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function p_(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M0(n){return new p9(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=i,this.A_=r,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-i);r>0&&Ue("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uA="PersistentStream";class i3{constructor(e,t,i,r,s,a,o,l){this.Mi=e,this.S_=i,this.b_=r,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new n3(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ie.RESOURCE_EXHAUSTED?(zs(t.toString()),zs("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ie.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.D_===t&&this.G_(i,r)},i=>{e(()=>{const r=new Pe(ie.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(r)})})}G_(e,t){const i=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{i(()=>this.listener.Xo())}),this.stream.t_(()=>{i(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(r=>{i(()=>this.z_(r))}),this.stream.onMessage(r=>{i(()=>++this.F_==1?this.J_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Ue(uA,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(Ue(uA,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class h8 extends i3{constructor(e,t,i,r,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,a),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=y9(this.serializer,e),i=function(s){if(!("targetChange"in s))return dt.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?dt.min():a.readTime?rs(a.readTime):dt.min()}(e);return this.listener.H_(t,i)}Y_(e){const t={};t.database=Fv(this.serializer),t.addTarget=function(s,a){let o;const l=a.target;if(o=Lv(l)?{documents:v9(s,l)}:{query:S9(s,l).ft},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=$2(s,a.resumeToken);const c=Ov(s,a.expectedCount);c!==null&&(o.expectedCount=c)}else if(a.snapshotVersion.compareTo(dt.min())>0){o.readTime=Km(s,a.snapshotVersion.toTimestamp());const c=Ov(s,a.expectedCount);c!==null&&(o.expectedCount=c)}return o}(this.serializer,e);const i=w9(this.serializer,e);i&&(t.labels=i),this.q_(t)}Z_(e){const t={};t.database=Fv(this.serializer),t.removeTarget=e,this.q_(t)}}class d8 extends i3{constructor(e,t,i,r,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,a),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return zt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,zt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){zt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=x9(e.writeResults,e.commitTime),i=rs(e.commitTime);return this.listener.na(i,t)}ra(){const e={};e.database=Fv(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>_9(this.serializer,i))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f8{}class p8 extends f8{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new Pe(ie.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Go(e,kv(t,i),r,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Pe(ie.UNKNOWN,s.toString())})}Ho(e,t,i,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Ho(e,kv(t,i),r,a,o,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Pe(ie.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class m8{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(zs(t),this.aa=!1):Ue("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ol="RemoteStore";class g8{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(a=>{i.enqueueAndForget(async()=>{vl(this)&&(Ue(ol,"Restarting streams for network reachability change."),await async function(l){const c=mt(l);c.Ea.add(4),await Wd(c),c.Ra.set("Unknown"),c.Ea.delete(4),await C0(c)}(this))})}),this.Ra=new m8(i,r)}}async function C0(n){if(vl(n))for(const e of n.da)await e(!0)}async function Wd(n){for(const e of n.da)await e(!1)}function r3(n,e){const t=mt(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Vb(t)?Fb(t):pu(t).O_()&&Ub(t,e))}function kb(n,e){const t=mt(n),i=pu(t);t.Ia.delete(e),i.O_()&&s3(t,e),t.Ia.size===0&&(i.O_()?i.L_():vl(t)&&t.Ra.set("Unknown"))}function Ub(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(dt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}pu(n).Y_(e)}function s3(n,e){n.Va.Ue(e),pu(n).Z_(e)}function Fb(n){n.Va=new u9({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),pu(n).start(),n.Ra.ua()}function Vb(n){return vl(n)&&!pu(n).x_()&&n.Ia.size>0}function vl(n){return mt(n).Ea.size===0}function a3(n){n.Va=void 0}async function y8(n){n.Ra.set("Online")}async function _8(n){n.Ia.forEach((e,t)=>{Ub(n,e)})}async function x8(n,e){a3(n),Vb(n)?(n.Ra.ha(e),Fb(n)):n.Ra.set("Unknown")}async function v8(n,e,t){if(n.Ra.set("Online"),e instanceof W2&&e.state===2&&e.cause)try{await async function(r,s){const a=s.cause;for(const o of s.targetIds)r.Ia.has(o)&&(await r.remoteSyncer.rejectListen(o,a),r.Ia.delete(o),r.Va.removeTarget(o))}(n,e)}catch(i){Ue(ol,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Jm(n,i)}else if(e instanceof Qp?n.Va.Ze(e):e instanceof G2?n.Va.st(e):n.Va.tt(e),!t.isEqual(dt.min()))try{const i=await t3(n.localStore);t.compareTo(i)>=0&&await function(s,a){const o=s.Va.Tt(a);return o.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const u=s.Ia.get(c);u&&s.Ia.set(c,u.withResumeToken(l.resumeToken,a))}}),o.targetMismatches.forEach((l,c)=>{const u=s.Ia.get(l);if(!u)return;s.Ia.set(l,u.withResumeToken(Xn.EMPTY_BYTE_STRING,u.snapshotVersion)),s3(s,l);const h=new Ma(u.target,l,c,u.sequenceNumber);Ub(s,h)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t)}catch(i){Ue(ol,"Failed to raise snapshot:",i),await Jm(n,i)}}async function Jm(n,e,t){if(!du(e))throw e;n.Ea.add(1),await Wd(n),n.Ra.set("Offline"),t||(t=()=>t3(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Ue(ol,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await C0(n)})}function o3(n,e){return e().catch(t=>Jm(n,t,e))}async function I0(n){const e=mt(n),t=Qa(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:bb;for(;S8(e);)try{const r=await n8(e.localStore,i);if(r===null){e.Ta.length===0&&t.L_();break}i=r.batchId,b8(e,r)}catch(r){await Jm(e,r)}l3(e)&&c3(e)}function S8(n){return vl(n)&&n.Ta.length<10}function b8(n,e){n.Ta.push(e);const t=Qa(n);t.O_()&&t.X_&&t.ea(e.mutations)}function l3(n){return vl(n)&&!Qa(n).x_()&&n.Ta.length>0}function c3(n){Qa(n).start()}async function w8(n){Qa(n).ra()}async function T8(n){const e=Qa(n);for(const t of n.Ta)e.ea(t.mutations)}async function E8(n,e,t){const i=n.Ta.shift(),r=Ib.from(i,e,t);await o3(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await I0(n)}async function A8(n,e){e&&Qa(n).X_&&await async function(i,r){if(function(a){return o9(a)&&a!==ie.ABORTED}(r.code)){const s=i.Ta.shift();Qa(i).B_(),await o3(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),await I0(i)}}(n,e),l3(n)&&c3(n)}async function hA(n,e){const t=mt(n);t.asyncQueue.verifyOperationInProgress(),Ue(ol,"RemoteStore received new credentials");const i=vl(t);t.Ea.add(3),await Wd(t),i&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await C0(t)}async function M8(n,e){const t=mt(n);e?(t.Ea.delete(2),await C0(t)):e||(t.Ea.add(2),await Wd(t),t.Ra.set("Unknown"))}function pu(n){return n.ma||(n.ma=function(t,i,r){const s=mt(t);return s.sa(),new h8(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Xo:y8.bind(null,n),t_:_8.bind(null,n),r_:x8.bind(null,n),H_:v8.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),Vb(n)?Fb(n):n.Ra.set("Unknown")):(await n.ma.stop(),a3(n))})),n.ma}function Qa(n){return n.fa||(n.fa=function(t,i,r){const s=mt(t);return s.sa(),new d8(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:w8.bind(null,n),r_:A8.bind(null,n),ta:T8.bind(null,n),na:E8.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await I0(n)):(await n.fa.stop(),n.Ta.length>0&&(Ue(ol,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new Ps,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){const a=Date.now()+i,o=new Bb(e,t,a,r,s);return o.start(i),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Pe(ie.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zb(n,e){if(zs("AsyncQueue",`${e}: ${n}`),du(n))return new Pe(ie.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc{static emptySet(e){return new Pc(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||Ze.comparator(t.key,i.key):(t,i)=>Ze.comparator(t.key,i.key),this.keyedMap=rh(),this.sortedSet=new ln(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Pc)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new Pc;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(){this.ga=new ln(Ze.comparator)}track(e){const t=e.doc.key,i=this.ga.get(t);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(t,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(t):e.type===1&&i.type===2?this.ga=this.ga.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):at(63341,{Rt:e,pa:i}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,i)=>{e.push(i)}),e}}class Xc{constructor(e,t,i,r,s,a,o,l,c){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,i,r,s){const a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new Xc(e,t,Pc.emptySet(t),a,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&b0(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C8{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class I8{constructor(){this.queries=fA(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,i){const r=mt(t),s=r.queries;r.queries=fA(),s.forEach((a,o)=>{for(const l of o.Sa)l.onError(i)})})(this,new Pe(ie.ABORTED,"Firestore shutting down"))}}function fA(){return new _l(n=>I2(n),b0)}async function u3(n,e){const t=mt(n);let i=3;const r=e.query;let s=t.queries.get(r);s?!s.ba()&&e.Da()&&(i=2):(s=new C8,i=e.Da()?0:1);try{switch(i){case 0:s.wa=await t.onListen(r,!0);break;case 1:s.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const o=zb(a,`Initialization of query '${rc(e.query)}' failed`);return void e.onError(o)}t.queries.set(r,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&Hb(t)}async function h3(n,e){const t=mt(n),i=e.query;let r=3;const s=t.queries.get(i);if(s){const a=s.Sa.indexOf(e);a>=0&&(s.Sa.splice(a,1),s.Sa.length===0?r=e.Da()?0:1:!s.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function R8(n,e){const t=mt(n);let i=!1;for(const r of e){const s=r.query,a=t.queries.get(s);if(a){for(const o of a.Sa)o.Fa(r)&&(i=!0);a.wa=r}}i&&Hb(t)}function P8(n,e,t){const i=mt(n),r=i.queries.get(e);if(r)for(const s of r.Sa)s.onError(t);i.queries.delete(e)}function Hb(n){n.Ca.forEach(e=>{e.next()})}var zv,pA;(pA=zv||(zv={})).Ma="default",pA.Cache="cache";class d3{constructor(e,t,i){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)r.type!==3&&i.push(r);e=new Xc(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const i=t!=="Offline";return(!this.options.qa||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Xc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==zv.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f3{constructor(e){this.key=e}}class p3{constructor(e){this.key=e}}class L8{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=It(),this.mutatedKeys=It(),this.eu=R2(e),this.tu=new Pc(this.eu)}get nu(){return this.Ya}ru(e,t){const i=t?t.iu:new dA,r=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((u,h)=>{const d=r.get(u),p=w0(this.query,h)?h:null,g=!!d&&this.mutatedKeys.has(d.key),_=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let y=!1;d&&p?d.data.isEqual(p.data)?g!==_&&(i.track({type:3,doc:p}),y=!0):this.su(d,p)||(i.track({type:2,doc:p}),y=!0,(l&&this.eu(p,l)>0||c&&this.eu(p,c)<0)&&(o=!0)):!d&&p?(i.track({type:0,doc:p}),y=!0):d&&!p&&(i.track({type:1,doc:d}),y=!0,(l||c)&&(o=!0)),y&&(p?(a=a.add(p),s=_?s.add(u):s.delete(u)):(a=a.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const u=this.query.limitType==="F"?a.last():a.first();a=a.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{tu:a,iu:i,Cs:o,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((u,h)=>function(p,g){const _=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return at(20277,{Rt:y})}};return _(p)-_(g)}(u.type,h.type)||this.eu(u.doc,h.doc)),this.ou(i),r=r??!1;const o=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,c=l!==this.Za;return this.Za=l,a.length!==0||c?{snapshot:new Xc(this.query,e.tu,s,a,e.mutatedKeys,l===0,c,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new dA,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=It(),this.tu.forEach(i=>{this.uu(i.key)&&(this.Xa=this.Xa.add(i.key))});const t=[];return e.forEach(i=>{this.Xa.has(i)||t.push(new p3(i))}),this.Xa.forEach(i=>{e.has(i)||t.push(new f3(i))}),t}cu(e){this.Ya=e.Qs,this.Xa=It();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Xc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Gb="SyncEngine";class D8{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class N8{constructor(e){this.key=e,this.hu=!1}}class O8{constructor(e,t,i,r,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new _l(o=>I2(o),b0),this.Iu=new Map,this.Eu=new Set,this.du=new ln(Ze.comparator),this.Au=new Map,this.Ru=new Lb,this.Vu={},this.mu=new Map,this.fu=jc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function k8(n,e,t=!0){const i=v3(n);let r;const s=i.Tu.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await m3(i,e,t,!0),r}async function U8(n,e){const t=v3(n);await m3(t,e,!0,!1)}async function m3(n,e,t,i){const r=await i8(n.localStore,ns(e)),s=r.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t);let o;return i&&(o=await F8(n,e,s,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&r3(n.remoteStore,r),o}async function F8(n,e,t,i,r){n.pu=(h,d,p)=>async function(_,y,m,x){let v=y.view.ru(m);v.Cs&&(v=await aA(_.localStore,y.query,!1).then(({documents:A})=>y.view.ru(A,v)));const T=x&&x.targetChanges.get(y.targetId),R=x&&x.targetMismatches.get(y.targetId)!=null,C=y.view.applyChanges(v,_.isPrimaryClient,T,R);return gA(_,y.targetId,C.au),C.snapshot}(n,h,d,p);const s=await aA(n.localStore,e,!0),a=new L8(e,s.Qs),o=a.ru(s.documents),l=Gd.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),c=a.applyChanges(o,n.isPrimaryClient,l);gA(n,t,c.au);const u=new D8(e,t,a);return n.Tu.set(e,u),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),c.snapshot}async function V8(n,e,t){const i=mt(n),r=i.Tu.get(e),s=i.Iu.get(r.targetId);if(s.length>1)return i.Iu.set(r.targetId,s.filter(a=>!b0(a,e))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await Vv(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&kb(i.remoteStore,r.targetId),Hv(i,r.targetId)}).catch(hu)):(Hv(i,r.targetId),await Vv(i.localStore,r.targetId,!0))}async function B8(n,e){const t=mt(n),i=t.Tu.get(e),r=t.Iu.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),kb(t.remoteStore,i.targetId))}async function z8(n,e,t){const i=X8(n);try{const r=await function(a,o){const l=mt(a),c=Zt.now(),u=o.reduce((p,g)=>p.add(g.key),It());let h,d;return l.persistence.runTransaction("Locally write mutations","readwrite",p=>{let g=Hs(),_=It();return l.Ns.getEntries(p,u).next(y=>{g=y,g.forEach((m,x)=>{x.isValidDocument()||(_=_.add(m))})}).next(()=>l.localDocuments.getOverlayedDocuments(p,g)).next(y=>{h=y;const m=[];for(const x of o){const v=n9(x,h.get(x.key).overlayedDocument);v!=null&&m.push(new xl(x.key,v,S2(v.value.mapValue),is.exists(!0)))}return l.mutationQueue.addMutationBatch(p,c,m,o)}).next(y=>{d=y;const m=y.applyToLocalDocumentSet(h,_);return l.documentOverlayCache.saveOverlays(p,y.batchId,m)})}).then(()=>({batchId:d.batchId,changes:L2(h)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(a,o,l){let c=a.Vu[a.currentUser.toKey()];c||(c=new ln(Ct)),c=c.insert(o,l),a.Vu[a.currentUser.toKey()]=c}(i,r.batchId,t),await $d(i,r.changes),await I0(i.remoteStore)}catch(r){const s=zb(r,"Failed to persist write");t.reject(s)}}async function g3(n,e){const t=mt(n);try{const i=await e8(t.localStore,e);e.targetChanges.forEach((r,s)=>{const a=t.Au.get(s);a&&(zt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?zt(a.hu,14607):r.removedDocuments.size>0&&(zt(a.hu,42227),a.hu=!1))}),await $d(t,i,e)}catch(i){await hu(i)}}function mA(n,e,t){const i=mt(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const r=[];i.Tu.forEach((s,a)=>{const o=a.view.va(e);o.snapshot&&r.push(o.snapshot)}),function(a,o){const l=mt(a);l.onlineState=o;let c=!1;l.queries.forEach((u,h)=>{for(const d of h.Sa)d.va(o)&&(c=!0)}),c&&Hb(l)}(i.eventManager,e),r.length&&i.Pu.H_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function H8(n,e,t){const i=mt(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.Au.get(e),s=r&&r.key;if(s){let a=new ln(Ze.comparator);a=a.insert(s,oi.newNoDocument(s,dt.min()));const o=It().add(s),l=new A0(dt.min(),new Map,new ln(Ct),a,o);await g3(i,l),i.du=i.du.remove(s),i.Au.delete(e),Wb(i)}else await Vv(i.localStore,e,!1).then(()=>Hv(i,e,t)).catch(hu)}async function G8(n,e){const t=mt(n),i=e.batch.batchId;try{const r=await Q9(t.localStore,e);_3(t,i,null),y3(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await $d(t,r)}catch(r){await hu(r)}}async function W8(n,e,t){const i=mt(n);try{const r=await function(a,o){const l=mt(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return l.mutationQueue.lookupMutationBatch(c,o).next(h=>(zt(h!==null,37113),u=h.keys(),l.mutationQueue.removeMutationBatch(c,h))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,u,o)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,u)).next(()=>l.localDocuments.getDocuments(c,u))})}(i.localStore,e);_3(i,e,t),y3(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await $d(i,r)}catch(r){await hu(r)}}function y3(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function _3(n,e,t){const i=mt(n);let r=i.Vu[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.Vu[i.currentUser.toKey()]=r}}function Hv(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Iu.get(e))n.Tu.delete(i),t&&n.Pu.yu(i,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(i=>{n.Ru.containsKey(i)||x3(n,i)})}function x3(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(kb(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Wb(n))}function gA(n,e,t){for(const i of t)i instanceof f3?(n.Ru.addReference(i.key,e),$8(n,i)):i instanceof p3?(Ue(Gb,"Document no longer in limbo: "+i.key),n.Ru.removeReference(i.key,e),n.Ru.containsKey(i.key)||x3(n,i.key)):at(19791,{wu:i})}function $8(n,e){const t=e.key,i=t.path.canonicalString();n.du.get(t)||n.Eu.has(i)||(Ue(Gb,"New document in limbo: "+t),n.Eu.add(i),Wb(n))}function Wb(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Ze(Xt.fromString(e)),i=n.fu.next();n.Au.set(i,new N8(t)),n.du=n.du.insert(t,i),r3(n.remoteStore,new Ma(ns(Mb(t.path)),i,"TargetPurposeLimboResolution",x0.ce))}}async function $d(n,e,t){const i=mt(n),r=[],s=[],a=[];i.Tu.isEmpty()||(i.Tu.forEach((o,l)=>{a.push(i.pu(l,e,t).then(c=>{var u;if((c||t)&&i.isPrimaryClient){const h=c?!c.fromCache:(u=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:u.current;i.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){r.push(c);const h=Nb.As(l.targetId,c);s.push(h)}}))}),await Promise.all(a),i.Pu.H_(r),await async function(l,c){const u=mt(l);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>ae.forEach(c,d=>ae.forEach(d.Es,p=>u.persistence.referenceDelegate.addReference(h,d.targetId,p)).next(()=>ae.forEach(d.ds,p=>u.persistence.referenceDelegate.removeReference(h,d.targetId,p)))))}catch(h){if(!du(h))throw h;Ue(Ob,"Failed to update sequence numbers: "+h)}for(const h of c){const d=h.targetId;if(!h.fromCache){const p=u.Ms.get(d),g=p.snapshotVersion,_=p.withLastLimboFreeSnapshotVersion(g);u.Ms=u.Ms.insert(d,_)}}}(i.localStore,s))}async function q8(n,e){const t=mt(n);if(!t.currentUser.isEqual(e)){Ue(Gb,"User change. New user:",e.toKey());const i=await e3(t.localStore,e);t.currentUser=e,function(s,a){s.mu.forEach(o=>{o.forEach(l=>{l.reject(new Pe(ie.CANCELLED,a))})}),s.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await $d(t,i.Ls)}}function j8(n,e){const t=mt(n),i=t.Au.get(e);if(i&&i.hu)return It().add(i.key);{let r=It();const s=t.Iu.get(e);if(!s)return r;for(const a of s){const o=t.Tu.get(a);r=r.unionWith(o.view.nu)}return r}}function v3(n){const e=mt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=g3.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=j8.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=H8.bind(null,e),e.Pu.H_=R8.bind(null,e.eventManager),e.Pu.yu=P8.bind(null,e.eventManager),e}function X8(n){const e=mt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=G8.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=W8.bind(null,e),e}class Zm{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=M0(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Z9(this.persistence,new K9,e.initialUser,this.serializer)}Cu(e){return new Q2(Db.mi,this.serializer)}Du(e){return new s8}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Zm.provider={build:()=>new Zm};class K8 extends Zm{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){zt(this.persistence.referenceDelegate instanceof Ym,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new N9(i,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Mi.withCacheSize(this.cacheSizeBytes):Mi.DEFAULT;return new Q2(i=>Ym.mi(i,t),this.serializer)}}class Gv{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>mA(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=q8.bind(null,this.syncEngine),await M8(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new I8}()}createDatastore(e){const t=M0(e.databaseInfo.databaseId),i=function(s){return new u8(s)}(e.databaseInfo);return function(s,a,o,l){return new p8(s,a,o,l)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(i,r,s,a,o){return new g8(i,r,s,a,o)}(this.localStore,this.datastore,e.asyncQueue,t=>mA(this.syncEngine,t,0),function(){return cA.v()?new cA:new a8}())}createSyncEngine(e,t){return function(r,s,a,o,l,c,u){const h=new O8(r,s,a,o,l,c);return u&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const s=mt(r);Ue(ol,"RemoteStore shutting down."),s.Ea.add(5),await Wd(s),s.Aa.shutdown(),s.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Gv.provider={build:()=>new Gv};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):zs("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eo="FirestoreClient";class Y8{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=ri.UNAUTHENTICATED,this.clientId=Sb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,async a=>{Ue(eo,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(i,a=>(Ue(eo,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ps;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=zb(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function m_(n,e){n.asyncQueue.verifyOperationInProgress(),Ue(eo,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async r=>{i.isEqual(r)||(await e3(e.localStore,r),i=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function yA(n,e){n.asyncQueue.verifyOperationInProgress();const t=await J8(n);Ue(eo,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>hA(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>hA(e.remoteStore,r)),n._onlineComponents=e}async function J8(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Ue(eo,"Using user provided OfflineComponentProvider");try{await m_(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===ie.FAILED_PRECONDITION||r.code===ie.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Gc("Error using user provided cache. Falling back to memory cache: "+t),await m_(n,new Zm)}}else Ue(eo,"Using default OfflineComponentProvider"),await m_(n,new K8(void 0));return n._offlineComponents}async function b3(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Ue(eo,"Using user provided OnlineComponentProvider"),await yA(n,n._uninitializedComponentsProvider._online)):(Ue(eo,"Using default OnlineComponentProvider"),await yA(n,new Gv))),n._onlineComponents}function Z8(n){return b3(n).then(e=>e.syncEngine)}async function w3(n){const e=await b3(n),t=e.eventManager;return t.onListen=k8.bind(null,e.syncEngine),t.onUnlisten=V8.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=U8.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=B8.bind(null,e.syncEngine),t}function Q8(n,e,t={}){const i=new Ps;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,c){const u=new S3({next:d=>{u.Nu(),a.enqueueAndForget(()=>h3(s,h));const p=d.docs.has(o);!p&&d.fromCache?c.reject(new Pe(ie.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&d.fromCache&&l&&l.source==="server"?c.reject(new Pe(ie.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new d3(Mb(o.path),u,{includeMetadataChanges:!0,qa:!0});return u3(s,h)}(await w3(n),n.asyncQueue,e,t,i)),i.promise}function eH(n,e,t={}){const i=new Ps;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,c){const u=new S3({next:d=>{u.Nu(),a.enqueueAndForget(()=>h3(s,h)),d.fromCache&&l.source==="server"?c.reject(new Pe(ie.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new d3(o,u,{includeMetadataChanges:!0,qa:!0});return u3(s,h)}(await w3(n),n.asyncQueue,e,t,i)),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T3(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _A=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E3="firestore.googleapis.com",xA=!0;class vA{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Pe(ie.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=E3,this.ssl=xA}else this.host=e.host,this.ssl=e.ssl??xA;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Z2;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<L9)throw new Pe(ie.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}g6("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=T3(e.experimentalLongPollingOptions??{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Pe(ie.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Pe(ie.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Pe(ie.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class R0{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vA({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Pe(ie.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Pe(ie.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vA(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new a6;switch(i.type){case"firstParty":return new u6(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new Pe(ie.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=_A.get(t);i&&(Ue("ComponentProvider","Removing Datastore"),_A.delete(t),i.terminate())}(this),Promise.resolve()}}function tH(n,e,t,i={}){var c;n=Xa(n,R0);const r=lo(e),s=n._getSettings(),a={...s,emulatorOptions:n._getEmulatorOptions()},o=`${e}:${t}`;r&&(tb(`https://${o}`),nb("Firestore",!0)),s.host!==E3&&s.host!==o&&Gc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:o,ssl:r,emulatorOptions:i};if(!nl(l,a)&&(n._setSettings(l),i.mockUserToken)){let u,h;if(typeof i.mockUserToken=="string")u=i.mockUserToken,h=ri.MOCK_USER;else{u=eP(i.mockUserToken,(c=n._app)==null?void 0:c.options.projectId);const d=i.mockUserToken.sub||i.mockUserToken.user_id;if(!d)throw new Pe(ie.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new ri(d)}n._authCredentials=new o6(new c2(u,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Sl(this.firestore,e,this._query)}}class En{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ga(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new En(this.firestore,e,this._key)}toJSON(){return{type:En._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(zd(t,En._jsonSchema))return new En(e,i||null,new Ze(Xt.fromString(t.referencePath)))}}En._jsonSchemaVersion="firestore/documentReference/1.0",En._jsonSchema={type:Tn("string",En._jsonSchemaVersion),referencePath:Tn("string")};class Ga extends Sl{constructor(e,t,i){super(e,t,Mb(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new En(this.firestore,null,new Ze(e))}withConverter(e){return new Ga(this.firestore,e,this._path)}}function hJ(n,e,...t){if(n=Ln(n),u2("collection","path",e),n instanceof R0){const i=Xt.fromString(e,...t);return D1(i),new Ga(n,null,i)}{if(!(n instanceof En||n instanceof Ga))throw new Pe(ie.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Xt.fromString(e,...t));return D1(i),new Ga(n.firestore,null,i)}}function $b(n,e,...t){if(n=Ln(n),arguments.length===1&&(e=Sb.newId()),u2("doc","path",e),n instanceof R0){const i=Xt.fromString(e,...t);return L1(i),new En(n,null,new Ze(i))}{if(!(n instanceof En||n instanceof Ga))throw new Pe(ie.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Xt.fromString(e,...t));return L1(i),new En(n.firestore,n instanceof Ga?n.converter:null,new Ze(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SA="AsyncQueue";class bA{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new n3(this,"async_queue_retry"),this._c=()=>{const i=p_();i&&Ue(SA,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const t=p_();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=p_();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Ps;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!du(e))throw e;Ue(SA,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(i=>{throw this.nc=i,this.rc=!1,zs("INTERNAL UNHANDLED ERROR: ",wA(i)),i}).then(i=>(this.rc=!1,i))));return this.ac=t,t}enqueueAfterDelay(e,t,i){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Bb.createAndSchedule(this,e,t,i,s=>this.hc(s));return this.tc.push(r),r}uc(){this.nc&&at(47125,{Pc:wA(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function wA(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class qd extends R0{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new bA,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new bA(e),this._firestoreClient=void 0,await e}}}function nH(n,e){const t=typeof n=="object"?n:sb(),i=typeof n=="string"?n:Wm,r=f0(t,"firestore").getImmediate({identifier:i});if(!r._initialized){const s=JR("firestore");s&&tH(r,...s)}return r}function qb(n){if(n._terminated)throw new Pe(ie.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||iH(n),n._firestoreClient}function iH(n){var i,r,s;const e=n._freezeSettings(),t=function(o,l,c,u){return new M6(o,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,T3(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)}(n._databaseId,((i=n._app)==null?void 0:i.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(r=e.localCache)!=null&&r._offlineComponentProvider&&((s=e.localCache)!=null&&s._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Y8(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(o){const l=o==null?void 0:o._online.build();return{_offline:o==null?void 0:o._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lr(Xn.fromBase64String(e))}catch(t){throw new Pe(ie.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new lr(Xn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:lr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(zd(e,lr._jsonSchema))return lr.fromBase64String(e.bytes)}}lr._jsonSchemaVersion="firestore/bytes/1.0",lr._jsonSchema={type:Tn("string",lr._jsonSchemaVersion),bytes:Tn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jb{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Pe(ie.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Gn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A3{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Pe(ie.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Pe(ie.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ct(this._lat,e._lat)||Ct(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ss._jsonSchemaVersion}}static fromJSON(e){if(zd(e,ss._jsonSchema))return new ss(e.latitude,e.longitude)}}ss._jsonSchemaVersion="firestore/geoPoint/1.0",ss._jsonSchema={type:Tn("string",ss._jsonSchemaVersion),latitude:Tn("number"),longitude:Tn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:as._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(zd(e,as._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new as(e.vectorValues);throw new Pe(ie.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}as._jsonSchemaVersion="firestore/vectorValue/1.0",as._jsonSchema={type:Tn("string",as._jsonSchemaVersion),vectorValues:Tn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rH=/^__.*__$/;class sH{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new xl(e,this.data,this.fieldMask,t,this.fieldTransforms):new Hd(e,this.data,t,this.fieldTransforms)}}function M3(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw at(40011,{Ac:n})}}class Xb{constructor(e,t,i,r,s,a){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Xb({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),i=this.Vc({path:t,fc:!1});return i.gc(e),i}yc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),i=this.Vc({path:t,fc:!1});return i.Rc(),i}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Qm(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(M3(this.Ac)&&rH.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class aH{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||M0(e)}Cc(e,t,i,r=!1){return new Xb({Ac:e,methodName:t,Dc:i,path:Gn.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Kb(n){const e=n._freezeSettings(),t=M0(n._databaseId);return new aH(n._databaseId,!!e.ignoreUndefinedProperties,t)}function C3(n,e,t,i,r,s={}){const a=n.Cc(s.merge||s.mergeFields?2:0,e,t,r);P3("Data must be an object, but it was:",a,i);const o=I3(i,a);let l,c;if(s.merge)l=new Ar(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){const u=[];for(const h of s.mergeFields){const d=lH(e,h,t);if(!a.contains(d))throw new Pe(ie.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);uH(u,d)||u.push(d)}l=new Ar(u),c=a.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=a.fieldTransforms;return new sH(new or(o),l,c)}function oH(n,e,t,i=!1){return Yb(t,n.Cc(i?4:3,e))}function Yb(n,e){if(R3(n=Ln(n)))return P3("Unsupported field value:",e,n),I3(n,e);if(n instanceof A3)return function(i,r){if(!M3(r.Ac))throw r.Sc(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${i._methodName}() is not currently supported inside arrays`);const s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(i,r){const s=[];let a=0;for(const o of i){let l=Yb(o,r.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=Ln(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return Y6(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const s=Zt.fromDate(i);return{timestampValue:Km(r.serializer,s)}}if(i instanceof Zt){const s=new Zt(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Km(r.serializer,s)}}if(i instanceof ss)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof lr)return{bytesValue:$2(r.serializer,i._byteString)};if(i instanceof En){const s=r.databaseId,a=i.firestore._databaseId;if(!a.isEqual(s))throw r.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Pb(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof as)return function(a,o){return{mapValue:{fields:{[x2]:{stringValue:v2},[$m]:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw o.Sc("VectorValues must only contain numeric values.");return Cb(o.serializer,c)})}}}}}}(i,r);throw r.Sc(`Unsupported field value: ${_0(i)}`)}(n,e)}function I3(n,e){const t={};return f2(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yl(n,(i,r)=>{const s=Yb(r,e.mc(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function R3(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Zt||n instanceof ss||n instanceof lr||n instanceof En||n instanceof A3||n instanceof as)}function P3(n,e,t){if(!R3(t)||!h2(t)){const i=_0(t);throw i==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+i)}}function lH(n,e,t){if((e=Ln(e))instanceof jb)return e._internalPath;if(typeof e=="string")return L3(n,e);throw Qm("Field path arguments must be of type string or ",n,!1,void 0,t)}const cH=new RegExp("[~\\*/\\[\\]]");function L3(n,e,t){if(e.search(cH)>=0)throw Qm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new jb(...e.split("."))._internalPath}catch{throw Qm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Qm(n,e,t,i,r){const s=i&&!i.isEmpty(),a=r!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${i}`),a&&(l+=` in document ${r}`),l+=")"),new Pe(ie.INVALID_ARGUMENT,o+n+l)}function uH(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D3{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new En(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new hH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(P0("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class hH extends D3{data(){return super.data()}}function P0(n,e){return typeof e=="string"?L3(n,e):e instanceof jb?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dH(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Pe(ie.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jb{}class N3 extends Jb{}function dJ(n,e,...t){let i=[];e instanceof Jb&&i.push(e),i=i.concat(t),function(s){const a=s.filter(l=>l instanceof Zb).length,o=s.filter(l=>l instanceof L0).length;if(a>1||a>0&&o>0)throw new Pe(ie.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)n=r._apply(n);return n}class L0 extends N3{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new L0(e,t,i)}_apply(e){const t=this._parse(e);return O3(e._query,t),new Sl(e.firestore,e.converter,Dv(e._query,t))}_parse(e){const t=Kb(e.firestore);return function(s,a,o,l,c,u,h){let d;if(c.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new Pe(ie.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){EA(h,u);const g=[];for(const _ of h)g.push(TA(l,s,_));d={arrayValue:{values:g}}}else d=TA(l,s,h)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||EA(h,u),d=oH(o,a,h,u==="in"||u==="not-in");return wn.create(c,u,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function fJ(n,e,t){const i=e,r=P0("where",n);return L0._create(r,i,t)}class Zb extends Jb{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Zb(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:Nr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let a=r;const o=s.getFlattenedFilters();for(const l of o)O3(a,l),a=Dv(a,l)}(e._query,t),new Sl(e.firestore,e.converter,Dv(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Qb extends N3{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Qb(e,t)}_apply(e){const t=function(r,s,a){if(r.startAt!==null)throw new Pe(ie.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new Pe(ie.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ld(s,a)}(e._query,this._field,this._direction);return new Sl(e.firestore,e.converter,function(r,s){const a=r.explicitOrderBy.concat([s]);return new fu(r.path,r.collectionGroup,a,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function pJ(n,e="asc"){const t=e,i=P0("orderBy",n);return Qb._create(i,t)}function TA(n,e,t){if(typeof(t=Ln(t))=="string"){if(t==="")throw new Pe(ie.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!C2(e)&&t.indexOf("/")!==-1)throw new Pe(ie.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(Xt.fromString(t));if(!Ze.isDocumentKey(i))throw new Pe(ie.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return z1(n,new Ze(i))}if(t instanceof En)return z1(n,t._key);throw new Pe(ie.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_0(t)}.`)}function EA(n,e){if(!Array.isArray(n)||n.length===0)throw new Pe(ie.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function O3(n,e){const t=function(r,s){for(const a of r)for(const o of a.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Pe(ie.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Pe(ie.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class fH{convertValue(e,t="none"){switch(Za(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ja(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw at(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return yl(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var i,r,s;const t=(s=(r=(i=e.fields)==null?void 0:i[$m].arrayValue)==null?void 0:r.values)==null?void 0:s.map(a=>yn(a.doubleValue));return new as(t)}convertGeoPoint(e){return new ss(yn(e.latitude),yn(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=S0(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(sd(e));default:return null}}convertTimestamp(e){const t=Ya(e);return new Zt(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=Xt.fromString(e);zt(J2(i),9688,{name:e});const r=new ad(i.get(1),i.get(3)),s=new Ze(i.popFirst(5));return r.isEqual(t)||zs(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k3(n,e,t){let i;return i=n?n.toFirestore(e):e,i}class ah{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jo extends D3{constructor(e,t,i,r,s,a){super(e,t,i,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new em(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(P0("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Pe(ie.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=jo._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}jo._jsonSchemaVersion="firestore/documentSnapshot/1.0",jo._jsonSchema={type:Tn("string",jo._jsonSchemaVersion),bundleSource:Tn("string","DocumentSnapshot"),bundleName:Tn("string"),bundle:Tn("string")};class em extends jo{data(e={}){return super.data(e)}}class Lc{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ah(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new em(this._firestore,this._userDataWriter,i.key,i,new ah(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Pe(ie.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map(o=>{const l=new em(r._firestore,r._userDataWriter,o.doc.key,o.doc,new ah(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const l=new em(r._firestore,r._userDataWriter,o.doc.key,o.doc,new ah(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let c=-1,u=-1;return o.type!==0&&(c=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),u=a.indexOf(o.doc.key)),{type:pH(o.type),doc:l,oldIndex:c,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Pe(ie.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Lc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Sb.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],r=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),i.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),r.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function pH(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return at(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U3(n){n=Xa(n,En);const e=Xa(n.firestore,qd);return Q8(qb(e),n._key).then(t=>gH(e,n,t))}Lc._jsonSchemaVersion="firestore/querySnapshot/1.0",Lc._jsonSchema={type:Tn("string",Lc._jsonSchemaVersion),bundleSource:Tn("string","QuerySnapshot"),bundleName:Tn("string"),bundle:Tn("string")};class F3 extends fH{constructor(e){super(),this.firestore=e}convertBytes(e){return new lr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new En(this.firestore,null,t)}}function mJ(n){n=Xa(n,Sl);const e=Xa(n.firestore,qd),t=qb(e),i=new F3(e);return dH(n._query),eH(t,n._query).then(r=>new Lc(e,i,n,r))}function mH(n,e,t){n=Xa(n,En);const i=Xa(n.firestore,qd),r=k3(n.converter,e);return V3(i,[C3(Kb(i),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,is.none())])}function gJ(n,e){const t=Xa(n.firestore,qd),i=$b(n),r=k3(n.converter,e);return V3(t,[C3(Kb(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,is.exists(!1))]).then(()=>i)}function V3(n,e){return function(i,r){const s=new Ps;return i.asyncQueue.enqueueAndForget(async()=>z8(await Z8(i),r,s)),s.promise}(qb(n),e)}function gH(n,e,t){const i=t.docs.get(e._key),r=new F3(n);return new jo(n,r,e._key,i,new ah(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(r){uu=r})(gl),il(new qa("firestore",(i,{instanceIdentifier:r,options:s})=>{const a=i.getProvider("app").getImmediate(),o=new qd(new l6(i.getProvider("auth-internal")),new h6(a,i.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new Pe(ie.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ad(c.options.projectId,u)}(a,r),a);return s={useFetchStreams:t,...s},o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),es(C1,I1,e),es(C1,I1,"esm2020")})();const tm={apiKey:"AIzaSyAQPF1tgRiHvVNZUmziPUtVQ6A7voU5KPw",authDomain:"exoplanets-review.firebaseapp.com",projectId:"exoplanets-review",storageBucket:"exoplanets-review.appspot.com",messagingSenderId:"779246060594",appId:"1:779246060594:web:33d48d828279ce9c14282b"};let g_=null,y_=null,__=null,x_=null,v_=null;function jd(){return!!(tm.apiKey&&tm.projectId&&tm.authDomain)}function ew(){if(!g_){if(!jd())throw new Error("Firebase is not configured. Please add Firebase environment variables to .env file.");g_=iP(tm)}return g_}function Vf(){return y_||(y_=r6(ew())),y_}function B3(){return __||(__=nH(ew())),__}function z3(){return x_||(x_=QB(ew())),x_}function yH(){return v_||(v_=new ws),v_}const _H={planet:"thumbnails/planets",star:"thumbnails/stars"},Vt=128,H3=new Map,tw=new Set,eg=new Map;function G3(n,e){const t=yv(n);return`${_H[e]}/${t}.png`}function W3(n,e){const t=`${e}:${n}`;return H3.get(t)}function $3(n,e,t){const i=`${e}:${n}`;H3.set(i,t)}async function xH(n,e){const t=W3(n,e);if(t)return t;if(!jd())return null;try{const i=z3(),r=G3(n,e),s=TP(i,r),a=await wP(s);return $3(n,e,a),a}catch(i){return i.code==="storage/object-not-found"||console.warn(`Failed to get thumbnail for ${n}:`,i),null}}async function vH(n,e,t){if(!jd())throw new Error("Firebase is not configured");const i=z3(),r=G3(n,e),s=TP(i,r);await ZB(s,t,{contentType:"image/png",cacheControl:"public, max-age=31536000"});const a=await wP(s);return $3(n,e,a),a}function SH(n,e){const t=`${e}:${n}`;return tw.has(t)}function bH(n,e){const t=`${e}:${n}`;tw.add(t)}function wH(n,e,t){const i=`${e}:${n}`;tw.delete(i);const r=eg.get(i);r&&(r.forEach(s=>s(t)),eg.delete(i))}function TH(n,e){const t=`${e}:${n}`;return new Promise(i=>{const r=eg.get(t)||[];r.push(i),eg.set(t,r)})}const ra={getThumbnailUrl:xH,uploadThumbnail:vH,getCachedUrl:W3,isGenerating:SH,markGenerating:bH,markGenerationComplete:wH,waitForGeneration:TH,THUMBNAIL_SIZE:Vt};/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const D0="181",EH={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},AH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},q3=0,Wv=1,j3=2,MH=3,CH=0,nw=1,X3=2,Wr=3,Gs=0,vi=1,jr=2,os=0,Xo=1,$v=2,qv=3,jv=4,K3=5,ba=100,Y3=101,J3=102,Z3=103,Q3=104,eL=200,tL=201,nL=202,iL=203,tg=204,ng=205,rL=206,sL=207,aL=208,oL=209,lL=210,cL=211,uL=212,hL=213,dL=214,ig=0,rg=1,sg=2,ll=3,ag=4,og=5,lg=6,cg=7,Xd=0,fL=1,pL=2,Ls=0,mL=1,gL=2,yL=3,_L=4,xL=5,vL=6,SL=7,Xv="attached",bL="detached",N0=300,Ws=301,to=302,hd=303,dd=304,mu=306,fd=1e3,Pi=1001,pd=1002,$n=1003,iw=1004,IH=1004,xc=1005,RH=1005,sn=1006,Mh=1007,PH=1007,Yr=1008,LH=1008,Or=1009,rw=1010,sw=1011,Kc=1012,O0=1013,$s=1014,Li=1015,bl=1016,k0=1017,U0=1018,Yc=1020,aw=35902,ow=35899,lw=1021,cw=1022,li=1023,Jc=1026,Zc=1027,F0=1028,Kd=1029,V0=1030,B0=1031,DH=1032,z0=1033,Ch=33776,Ih=33777,Rh=33778,Ph=33779,ug=35840,hg=35841,dg=35842,fg=35843,pg=36196,mg=37492,gg=37496,yg=37808,_g=37809,xg=37810,vg=37811,Sg=37812,bg=37813,wg=37814,Tg=37815,Eg=37816,Ag=37817,Mg=37818,Cg=37819,Ig=37820,Rg=37821,Pg=36492,Lg=36494,Dg=36495,Ng=36283,Og=36284,kg=36285,Ug=36286,wL=2200,TL=2201,EL=2202,md=2300,Fg=2301,nm=2302,Bo=2400,zo=2401,gd=2402,H0=2500,uw=2501,NH=0,OH=1,kH=2,AL=3200,ML=3201,UH=3202,FH=3203,co=0,CL=1,Ts="",si="srgb",cl="srgb-linear",yd="linear",Ht="srgb",VH=0,Do=7680,BH=7681,zH=7682,HH=7683,GH=34055,WH=34056,$H=5386,qH=512,jH=513,XH=514,KH=515,YH=516,JH=517,ZH=518,Kv=519,IL=512,RL=513,PL=514,hw=515,LL=516,DL=517,NL=518,OL=519,_d=35044,QH=35048,eG=35040,tG=35045,nG=35049,iG=35041,rG=35046,sG=35050,aG=35042,oG="100",Yv="300 es",ji=2e3,Qc=2001,lG={COMPUTE:"compute",RENDER:"render"},cG={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},uG={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function kL(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const hG={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function vc(n,e){return new hG[n](e)}function xd(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function UL(){const n=xd("canvas");return n.style.display="block",n}const AA={};let no=null;function dG(n){no=n}function fG(){return no}function vd(...n){const e="THREE."+n.shift();no?no("log",e,...n):console.log(e,...n)}function Ie(...n){const e="THREE."+n.shift();no?no("warn",e,...n):console.warn(e,...n)}function lt(...n){const e="THREE."+n.shift();no?no("error",e,...n):console.error(e,...n)}function eu(...n){const e=n.join(" ");e in AA||(AA[e]=!0,Ie(...n))}function pG(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}class hs{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const r=i[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}}const ei=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let MA=1234567;const Ko=Math.PI/180,tu=180/Math.PI;function Ki(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ei[n&255]+ei[n>>8&255]+ei[n>>16&255]+ei[n>>24&255]+"-"+ei[e&255]+ei[e>>8&255]+"-"+ei[e>>16&15|64]+ei[e>>24&255]+"-"+ei[t&63|128]+ei[t>>8&255]+"-"+ei[t>>16&255]+ei[t>>24&255]+ei[i&255]+ei[i>>8&255]+ei[i>>16&255]+ei[i>>24&255]).toLowerCase()}function st(n,e,t){return Math.max(e,Math.min(t,n))}function dw(n,e){return(n%e+e)%e}function mG(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function gG(n,e,t){return n!==e?(t-n)/(e-n):0}function Lh(n,e,t){return(1-t)*n+t*e}function yG(n,e,t,i){return Lh(n,e,1-Math.exp(-t*i))}function _G(n,e=1){return e-Math.abs(dw(n,e*2)-e)}function xG(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function vG(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function SG(n,e){return n+Math.floor(Math.random()*(e-n+1))}function bG(n,e){return n+Math.random()*(e-n)}function wG(n){return n*(.5-Math.random())}function TG(n){n!==void 0&&(MA=n);let e=MA+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function EG(n){return n*Ko}function AG(n){return n*tu}function MG(n){return(n&n-1)===0&&n!==0}function CG(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function IG(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function RG(n,e,t,i,r){const s=Math.cos,a=Math.sin,o=s(t/2),l=a(t/2),c=s((e+i)/2),u=a((e+i)/2),h=s((e-i)/2),d=a((e-i)/2),p=s((i-e)/2),g=a((i-e)/2);switch(r){case"XYX":n.set(o*u,l*h,l*d,o*c);break;case"YZY":n.set(l*d,o*u,l*h,o*c);break;case"ZXZ":n.set(l*h,l*d,o*u,o*c);break;case"XZX":n.set(o*u,l*g,l*p,o*c);break;case"YXY":n.set(l*p,o*u,l*g,o*c);break;case"ZYZ":n.set(l*g,l*p,o*u,o*c);break;default:Ie("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function _i(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function _t(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const PG={DEG2RAD:Ko,RAD2DEG:tu,generateUUID:Ki,clamp:st,euclideanModulo:dw,mapLinear:mG,inverseLerp:gG,lerp:Lh,damp:yG,pingpong:_G,smoothstep:xG,smootherstep:vG,randInt:SG,randFloat:bG,randFloatSpread:wG,seededRandom:TG,degToRad:EG,radToDeg:AG,isPowerOfTwo:MG,ceilPowerOfTwo:CG,floorPowerOfTwo:IG,setQuaternionFromProperEuler:RG,normalize:_t,denormalize:_i};class ce{constructor(e=0,t=0){ce.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=st(this.x,e.x,t.x),this.y=st(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=st(this.x,e,t),this.y=st(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(st(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(st(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*i-a*r+e.x,this.y=s*r+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ki{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,a,o){let l=i[r+0],c=i[r+1],u=i[r+2],h=i[r+3],d=s[a+0],p=s[a+1],g=s[a+2],_=s[a+3];if(o<=0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(o>=1){e[t+0]=d,e[t+1]=p,e[t+2]=g,e[t+3]=_;return}if(h!==_||l!==d||c!==p||u!==g){let y=l*d+c*p+u*g+h*_;y<0&&(d=-d,p=-p,g=-g,_=-_,y=-y);let m=1-o;if(y<.9995){const x=Math.acos(y),v=Math.sin(x);m=Math.sin(m*x)/v,o=Math.sin(o*x)/v,l=l*m+d*o,c=c*m+p*o,u=u*m+g*o,h=h*m+_*o}else{l=l*m+d*o,c=c*m+p*o,u=u*m+g*o,h=h*m+_*o;const x=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=x,c*=x,u*=x,h*=x}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,s,a){const o=i[r],l=i[r+1],c=i[r+2],u=i[r+3],h=s[a],d=s[a+1],p=s[a+2],g=s[a+3];return e[t]=o*g+u*h+l*p-c*d,e[t+1]=l*g+u*d+c*h-o*p,e[t+2]=c*g+u*p+o*d-l*h,e[t+3]=u*g-o*h-l*d-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(i/2),u=o(r/2),h=o(s/2),d=l(i/2),p=l(r/2),g=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h-d*p*g;break;case"YXZ":this._x=d*u*h+c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h+d*p*g;break;case"ZXY":this._x=d*u*h-c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h-d*p*g;break;case"ZYX":this._x=d*u*h-c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h+d*p*g;break;case"YZX":this._x=d*u*h+c*p*g,this._y=c*p*h+d*u*g,this._z=c*u*g-d*p*h,this._w=c*u*h-d*p*g;break;case"XZY":this._x=d*u*h-c*p*g,this._y=c*p*h-d*u*g,this._z=c*u*g+d*p*h,this._w=c*u*h+d*p*g;break;default:Ie("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],a=t[1],o=t[5],l=t[9],c=t[2],u=t[6],h=t[10],d=i+o+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-l)*p,this._y=(s-c)*p,this._z=(a-r)*p}else if(i>o&&i>h){const p=2*Math.sqrt(1+i-o-h);this._w=(u-l)/p,this._x=.25*p,this._y=(r+a)/p,this._z=(s+c)/p}else if(o>h){const p=2*Math.sqrt(1+o-i-h);this._w=(s-c)/p,this._x=(r+a)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+h-i-o);this._w=(a-r)/p,this._x=(s+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(st(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,a=e._w,o=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+a*o+r*c-s*l,this._y=r*u+a*l+s*o-i*c,this._z=s*u+a*c+i*l-r*o,this._w=a*u-i*o-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let i=e._x,r=e._y,s=e._z,a=e._w,o=this.dot(e);o<0&&(i=-i,r=-r,s=-s,a=-a,o=-o);let l=1-t;if(o<.9995){const c=Math.acos(o),u=Math.sin(c);l=Math.sin(l*c)/u,t=Math.sin(t*c)/u,this._x=this._x*l+i*t,this._y=this._y*l+r*t,this._z=this._z*l+s*t,this._w=this._w*l+a*t,this._onChangeCallback()}else this._x=this._x*l+i*t,this._y=this._y*l+r*t,this._z=this._z*l+s*t,this._w=this._w*l+a*t,this.normalize();return this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class F{constructor(e=0,t=0,i=0){F.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(CA.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(CA.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,a=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*a,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*a,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,a=e.y,o=e.z,l=e.w,c=2*(a*r-o*i),u=2*(o*t-s*r),h=2*(s*i-a*t);return this.x=t+l*c+a*h-o*u,this.y=i+l*u+o*c-s*h,this.z=r+l*h+s*u-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=st(this.x,e.x,t.x),this.y=st(this.y,e.y,t.y),this.z=st(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=st(this.x,e,t),this.y=st(this.y,e,t),this.z=st(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(st(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,a=t.x,o=t.y,l=t.z;return this.x=r*l-s*o,this.y=s*a-i*l,this.z=i*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return S_.copy(this).projectOnVector(e),this.sub(S_)}reflect(e){return this.sub(S_.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(st(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const S_=new F,CA=new ki;class gt{constructor(e,t,i,r,s,a,o,l,c){gt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,a,o,l,c)}set(e,t,i,r,s,a,o,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=t,u[4]=s,u[5]=l,u[6]=i,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,a=i[0],o=i[3],l=i[6],c=i[1],u=i[4],h=i[7],d=i[2],p=i[5],g=i[8],_=r[0],y=r[3],m=r[6],x=r[1],v=r[4],T=r[7],R=r[2],C=r[5],A=r[8];return s[0]=a*_+o*x+l*R,s[3]=a*y+o*v+l*C,s[6]=a*m+o*T+l*A,s[1]=c*_+u*x+h*R,s[4]=c*y+u*v+h*C,s[7]=c*m+u*T+h*A,s[2]=d*_+p*x+g*R,s[5]=d*y+p*v+g*C,s[8]=d*m+p*T+g*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return t*a*u-t*o*c-i*s*u+i*o*l+r*s*c-r*a*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=u*a-o*c,d=o*l-u*s,p=c*s-a*l,g=t*h+i*d+r*p;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/g;return e[0]=h*_,e[1]=(r*c-u*i)*_,e[2]=(o*i-r*a)*_,e[3]=d*_,e[4]=(u*t-r*l)*_,e[5]=(r*s-o*t)*_,e[6]=p*_,e[7]=(i*l-c*t)*_,e[8]=(a*t-i*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*a+c*o)+a+e,-r*c,r*l,-r*(-c*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(b_.makeScale(e,t)),this}rotate(e){return this.premultiply(b_.makeRotation(-e)),this}translate(e,t){return this.premultiply(b_.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const b_=new gt,IA=new gt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),RA=new gt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function LG(){const n={enabled:!0,workingColorSpace:cl,spaces:{},convert:function(r,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Ht&&(r.r=Ds(r.r),r.g=Ds(r.g),r.b=Ds(r.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Ht&&(r.r=Dc(r.r),r.g=Dc(r.g),r.b=Dc(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Ts?yd:this.spaces[r].transfer},getToneMappingMode:function(r){return this.spaces[r].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,a){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return eu("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return eu("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[cl]:{primaries:e,whitePoint:i,transfer:yd,toXYZ:IA,fromXYZ:RA,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:si},outputColorSpaceConfig:{drawingBufferColorSpace:si}},[si]:{primaries:e,whitePoint:i,transfer:Ht,toXYZ:IA,fromXYZ:RA,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:si}}}),n}const Lt=LG();function Ds(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Dc(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Nl;class FL{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{Nl===void 0&&(Nl=xd("canvas")),Nl.width=e.width,Nl.height=e.height;const r=Nl.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=Nl}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=xd("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let a=0;a<s.length;a++)s[a]=Ds(s[a]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Ds(t[i]/255)*255):t[i]=Ds(t[i]);return{data:t,width:e.width,height:e.height}}else return Ie("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let DG=0;class Ca{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:DG++}),this.uuid=Ki(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let a=0,o=r.length;a<o;a++)r[a].isDataTexture?s.push(w_(r[a].image)):s.push(w_(r[a]))}else s=w_(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function w_(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?FL.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(Ie("Texture: Unable to serialize Texture."),{})}let NG=0;const T_=new F;class fn extends hs{constructor(e=fn.DEFAULT_IMAGE,t=fn.DEFAULT_MAPPING,i=Pi,r=Pi,s=sn,a=Yr,o=li,l=Or,c=fn.DEFAULT_ANISOTROPY,u=Ts){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:NG++}),this.uuid=Ki(),this.name="",this.source=new Ca(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new ce(0,0),this.repeat=new ce(1,1),this.center=new ce(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(T_).x}get height(){return this.source.getSize(T_).y}get depth(){return this.source.getSize(T_).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const i=e[t];if(i===void 0){Ie(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){Ie(`Texture.setValues(): property '${t}' does not exist.`);continue}r&&i&&r.isVector2&&i.isVector2||r&&i&&r.isVector3&&i.isVector3||r&&i&&r.isMatrix3&&i.isMatrix3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==N0)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case fd:e.x=e.x-Math.floor(e.x);break;case Pi:e.x=e.x<0?0:1;break;case pd:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case fd:e.y=e.y-Math.floor(e.y);break;case Pi:e.y=e.y<0?0:1;break;case pd:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}fn.DEFAULT_IMAGE=null;fn.DEFAULT_MAPPING=N0;fn.DEFAULT_ANISOTROPY=1;class kt{constructor(e=0,t=0,i=0,r=1){kt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*s,this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*s,this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*s,this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],p=l[5],g=l[9],_=l[2],y=l[6],m=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-_)<.01&&Math.abs(g-y)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+_)<.1&&Math.abs(g+y)<.1&&Math.abs(c+p+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const v=(c+1)/2,T=(p+1)/2,R=(m+1)/2,C=(u+d)/4,A=(h+_)/4,E=(g+y)/4;return v>T&&v>R?v<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(v),r=C/i,s=A/i):T>R?T<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(T),i=C/r,s=E/r):R<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(R),i=A/s,r=E/s),this.set(i,r,s,t),this}let x=Math.sqrt((y-g)*(y-g)+(h-_)*(h-_)+(d-u)*(d-u));return Math.abs(x)<.001&&(x=1),this.x=(y-g)/x,this.y=(h-_)/x,this.z=(d-u)/x,this.w=Math.acos((c+p+m-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=st(this.x,e.x,t.x),this.y=st(this.y,e.y,t.y),this.z=st(this.z,e.z,t.z),this.w=st(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=st(this.x,e,t),this.y=st(this.y,e,t),this.z=st(this.z,e,t),this.w=st(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(st(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class fw extends hs{constructor(e=1,t=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:sn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=i.depth,this.scissor=new kt(0,0,e,t),this.scissorTest=!1,this.viewport=new kt(0,0,e,t);const r={width:e,height:t,depth:i.depth},s=new fn(r);this.textures=[];const a=i.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(e={}){const t={minFilter:sn,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let i=0;i<this.textures.length;i++)this.textures[i].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i,this.textures[r].isData3DTexture!==!0&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new Ca(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class kr extends fw{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class G0 extends fn{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=$n,this.minFilter=$n,this.wrapR=Pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class OG extends kr{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new G0(null,e,t,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class W0 extends fn{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=$n,this.minFilter=$n,this.wrapR=Pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class kG extends kr{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new W0(null,e,t,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class ci{constructor(e=new F(1/0,1/0,1/0),t=new F(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(_r.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(_r.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=_r.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,_r):_r.fromBufferAttribute(s,a),_r.applyMatrix4(e.matrixWorld),this.expandByPoint(_r);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Bf.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Bf.copy(i.boundingBox)),Bf.applyMatrix4(e.matrixWorld),this.union(Bf)}const r=e.children;for(let s=0,a=r.length;s<a;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,_r),_r.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Vu),zf.subVectors(this.max,Vu),Ol.subVectors(e.a,Vu),kl.subVectors(e.b,Vu),Ul.subVectors(e.c,Vu),sa.subVectors(kl,Ol),aa.subVectors(Ul,kl),go.subVectors(Ol,Ul);let t=[0,-sa.z,sa.y,0,-aa.z,aa.y,0,-go.z,go.y,sa.z,0,-sa.x,aa.z,0,-aa.x,go.z,0,-go.x,-sa.y,sa.x,0,-aa.y,aa.x,0,-go.y,go.x,0];return!E_(t,Ol,kl,Ul,zf)||(t=[1,0,0,0,1,0,0,0,1],!E_(t,Ol,kl,Ul,zf))?!1:(Hf.crossVectors(sa,aa),t=[Hf.x,Hf.y,Hf.z],E_(t,Ol,kl,Ul,zf))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_r).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(_r).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ps[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ps[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ps[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ps[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ps[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ps[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ps[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ps[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ps),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const ps=[new F,new F,new F,new F,new F,new F,new F,new F],_r=new F,Bf=new ci,Ol=new F,kl=new F,Ul=new F,sa=new F,aa=new F,go=new F,Vu=new F,zf=new F,Hf=new F,yo=new F;function E_(n,e,t,i,r){for(let s=0,a=n.length-3;s<=a;s+=3){yo.fromArray(n,s);const o=r.x*Math.abs(yo.x)+r.y*Math.abs(yo.y)+r.z*Math.abs(yo.z),l=e.dot(yo),c=t.dot(yo),u=i.dot(yo);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const UG=new ci,Bu=new F,A_=new F;class qn{constructor(e=new F,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):UG.setFromPoints(e).getCenter(i);let r=0;for(let s=0,a=e.length;s<a;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Bu.subVectors(e,this.center);const t=Bu.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Bu,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(A_.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Bu.copy(e.center).add(A_)),this.expandByPoint(Bu.copy(e.center).sub(A_))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const ms=new F,M_=new F,Gf=new F,oa=new F,C_=new F,Wf=new F,I_=new F;class gu{constructor(e=new F,t=new F(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ms)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ms.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ms.copy(this.origin).addScaledVector(this.direction,t),ms.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){M_.copy(e).add(t).multiplyScalar(.5),Gf.copy(t).sub(e).normalize(),oa.copy(this.origin).sub(M_);const s=e.distanceTo(t)*.5,a=-this.direction.dot(Gf),o=oa.dot(this.direction),l=-oa.dot(Gf),c=oa.lengthSq(),u=Math.abs(1-a*a);let h,d,p,g;if(u>0)if(h=a*l-o,d=a*o-l,g=s*u,h>=0)if(d>=-g)if(d<=g){const _=1/u;h*=_,d*=_,p=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d<=-g?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c):d<=g?(h=0,d=Math.min(Math.max(-s,-l),s),p=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(M_).addScaledVector(Gf,d),p}intersectSphere(e,t){ms.subVectors(e.center,this.origin);const i=ms.dot(this.direction),r=ms.dot(ms)-i*i,s=e.radius*e.radius;if(r>s)return null;const a=Math.sqrt(s-r),o=i-a,l=i+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(i=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(i=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),u>=0?(s=(e.min.y-d.y)*u,a=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,a=(e.min.y-d.y)*u),i>a||s>r||((s>i||isNaN(i))&&(i=s),(a<r||isNaN(r))&&(r=a),h>=0?(o=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(o=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),i>l||o>r)||((o>i||i!==i)&&(i=o),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,ms)!==null}intersectTriangle(e,t,i,r,s){C_.subVectors(t,e),Wf.subVectors(i,e),I_.crossVectors(C_,Wf);let a=this.direction.dot(I_),o;if(a>0){if(r)return null;o=1}else if(a<0)o=-1,a=-a;else return null;oa.subVectors(this.origin,e);const l=o*this.direction.dot(Wf.crossVectors(oa,Wf));if(l<0)return null;const c=o*this.direction.dot(C_.cross(oa));if(c<0||l+c>a)return null;const u=-o*oa.dot(I_);return u<0?null:this.at(u/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ot{constructor(e,t,i,r,s,a,o,l,c,u,h,d,p,g,_,y){ot.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,a,o,l,c,u,h,d,p,g,_,y)}set(e,t,i,r,s,a,o,l,c,u,h,d,p,g,_,y){const m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=r,m[1]=s,m[5]=a,m[9]=o,m[13]=l,m[2]=c,m[6]=u,m[10]=h,m[14]=d,m[3]=p,m[7]=g,m[11]=_,m[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ot().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Fl.setFromMatrixColumn(e,0).length(),s=1/Fl.setFromMatrixColumn(e,1).length(),a=1/Fl.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,a=Math.cos(i),o=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=a*u,p=a*h,g=o*u,_=o*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=p+g*c,t[5]=d-_*c,t[9]=-o*l,t[2]=_-d*c,t[6]=g+p*c,t[10]=a*l}else if(e.order==="YXZ"){const d=l*u,p=l*h,g=c*u,_=c*h;t[0]=d+_*o,t[4]=g*o-p,t[8]=a*c,t[1]=a*h,t[5]=a*u,t[9]=-o,t[2]=p*o-g,t[6]=_+d*o,t[10]=a*l}else if(e.order==="ZXY"){const d=l*u,p=l*h,g=c*u,_=c*h;t[0]=d-_*o,t[4]=-a*h,t[8]=g+p*o,t[1]=p+g*o,t[5]=a*u,t[9]=_-d*o,t[2]=-a*c,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const d=a*u,p=a*h,g=o*u,_=o*h;t[0]=l*u,t[4]=g*c-p,t[8]=d*c+_,t[1]=l*h,t[5]=_*c+d,t[9]=p*c-g,t[2]=-c,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const d=a*l,p=a*c,g=o*l,_=o*c;t[0]=l*u,t[4]=_-d*h,t[8]=g*h+p,t[1]=h,t[5]=a*u,t[9]=-o*u,t[2]=-c*u,t[6]=p*h+g,t[10]=d-_*h}else if(e.order==="XZY"){const d=a*l,p=a*c,g=o*l,_=o*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=d*h+_,t[5]=a*u,t[9]=p*h-g,t[2]=g*h-p,t[6]=o*u,t[10]=_*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(FG,e,VG)}lookAt(e,t,i){const r=this.elements;return Bi.subVectors(e,t),Bi.lengthSq()===0&&(Bi.z=1),Bi.normalize(),la.crossVectors(i,Bi),la.lengthSq()===0&&(Math.abs(i.z)===1?Bi.x+=1e-4:Bi.z+=1e-4,Bi.normalize(),la.crossVectors(i,Bi)),la.normalize(),$f.crossVectors(Bi,la),r[0]=la.x,r[4]=$f.x,r[8]=Bi.x,r[1]=la.y,r[5]=$f.y,r[9]=Bi.y,r[2]=la.z,r[6]=$f.z,r[10]=Bi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,a=i[0],o=i[4],l=i[8],c=i[12],u=i[1],h=i[5],d=i[9],p=i[13],g=i[2],_=i[6],y=i[10],m=i[14],x=i[3],v=i[7],T=i[11],R=i[15],C=r[0],A=r[4],E=r[8],b=r[12],S=r[1],I=r[5],D=r[9],P=r[13],$=r[2],Y=r[6],Z=r[10],fe=r[14],B=r[3],X=r[7],ee=r[11],_e=r[15];return s[0]=a*C+o*S+l*$+c*B,s[4]=a*A+o*I+l*Y+c*X,s[8]=a*E+o*D+l*Z+c*ee,s[12]=a*b+o*P+l*fe+c*_e,s[1]=u*C+h*S+d*$+p*B,s[5]=u*A+h*I+d*Y+p*X,s[9]=u*E+h*D+d*Z+p*ee,s[13]=u*b+h*P+d*fe+p*_e,s[2]=g*C+_*S+y*$+m*B,s[6]=g*A+_*I+y*Y+m*X,s[10]=g*E+_*D+y*Z+m*ee,s[14]=g*b+_*P+y*fe+m*_e,s[3]=x*C+v*S+T*$+R*B,s[7]=x*A+v*I+T*Y+R*X,s[11]=x*E+v*D+T*Z+R*ee,s[15]=x*b+v*P+T*fe+R*_e,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],a=e[1],o=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],p=e[14],g=e[3],_=e[7],y=e[11],m=e[15];return g*(+s*l*h-r*c*h-s*o*d+i*c*d+r*o*p-i*l*p)+_*(+t*l*p-t*c*d+s*a*d-r*a*p+r*c*u-s*l*u)+y*(+t*c*h-t*o*p-s*a*h+i*a*p+s*o*u-i*c*u)+m*(-r*o*u-t*l*h+t*o*d+r*a*h-i*a*d+i*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],g=e[12],_=e[13],y=e[14],m=e[15],x=h*y*c-_*d*c+_*l*p-o*y*p-h*l*m+o*d*m,v=g*d*c-u*y*c-g*l*p+a*y*p+u*l*m-a*d*m,T=u*_*c-g*h*c+g*o*p-a*_*p-u*o*m+a*h*m,R=g*h*l-u*_*l-g*o*d+a*_*d+u*o*y-a*h*y,C=t*x+i*v+r*T+s*R;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/C;return e[0]=x*A,e[1]=(_*d*s-h*y*s-_*r*p+i*y*p+h*r*m-i*d*m)*A,e[2]=(o*y*s-_*l*s+_*r*c-i*y*c-o*r*m+i*l*m)*A,e[3]=(h*l*s-o*d*s-h*r*c+i*d*c+o*r*p-i*l*p)*A,e[4]=v*A,e[5]=(u*y*s-g*d*s+g*r*p-t*y*p-u*r*m+t*d*m)*A,e[6]=(g*l*s-a*y*s-g*r*c+t*y*c+a*r*m-t*l*m)*A,e[7]=(a*d*s-u*l*s+u*r*c-t*d*c-a*r*p+t*l*p)*A,e[8]=T*A,e[9]=(g*h*s-u*_*s-g*i*p+t*_*p+u*i*m-t*h*m)*A,e[10]=(a*_*s-g*o*s+g*i*c-t*_*c-a*i*m+t*o*m)*A,e[11]=(u*o*s-a*h*s-u*i*c+t*h*c+a*i*p-t*o*p)*A,e[12]=R*A,e[13]=(u*_*r-g*h*r+g*i*d-t*_*d-u*i*y+t*h*y)*A,e[14]=(g*o*r-a*_*r-g*i*l+t*_*l+a*i*y-t*o*y)*A,e[15]=(a*h*r-u*o*r+u*i*l-t*h*l-a*i*d+t*o*d)*A,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,a=e.x,o=e.y,l=e.z,c=s*a,u=s*o;return this.set(c*a+i,c*o-r*l,c*l+r*o,0,c*o+r*l,u*o+i,u*l-r*a,0,c*l-r*o,u*l+r*a,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,a){return this.set(1,i,s,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,a=t._y,o=t._z,l=t._w,c=s+s,u=a+a,h=o+o,d=s*c,p=s*u,g=s*h,_=a*u,y=a*h,m=o*h,x=l*c,v=l*u,T=l*h,R=i.x,C=i.y,A=i.z;return r[0]=(1-(_+m))*R,r[1]=(p+T)*R,r[2]=(g-v)*R,r[3]=0,r[4]=(p-T)*C,r[5]=(1-(d+m))*C,r[6]=(y+x)*C,r[7]=0,r[8]=(g+v)*A,r[9]=(y-x)*A,r[10]=(1-(d+_))*A,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Fl.set(r[0],r[1],r[2]).length();const a=Fl.set(r[4],r[5],r[6]).length(),o=Fl.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],xr.copy(this);const c=1/s,u=1/a,h=1/o;return xr.elements[0]*=c,xr.elements[1]*=c,xr.elements[2]*=c,xr.elements[4]*=u,xr.elements[5]*=u,xr.elements[6]*=u,xr.elements[8]*=h,xr.elements[9]*=h,xr.elements[10]*=h,t.setFromRotationMatrix(xr),i.x=s,i.y=a,i.z=o,this}makePerspective(e,t,i,r,s,a,o=ji,l=!1){const c=this.elements,u=2*s/(t-e),h=2*s/(i-r),d=(t+e)/(t-e),p=(i+r)/(i-r);let g,_;if(l)g=s/(a-s),_=a*s/(a-s);else if(o===ji)g=-(a+s)/(a-s),_=-2*a*s/(a-s);else if(o===Qc)g=-a/(a-s),_=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=u,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=h,c[9]=p,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=_,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,r,s,a,o=ji,l=!1){const c=this.elements,u=2/(t-e),h=2/(i-r),d=-(t+e)/(t-e),p=-(i+r)/(i-r);let g,_;if(l)g=1/(a-s),_=a/(a-s);else if(o===ji)g=-2/(a-s),_=-(a+s)/(a-s);else if(o===Qc)g=-1/(a-s),_=-s/(a-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=u,c[4]=0,c[8]=0,c[12]=d,c[1]=0,c[5]=h,c[9]=0,c[13]=p,c[2]=0,c[6]=0,c[10]=g,c[14]=_,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Fl=new F,xr=new ot,FG=new F(0,0,0),VG=new F(1,1,1),la=new F,$f=new F,Bi=new F,PA=new ot,LA=new ki;class Ji{constructor(e=0,t=0,i=0,r=Ji.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],a=r[4],o=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],p=r[10];switch(t){case"XYZ":this._y=Math.asin(st(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-st(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(st(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-st(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(st(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-st(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:Ie("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return PA.makeRotationFromQuaternion(e),this.setFromRotationMatrix(PA,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return LA.setFromEuler(this),this.setFromQuaternion(LA,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ji.DEFAULT_ORDER="XYZ";class $0{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let BG=0;const DA=new F,Vl=new ki,gs=new ot,qf=new F,zu=new F,zG=new F,HG=new ki,NA=new F(1,0,0),OA=new F(0,1,0),kA=new F(0,0,1),UA={type:"added"},GG={type:"removed"},Bl={type:"childadded",child:null},R_={type:"childremoved",child:null};class Ft extends hs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:BG++}),this.uuid=Ki(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ft.DEFAULT_UP.clone();const e=new F,t=new Ji,i=new ki,r=new F(1,1,1);function s(){i.setFromEuler(t,!1)}function a(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ot},normalMatrix:{value:new gt}}),this.matrix=new ot,this.matrixWorld=new ot,this.matrixAutoUpdate=Ft.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new $0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Vl.setFromAxisAngle(e,t),this.quaternion.multiply(Vl),this}rotateOnWorldAxis(e,t){return Vl.setFromAxisAngle(e,t),this.quaternion.premultiply(Vl),this}rotateX(e){return this.rotateOnAxis(NA,e)}rotateY(e){return this.rotateOnAxis(OA,e)}rotateZ(e){return this.rotateOnAxis(kA,e)}translateOnAxis(e,t){return DA.copy(e).applyQuaternion(this.quaternion),this.position.add(DA.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(NA,e)}translateY(e){return this.translateOnAxis(OA,e)}translateZ(e){return this.translateOnAxis(kA,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(gs.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?qf.copy(e):qf.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),zu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?gs.lookAt(zu,qf,this.up):gs.lookAt(qf,zu,this.up),this.quaternion.setFromRotationMatrix(gs),r&&(gs.extractRotation(r.matrixWorld),Vl.setFromRotationMatrix(gs),this.quaternion.premultiply(Vl.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(lt("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(UA),Bl.child=e,this.dispatchEvent(Bl),Bl.child=null):lt("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(GG),R_.child=e,this.dispatchEvent(R_),R_.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),gs.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),gs.multiply(e.parent.matrixWorld)),e.applyMatrix4(gs),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(UA),Bl.child=e,this.dispatchEvent(Bl),Bl.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const a=this.children[i].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zu,e,zG),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zu,HG,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(o=>({...o})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(e.materials,this.material[l]));r.material=o}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];r.animations.push(s(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),u=a(e.images),h=a(e.shapes),d=a(e.skeletons),p=a(e.animations),g=a(e.nodes);o.length>0&&(i.geometries=o),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),u.length>0&&(i.images=u),h.length>0&&(i.shapes=h),d.length>0&&(i.skeletons=d),p.length>0&&(i.animations=p),g.length>0&&(i.nodes=g)}return i.object=r,i;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Ft.DEFAULT_UP=new F(0,1,0);Ft.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const vr=new F,ys=new F,P_=new F,_s=new F,zl=new F,Hl=new F,FA=new F,L_=new F,D_=new F,N_=new F,O_=new kt,k_=new kt,U_=new kt;class Ii{constructor(e=new F,t=new F,i=new F){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),vr.subVectors(e,t),r.cross(vr);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){vr.subVectors(r,t),ys.subVectors(i,t),P_.subVectors(e,t);const a=vr.dot(vr),o=vr.dot(ys),l=vr.dot(P_),c=ys.dot(ys),u=ys.dot(P_),h=a*c-o*o;if(h===0)return s.set(0,0,0),null;const d=1/h,p=(c*l-o*u)*d,g=(a*u-o*l)*d;return s.set(1-p-g,g,p)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,_s)===null?!1:_s.x>=0&&_s.y>=0&&_s.x+_s.y<=1}static getInterpolation(e,t,i,r,s,a,o,l){return this.getBarycoord(e,t,i,r,_s)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,_s.x),l.addScaledVector(a,_s.y),l.addScaledVector(o,_s.z),l)}static getInterpolatedAttribute(e,t,i,r,s,a){return O_.setScalar(0),k_.setScalar(0),U_.setScalar(0),O_.fromBufferAttribute(e,t),k_.fromBufferAttribute(e,i),U_.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(O_,s.x),a.addScaledVector(k_,s.y),a.addScaledVector(U_,s.z),a}static isFrontFacing(e,t,i,r){return vr.subVectors(i,t),ys.subVectors(e,t),vr.cross(ys).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vr.subVectors(this.c,this.b),ys.subVectors(this.a,this.b),vr.cross(ys).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ii.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ii.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return Ii.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Ii.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ii.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let a,o;zl.subVectors(r,i),Hl.subVectors(s,i),L_.subVectors(e,i);const l=zl.dot(L_),c=Hl.dot(L_);if(l<=0&&c<=0)return t.copy(i);D_.subVectors(e,r);const u=zl.dot(D_),h=Hl.dot(D_);if(u>=0&&h<=u)return t.copy(r);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),t.copy(i).addScaledVector(zl,a);N_.subVectors(e,s);const p=zl.dot(N_),g=Hl.dot(N_);if(g>=0&&p<=g)return t.copy(s);const _=p*c-l*g;if(_<=0&&c>=0&&g<=0)return o=c/(c-g),t.copy(i).addScaledVector(Hl,o);const y=u*g-p*h;if(y<=0&&h-u>=0&&p-g>=0)return FA.subVectors(s,r),o=(h-u)/(h-u+(p-g)),t.copy(r).addScaledVector(FA,o);const m=1/(y+_+d);return a=_*m,o=d*m,t.copy(i).addScaledVector(zl,a).addScaledVector(Hl,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const VL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ca={h:0,s:0,l:0},jf={h:0,s:0,l:0};function F_(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class De{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=si){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Lt.colorSpaceToWorking(this,t),this}setRGB(e,t,i,r=Lt.workingColorSpace){return this.r=e,this.g=t,this.b=i,Lt.colorSpaceToWorking(this,r),this}setHSL(e,t,i,r=Lt.workingColorSpace){if(e=dw(e,1),t=st(t,0,1),i=st(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,a=2*i-s;this.r=F_(a,s,e+1/3),this.g=F_(a,s,e),this.b=F_(a,s,e-1/3)}return Lt.colorSpaceToWorking(this,r),this}setStyle(e,t=si){function i(s){s!==void 0&&parseFloat(s)<1&&Ie("Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:Ie("Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);Ie("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=si){const i=VL[e.toLowerCase()];return i!==void 0?this.setHex(i,t):Ie("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ds(e.r),this.g=Ds(e.g),this.b=Ds(e.b),this}copyLinearToSRGB(e){return this.r=Dc(e.r),this.g=Dc(e.g),this.b=Dc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=si){return Lt.workingToColorSpace(ti.copy(this),e),Math.round(st(ti.r*255,0,255))*65536+Math.round(st(ti.g*255,0,255))*256+Math.round(st(ti.b*255,0,255))}getHexString(e=si){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Lt.workingColorSpace){Lt.workingToColorSpace(ti.copy(this),t);const i=ti.r,r=ti.g,s=ti.b,a=Math.max(i,r,s),o=Math.min(i,r,s);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case i:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-i)/h+2;break;case s:l=(i-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Lt.workingColorSpace){return Lt.workingToColorSpace(ti.copy(this),t),e.r=ti.r,e.g=ti.g,e.b=ti.b,e}getStyle(e=si){Lt.workingToColorSpace(ti.copy(this),e);const t=ti.r,i=ti.g,r=ti.b;return e!==si?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(ca),this.setHSL(ca.h+e,ca.s+t,ca.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(ca),e.getHSL(jf);const i=Lh(ca.h,jf.h,t),r=Lh(ca.s,jf.s,t),s=Lh(ca.l,jf.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ti=new De;De.NAMES=VL;let WG=0;class Kn extends hs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:WG++}),this.uuid=Ki(),this.name="",this.type="Material",this.blending=Xo,this.side=Gs,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=tg,this.blendDst=ng,this.blendEquation=ba,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new De(0,0,0),this.blendAlpha=0,this.depthFunc=ll,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Kv,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Do,this.stencilZFail=Do,this.stencilZPass=Do,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){Ie(`Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){Ie(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Xo&&(i.blending=this.blending),this.side!==Gs&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==tg&&(i.blendSrc=this.blendSrc),this.blendDst!==ng&&(i.blendDst=this.blendDst),this.blendEquation!==ba&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==ll&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Kv&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Do&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Do&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Do&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(t){const s=r(e.textures),a=r(e.images);s.length>0&&(i.textures=s),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Pr extends Kn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new De(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ji,this.combine=Xd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Es=$G();function $G(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,r[l]=24,r[l|256]=24):(i[l]=31744,i[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function Ai(n){Math.abs(n)>65504&&Ie("DataUtils.toHalfFloat(): Value out of range."),n=st(n,-65504,65504),Es.floatView[0]=n;const e=Es.uint32View[0],t=e>>23&511;return Es.baseTable[t]+((e&8388607)>>Es.shiftTable[t])}function oh(n){const e=n>>10;return Es.uint32View[0]=Es.mantissaTable[Es.offsetTable[e]+(n&1023)]+Es.exponentTable[e],Es.floatView[0]}class qG{static toHalfFloat(e){return Ai(e)}static fromHalfFloat(e){return oh(e)}}const vn=new F,Xf=new ce;let jG=0;class $t{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:jG++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=_d,this.updateRanges=[],this.gpuType=Li,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Xf.fromBufferAttribute(this,t),Xf.applyMatrix3(e),this.setXY(t,Xf.x,Xf.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)vn.fromBufferAttribute(this,t),vn.applyMatrix3(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)vn.fromBufferAttribute(this,t),vn.applyMatrix4(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)vn.fromBufferAttribute(this,t),vn.applyNormalMatrix(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)vn.fromBufferAttribute(this,t),vn.transformDirection(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=_i(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=_t(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=_i(t,this.array)),t}setX(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=_i(t,this.array)),t}setY(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=_i(t,this.array)),t}setZ(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=_i(t,this.array)),t}setW(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=_t(t,this.array),i=_t(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=_t(t,this.array),i=_t(i,this.array),r=_t(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=_t(t,this.array),i=_t(i,this.array),r=_t(r,this.array),s=_t(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==_d&&(e.usage=this.usage),e}}class XG extends $t{constructor(e,t,i){super(new Int8Array(e),t,i)}}class KG extends $t{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class YG extends $t{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class JG extends $t{constructor(e,t,i){super(new Int16Array(e),t,i)}}class pw extends $t{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class ZG extends $t{constructor(e,t,i){super(new Int32Array(e),t,i)}}class mw extends $t{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class QG extends $t{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=oh(this.array[e*this.itemSize]);return this.normalized&&(t=_i(t,this.array)),t}setX(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize]=Ai(t),this}getY(e){let t=oh(this.array[e*this.itemSize+1]);return this.normalized&&(t=_i(t,this.array)),t}setY(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize+1]=Ai(t),this}getZ(e){let t=oh(this.array[e*this.itemSize+2]);return this.normalized&&(t=_i(t,this.array)),t}setZ(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize+2]=Ai(t),this}getW(e){let t=oh(this.array[e*this.itemSize+3]);return this.normalized&&(t=_i(t,this.array)),t}setW(e,t){return this.normalized&&(t=_t(t,this.array)),this.array[e*this.itemSize+3]=Ai(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=_t(t,this.array),i=_t(i,this.array)),this.array[e+0]=Ai(t),this.array[e+1]=Ai(i),this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=_t(t,this.array),i=_t(i,this.array),r=_t(r,this.array)),this.array[e+0]=Ai(t),this.array[e+1]=Ai(i),this.array[e+2]=Ai(r),this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=_t(t,this.array),i=_t(i,this.array),r=_t(r,this.array),s=_t(s,this.array)),this.array[e+0]=Ai(t),this.array[e+1]=Ai(i),this.array[e+2]=Ai(r),this.array[e+3]=Ai(s),this}}class ze extends $t{constructor(e,t,i){super(new Float32Array(e),t,i)}}let eW=0;const rr=new ot,V_=new Ft,Gl=new F,zi=new ci,Hu=new ci,kn=new F;class yt extends hs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:eW++}),this.uuid=Ki(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(kL(e)?mw:pw)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new gt().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return rr.makeRotationFromQuaternion(e),this.applyMatrix4(rr),this}rotateX(e){return rr.makeRotationX(e),this.applyMatrix4(rr),this}rotateY(e){return rr.makeRotationY(e),this.applyMatrix4(rr),this}rotateZ(e){return rr.makeRotationZ(e),this.applyMatrix4(rr),this}translate(e,t,i){return rr.makeTranslation(e,t,i),this.applyMatrix4(rr),this}scale(e,t,i){return rr.makeScale(e,t,i),this.applyMatrix4(rr),this}lookAt(e){return V_.lookAt(e),V_.updateMatrix(),this.applyMatrix4(V_.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Gl).negate(),this.translate(Gl.x,Gl.y,Gl.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let r=0,s=e.length;r<s;r++){const a=e[r];i.push(a.x,a.y,a.z||0)}this.setAttribute("position",new ze(i,3))}else{const i=Math.min(e.length,t.count);for(let r=0;r<i;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&Ie("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ci);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){lt("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new F(-1/0,-1/0,-1/0),new F(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];zi.setFromBufferAttribute(s),this.morphTargetsRelative?(kn.addVectors(this.boundingBox.min,zi.min),this.boundingBox.expandByPoint(kn),kn.addVectors(this.boundingBox.max,zi.max),this.boundingBox.expandByPoint(kn)):(this.boundingBox.expandByPoint(zi.min),this.boundingBox.expandByPoint(zi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&lt('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){lt("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new F,1/0);return}if(e){const i=this.boundingSphere.center;if(zi.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];Hu.setFromBufferAttribute(o),this.morphTargetsRelative?(kn.addVectors(zi.min,Hu.min),zi.expandByPoint(kn),kn.addVectors(zi.max,Hu.max),zi.expandByPoint(kn)):(zi.expandByPoint(Hu.min),zi.expandByPoint(Hu.max))}zi.getCenter(i);let r=0;for(let s=0,a=e.count;s<a;s++)kn.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(kn));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)kn.fromBufferAttribute(o,c),l&&(Gl.fromBufferAttribute(e,c),kn.add(Gl)),r=Math.max(r,i.distanceToSquared(kn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&lt('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){lt("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new $t(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let E=0;E<i.count;E++)o[E]=new F,l[E]=new F;const c=new F,u=new F,h=new F,d=new ce,p=new ce,g=new ce,_=new F,y=new F;function m(E,b,S){c.fromBufferAttribute(i,E),u.fromBufferAttribute(i,b),h.fromBufferAttribute(i,S),d.fromBufferAttribute(s,E),p.fromBufferAttribute(s,b),g.fromBufferAttribute(s,S),u.sub(c),h.sub(c),p.sub(d),g.sub(d);const I=1/(p.x*g.y-g.x*p.y);isFinite(I)&&(_.copy(u).multiplyScalar(g.y).addScaledVector(h,-p.y).multiplyScalar(I),y.copy(h).multiplyScalar(p.x).addScaledVector(u,-g.x).multiplyScalar(I),o[E].add(_),o[b].add(_),o[S].add(_),l[E].add(y),l[b].add(y),l[S].add(y))}let x=this.groups;x.length===0&&(x=[{start:0,count:e.count}]);for(let E=0,b=x.length;E<b;++E){const S=x[E],I=S.start,D=S.count;for(let P=I,$=I+D;P<$;P+=3)m(e.getX(P+0),e.getX(P+1),e.getX(P+2))}const v=new F,T=new F,R=new F,C=new F;function A(E){R.fromBufferAttribute(r,E),C.copy(R);const b=o[E];v.copy(b),v.sub(R.multiplyScalar(R.dot(b))).normalize(),T.crossVectors(C,b);const I=T.dot(l[E])<0?-1:1;a.setXYZW(E,v.x,v.y,v.z,I)}for(let E=0,b=x.length;E<b;++E){const S=x[E],I=S.start,D=S.count;for(let P=I,$=I+D;P<$;P+=3)A(e.getX(P+0)),A(e.getX(P+1)),A(e.getX(P+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new $t(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,p=i.count;d<p;d++)i.setXYZ(d,0,0,0);const r=new F,s=new F,a=new F,o=new F,l=new F,c=new F,u=new F,h=new F;if(e)for(let d=0,p=e.count;d<p;d+=3){const g=e.getX(d+0),_=e.getX(d+1),y=e.getX(d+2);r.fromBufferAttribute(t,g),s.fromBufferAttribute(t,_),a.fromBufferAttribute(t,y),u.subVectors(a,s),h.subVectors(r,s),u.cross(h),o.fromBufferAttribute(i,g),l.fromBufferAttribute(i,_),c.fromBufferAttribute(i,y),o.add(u),l.add(u),c.add(u),i.setXYZ(g,o.x,o.y,o.z),i.setXYZ(_,l.x,l.y,l.z),i.setXYZ(y,c.x,c.y,c.z)}else for(let d=0,p=t.count;d<p;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),a.fromBufferAttribute(t,d+2),u.subVectors(a,s),h.subVectors(r,s),u.cross(h),i.setXYZ(d+0,u.x,u.y,u.z),i.setXYZ(d+1,u.x,u.y,u.z),i.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)kn.fromBufferAttribute(e,t),kn.normalize(),e.setXYZ(t,kn.x,kn.y,kn.z)}toNonIndexed(){function e(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let p=0,g=0;for(let _=0,y=l.length;_<y;_++){o.isInterleavedBufferAttribute?p=l[_]*o.data.stride+o.offset:p=l[_]*u;for(let m=0;m<u;m++)d[g++]=c[p++]}return new $t(d,u,h)}if(this.index===null)return Ie("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new yt,i=this.index.array,r=this.attributes;for(const o in r){const l=r[o],c=e(l,i);t.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],p=e(d,i);l.push(p)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h];u.push(p.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone());const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const VA=new ot,_o=new gu,Kf=new qn,BA=new F,Yf=new F,Jf=new F,Zf=new F,B_=new F,Qf=new F,zA=new F,ep=new F;class tn extends Ft{constructor(e=new yt,t=new Pr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(s&&o){Qf.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=o[l],h=s[l];u!==0&&(B_.fromBufferAttribute(h,e),a?Qf.addScaledVector(B_,u):Qf.addScaledVector(B_.sub(t),u))}t.add(Qf)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Kf.copy(i.boundingSphere),Kf.applyMatrix4(s),_o.copy(e.ray).recast(e.near),!(Kf.containsPoint(_o.origin)===!1&&(_o.intersectSphere(Kf,BA)===null||_o.origin.distanceToSquared(BA)>(e.far-e.near)**2))&&(VA.copy(s).invert(),_o.copy(e.ray).applyMatrix4(VA),!(i.boundingBox!==null&&_o.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,_o)))}_computeIntersections(e,t,i){let r;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,p=s.drawRange;if(o!==null)if(Array.isArray(a))for(let g=0,_=d.length;g<_;g++){const y=d[g],m=a[y.materialIndex],x=Math.max(y.start,p.start),v=Math.min(o.count,Math.min(y.start+y.count,p.start+p.count));for(let T=x,R=v;T<R;T+=3){const C=o.getX(T),A=o.getX(T+1),E=o.getX(T+2);r=tp(this,m,e,i,c,u,h,C,A,E),r&&(r.faceIndex=Math.floor(T/3),r.face.materialIndex=y.materialIndex,t.push(r))}}else{const g=Math.max(0,p.start),_=Math.min(o.count,p.start+p.count);for(let y=g,m=_;y<m;y+=3){const x=o.getX(y),v=o.getX(y+1),T=o.getX(y+2);r=tp(this,a,e,i,c,u,h,x,v,T),r&&(r.faceIndex=Math.floor(y/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(a))for(let g=0,_=d.length;g<_;g++){const y=d[g],m=a[y.materialIndex],x=Math.max(y.start,p.start),v=Math.min(l.count,Math.min(y.start+y.count,p.start+p.count));for(let T=x,R=v;T<R;T+=3){const C=T,A=T+1,E=T+2;r=tp(this,m,e,i,c,u,h,C,A,E),r&&(r.faceIndex=Math.floor(T/3),r.face.materialIndex=y.materialIndex,t.push(r))}}else{const g=Math.max(0,p.start),_=Math.min(l.count,p.start+p.count);for(let y=g,m=_;y<m;y+=3){const x=y,v=y+1,T=y+2;r=tp(this,a,e,i,c,u,h,x,v,T),r&&(r.faceIndex=Math.floor(y/3),t.push(r))}}}}function tW(n,e,t,i,r,s,a,o){let l;if(e.side===vi?l=i.intersectTriangle(a,s,r,!0,o):l=i.intersectTriangle(r,s,a,e.side===Gs,o),l===null)return null;ep.copy(o),ep.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(ep);return c<t.near||c>t.far?null:{distance:c,point:ep.clone(),object:n}}function tp(n,e,t,i,r,s,a,o,l,c){n.getVertexPosition(o,Yf),n.getVertexPosition(l,Jf),n.getVertexPosition(c,Zf);const u=tW(n,e,t,i,Yf,Jf,Zf,zA);if(u){const h=new F;Ii.getBarycoord(zA,Yf,Jf,Zf,h),r&&(u.uv=Ii.getInterpolatedAttribute(r,o,l,c,h,new ce)),s&&(u.uv1=Ii.getInterpolatedAttribute(s,o,l,c,h,new ce)),a&&(u.normal=Ii.getInterpolatedAttribute(a,o,l,c,h,new F),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a:o,b:l,c,normal:new F,materialIndex:0};Ii.getNormal(Yf,Jf,Zf,d.normal),u.face=d,u.barycoord=h}return u}class wl extends yt{constructor(e=1,t=1,i=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:a};const o=this;r=Math.floor(r),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,p=0;g("z","y","x",-1,-1,i,t,e,a,s,0),g("z","y","x",1,-1,i,t,-e,a,s,1),g("x","z","y",1,1,e,i,t,r,a,2),g("x","z","y",1,-1,e,i,-t,r,a,3),g("x","y","z",1,-1,e,t,i,r,s,4),g("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new ze(c,3)),this.setAttribute("normal",new ze(u,3)),this.setAttribute("uv",new ze(h,2));function g(_,y,m,x,v,T,R,C,A,E,b){const S=T/A,I=R/E,D=T/2,P=R/2,$=C/2,Y=A+1,Z=E+1;let fe=0,B=0;const X=new F;for(let ee=0;ee<Z;ee++){const _e=ee*I-P;for(let Ge=0;Ge<Y;Ge++){const ft=Ge*S-D;X[_]=ft*x,X[y]=_e*v,X[m]=$,c.push(X.x,X.y,X.z),X[_]=0,X[y]=0,X[m]=C>0?1:-1,u.push(X.x,X.y,X.z),h.push(Ge/A),h.push(1-ee/E),fe+=1}}for(let ee=0;ee<E;ee++)for(let _e=0;_e<A;_e++){const Ge=d+_e+Y*ee,ft=d+_e+Y*(ee+1),pt=d+(_e+1)+Y*(ee+1),wt=d+(_e+1)+Y*ee;l.push(Ge,ft,wt),l.push(ft,pt,wt),B+=6}o.addGroup(p,B,b),p+=B,d+=fe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function nu(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(Ie("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function gi(n){const e={};for(let t=0;t<n.length;t++){const i=nu(n[t]);for(const r in i)e[r]=i[r]}return e}function nW(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function BL(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Lt.workingColorSpace}const zL={clone:nu,merge:gi};var iW=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,rW=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Zi extends Kn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=iW,this.fragmentShader=rW,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nu(e.uniforms),this.uniformsGroups=nW(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class q0 extends Ft{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ot,this.projectionMatrix=new ot,this.projectionMatrixInverse=new ot,this.coordinateSystem=ji,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const ua=new F,HA=new ce,GA=new ce;class In extends q0{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=tu*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ko*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return tu*2*Math.atan(Math.tan(Ko*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){ua.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(ua.x,ua.y).multiplyScalar(-e/ua.z),ua.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ua.x,ua.y).multiplyScalar(-e/ua.z)}getViewSize(e,t){return this.getViewBounds(e,HA,GA),t.subVectors(GA,HA)}setViewOffset(e,t,i,r,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Ko*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*r/l,t-=a.offsetY*i/c,r*=a.width/l,i*=a.height/c}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Wl=-90,$l=1;class HL extends Ft{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new In(Wl,$l,e,t);r.layers=this.layers,this.add(r);const s=new In(Wl,$l,e,t);s.layers=this.layers,this.add(s);const a=new In(Wl,$l,e,t);a.layers=this.layers,this.add(a);const o=new In(Wl,$l,e,t);o.layers=this.layers,this.add(o);const l=new In(Wl,$l,e,t);l.layers=this.layers,this.add(l);const c=new In(Wl,$l,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,a,o,l]=t;for(const c of t)this.remove(c);if(e===ji)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Qc)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,c,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,a),e.setRenderTarget(i,2,r),e.render(t,o),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,c),i.texture.generateMipmaps=_,e.setRenderTarget(i,5,r),e.render(t,u),e.setRenderTarget(h,d,p),e.xr.enabled=g,i.texture.needsPMREMUpdate=!0}}class Yd extends fn{constructor(e=[],t=Ws,i,r,s,a,o,l,c,u){super(e,t,i,r,s,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class GL extends kr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new Yd(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new wl(5,5,5),s=new Zi({name:"CubemapFromEquirect",uniforms:nu(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:vi,blending:os});s.uniforms.tEquirect.value=t;const a=new tn(r,s),o=t.minFilter;return t.minFilter===Yr&&(t.minFilter=sn),new HL(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,i=!0,r=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,r);e.setRenderTarget(s)}}class Sc extends Ft{constructor(){super(),this.isGroup=!0,this.type="Group"}}const sW={type:"move"};class im{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Sc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Sc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new F,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new F),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Sc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new F,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new F),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const _ of e.hand.values()){const y=t.getJointPose(_,i),m=this._getHandJoint(c,_);y!==null&&(m.matrix.fromArray(y.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=y.radius),m.visible=y!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,g=.005;c.inputState.pinching&&d>p+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=p-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(sW)))}return o!==null&&(o.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Sc;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class j0{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new De(e),this.density=t}clone(){return new j0(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class X0{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new De(e),this.near=t,this.far=i}clone(){return new X0(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class K0 extends Ft{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ji,this.environmentIntensity=1,this.environmentRotation=new Ji,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Y0{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=_d,this.updateRanges=[],this.version=0,this.uuid=Ki()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ki()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ki()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const mi=new F;class ul{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)mi.fromBufferAttribute(this,t),mi.applyMatrix4(e),this.setXYZ(t,mi.x,mi.y,mi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)mi.fromBufferAttribute(this,t),mi.applyNormalMatrix(e),this.setXYZ(t,mi.x,mi.y,mi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)mi.fromBufferAttribute(this,t),mi.transformDirection(e),this.setXYZ(t,mi.x,mi.y,mi.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=_i(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=_t(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=_t(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=_t(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=_t(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=_t(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=_i(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=_i(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=_i(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=_i(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=_t(t,this.array),i=_t(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=_t(t,this.array),i=_t(i,this.array),r=_t(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=_t(t,this.array),i=_t(i,this.array),r=_t(r,this.array),s=_t(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){vd("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new $t(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ul(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){vd("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class gw extends Kn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new De(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let ql;const Gu=new F,jl=new F,Xl=new F,Kl=new ce,Wu=new ce,WL=new ot,np=new F,$u=new F,ip=new F,WA=new ce,z_=new ce,$A=new ce;class $L extends Ft{constructor(e=new gw){if(super(),this.isSprite=!0,this.type="Sprite",ql===void 0){ql=new yt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Y0(t,5);ql.setIndex([0,1,2,0,2,3]),ql.setAttribute("position",new ul(i,3,0,!1)),ql.setAttribute("uv",new ul(i,2,3,!1))}this.geometry=ql,this.material=e,this.center=new ce(.5,.5),this.count=1}raycast(e,t){e.camera===null&&lt('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),jl.setFromMatrixScale(this.matrixWorld),WL.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Xl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&jl.multiplyScalar(-Xl.z);const i=this.material.rotation;let r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));const a=this.center;rp(np.set(-.5,-.5,0),Xl,a,jl,r,s),rp($u.set(.5,-.5,0),Xl,a,jl,r,s),rp(ip.set(.5,.5,0),Xl,a,jl,r,s),WA.set(0,0),z_.set(1,0),$A.set(1,1);let o=e.ray.intersectTriangle(np,$u,ip,!1,Gu);if(o===null&&(rp($u.set(-.5,.5,0),Xl,a,jl,r,s),z_.set(0,1),o=e.ray.intersectTriangle(np,ip,$u,!1,Gu),o===null))return;const l=e.ray.origin.distanceTo(Gu);l<e.near||l>e.far||t.push({distance:l,point:Gu.clone(),uv:Ii.getInterpolation(Gu,np,$u,ip,WA,z_,$A,new ce),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function rp(n,e,t,i,r,s){Kl.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(Wu.x=s*Kl.x-r*Kl.y,Wu.y=r*Kl.x+s*Kl.y):Wu.copy(Kl),n.copy(e),n.x+=Wu.x,n.y+=Wu.y,n.applyMatrix4(WL)}const sp=new F,qA=new F;class qL extends Ft{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,r=t.length;i<r;i++){const s=t[i];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let i=0;i<t.length;i++)if(t[i].distance===e){const r=t.splice(i,1);return this.remove(r[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r;i++){let s=t[i].distance;if(t[i].object.visible&&(s-=s*t[i].hysteresis),e<s)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){sp.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(sp);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){sp.setFromMatrixPosition(e.matrixWorld),qA.setFromMatrixPosition(this.matrixWorld);const i=sp.distanceTo(qA)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s;r++){let a=t[r].distance;if(t[r].object.visible&&(a-=a*t[r].hysteresis),i>=a)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let r=0,s=i.length;r<s;r++){const a=i[r];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const jA=new F,XA=new kt,KA=new kt,aW=new F,YA=new ot,ap=new F,H_=new qn,JA=new ot,G_=new gu;class jL extends tn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Xv,this.bindMatrix=new ot,this.bindMatrixInverse=new ot,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ci),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,ap),this.boundingBox.expandByPoint(ap)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new qn),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,ap),this.boundingSphere.expandByPoint(ap)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),H_.copy(this.boundingSphere),H_.applyMatrix4(r),e.ray.intersectsSphere(H_)!==!1&&(JA.copy(r).invert(),G_.copy(e.ray).applyMatrix4(JA),!(this.boundingBox!==null&&G_.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,G_)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new kt,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Xv?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===bL?this.bindMatrixInverse.copy(this.bindMatrix).invert():Ie("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,r=this.geometry;XA.fromBufferAttribute(r.attributes.skinIndex,e),KA.fromBufferAttribute(r.attributes.skinWeight,e),jA.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=KA.getComponent(s);if(a!==0){const o=XA.getComponent(s);YA.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),t.addScaledVector(aW.copy(jA).applyMatrix4(YA),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class yw extends Ft{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Lr extends fn{constructor(e=null,t=1,i=1,r,s,a,o,l,c=$n,u=$n,h,d){super(null,a,o,l,c,u,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const ZA=new ot,oW=new ot;class J0{constructor(e=[],t=[]){this.uuid=Ki(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){Ie("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new ot)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new ot;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:oW;ZA.multiplyMatrices(o,t[s]),ZA.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new J0(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Lr(t,e,e,li,Li);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let a=t[s];a===void 0&&(Ie("Skeleton: No bone found with UUID:",s),a=new yw),this.bones.push(a),this.boneInverses.push(new ot().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const a=t[r];e.bones.push(a.uuid);const o=i[r];e.boneInverses.push(o.toArray())}return e}}class iu extends $t{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Yl=new ot,QA=new ot,op=[],eM=new ci,lW=new ot,qu=new tn,ju=new qn;class XL extends tn{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new iu(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,lW)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new ci),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Yl),eM.copy(e.boundingBox).applyMatrix4(Yl),this.boundingBox.union(eM)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new qn),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Yl),ju.copy(e.boundingSphere).applyMatrix4(Yl),this.boundingSphere.union(ju)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,a=e*s+1;for(let o=0;o<i.length;o++)i[o]=r[a+o]}raycast(e,t){const i=this.matrixWorld,r=this.count;if(qu.geometry=this.geometry,qu.material=this.material,qu.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ju.copy(this.boundingSphere),ju.applyMatrix4(i),e.ray.intersectsSphere(ju)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Yl),QA.multiplyMatrices(i,Yl),qu.matrixWorld=QA,qu.raycast(e,op);for(let a=0,o=op.length;a<o;a++){const l=op[a];l.instanceId=s,l.object=this,t.push(l)}op.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new iu(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new Lr(new Float32Array(r*this.count),r,this.count,F0,Li));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<i.length;c++)a+=i[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=r*e;s[l]=o,s.set(i,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const W_=new F,cW=new F,uW=new gt;class ma{constructor(e=new F(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=W_.subVectors(i,t).cross(cW.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(W_),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||uW.getNormalMatrix(e),r=this.coplanarPoint(W_).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const xo=new qn,hW=new ce(.5,.5),lp=new F;class yu{constructor(e=new ma,t=new ma,i=new ma,r=new ma,s=new ma,a=new ma){this.planes=[e,t,i,r,s,a]}set(e,t,i,r,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=ji,i=!1){const r=this.planes,s=e.elements,a=s[0],o=s[1],l=s[2],c=s[3],u=s[4],h=s[5],d=s[6],p=s[7],g=s[8],_=s[9],y=s[10],m=s[11],x=s[12],v=s[13],T=s[14],R=s[15];if(r[0].setComponents(c-a,p-u,m-g,R-x).normalize(),r[1].setComponents(c+a,p+u,m+g,R+x).normalize(),r[2].setComponents(c+o,p+h,m+_,R+v).normalize(),r[3].setComponents(c-o,p-h,m-_,R-v).normalize(),i)r[4].setComponents(l,d,y,T).normalize(),r[5].setComponents(c-l,p-d,m-y,R-T).normalize();else if(r[4].setComponents(c-l,p-d,m-y,R-T).normalize(),t===ji)r[5].setComponents(c+l,p+d,m+y,R+T).normalize();else if(t===Qc)r[5].setComponents(l,d,y,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),xo.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),xo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(xo)}intersectsSprite(e){xo.center.set(0,0,0);const t=hW.distanceTo(e.center);return xo.radius=.7071067811865476+t,xo.applyMatrix4(e.matrixWorld),this.intersectsSphere(xo)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(lp.x=r.normal.x>0?e.max.x:e.min.x,lp.y=r.normal.y>0?e.max.y:e.min.y,lp.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(lp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const zr=new ot,Hr=new yu;class Z0{constructor(){this.coordinateSystem=ji}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(zr.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hr.setFromProjectionMatrix(zr,r.coordinateSystem,r.reversedDepth),Hr.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(zr.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hr.setFromProjectionMatrix(zr,r.coordinateSystem,r.reversedDepth),Hr.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(zr.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hr.setFromProjectionMatrix(zr,r.coordinateSystem,r.reversedDepth),Hr.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(zr.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hr.setFromProjectionMatrix(zr,r.coordinateSystem,r.reversedDepth),Hr.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(zr.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Hr.setFromProjectionMatrix(zr,r.coordinateSystem,r.reversedDepth),Hr.containsPoint(e))return!0}return!1}clone(){return new Z0}}function $_(n,e){return n-e}function dW(n,e){return n.z-e.z}function fW(n,e){return e.z-n.z}class pW{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,i,r){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=i,o.index=r}reset(){this.list.length=0,this.index=0}}const Ei=new ot,mW=new De(1,1,1),tM=new yu,gW=new Z0,cp=new ci,vo=new qn,Xu=new F,nM=new F,yW=new F,q_=new pW,ni=new tn,up=[];function _W(n,e,t=0){const i=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const r=n.count;for(let s=0;s<r;s++)for(let a=0;a<i;a++)e.setComponent(s+t,a,n.getComponent(s,a))}else e.array.set(n.array,t*i);e.needsUpdate=!0}function So(n,e){if(n.constructor!==e.constructor){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++)e[i]=n[i]}else{const t=Math.min(n.length,e.length);e.set(new n.constructor(n.buffer,0,t))}}class KL extends tn{constructor(e,t,i=t*2,r){super(new yt,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new Lr(t,e,e,li,Li);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),i=new Lr(t,e,e,Kd,$s);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),i=new Lr(t,e,e,li,Li);i.colorSpace=Lt.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:o,itemSize:l,normalized:c}=a,u=new o.constructor(i*l),h=new $t(u,l,c);t.setAttribute(s,h)}if(e.getIndex()!==null){const s=i>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new $t(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(!e.hasAttribute(i))throw new Error(`THREE.BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const r=e.getAttribute(i),s=t.getAttribute(i);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ci);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let i=0,r=t.length;i<r;i++){if(t[i].active===!1)continue;const s=t[i].geometryIndex;this.getMatrixAt(i,Ei),this.getBoundingBoxAt(s,cp).applyMatrix4(Ei),e.union(cp)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qn);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let i=0,r=t.length;i<r;i++){if(t[i].active===!1)continue;const s=t[i].geometryIndex;this.getMatrixAt(i,Ei),this.getBoundingSphereAt(s,vo).applyMatrix4(Ei),e.union(vo)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let r=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort($_),r=this._availableInstanceIds.shift(),this._instanceInfo[r]=i):(r=this._instanceInfo.length,this._instanceInfo.push(i));const s=this._matricesTexture;Ei.identity().toArray(s.image.data,r*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(mW.toArray(a.image.data,r*4),a.needsUpdate=!0),this._visibilityChanged=!0,r}addGeometry(e,t=-1,i=-1){this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=i===-1?a.count:i),r.indexStart!==-1&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort($_),l=this._availableGeometryIds.shift(),s[l]=r):(l=this._geometryCount,this._geometryCount++,s.push(r)),this.setGeometryAt(l,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,l}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,r=i.getIndex()!==null,s=i.getIndex(),a=t.getIndex(),o=this._geometryInfo[e];if(r&&a.count>o.reservedIndexCount||t.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=t.getAttribute("position").count;for(const u in i.attributes){const h=t.getAttribute(u),d=i.getAttribute(u);_W(h,d,l);const p=h.itemSize;for(let g=h.count,_=c;g<_;g++){const y=l+g;for(let m=0;m<p;m++)d.setComponent(y,m,0)}d.needsUpdate=!0,d.addUpdateRange(l*p,c*p)}if(r){const u=o.indexStart,h=o.reservedIndexCount;o.indexCount=t.getIndex().count;for(let d=0;d<a.count;d++)s.setX(u+d,l+a.getX(d));for(let d=a.count,p=h;d<p;d++)s.setX(u+d,l);s.needsUpdate=!0,s.addUpdateRange(u,o.reservedIndexCount)}return o.start=r?o.indexStart:o.vertexStart,o.count=r?o.indexCount:o.vertexCount,o.boundingBox=null,t.boundingBox!==null&&(o.boundingBox=t.boundingBox.clone()),o.boundingSphere=null,t.boundingSphere!==null&&(o.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const i=this._instanceInfo;for(let r=0,s=i.length;r<s;r++)i[r].active&&i[r].geometryIndex===e&&this.deleteInstance(r);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const i=this._geometryInfo,r=i.map((a,o)=>o).sort((a,o)=>i[a].vertexStart-i[o].vertexStart),s=this.geometry;for(let a=0,o=i.length;a<o;a++){const l=r[a],c=i[l];if(c.active!==!1){if(s.index!==null){if(c.indexStart!==t){const{indexStart:u,vertexStart:h,reservedIndexCount:d}=c,p=s.index,g=p.array,_=e-h;for(let y=u;y<u+d;y++)g[y]=g[y]+_;p.array.copyWithin(t,u,u+d),p.addUpdateRange(t,d),c.indexStart=t}t+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:u,reservedVertexCount:h}=c,d=s.attributes;for(const p in d){const g=d[p],{array:_,itemSize:y}=g;_.copyWithin(e*y,u*y,(u+h)*y),g.addUpdateRange(e*y,h*y)}c.vertexStart=e}e+=c.reservedVertexCount,c.start=s.index?c.indexStart:c.vertexStart,this._nextIndexStart=s.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingBox===null){const s=new ci,a=i.index,o=i.attributes.position;for(let l=r.start,c=r.start+r.count;l<c;l++){let u=l;a&&(u=a.getX(u)),s.expandByPoint(Xu.fromBufferAttribute(o,u))}r.boundingBox=s}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingSphere===null){const s=new qn;this.getBoundingBoxAt(e,cp),cp.getCenter(s.center);const a=i.index,o=i.attributes.position;let l=0;for(let c=r.start,u=r.start+r.count;c<u;c++){let h=c;a&&(h=a.getX(h)),Xu.fromBufferAttribute(o,h),l=Math.max(l,s.center.distanceToSquared(Xu))}s.radius=Math.sqrt(l),r.boundingSphere=s}return t.copy(r.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const i=this._matricesTexture,r=this._matricesTexture.image.data;return t.toArray(r,e*16),i.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const i=this._geometryInfo[e];return t.vertexStart=i.vertexStart,t.vertexCount=i.vertexCount,t.reservedVertexCount=i.reservedVertexCount,t.indexStart=i.indexStart,t.indexCount=i.indexCount,t.reservedIndexCount=i.reservedIndexCount,t.start=i.start,t.count=i.count,t}setInstanceCount(e){const t=this._availableInstanceIds,i=this._instanceInfo;for(t.sort($_);t[t.length-1]===i.length-1;)i.pop(),t.pop();if(e<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const r=new Int32Array(e),s=new Int32Array(e);So(this._multiDrawCounts,r),So(this._multiDrawStarts,s),this._multiDrawCounts=r,this._multiDrawStarts=s,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),So(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),So(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),So(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const i=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...i.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map(l=>l.indexStart+l.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new yt,this._initializeGeometry(s));const a=this.geometry;s.index&&So(s.index.array,a.index.array);for(const o in s.attributes)So(s.attributes[o].array,a.attributes[o].array)}raycast(e,t){const i=this._instanceInfo,r=this._geometryInfo,s=this.matrixWorld,a=this.geometry;ni.material=this.material,ni.geometry.index=a.index,ni.geometry.attributes=a.attributes,ni.geometry.boundingBox===null&&(ni.geometry.boundingBox=new ci),ni.geometry.boundingSphere===null&&(ni.geometry.boundingSphere=new qn);for(let o=0,l=i.length;o<l;o++){if(!i[o].visible||!i[o].active)continue;const c=i[o].geometryIndex,u=r[c];ni.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(o,ni.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,ni.geometry.boundingBox),this.getBoundingSphereAt(c,ni.geometry.boundingSphere),ni.raycast(e,up);for(let h=0,d=up.length;h<d;h++){const p=up[h];p.object=this,p.batchId=o,t.push(p)}up.length=0}ni.material=null,ni.geometry.index=null,ni.geometry.attributes={},ni.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,i,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=r.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._geometryInfo,d=this.perObjectFrustumCulled,p=this._indirectTexture,g=p.image.data,_=i.isArrayCamera?gW:tM;d&&!i.isArrayCamera&&(Ei.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),tM.setFromProjectionMatrix(Ei,i.coordinateSystem,i.reversedDepth));let y=0;if(this.sortObjects){Ei.copy(this.matrixWorld).invert(),Xu.setFromMatrixPosition(i.matrixWorld).applyMatrix4(Ei),nM.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(Ei);for(let v=0,T=l.length;v<T;v++)if(l[v].visible&&l[v].active){const R=l[v].geometryIndex;this.getMatrixAt(v,Ei),this.getBoundingSphereAt(R,vo).applyMatrix4(Ei);let C=!1;if(d&&(C=!_.intersectsSphere(vo,i)),!C){const A=h[R],E=yW.subVectors(vo.center,Xu).dot(nM);q_.push(A.start,A.count,E,v)}}const m=q_.list,x=this.customSort;x===null?m.sort(s.transparent?fW:dW):x.call(this,m,i);for(let v=0,T=m.length;v<T;v++){const R=m[v];c[y]=R.start*o,u[y]=R.count,g[y]=R.index,y++}q_.reset()}else for(let m=0,x=l.length;m<x;m++)if(l[m].visible&&l[m].active){const v=l[m].geometryIndex;let T=!1;if(d&&(this.getMatrixAt(m,Ei),this.getBoundingSphereAt(v,vo).applyMatrix4(Ei),T=!_.intersectsSphere(vo,i)),!T){const R=h[v];c[y]=R.start*o,u[y]=R.count,g[y]=m,y++}}p.needsUpdate=!0,this._multiDrawCount=y,this._visibilityChanged=!1}onBeforeShadow(e,t,i,r,s,a){this.onBeforeRender(e,null,r,s,a)}}class wi extends Kn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new De(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Vg=new F,Bg=new F,iM=new ot,Ku=new gu,hp=new qn,j_=new F,rM=new F;class io extends Ft{constructor(e=new yt,t=new wi){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)Vg.fromBufferAttribute(t,r-1),Bg.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=Vg.distanceTo(Bg);e.setAttribute("lineDistance",new ze(i,1))}else Ie("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),hp.copy(i.boundingSphere),hp.applyMatrix4(r),hp.radius+=s,e.ray.intersectsSphere(hp)===!1)return;iM.copy(r).invert(),Ku.copy(e.ray).applyMatrix4(iM);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,u=i.index,d=i.attributes.position;if(u!==null){const p=Math.max(0,a.start),g=Math.min(u.count,a.start+a.count);for(let _=p,y=g-1;_<y;_+=c){const m=u.getX(_),x=u.getX(_+1),v=dp(this,e,Ku,l,m,x,_);v&&t.push(v)}if(this.isLineLoop){const _=u.getX(g-1),y=u.getX(p),m=dp(this,e,Ku,l,_,y,g-1);m&&t.push(m)}}else{const p=Math.max(0,a.start),g=Math.min(d.count,a.start+a.count);for(let _=p,y=g-1;_<y;_+=c){const m=dp(this,e,Ku,l,_,_+1,_);m&&t.push(m)}if(this.isLineLoop){const _=dp(this,e,Ku,l,g-1,p,g-1);_&&t.push(_)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function dp(n,e,t,i,r,s,a){const o=n.geometry.attributes.position;if(Vg.fromBufferAttribute(o,r),Bg.fromBufferAttribute(o,s),t.distanceSqToSegment(Vg,Bg,j_,rM)>i)return;j_.applyMatrix4(n.matrixWorld);const c=e.ray.origin.distanceTo(j_);if(!(c<e.near||c>e.far))return{distance:c,point:rM.clone().applyMatrix4(n.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:n}}const sM=new F,aM=new F;class ds extends io{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)sM.fromBufferAttribute(t,r),aM.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+sM.distanceTo(aM);e.setAttribute("lineDistance",new ze(i,1))}else Ie("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class YL extends io{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class _w extends Kn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new De(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const oM=new ot,Jv=new gu,fp=new qn,pp=new F;class JL extends Ft{constructor(e=new yt,t=new _w){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),fp.copy(i.boundingSphere),fp.applyMatrix4(r),fp.radius+=s,e.ray.intersectsSphere(fp)===!1)return;oM.copy(r).invert(),Jv.copy(e.ray).applyMatrix4(oM);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=i.index,h=i.attributes.position;if(c!==null){const d=Math.max(0,a.start),p=Math.min(c.count,a.start+a.count);for(let g=d,_=p;g<_;g++){const y=c.getX(g);pp.fromBufferAttribute(h,y),lM(pp,y,l,r,e,t,this)}}else{const d=Math.max(0,a.start),p=Math.min(h.count,a.start+a.count);for(let g=d,_=p;g<_;g++)pp.fromBufferAttribute(h,g),lM(pp,g,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function lM(n,e,t,i,r,s,a){const o=Jv.distanceSqToPoint(n);if(o<t){const l=new F;Jv.closestPointToPoint(n,l),l.applyMatrix4(i);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class ZL extends fn{constructor(e,t,i,r,s=sn,a=sn,o,l,c){super(e,t,i,r,s,a,o,l,c),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const u=this;function h(){u.needsUpdate=!0,u._requestVideoFrameCallbackId=e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(h))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class xW extends ZL{constructor(e,t,i,r,s,a,o,l){super({},e,t,i,r,s,a,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class vW extends fn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=$n,this.minFilter=$n,this.generateMipmaps=!1,this.needsUpdate=!0}}class Q0 extends fn{constructor(e,t,i,r,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,r,s,h,d),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class SW extends Q0{constructor(e,t,i,r,s,a){super(e,t,i,s,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Pi,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class bW extends Q0{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,Ws),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class wW extends fn{constructor(e,t,i,r,s,a,o,l,c){super(e,t,i,r,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class xw extends fn{constructor(e,t,i=$s,r,s,a,o=$n,l=$n,c,u=Jc,h=1){if(u!==Jc&&u!==Zc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const d={width:e,height:t,depth:h};super(d,r,s,a,o,l,u,i,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Ca(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class vw extends fn{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class ey extends yt{constructor(e=1,t=1,i=4,r=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:r,heightSegments:s},t=Math.max(0,t),i=Math.max(1,Math.floor(i)),r=Math.max(3,Math.floor(r)),s=Math.max(1,Math.floor(s));const a=[],o=[],l=[],c=[],u=t/2,h=Math.PI/2*e,d=t,p=2*h+d,g=i*2+s,_=r+1,y=new F,m=new F;for(let x=0;x<=g;x++){let v=0,T=0,R=0,C=0;if(x<=i){const b=x/i,S=b*Math.PI/2;T=-u-e*Math.cos(S),R=e*Math.sin(S),C=-e*Math.cos(S),v=b*h}else if(x<=i+s){const b=(x-i)/s;T=-u+b*t,R=e,C=0,v=h+b*d}else{const b=(x-i-s)/i,S=b*Math.PI/2;T=u+e*Math.sin(S),R=e*Math.cos(S),C=e*Math.sin(S),v=h+d+b*h}const A=Math.max(0,Math.min(1,v/p));let E=0;x===0?E=.5/r:x===g&&(E=-.5/r);for(let b=0;b<=r;b++){const S=b/r,I=S*Math.PI*2,D=Math.sin(I),P=Math.cos(I);m.x=-R*P,m.y=T,m.z=R*D,o.push(m.x,m.y,m.z),y.set(-R*P,C,R*D),y.normalize(),l.push(y.x,y.y,y.z),c.push(S+E,A)}if(x>0){const b=(x-1)*_;for(let S=0;S<r;S++){const I=b+S,D=b+S+1,P=x*_+S,$=x*_+S+1;a.push(I,D,P),a.push(D,$,P)}}}this.setIndex(a),this.setAttribute("position",new ze(o,3)),this.setAttribute("normal",new ze(l,3)),this.setAttribute("uv",new ze(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ey(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class ty extends yt{constructor(e=1,t=32,i=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},t=Math.max(3,t);const s=[],a=[],o=[],l=[],c=new F,u=new ce;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=t;h++,d+=3){const p=i+h/t*r;c.x=e*Math.cos(p),c.y=e*Math.sin(p),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/e+1)/2,u.y=(a[d+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=t;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new ze(a,3)),this.setAttribute("normal",new ze(o,3)),this.setAttribute("uv",new ze(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ty(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Jd extends yt{constructor(e=1,t=1,i=1,r=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],h=[],d=[],p=[];let g=0;const _=[],y=i/2;let m=0;x(),a===!1&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new ze(h,3)),this.setAttribute("normal",new ze(d,3)),this.setAttribute("uv",new ze(p,2));function x(){const T=new F,R=new F;let C=0;const A=(t-e)/i;for(let E=0;E<=s;E++){const b=[],S=E/s,I=S*(t-e)+e;for(let D=0;D<=r;D++){const P=D/r,$=P*l+o,Y=Math.sin($),Z=Math.cos($);R.x=I*Y,R.y=-S*i+y,R.z=I*Z,h.push(R.x,R.y,R.z),T.set(Y,A,Z).normalize(),d.push(T.x,T.y,T.z),p.push(P,1-S),b.push(g++)}_.push(b)}for(let E=0;E<r;E++)for(let b=0;b<s;b++){const S=_[b][E],I=_[b+1][E],D=_[b+1][E+1],P=_[b][E+1];(e>0||b!==0)&&(u.push(S,I,P),C+=3),(t>0||b!==s-1)&&(u.push(I,D,P),C+=3)}c.addGroup(m,C,0),m+=C}function v(T){const R=g,C=new ce,A=new F;let E=0;const b=T===!0?e:t,S=T===!0?1:-1;for(let D=1;D<=r;D++)h.push(0,y*S,0),d.push(0,S,0),p.push(.5,.5),g++;const I=g;for(let D=0;D<=r;D++){const $=D/r*l+o,Y=Math.cos($),Z=Math.sin($);A.x=b*Z,A.y=y*S,A.z=b*Y,h.push(A.x,A.y,A.z),d.push(0,S,0),C.x=Y*.5+.5,C.y=Z*.5*S+.5,p.push(C.x,C.y),g++}for(let D=0;D<r;D++){const P=R+D,$=I+D;T===!0?u.push($,$+1,P):u.push($+1,$,P),E+=3}c.addGroup(m,E,T===!0?1:2),m+=E}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jd(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Zd extends Jd{constructor(e=1,t=1,i=32,r=1,s=!1,a=0,o=Math.PI*2){super(0,e,t,i,r,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new Zd(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class uo extends yt{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};const s=[],a=[];o(r),c(i),u(),this.setAttribute("position",new ze(s,3)),this.setAttribute("normal",new ze(s.slice(),3)),this.setAttribute("uv",new ze(a,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function o(x){const v=new F,T=new F,R=new F;for(let C=0;C<t.length;C+=3)p(t[C+0],v),p(t[C+1],T),p(t[C+2],R),l(v,T,R,x)}function l(x,v,T,R){const C=R+1,A=[];for(let E=0;E<=C;E++){A[E]=[];const b=x.clone().lerp(T,E/C),S=v.clone().lerp(T,E/C),I=C-E;for(let D=0;D<=I;D++)D===0&&E===C?A[E][D]=b:A[E][D]=b.clone().lerp(S,D/I)}for(let E=0;E<C;E++)for(let b=0;b<2*(C-E)-1;b++){const S=Math.floor(b/2);b%2===0?(d(A[E][S+1]),d(A[E+1][S]),d(A[E][S])):(d(A[E][S+1]),d(A[E+1][S+1]),d(A[E+1][S]))}}function c(x){const v=new F;for(let T=0;T<s.length;T+=3)v.x=s[T+0],v.y=s[T+1],v.z=s[T+2],v.normalize().multiplyScalar(x),s[T+0]=v.x,s[T+1]=v.y,s[T+2]=v.z}function u(){const x=new F;for(let v=0;v<s.length;v+=3){x.x=s[v+0],x.y=s[v+1],x.z=s[v+2];const T=y(x)/2/Math.PI+.5,R=m(x)/Math.PI+.5;a.push(T,1-R)}g(),h()}function h(){for(let x=0;x<a.length;x+=6){const v=a[x+0],T=a[x+2],R=a[x+4],C=Math.max(v,T,R),A=Math.min(v,T,R);C>.9&&A<.1&&(v<.2&&(a[x+0]+=1),T<.2&&(a[x+2]+=1),R<.2&&(a[x+4]+=1))}}function d(x){s.push(x.x,x.y,x.z)}function p(x,v){const T=x*3;v.x=e[T+0],v.y=e[T+1],v.z=e[T+2]}function g(){const x=new F,v=new F,T=new F,R=new F,C=new ce,A=new ce,E=new ce;for(let b=0,S=0;b<s.length;b+=9,S+=6){x.set(s[b+0],s[b+1],s[b+2]),v.set(s[b+3],s[b+4],s[b+5]),T.set(s[b+6],s[b+7],s[b+8]),C.set(a[S+0],a[S+1]),A.set(a[S+2],a[S+3]),E.set(a[S+4],a[S+5]),R.copy(x).add(v).add(T).divideScalar(3);const I=y(R);_(C,S+0,x,I),_(A,S+2,v,I),_(E,S+4,T,I)}}function _(x,v,T,R){R<0&&x.x===1&&(a[v]=x.x-1),T.x===0&&T.z===0&&(a[v]=R/2/Math.PI+.5)}function y(x){return Math.atan2(x.z,-x.x)}function m(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uo(e.vertices,e.indices,e.radius,e.details)}}class ny extends uo{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ny(e.radius,e.detail)}}const mp=new F,gp=new F,X_=new F,yp=new Ii;class QL extends yt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(Ko*t),a=e.getIndex(),o=e.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},p=[];for(let g=0;g<l;g+=3){a?(c[0]=a.getX(g),c[1]=a.getX(g+1),c[2]=a.getX(g+2)):(c[0]=g,c[1]=g+1,c[2]=g+2);const{a:_,b:y,c:m}=yp;if(_.fromBufferAttribute(o,c[0]),y.fromBufferAttribute(o,c[1]),m.fromBufferAttribute(o,c[2]),yp.getNormal(X_),h[0]=`${Math.round(_.x*r)},${Math.round(_.y*r)},${Math.round(_.z*r)}`,h[1]=`${Math.round(y.x*r)},${Math.round(y.y*r)},${Math.round(y.z*r)}`,h[2]=`${Math.round(m.x*r)},${Math.round(m.y*r)},${Math.round(m.z*r)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let x=0;x<3;x++){const v=(x+1)%3,T=h[x],R=h[v],C=yp[u[x]],A=yp[u[v]],E=`${T}_${R}`,b=`${R}_${T}`;b in d&&d[b]?(X_.dot(d[b].normal)<=s&&(p.push(C.x,C.y,C.z),p.push(A.x,A.y,A.z)),d[b]=null):E in d||(d[E]={index0:c[x],index1:c[v],normal:X_.clone()})}}for(const g in d)if(d[g]){const{index0:_,index1:y}=d[g];mp.fromBufferAttribute(o,_),gp.fromBufferAttribute(o,y),p.push(mp.x,mp.y,mp.z),p.push(gp.x,gp.y,gp.z)}this.setAttribute("position",new ze(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Ur{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Ie("Curve: .getPoint() not implemented.")}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)i=this.getPoint(a/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const i=this.getLengths();let r=0;const s=i.length;let a;t?a=t:a=e*i[s-1];let o=0,l=s-1,c;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),c=i[r]-a,c<0)o=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,i[r]===a)return r/(s-1);const u=i[r],d=i[r+1]-u,p=(a-u)/d;return(r+p)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const a=this.getPoint(r),o=this.getPoint(s),l=t||(a.isVector2?new ce:new F);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t=!1){const i=new F,r=[],s=[],a=[],o=new F,l=new ot;for(let p=0;p<=e;p++){const g=p/e;r[p]=this.getTangentAt(g,new F)}s[0]=new F,a[0]=new F;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=c&&(c=u,i.set(1,0,0)),h<=c&&(c=h,i.set(0,1,0)),d<=c&&i.set(0,0,1),o.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],o),a[0].crossVectors(r[0],s[0]);for(let p=1;p<=e;p++){if(s[p]=s[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();const g=Math.acos(st(r[p-1].dot(r[p]),-1,1));s[p].applyMatrix4(l.makeRotationAxis(o,g))}a[p].crossVectors(r[p],s[p])}if(t===!0){let p=Math.acos(st(s[0].dot(s[e]),-1,1));p/=e,r[0].dot(o.crossVectors(s[0],s[e]))>0&&(p=-p);for(let g=1;g<=e;g++)s[g].applyMatrix4(l.makeRotationAxis(r[g],p*g)),a[g].crossVectors(r[g],s[g])}return{tangents:r,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class iy extends Ur{constructor(e=0,t=0,i=1,r=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new ce){const i=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(a?s=0:s=r),this.aClockwise===!0&&!a&&(s===r?s=-r:s=s-r);const o=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,p=c-this.aY;l=d*u-p*h+this.aX,c=d*h+p*u+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class eD extends iy{constructor(e,t,i,r,s,a){super(e,t,i,i,r,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function Sw(){let n=0,e=0,t=0,i=0;function r(s,a,o,l){n=s,e=o,t=-3*s+3*a-2*o-l,i=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){r(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,r(a,o,d,p)},calc:function(s){const a=s*s,o=a*s;return n+e*s+t*a+i*o}}}const _p=new F,K_=new Sw,Y_=new Sw,J_=new Sw;class tD extends Ur{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new F){const i=t,r=this.points,s=r.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=r[(o-1)%s]:(_p.subVectors(r[0],r[1]).add(r[0]),c=_p);const h=r[o%s],d=r[(o+1)%s];if(this.closed||o+2<s?u=r[(o+2)%s]:(_p.subVectors(r[s-1],r[s-2]).add(r[s-1]),u=_p),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let g=Math.pow(c.distanceToSquared(h),p),_=Math.pow(h.distanceToSquared(d),p),y=Math.pow(d.distanceToSquared(u),p);_<1e-4&&(_=1),g<1e-4&&(g=_),y<1e-4&&(y=_),K_.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,g,_,y),Y_.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,g,_,y),J_.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,g,_,y)}else this.curveType==="catmullrom"&&(K_.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),Y_.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),J_.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return i.set(K_.calc(l),Y_.calc(l),J_.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new F().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function cM(n,e,t,i,r){const s=(i-e)*.5,a=(r-t)*.5,o=n*n,l=n*o;return(2*t-2*i+s+a)*l+(-3*t+3*i-2*s-a)*o+s*n+t}function TW(n,e){const t=1-n;return t*t*e}function EW(n,e){return 2*(1-n)*n*e}function AW(n,e){return n*n*e}function Dh(n,e,t,i){return TW(n,e)+EW(n,t)+AW(n,i)}function MW(n,e){const t=1-n;return t*t*t*e}function CW(n,e){const t=1-n;return 3*t*t*n*e}function IW(n,e){return 3*(1-n)*n*n*e}function RW(n,e){return n*n*n*e}function Nh(n,e,t,i,r){return MW(n,e)+CW(n,t)+IW(n,i)+RW(n,r)}class bw extends Ur{constructor(e=new ce,t=new ce,i=new ce,r=new ce){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new ce){const i=t,r=this.v0,s=this.v1,a=this.v2,o=this.v3;return i.set(Nh(e,r.x,s.x,a.x,o.x),Nh(e,r.y,s.y,a.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class nD extends Ur{constructor(e=new F,t=new F,i=new F,r=new F){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new F){const i=t,r=this.v0,s=this.v1,a=this.v2,o=this.v3;return i.set(Nh(e,r.x,s.x,a.x,o.x),Nh(e,r.y,s.y,a.y,o.y),Nh(e,r.z,s.z,a.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class ww extends Ur{constructor(e=new ce,t=new ce){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ce){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ce){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class iD extends Ur{constructor(e=new F,t=new F){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new F){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new F){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Tw extends Ur{constructor(e=new ce,t=new ce,i=new ce){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ce){const i=t,r=this.v0,s=this.v1,a=this.v2;return i.set(Dh(e,r.x,s.x,a.x),Dh(e,r.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ew extends Ur{constructor(e=new F,t=new F,i=new F){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new F){const i=t,r=this.v0,s=this.v1,a=this.v2;return i.set(Dh(e,r.x,s.x,a.x),Dh(e,r.y,s.y,a.y),Dh(e,r.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Aw extends Ur{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ce){const i=t,r=this.points,s=(r.length-1)*e,a=Math.floor(s),o=s-a,l=r[a===0?a:a-1],c=r[a],u=r[a>r.length-2?r.length-1:a+1],h=r[a>r.length-3?r.length-1:a+2];return i.set(cM(o,l.x,c.x,u.x,h.x),cM(o,l.y,c.y,u.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new ce().fromArray(r))}return this}}var zg=Object.freeze({__proto__:null,ArcCurve:eD,CatmullRomCurve3:tD,CubicBezierCurve:bw,CubicBezierCurve3:nD,EllipseCurve:iy,LineCurve:ww,LineCurve3:iD,QuadraticBezierCurve:Tw,QuadraticBezierCurve3:Ew,SplineCurve:Aw});class rD extends Ur{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new zg[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=i){const a=r[s]-i,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,s=this.curves;r<s.length;r++){const a=s[r],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];i&&i.equals(u)||(t.push(u),i=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(new zg[r.type]().fromJSON(r))}return this}}class Hg extends rD{constructor(e){super(),this.type="Path",this.currentPoint=new ce,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new ww(this.currentPoint.clone(),new ce(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const s=new Tw(this.currentPoint.clone(),new ce(e,t),new ce(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,a){const o=new bw(this.currentPoint.clone(),new ce(e,t),new ce(i,r),new ce(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new Aw(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,i,r,s,a),this}absarc(e,t,i,r,s,a){return this.absellipse(e,t,i,i,r,s,a),this}ellipse(e,t,i,r,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,i,r,s,a,o,l),this}absellipse(e,t,i,r,s,a,o,l){const c=new iy(e,t,i,r,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Yo extends Hg{constructor(e){super(e),this.uuid=Ki(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(new Hg().fromJSON(r))}return this}}function PW(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let s=sD(n,0,r,t,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c;if(i&&(s=kW(n,e,s,t)),n.length>80*t){o=n[0],l=n[1];let u=o,h=l;for(let d=t;d<r;d+=t){const p=n[d],g=n[d+1];p<o&&(o=p),g<l&&(l=g),p>u&&(u=p),g>h&&(h=g)}c=Math.max(u-o,h-l),c=c!==0?32767/c:0}return Sd(s,a,t,o,l,c,0),a}function sD(n,e,t,i,r){let s;if(r===jW(n,e,t,i)>0)for(let a=e;a<t;a+=i)s=uM(a/i|0,n[a],n[a+1],s);else for(let a=t-i;a>=e;a-=i)s=uM(a/i|0,n[a],n[a+1],s);return s&&ru(s,s.next)&&(wd(s),s=s.next),s}function hl(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(ru(t,t.next)||rn(t.prev,t,t.next)===0)){if(wd(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Sd(n,e,t,i,r,s,a){if(!n)return;!a&&s&&zW(n,i,r,s);let o=n;for(;n.prev!==n.next;){const l=n.prev,c=n.next;if(s?DW(n,i,r,s):LW(n)){e.push(l.i,n.i,c.i),wd(n),n=c.next,o=c.next;continue}if(n=c,n===o){a?a===1?(n=NW(hl(n),e),Sd(n,e,t,i,r,s,2)):a===2&&OW(n,e,t,i,r,s):Sd(hl(n),e,t,i,r,s,1);break}}}function LW(n){const e=n.prev,t=n,i=n.next;if(rn(e,t,i)>=0)return!1;const r=e.x,s=t.x,a=i.x,o=e.y,l=t.y,c=i.y,u=Math.min(r,s,a),h=Math.min(o,l,c),d=Math.max(r,s,a),p=Math.max(o,l,c);let g=i.next;for(;g!==e;){if(g.x>=u&&g.x<=d&&g.y>=h&&g.y<=p&&lh(r,o,s,l,a,c,g.x,g.y)&&rn(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function DW(n,e,t,i){const r=n.prev,s=n,a=n.next;if(rn(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,u=r.y,h=s.y,d=a.y,p=Math.min(o,l,c),g=Math.min(u,h,d),_=Math.max(o,l,c),y=Math.max(u,h,d),m=Zv(p,g,e,t,i),x=Zv(_,y,e,t,i);let v=n.prevZ,T=n.nextZ;for(;v&&v.z>=m&&T&&T.z<=x;){if(v.x>=p&&v.x<=_&&v.y>=g&&v.y<=y&&v!==r&&v!==a&&lh(o,u,l,h,c,d,v.x,v.y)&&rn(v.prev,v,v.next)>=0||(v=v.prevZ,T.x>=p&&T.x<=_&&T.y>=g&&T.y<=y&&T!==r&&T!==a&&lh(o,u,l,h,c,d,T.x,T.y)&&rn(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;v&&v.z>=m;){if(v.x>=p&&v.x<=_&&v.y>=g&&v.y<=y&&v!==r&&v!==a&&lh(o,u,l,h,c,d,v.x,v.y)&&rn(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;T&&T.z<=x;){if(T.x>=p&&T.x<=_&&T.y>=g&&T.y<=y&&T!==r&&T!==a&&lh(o,u,l,h,c,d,T.x,T.y)&&rn(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function NW(n,e){let t=n;do{const i=t.prev,r=t.next.next;!ru(i,r)&&oD(i,t,t.next,r)&&bd(i,r)&&bd(r,i)&&(e.push(i.i,t.i,r.i),wd(t),wd(t.next),t=n=r),t=t.next}while(t!==n);return hl(t)}function OW(n,e,t,i,r,s){let a=n;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&WW(a,o)){let l=lD(a,o);a=hl(a,a.next),l=hl(l,l.next),Sd(a,e,t,i,r,s,0),Sd(l,e,t,i,r,s,0);return}o=o.next}a=a.next}while(a!==n)}function kW(n,e,t,i){const r=[];for(let s=0,a=e.length;s<a;s++){const o=e[s]*i,l=s<a-1?e[s+1]*i:n.length,c=sD(n,o,l,i,!1);c===c.next&&(c.steiner=!0),r.push(GW(c))}r.sort(UW);for(let s=0;s<r.length;s++)t=FW(r[s],t);return t}function UW(n,e){let t=n.x-e.x;if(t===0&&(t=n.y-e.y,t===0)){const i=(n.next.y-n.y)/(n.next.x-n.x),r=(e.next.y-e.y)/(e.next.x-e.x);t=i-r}return t}function FW(n,e){const t=VW(n,e);if(!t)return e;const i=lD(t,n);return hl(i,i.next),hl(t,t.next)}function VW(n,e){let t=e;const i=n.x,r=n.y;let s=-1/0,a;if(ru(n,t))return t;do{if(ru(n,t.next))return t.next;if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const h=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=i&&h>s&&(s=h,a=t.x<t.next.x?t:t.next,h===i))return a}t=t.next}while(t!==e);if(!a)return null;const o=a,l=a.x,c=a.y;let u=1/0;t=a;do{if(i>=t.x&&t.x>=l&&i!==t.x&&aD(r<c?i:s,r,l,c,r<c?s:i,r,t.x,t.y)){const h=Math.abs(r-t.y)/(i-t.x);bd(t,n)&&(h<u||h===u&&(t.x>a.x||t.x===a.x&&BW(a,t)))&&(a=t,u=h)}t=t.next}while(t!==o);return a}function BW(n,e){return rn(n.prev,n,e.prev)<0&&rn(e.next,n,n.next)<0}function zW(n,e,t,i){let r=n;do r.z===0&&(r.z=Zv(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,HW(r)}function HW(n){let e,t=1;do{let i=n,r;n=null;let s=null;for(e=0;i;){e++;let a=i,o=0;for(let c=0;c<t&&(o++,a=a.nextZ,!!a);c++);let l=t;for(;o>0||l>0&&a;)o!==0&&(l===0||!a||i.z<=a.z)?(r=i,i=i.nextZ,o--):(r=a,a=a.nextZ,l--),s?s.nextZ=r:n=r,r.prevZ=s,s=r;i=a}s.nextZ=null,t*=2}while(e>1);return n}function Zv(n,e,t,i,r){return n=(n-t)*r|0,e=(e-i)*r|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function GW(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function aD(n,e,t,i,r,s,a,o){return(r-a)*(e-o)>=(n-a)*(s-o)&&(n-a)*(i-o)>=(t-a)*(e-o)&&(t-a)*(s-o)>=(r-a)*(i-o)}function lh(n,e,t,i,r,s,a,o){return!(n===a&&e===o)&&aD(n,e,t,i,r,s,a,o)}function WW(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!$W(n,e)&&(bd(n,e)&&bd(e,n)&&qW(n,e)&&(rn(n.prev,n,e.prev)||rn(n,e.prev,e))||ru(n,e)&&rn(n.prev,n,n.next)>0&&rn(e.prev,e,e.next)>0)}function rn(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function ru(n,e){return n.x===e.x&&n.y===e.y}function oD(n,e,t,i){const r=vp(rn(n,e,t)),s=vp(rn(n,e,i)),a=vp(rn(t,i,n)),o=vp(rn(t,i,e));return!!(r!==s&&a!==o||r===0&&xp(n,t,e)||s===0&&xp(n,i,e)||a===0&&xp(t,n,i)||o===0&&xp(t,e,i))}function xp(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function vp(n){return n>0?1:n<0?-1:0}function $W(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&oD(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function bd(n,e){return rn(n.prev,n,n.next)<0?rn(n,e,n.next)>=0&&rn(n,n.prev,e)>=0:rn(n,e,n.prev)<0||rn(n,n.next,e)<0}function qW(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function lD(n,e){const t=Qv(n.i,n.x,n.y),i=Qv(e.i,e.x,e.y),r=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function uM(n,e,t,i){const r=Qv(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function wd(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Qv(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function jW(n,e,t,i){let r=0;for(let s=e,a=t-i;s<t;s+=i)r+=(n[a]-n[s])*(n[s+1]+n[a+1]),a=s;return r}class XW{static triangulate(e,t,i=2){return PW(e,t,i)}}class Mr{static area(e){const t=e.length;let i=0;for(let r=t-1,s=0;s<t;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return Mr.area(e)<0}static triangulateShape(e,t){const i=[],r=[],s=[];hM(e),dM(i,e);let a=e.length;t.forEach(hM);for(let l=0;l<t.length;l++)r.push(a),a+=t[l].length,dM(i,t[l]);const o=XW.triangulate(i,r);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function hM(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function dM(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class ry extends yt{constructor(e=new Yo([new ce(.5,.5),new ce(-.5,.5),new ce(-.5,-.5),new ce(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],s=[];for(let o=0,l=e.length;o<l;o++){const c=e[o];a(c)}this.setAttribute("position",new ze(r,3)),this.setAttribute("uv",new ze(s,2)),this.computeVertexNormals();function a(o){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1;let d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,g=t.bevelSize!==void 0?t.bevelSize:p-.1,_=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const m=t.extrudePath,x=t.UVGenerator!==void 0?t.UVGenerator:KW;let v,T=!1,R,C,A,E;m&&(v=m.getSpacedPoints(u),T=!0,d=!1,R=m.computeFrenetFrames(u,!1),C=new F,A=new F,E=new F),d||(y=0,p=0,g=0,_=0);const b=o.extractPoints(c);let S=b.shape;const I=b.holes;if(!Mr.isClockWise(S)){S=S.reverse();for(let de=0,U=I.length;de<U;de++){const he=I[de];Mr.isClockWise(he)&&(I[de]=he.reverse())}}function P(de){const he=10000000000000001e-36;let me=de[0];for(let ve=1;ve<=de.length;ve++){const oe=ve%de.length,Ae=de[oe],be=Ae.x-me.x,Oe=Ae.y-me.y,k=be*be+Oe*Oe,L=Math.max(Math.abs(Ae.x),Math.abs(Ae.y),Math.abs(me.x),Math.abs(me.y)),G=he*L*L;if(k<=G){de.splice(oe,1),ve--;continue}me=Ae}}P(S),I.forEach(P);const $=I.length,Y=S;for(let de=0;de<$;de++){const U=I[de];S=S.concat(U)}function Z(de,U,he){return U||lt("ExtrudeGeometry: vec does not exist"),de.clone().addScaledVector(U,he)}const fe=S.length;function B(de,U,he){let me,ve,oe;const Ae=de.x-U.x,be=de.y-U.y,Oe=he.x-de.x,k=he.y-de.y,L=Ae*Ae+be*be,G=Ae*k-be*Oe;if(Math.abs(G)>Number.EPSILON){const Q=Math.sqrt(L),le=Math.sqrt(Oe*Oe+k*k),J=U.x-be/Q,$e=U.y+Ae/Q,Me=he.x-k/le,Xe=he.y+Oe/le,He=((Me-J)*k-(Xe-$e)*Oe)/(Ae*k-be*Oe);me=J+Ae*He-de.x,ve=$e+be*He-de.y;const ue=me*me+ve*ve;if(ue<=2)return new ce(me,ve);oe=Math.sqrt(ue/2)}else{let Q=!1;Ae>Number.EPSILON?Oe>Number.EPSILON&&(Q=!0):Ae<-Number.EPSILON?Oe<-Number.EPSILON&&(Q=!0):Math.sign(be)===Math.sign(k)&&(Q=!0),Q?(me=-be,ve=Ae,oe=Math.sqrt(L)):(me=Ae,ve=be,oe=Math.sqrt(L/2))}return new ce(me/oe,ve/oe)}const X=[];for(let de=0,U=Y.length,he=U-1,me=de+1;de<U;de++,he++,me++)he===U&&(he=0),me===U&&(me=0),X[de]=B(Y[de],Y[he],Y[me]);const ee=[];let _e,Ge=X.concat();for(let de=0,U=$;de<U;de++){const he=I[de];_e=[];for(let me=0,ve=he.length,oe=ve-1,Ae=me+1;me<ve;me++,oe++,Ae++)oe===ve&&(oe=0),Ae===ve&&(Ae=0),_e[me]=B(he[me],he[oe],he[Ae]);ee.push(_e),Ge=Ge.concat(_e)}let ft;if(y===0)ft=Mr.triangulateShape(Y,I);else{const de=[],U=[];for(let he=0;he<y;he++){const me=he/y,ve=p*Math.cos(me*Math.PI/2),oe=g*Math.sin(me*Math.PI/2)+_;for(let Ae=0,be=Y.length;Ae<be;Ae++){const Oe=Z(Y[Ae],X[Ae],oe);Ye(Oe.x,Oe.y,-ve),me===0&&de.push(Oe)}for(let Ae=0,be=$;Ae<be;Ae++){const Oe=I[Ae];_e=ee[Ae];const k=[];for(let L=0,G=Oe.length;L<G;L++){const Q=Z(Oe[L],_e[L],oe);Ye(Q.x,Q.y,-ve),me===0&&k.push(Q)}me===0&&U.push(k)}}ft=Mr.triangulateShape(de,U)}const pt=ft.length,wt=g+_;for(let de=0;de<fe;de++){const U=d?Z(S[de],Ge[de],wt):S[de];T?(A.copy(R.normals[0]).multiplyScalar(U.x),C.copy(R.binormals[0]).multiplyScalar(U.y),E.copy(v[0]).add(A).add(C),Ye(E.x,E.y,E.z)):Ye(U.x,U.y,0)}for(let de=1;de<=u;de++)for(let U=0;U<fe;U++){const he=d?Z(S[U],Ge[U],wt):S[U];T?(A.copy(R.normals[de]).multiplyScalar(he.x),C.copy(R.binormals[de]).multiplyScalar(he.y),E.copy(v[de]).add(A).add(C),Ye(E.x,E.y,E.z)):Ye(he.x,he.y,h/u*de)}for(let de=y-1;de>=0;de--){const U=de/y,he=p*Math.cos(U*Math.PI/2),me=g*Math.sin(U*Math.PI/2)+_;for(let ve=0,oe=Y.length;ve<oe;ve++){const Ae=Z(Y[ve],X[ve],me);Ye(Ae.x,Ae.y,h+he)}for(let ve=0,oe=I.length;ve<oe;ve++){const Ae=I[ve];_e=ee[ve];for(let be=0,Oe=Ae.length;be<Oe;be++){const k=Z(Ae[be],_e[be],me);T?Ye(k.x,k.y+v[u-1].y,v[u-1].x+he):Ye(k.x,k.y,h+he)}}}ne(),se();function ne(){const de=r.length/3;if(d){let U=0,he=fe*U;for(let me=0;me<pt;me++){const ve=ft[me];We(ve[2]+he,ve[1]+he,ve[0]+he)}U=u+y*2,he=fe*U;for(let me=0;me<pt;me++){const ve=ft[me];We(ve[0]+he,ve[1]+he,ve[2]+he)}}else{for(let U=0;U<pt;U++){const he=ft[U];We(he[2],he[1],he[0])}for(let U=0;U<pt;U++){const he=ft[U];We(he[0]+fe*u,he[1]+fe*u,he[2]+fe*u)}}i.addGroup(de,r.length/3-de,0)}function se(){const de=r.length/3;let U=0;Ne(Y,U),U+=Y.length;for(let he=0,me=I.length;he<me;he++){const ve=I[he];Ne(ve,U),U+=ve.length}i.addGroup(de,r.length/3-de,1)}function Ne(de,U){let he=de.length;for(;--he>=0;){const me=he;let ve=he-1;ve<0&&(ve=de.length-1);for(let oe=0,Ae=u+y*2;oe<Ae;oe++){const be=fe*oe,Oe=fe*(oe+1),k=U+me+be,L=U+ve+be,G=U+ve+Oe,Q=U+me+Oe;vt(k,L,G,Q)}}}function Ye(de,U,he){l.push(de),l.push(U),l.push(he)}function We(de,U,he){Bt(de),Bt(U),Bt(he);const me=r.length/3,ve=x.generateTopUV(i,r,me-3,me-2,me-1);tt(ve[0]),tt(ve[1]),tt(ve[2])}function vt(de,U,he,me){Bt(de),Bt(U),Bt(me),Bt(U),Bt(he),Bt(me);const ve=r.length/3,oe=x.generateSideWallUV(i,r,ve-6,ve-3,ve-2,ve-1);tt(oe[0]),tt(oe[1]),tt(oe[3]),tt(oe[1]),tt(oe[2]),tt(oe[3])}function Bt(de){r.push(l[de*3+0]),r.push(l[de*3+1]),r.push(l[de*3+2])}function tt(de){s.push(de.x),s.push(de.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return YW(t,i,e)}static fromJSON(e,t){const i=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=t[e.shapes[s]];i.push(o)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new zg[r.type]().fromJSON(r)),new ry(i,e.options)}}const KW={generateTopUV:function(n,e,t,i,r){const s=e[t*3],a=e[t*3+1],o=e[i*3],l=e[i*3+1],c=e[r*3],u=e[r*3+1];return[new ce(s,a),new ce(o,l),new ce(c,u)]},generateSideWallUV:function(n,e,t,i,r,s){const a=e[t*3],o=e[t*3+1],l=e[t*3+2],c=e[i*3],u=e[i*3+1],h=e[i*3+2],d=e[r*3],p=e[r*3+1],g=e[r*3+2],_=e[s*3],y=e[s*3+1],m=e[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new ce(a,1-l),new ce(c,1-h),new ce(d,1-g),new ce(_,1-m)]:[new ce(o,1-l),new ce(u,1-h),new ce(p,1-g),new ce(y,1-m)]}};function YW(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){const s=n[i];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class sy extends uo{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sy(e.radius,e.detail)}}class ay extends yt{constructor(e=[new ce(0,-.5),new ce(.5,0),new ce(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=st(r,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],u=1/t,h=new F,d=new ce,p=new F,g=new F,_=new F;let y=0,m=0;for(let x=0;x<=e.length-1;x++)switch(x){case 0:y=e[x+1].x-e[x].x,m=e[x+1].y-e[x].y,p.x=m*1,p.y=-y,p.z=m*0,_.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(_.x,_.y,_.z);break;default:y=e[x+1].x-e[x].x,m=e[x+1].y-e[x].y,p.x=m*1,p.y=-y,p.z=m*0,g.copy(p),p.x+=_.x,p.y+=_.y,p.z+=_.z,p.normalize(),l.push(p.x,p.y,p.z),_.copy(g)}for(let x=0;x<=t;x++){const v=i+x*u*r,T=Math.sin(v),R=Math.cos(v);for(let C=0;C<=e.length-1;C++){h.x=e[C].x*T,h.y=e[C].y,h.z=e[C].x*R,a.push(h.x,h.y,h.z),d.x=x/t,d.y=C/(e.length-1),o.push(d.x,d.y);const A=l[3*C+0]*T,E=l[3*C+1],b=l[3*C+0]*R;c.push(A,E,b)}}for(let x=0;x<t;x++)for(let v=0;v<e.length-1;v++){const T=v+x*e.length,R=T,C=T+e.length,A=T+e.length+1,E=T+1;s.push(R,C,E),s.push(A,E,C)}this.setIndex(s),this.setAttribute("position",new ze(a,3)),this.setAttribute("uv",new ze(o,2)),this.setAttribute("normal",new ze(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ay(e.points,e.segments,e.phiStart,e.phiLength)}}class Qd extends uo{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Qd(e.radius,e.detail)}}class _u extends yt{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,a=t/2,o=Math.floor(i),l=Math.floor(r),c=o+1,u=l+1,h=e/o,d=t/l,p=[],g=[],_=[],y=[];for(let m=0;m<u;m++){const x=m*d-a;for(let v=0;v<c;v++){const T=v*h-s;g.push(T,-x,0),_.push(0,0,1),y.push(v/o),y.push(1-m/l)}}for(let m=0;m<l;m++)for(let x=0;x<o;x++){const v=x+c*m,T=x+c*(m+1),R=x+1+c*(m+1),C=x+1+c*m;p.push(v,T,C),p.push(T,R,C)}this.setIndex(p),this.setAttribute("position",new ze(g,3)),this.setAttribute("normal",new ze(_,3)),this.setAttribute("uv",new ze(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _u(e.width,e.height,e.widthSegments,e.heightSegments)}}class oy extends yt{constructor(e=.5,t=1,i=32,r=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:s,thetaLength:a},i=Math.max(3,i),r=Math.max(1,r);const o=[],l=[],c=[],u=[];let h=e;const d=(t-e)/r,p=new F,g=new ce;for(let _=0;_<=r;_++){for(let y=0;y<=i;y++){const m=s+y/i*a;p.x=h*Math.cos(m),p.y=h*Math.sin(m),l.push(p.x,p.y,p.z),c.push(0,0,1),g.x=(p.x/t+1)/2,g.y=(p.y/t+1)/2,u.push(g.x,g.y)}h+=d}for(let _=0;_<r;_++){const y=_*(i+1);for(let m=0;m<i;m++){const x=m+y,v=x,T=x+i+1,R=x+i+2,C=x+1;o.push(v,T,C),o.push(T,R,C)}}this.setIndex(o),this.setAttribute("position",new ze(l,3)),this.setAttribute("normal",new ze(c,3)),this.setAttribute("uv",new ze(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oy(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ly extends yt{constructor(e=new Yo([new ce(0,.5),new ce(-.5,-.5),new ce(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],s=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(i),this.setAttribute("position",new ze(r,3)),this.setAttribute("normal",new ze(s,3)),this.setAttribute("uv",new ze(a,2));function c(u){const h=r.length/3,d=u.extractPoints(t);let p=d.shape;const g=d.holes;Mr.isClockWise(p)===!1&&(p=p.reverse());for(let y=0,m=g.length;y<m;y++){const x=g[y];Mr.isClockWise(x)===!0&&(g[y]=x.reverse())}const _=Mr.triangulateShape(p,g);for(let y=0,m=g.length;y<m;y++){const x=g[y];p=p.concat(x)}for(let y=0,m=p.length;y<m;y++){const x=p[y];r.push(x.x,x.y,0),s.push(0,0,1),a.push(x.x,x.y)}for(let y=0,m=_.length;y<m;y++){const x=_[y],v=x[0]+h,T=x[1]+h,R=x[2]+h;i.push(v,T,R),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return JW(t,e)}static fromJSON(e,t){const i=[];for(let r=0,s=e.shapes.length;r<s;r++){const a=t[e.shapes[r]];i.push(a)}return new ly(i,e.curveSegments)}}function JW(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const r=n[t];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}class Ns extends yt{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new F,d=new F,p=[],g=[],_=[],y=[];for(let m=0;m<=i;m++){const x=[],v=m/i;let T=0;m===0&&a===0?T=.5/t:m===i&&l===Math.PI&&(T=-.5/t);for(let R=0;R<=t;R++){const C=R/t;h.x=-e*Math.cos(r+C*s)*Math.sin(a+v*o),h.y=e*Math.cos(a+v*o),h.z=e*Math.sin(r+C*s)*Math.sin(a+v*o),g.push(h.x,h.y,h.z),d.copy(h).normalize(),_.push(d.x,d.y,d.z),y.push(C+T,1-v),x.push(c++)}u.push(x)}for(let m=0;m<i;m++)for(let x=0;x<t;x++){const v=u[m][x+1],T=u[m][x],R=u[m+1][x],C=u[m+1][x+1];(m!==0||a>0)&&p.push(v,T,C),(m!==i-1||l<Math.PI)&&p.push(T,R,C)}this.setIndex(p),this.setAttribute("position",new ze(g,3)),this.setAttribute("normal",new ze(_,3)),this.setAttribute("uv",new ze(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ns(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class cy extends uo{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new cy(e.radius,e.detail)}}class uy extends yt{constructor(e=1,t=.4,i=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:s},i=Math.floor(i),r=Math.floor(r);const a=[],o=[],l=[],c=[],u=new F,h=new F,d=new F;for(let p=0;p<=i;p++)for(let g=0;g<=r;g++){const _=g/r*s,y=p/i*Math.PI*2;h.x=(e+t*Math.cos(y))*Math.cos(_),h.y=(e+t*Math.cos(y))*Math.sin(_),h.z=t*Math.sin(y),o.push(h.x,h.y,h.z),u.x=e*Math.cos(_),u.y=e*Math.sin(_),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(g/r),c.push(p/i)}for(let p=1;p<=i;p++)for(let g=1;g<=r;g++){const _=(r+1)*p+g-1,y=(r+1)*(p-1)+g-1,m=(r+1)*(p-1)+g,x=(r+1)*p+g;a.push(_,y,x),a.push(y,m,x)}this.setIndex(a),this.setAttribute("position",new ze(o,3)),this.setAttribute("normal",new ze(l,3)),this.setAttribute("uv",new ze(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uy(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class hy extends yt{constructor(e=1,t=.4,i=64,r=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:s,q:a},i=Math.floor(i),r=Math.floor(r);const o=[],l=[],c=[],u=[],h=new F,d=new F,p=new F,g=new F,_=new F,y=new F,m=new F;for(let v=0;v<=i;++v){const T=v/i*s*Math.PI*2;x(T,s,a,e,p),x(T+.01,s,a,e,g),y.subVectors(g,p),m.addVectors(g,p),_.crossVectors(y,m),m.crossVectors(_,y),_.normalize(),m.normalize();for(let R=0;R<=r;++R){const C=R/r*Math.PI*2,A=-t*Math.cos(C),E=t*Math.sin(C);h.x=p.x+(A*m.x+E*_.x),h.y=p.y+(A*m.y+E*_.y),h.z=p.z+(A*m.z+E*_.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),c.push(d.x,d.y,d.z),u.push(v/i),u.push(R/r)}}for(let v=1;v<=i;v++)for(let T=1;T<=r;T++){const R=(r+1)*(v-1)+(T-1),C=(r+1)*v+(T-1),A=(r+1)*v+T,E=(r+1)*(v-1)+T;o.push(R,C,E),o.push(C,A,E)}this.setIndex(o),this.setAttribute("position",new ze(l,3)),this.setAttribute("normal",new ze(c,3)),this.setAttribute("uv",new ze(u,2));function x(v,T,R,C,A){const E=Math.cos(v),b=Math.sin(v),S=R/T*v,I=Math.cos(S);A.x=C*(2+I)*.5*E,A.y=C*(2+I)*b*.5,A.z=C*Math.sin(S)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hy(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class dy extends yt{constructor(e=new Ew(new F(-1,-1,0),new F(-1,1,0),new F(1,1,0)),t=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new F,l=new F,c=new ce;let u=new F;const h=[],d=[],p=[],g=[];_(),this.setIndex(g),this.setAttribute("position",new ze(h,3)),this.setAttribute("normal",new ze(d,3)),this.setAttribute("uv",new ze(p,2));function _(){for(let v=0;v<t;v++)y(v);y(s===!1?t:0),x(),m()}function y(v){u=e.getPointAt(v/t,u);const T=a.normals[v],R=a.binormals[v];for(let C=0;C<=r;C++){const A=C/r*Math.PI*2,E=Math.sin(A),b=-Math.cos(A);l.x=b*T.x+E*R.x,l.y=b*T.y+E*R.y,l.z=b*T.z+E*R.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+i*l.x,o.y=u.y+i*l.y,o.z=u.z+i*l.z,h.push(o.x,o.y,o.z)}}function m(){for(let v=1;v<=t;v++)for(let T=1;T<=r;T++){const R=(r+1)*(v-1)+(T-1),C=(r+1)*v+(T-1),A=(r+1)*v+T,E=(r+1)*(v-1)+T;g.push(R,C,E),g.push(C,A,E)}}function x(){for(let v=0;v<=t;v++)for(let T=0;T<=r;T++)c.x=v/t,c.y=T/r,p.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new dy(new zg[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class cD extends yt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,r=new F,s=new F;if(e.index!==null){const a=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,p=h.count;for(let g=d,_=d+p;g<_;g+=3)for(let y=0;y<3;y++){const m=o.getX(g+y),x=o.getX(g+(y+1)%3);r.fromBufferAttribute(a,m),s.fromBufferAttribute(a,x),fM(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;r.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),fM(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new ze(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function fM(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(r)===!0?!1:(t.add(i),t.add(r),!0)}var pM=Object.freeze({__proto__:null,BoxGeometry:wl,CapsuleGeometry:ey,CircleGeometry:ty,ConeGeometry:Zd,CylinderGeometry:Jd,DodecahedronGeometry:ny,EdgesGeometry:QL,ExtrudeGeometry:ry,IcosahedronGeometry:sy,LatheGeometry:ay,OctahedronGeometry:Qd,PlaneGeometry:_u,PolyhedronGeometry:uo,RingGeometry:oy,ShapeGeometry:ly,SphereGeometry:Ns,TetrahedronGeometry:cy,TorusGeometry:uy,TorusKnotGeometry:hy,TubeGeometry:dy,WireframeGeometry:cD});class uD extends Kn{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new De(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class hD extends Zi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Mw extends Kn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new De(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ji,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class dD extends Mw{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ce(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return st(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new De(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new De(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new De(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class fD extends Kn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new De(16777215),this.specular=new De(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ji,this.combine=Xd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pD extends Kn{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new De(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class mD extends Kn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class gD extends Kn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new De(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ji,this.combine=Xd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Cw extends Kn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=AL,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Iw extends Kn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class yD extends Kn{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new De(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=co,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class _D extends wi{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Ho(n,e){return!n||n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function xD(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function vD(n){function e(r,s){return n[r]-n[s]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i}function eS(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,a=0;a!==i;++s){const o=t[s]*e;for(let l=0;l!==e;++l)r[a++]=n[o+l]}return r}function Rw(n,e,t,i){let r=1,s=n[0];for(;s!==void 0&&s[i]===void 0;)s=n[r++];if(s===void 0)return;let a=s[i];if(a!==void 0)if(Array.isArray(a))do a=s[i],a!==void 0&&(e.push(s.time),t.push(...a)),s=n[r++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[i],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=n[r++];while(s!==void 0);else do a=s[i],a!==void 0&&(e.push(s.time),t.push(a)),s=n[r++];while(s!==void 0)}function ZW(n,e,t,i,r=30){const s=n.clone();s.name=e;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let p=0;p<c.times.length;++p){const g=c.times[p]*r;if(!(g<t||g>=i)){h.push(c.times[p]);for(let _=0;_<u;++_)d.push(c.values[p*u+_])}}h.length!==0&&(c.times=Ho(h,c.times.constructor),c.values=Ho(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function QW(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,s=e/i;for(let a=0;a<r;++a){const o=t.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=n.tracks.find(function(m){return m.name===o.name&&m.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const g=o.times.length-1;let _;if(s<=o.times[0]){const m=u,x=h-u;_=o.values.slice(m,x)}else if(s>=o.times[g]){const m=g*h+u,x=m+h-u;_=o.values.slice(m,x)}else{const m=o.createInterpolant(),x=u,v=h-u;m.evaluate(s),_=m.resultBuffer.slice(x,v)}l==="quaternion"&&new ki().fromArray(_).normalize().conjugate().toArray(_);const y=c.times.length;for(let m=0;m<y;++m){const x=m*p+d;if(l==="quaternion")ki.multiplyQuaternionsFlat(c.values,x,_,0,c.values,x);else{const v=p-d*2;for(let T=0;T<v;++T)c.values[x+T]-=_[T]}}}return n.blendMode=uw,n}class e7{static convertArray(e,t){return Ho(e,t)}static isTypedArray(e){return xD(e)}static getKeyframeOrder(e){return vD(e)}static sortedArray(e,t,i){return eS(e,t,i)}static flattenJSON(e,t,i,r){Rw(e,t,i,r)}static subclip(e,t,i,r,s=30){return ZW(e,t,i,r,s)}static makeClipAdditive(e,t=0,i=e,r=30){return QW(e,t,i,r)}}class ef{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let a;n:{i:if(!(e<r)){for(let o=i+2;;){if(r===void 0){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(s=r,r=t[++i],e<r)break t}a=t.length;break n}if(!(e>=s)){const o=t[1];e<o&&(i=2,s=o);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}a=i,i=0;break n}break e}for(;i<a;){const o=i+a>>>1;e<t[o]?a=o:i=o+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let a=0;a!==r;++a)t[a]=i[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class SD extends ef{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Bo,endingEnd:Bo}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,a=e+1,o=r[s],l=r[a];if(o===void 0)switch(this.getSettings_().endingStart){case zo:s=e,o=2*t-i;break;case gd:s=r.length-2,o=t+r[s]-r[s+1];break;default:s=e,o=i}if(l===void 0)switch(this.getSettings_().endingEnd){case zo:a=e,l=2*i-t;break;case gd:a=1,l=i+r[1]-r[0];break;default:a=e-1,l=t}const c=(i-t)*.5,u=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-i),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,g=(i-t)/(r-t),_=g*g,y=_*g,m=-d*y+2*d*_-d*g,x=(1+d)*y+(-1.5-2*d)*_+(-.5+d)*g+1,v=(-1-p)*y+(1.5+p)*_+.5*g,T=p*y-p*_;for(let R=0;R!==o;++R)s[R]=m*a[u+R]+x*a[c+R]+v*a[l+R]+T*a[h+R];return s}}class Pw extends ef{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=(i-t)/(r-t),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class bD extends ef{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class fr{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ho(t,this.TimeBufferType),this.values=Ho(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Ho(e.times,Array),values:Ho(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new bD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Pw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new SD(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case md:t=this.InterpolantFactoryMethodDiscrete;break;case Fg:t=this.InterpolantFactoryMethodLinear;break;case nm:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return Ie("KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return md;case this.InterpolantFactoryMethodLinear:return Fg;case this.InterpolantFactoryMethodSmooth:return nm}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,a=r-1;for(;s!==r&&i[s]<e;)++s;for(;a!==-1&&i[a]>t;)--a;if(++a,s!==0||a!==r){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=i.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(lt("KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(lt("KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const l=i[o];if(typeof l=="number"&&isNaN(l)){lt("KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){lt("KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(r!==void 0&&xD(r))for(let o=0,l=r.length;o!==l;++o){const c=r[o];if(isNaN(c)){lt("KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===nm,s=e.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=e[o],u=e[o+1];if(c!==u&&(o!==1||c!==e[0]))if(r)l=!0;else{const h=o*i,d=h-i,p=h+i;for(let g=0;g!==i;++g){const _=t[h+g];if(_!==t[d+g]||_!==t[p+g]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const h=o*i,d=a*i;for(let p=0;p!==i;++p)t[d+p]=t[h+p]}++a}}if(s>0){e[a]=e[s];for(let o=s*i,l=a*i,c=0;c!==i;++c)t[l+c]=t[o+c];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}fr.prototype.ValueTypeName="";fr.prototype.TimeBufferType=Float32Array;fr.prototype.ValueBufferType=Float32Array;fr.prototype.DefaultInterpolation=Fg;class Tl extends fr{constructor(e,t,i){super(e,t,i)}}Tl.prototype.ValueTypeName="bool";Tl.prototype.ValueBufferType=Array;Tl.prototype.DefaultInterpolation=md;Tl.prototype.InterpolantFactoryMethodLinear=void 0;Tl.prototype.InterpolantFactoryMethodSmooth=void 0;class Lw extends fr{constructor(e,t,i,r){super(e,t,i,r)}}Lw.prototype.ValueTypeName="color";class Td extends fr{constructor(e,t,i,r){super(e,t,i,r)}}Td.prototype.ValueTypeName="number";class wD extends ef{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(i-t)/(r-t);let c=e*o;for(let u=c+o;c!==u;c+=4)ki.slerpFlat(s,0,a,c-o,a,c,l);return s}}class tf extends fr{constructor(e,t,i,r){super(e,t,i,r)}InterpolantFactoryMethodLinear(e){return new wD(this.times,this.values,this.getValueSize(),e)}}tf.prototype.ValueTypeName="quaternion";tf.prototype.InterpolantFactoryMethodSmooth=void 0;class El extends fr{constructor(e,t,i){super(e,t,i)}}El.prototype.ValueTypeName="string";El.prototype.ValueBufferType=Array;El.prototype.DefaultInterpolation=md;El.prototype.InterpolantFactoryMethodLinear=void 0;El.prototype.InterpolantFactoryMethodSmooth=void 0;class Ed extends fr{constructor(e,t,i,r){super(e,t,i,r)}}Ed.prototype.ValueTypeName="vector";class Ad{constructor(e="",t=-1,i=[],r=H0){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Ki(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let a=0,o=i.length;a!==o;++a)t.push(n7(i[a]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s.userData=JSON.parse(e.userData||"{}"),s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let s=0,a=i.length;s!==a;++s)t.push(fr.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=vD(l);l=eS(l,1,u),c=eS(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new Td(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=r[h];d||(r[h]=d=[]),d.push(c)}}const a=[];for(const o in r)a.push(this.CreateFromMorphTargetSequence(o,r[o],t,i));return a}static parseAnimation(e,t){if(Ie("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return lt("AnimationClip: No animation in JSONLoader data."),null;const i=function(h,d,p,g,_){if(p.length!==0){const y=[],m=[];Rw(p,y,m,g),y.length!==0&&_.push(new h(d,y,m))}},r=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let g;for(g=0;g<d.length;g++)if(d[g].morphTargets)for(let _=0;_<d[g].morphTargets.length;_++)p[d[g].morphTargets[_]]=-1;for(const _ in p){const y=[],m=[];for(let x=0;x!==d[g].morphTargets.length;++x){const v=d[g];y.push(v.time),m.push(v.morphTarget===_?1:0)}r.push(new Td(".morphTargetInfluence["+_+"]",y,m))}l=p.length*a}else{const p=".bones["+t[h].name+"]";i(Ed,p+".position",d,"pos",r),i(tf,p+".quaternion",d,"rot",r),i(Ed,p+".scale",d,"scl",r)}}return r.length===0?null:new this(s,l,r,o)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function t7(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Td;case"vector":case"vector2":case"vector3":case"vector4":return Ed;case"color":return Lw;case"quaternion":return tf;case"bool":case"boolean":return Tl;case"string":return El}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function n7(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=t7(n.type);if(n.times===void 0){const t=[],i=[];Rw(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Jr={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Dw{constructor(e,t,i){const r=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this._abortController=null,this.itemStart=function(u){o++,s===!1&&r.onStart!==void 0&&r.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,r.onProgress!==void 0&&r.onProgress(u,a,o),a===o&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const p=c[h],g=c[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return g}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const TD=new Dw;class Ui{constructor(e){this.manager=e!==void 0?e:TD,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Ui.DEFAULT_MATERIAL_NAME="__DEFAULT";const xs={};class i7 extends Error{constructor(e,t){super(e),this.response=t}}class qs extends Ui{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Jr.get(`file:${e}`);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(xs[e]!==void 0){xs[e].push({onLoad:t,onProgress:i,onError:r});return}xs[e]=[],xs[e].push({onLoad:t,onProgress:i,onError:r});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&Ie("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=xs[e],h=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=d?parseInt(d):0,g=p!==0;let _=0;const y=new ReadableStream({start(m){x();function x(){h.read().then(({done:v,value:T})=>{if(v)m.close();else{_+=T.byteLength;const R=new ProgressEvent("progress",{lengthComputable:g,loaded:_,total:p});for(let C=0,A=u.length;C<A;C++){const E=u[C];E.onProgress&&E.onProgress(R)}m.enqueue(T),x()}},v=>{m.error(v)})}}});return new Response(y)}else throw new i7(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o==="")return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return c.arrayBuffer().then(g=>p.decode(g))}}}).then(c=>{Jr.add(`file:${e}`,c);const u=xs[e];delete xs[e];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onLoad&&p.onLoad(c)}}).catch(c=>{const u=xs[e];if(u===void 0)throw this.manager.itemError(e),c;delete xs[e];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class r7 extends Ui{constructor(e){super(e)}load(e,t,i,r){const s=this,a=new qs(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(l){r?r(l):lt(l),s.manager.itemError(e)}},i,r)}parse(e){const t=[];for(let i=0;i<e.length;i++){const r=Ad.parse(e[i]);t.push(r)}return t}}class s7 extends Ui{constructor(e){super(e)}load(e,t,i,r){const s=this,a=[],o=new Q0,l=new qs(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(e[h],function(d){const p=s.parse(d,!0);a[h]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(o.minFilter=sn),o.image=a,o.format=p.format,o.needsUpdate=!0,t&&t(o))},i,r)}if(Array.isArray(e))for(let h=0,d=e.length;h<d;++h)u(h);else l.load(e,function(h){const d=s.parse(h,!0);if(d.isCubemap){const p=d.mipmaps.length/d.mipmapCount;for(let g=0;g<p;g++){a[g]={mipmaps:[]};for(let _=0;_<d.mipmapCount;_++)a[g].mipmaps.push(d.mipmaps[g*d.mipmapCount+_]),a[g].format=d.format,a[g].width=d.width,a[g].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=sn),o.format=d.format,o.needsUpdate=!0,t&&t(o)},i,r);return o}}const Jl=new WeakMap;class Md extends Ui{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Jr.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0);else{let h=Jl.get(a);h===void 0&&(h=[],Jl.set(a,h)),h.push({onLoad:t,onError:r})}return a}const o=xd("img");function l(){u(),t&&t(this);const h=Jl.get(this)||[];for(let d=0;d<h.length;d++){const p=h[d];p.onLoad&&p.onLoad(this)}Jl.delete(this),s.manager.itemEnd(e)}function c(h){u(),r&&r(h),Jr.remove(`image:${e}`);const d=Jl.get(this)||[];for(let p=0;p<d.length;p++){const g=d[p];g.onError&&g.onError(h)}Jl.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Jr.add(`image:${e}`,o),s.manager.itemStart(e),o.src=e,o}}class a7 extends Ui{constructor(e){super(e)}load(e,t,i,r){const s=new Yd;s.colorSpace=si;const a=new Md(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(e[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class o7 extends Ui{constructor(e){super(e)}load(e,t,i,r){const s=this,a=new Lr,o=new qs(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(l){let c;try{c=s.parse(l)}catch(u){if(r!==void 0)r(u);else{u(u);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:Pi,a.wrapT=c.wrapT!==void 0?c.wrapT:Pi,a.magFilter=c.magFilter!==void 0?c.magFilter:sn,a.minFilter=c.minFilter!==void 0?c.minFilter:sn,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Yr),c.mipmapCount===1&&(a.minFilter=sn),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,t&&t(a,c)},i,r),a}}class l7 extends Ui{constructor(e){super(e)}load(e,t,i,r){const s=new fn,a=new Md(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class ho extends Ft{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new De(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class Nw extends ho{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ft.DEFAULT_UP),this.updateMatrix(),this.groundColor=new De(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Z_=new ot,mM=new F,gM=new F;class Ow{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ce(512,512),this.mapType=Or,this.map=null,this.mapPass=null,this.matrix=new ot,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new yu,this._frameExtents=new ce(1,1),this._viewportCount=1,this._viewports=[new kt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;mM.setFromMatrixPosition(e.matrixWorld),t.position.copy(mM),gM.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(gM),t.updateMatrixWorld(),Z_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Z_,t.coordinateSystem,t.reversedDepth),t.reversedDepth?i.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Z_)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class c7 extends Ow{constructor(){super(new In(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,i=tu*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class ED extends ho{constructor(e,t,i=0,r=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ft.DEFAULT_UP),this.updateMatrix(),this.target=new Ft,this.distance=i,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new c7}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const yM=new ot,Yu=new F,Q_=new F;class u7 extends Ow{constructor(){super(new In(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ce(4,2),this._viewportCount=6,this._viewports=[new kt(2,1,1,1),new kt(0,1,1,1),new kt(3,1,1,1),new kt(1,1,1,1),new kt(3,0,1,1),new kt(1,0,1,1)],this._cubeDirections=[new F(1,0,0),new F(-1,0,0),new F(0,0,1),new F(0,0,-1),new F(0,1,0),new F(0,-1,0)],this._cubeUps=[new F(0,1,0),new F(0,1,0),new F(0,1,0),new F(0,1,0),new F(0,0,1),new F(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Yu.setFromMatrixPosition(e.matrixWorld),i.position.copy(Yu),Q_.copy(i.position),Q_.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Q_),i.updateMatrixWorld(),r.makeTranslation(-Yu.x,-Yu.y,-Yu.z),yM.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yM,i.coordinateSystem,i.reversedDepth)}}class AD extends ho{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new u7}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class fy extends q0{constructor(e=-1,t=1,i=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,a=i+e,o=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class h7 extends Ow{constructor(){super(new fy(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class kw extends ho{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ft.DEFAULT_UP),this.updateMatrix(),this.target=new Ft,this.shadow=new h7}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Uw extends ho{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class MD extends ho{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class CD{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new F)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*i),t.addScaledVector(a[4],1.092548*(i*r)),t.addScaledVector(a[5],1.092548*(r*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(i*s)),t.addScaledVector(a[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*r),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*i),t.addScaledVector(a[4],2*.429043*i*r),t.addScaledVector(a[5],2*.429043*r*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*i*s),t.addScaledVector(a[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}}class ID extends ho{constructor(e=new CD,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class py extends Ui{constructor(e){super(e),this.textures={}}load(e,t,i,r){const s=this,a=new qs(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(l){r?r(l):lt(l),s.manager.itemError(e)}},i,r)}parse(e){const t=this.textures;function i(s){return t[s]===void 0&&Ie("MaterialLoader: Undefined texture",s),t[s]}const r=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new De().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(r.dispersion=e.dispersion),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(r.uniforms[s]={},a.type){case"t":r.uniforms[s].value=i(a.value);break;case"c":r.uniforms[s].value=new De().setHex(a.value);break;case"v2":r.uniforms[s].value=new ce().fromArray(a.value);break;case"v3":r.uniforms[s].value=new F().fromArray(a.value);break;case"v4":r.uniforms[s].value=new kt().fromArray(a.value);break;case"m3":r.uniforms[s].value=new gt().fromArray(a.value);break;case"m4":r.uniforms[s].value=new ot().fromArray(a.value);break;default:r.uniforms[s].value=a.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=i(e.map)),e.matcap!==void 0&&(r.matcap=i(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new ce().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=i(e.envMap)),e.envMapRotation!==void 0&&r.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new ce().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return py.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:uD,SpriteMaterial:gw,RawShaderMaterial:hD,ShaderMaterial:Zi,PointsMaterial:_w,MeshPhysicalMaterial:dD,MeshStandardMaterial:Mw,MeshPhongMaterial:fD,MeshToonMaterial:pD,MeshNormalMaterial:mD,MeshLambertMaterial:gD,MeshDepthMaterial:Cw,MeshDistanceMaterial:Iw,MeshBasicMaterial:Pr,MeshMatcapMaterial:yD,LineDashedMaterial:_D,LineBasicMaterial:wi,Material:Kn};return new t[e]}}class tS{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class RD extends yt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class PD extends Ui{constructor(e){super(e)}load(e,t,i,r){const s=this,a=new qs(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(l){r?r(l):lt(l),s.manager.itemError(e)}},i,r)}parse(e){const t={},i={};function r(p,g){if(t[g]!==void 0)return t[g];const y=p.interleavedBuffers[g],m=s(p,y.buffer),x=vc(y.type,m),v=new Y0(x,y.stride);return v.uuid=y.uuid,t[g]=v,v}function s(p,g){if(i[g]!==void 0)return i[g];const y=p.arrayBuffers[g],m=new Uint32Array(y).buffer;return i[g]=m,m}const a=e.isInstancedBufferGeometry?new RD:new yt,o=e.data.index;if(o!==void 0){const p=vc(o.type,o.array);a.setIndex(new $t(p,1))}const l=e.data.attributes;for(const p in l){const g=l[p];let _;if(g.isInterleavedBufferAttribute){const y=r(e.data,g.data);_=new ul(y,g.itemSize,g.offset,g.normalized)}else{const y=vc(g.type,g.array),m=g.isInstancedBufferAttribute?iu:$t;_=new m(y,g.itemSize,g.normalized)}g.name!==void 0&&(_.name=g.name),g.usage!==void 0&&_.setUsage(g.usage),a.setAttribute(p,_)}const c=e.data.morphAttributes;if(c)for(const p in c){const g=c[p],_=[];for(let y=0,m=g.length;y<m;y++){const x=g[y];let v;if(x.isInterleavedBufferAttribute){const T=r(e.data,x.data);v=new ul(T,x.itemSize,x.offset,x.normalized)}else{const T=vc(x.type,x.array);v=new $t(T,x.itemSize,x.normalized)}x.name!==void 0&&(v.name=x.name),_.push(v)}a.morphAttributes[p]=_}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let p=0,g=h.length;p!==g;++p){const _=h[p];a.addGroup(_.start,_.count,_.materialIndex)}const d=e.data.boundingSphere;return d!==void 0&&(a.boundingSphere=new qn().fromJSON(d)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class d7 extends Ui{constructor(e){super(e)}load(e,t,i,r){const s=this,a=this.path===""?tS.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new qs(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){r!==void 0&&r(h),h("ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),lt("ObjectLoader: Can't load "+e);return}s.parse(c,t)},i,r)}async loadAsync(e,t){const i=this,r=this.path===""?tS.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new qs(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,t),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(o)}parse(e,t){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,function(){t!==void 0&&t(c)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,s,l,o,i),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),this.bindLightTargets(c),t!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,r,o,a,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,r=e.length;i<r;i++){const s=new Yo().fromJSON(e[i]);t[s.uuid]=s}return t}parseSkeletons(e,t){const i={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new J0().fromJSON(e[s],r);i[o.uuid]=o}return i}parseGeometries(e,t){const i={};if(e!==void 0){const r=new PD;for(let s=0,a=e.length;s<a;s++){let o;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(l);break;default:l.type in pM?o=pM[l.type].fromJSON(l,t):Ie(`ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),i[l.uuid]=o}}return i}parseMaterials(e,t){const i={},r={};if(e!==void 0){const s=new py;s.setTextures(t);for(let a=0,o=e.length;a<o;a++){const l=e[a];i[l.uuid]===void 0&&(i[l.uuid]=s.parse(l)),r[l.uuid]=i[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const r=e[i],s=Ad.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const i=this,r={};let s;function a(l){return i.manager.itemStart(l),s.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return a(u)}else return l.data?{data:vc(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new Dw(t);s=new Md(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],d=h.url;if(Array.isArray(d)){const p=[];for(let g=0,_=d.length;g<_;g++){const y=d[g],m=o(y);m!==null&&(m instanceof HTMLImageElement?p.push(m):p.push(new Lr(m.data,m.width,m.height)))}r[h.uuid]=new Ca(p)}else{const p=o(h.url);r[h.uuid]=new Ca(p)}}}return r}async parseImagesAsync(e){const t=this,i={};let r;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await r.loadAsync(l)}else return a.data?{data:vc(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){r=new Md(this.manager),r.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const l=e[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h],g=await s(p);g!==null&&(g instanceof HTMLImageElement?u.push(g):u.push(new Lr(g.data,g.width,g.height)))}i[l.uuid]=new Ca(u)}else{const u=await s(l.url);i[l.uuid]=new Ca(u)}}}return i}parseTextures(e,t){function i(s,a){return typeof s=="number"?s:(Ie("ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const r={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&Ie('ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&Ie("ObjectLoader: Undefined image",o.image);const l=t[o.image],c=l.data;let u;Array.isArray(c)?(u=new Yd,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Lr:u=new fn,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=i(o.mapping,f7)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=i(o.wrap[0],_M),u.wrapT=i(o.wrap[1],_M)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.minFilter!==void 0&&(u.minFilter=i(o.minFilter,xM)),o.magFilter!==void 0&&(u.magFilter=i(o.magFilter,xM)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),r[o.uuid]=u}return r}parseObject(e,t,i,r,s){let a;function o(d){return t[d]===void 0&&Ie("ObjectLoader: Undefined geometry",d),t[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let g=0,_=d.length;g<_;g++){const y=d[g];i[y]===void 0&&Ie("ObjectLoader: Undefined material",y),p.push(i[y])}return p}return i[d]===void 0&&Ie("ObjectLoader: Undefined material",d),i[d]}}function c(d){return r[d]===void 0&&Ie("ObjectLoader: Undefined texture",d),r[d]}let u,h;switch(e.type){case"Scene":a=new K0,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new De(e.background):a.background=c(e.background)),e.environment!==void 0&&(a.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new X0(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new j0(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new In(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new fy(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new Uw(e.color,e.intensity);break;case"DirectionalLight":a=new kw(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new AD(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new MD(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new ED(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new Nw(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new ID().fromJSON(e);break;case"SkinnedMesh":u=o(e.geometry),h=l(e.material),a=new jL(u,h),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":u=o(e.geometry),h=l(e.material),a=new tn(u,h);break;case"InstancedMesh":u=o(e.geometry),h=l(e.material);const d=e.count,p=e.instanceMatrix,g=e.instanceColor;a=new XL(u,h,d),a.instanceMatrix=new iu(new Float32Array(p.array),16),g!==void 0&&(a.instanceColor=new iu(new Float32Array(g.array),g.itemSize));break;case"BatchedMesh":u=o(e.geometry),h=l(e.material),a=new KL(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(_=>{let y=null,m=null;return _.boundingBox!==void 0&&(y=new ci().fromJSON(_.boundingBox)),_.boundingSphere!==void 0&&(m=new qn().fromJSON(_.boundingSphere)),{..._,boundingBox:y,boundingSphere:m}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=c(e.matricesTexture.uuid),a._indirectTexture=c(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=c(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new qn().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(a.boundingBox=new ci().fromJSON(e.boundingBox));break;case"LOD":a=new qL;break;case"Line":a=new io(o(e.geometry),l(e.material));break;case"LineLoop":a=new YL(o(e.geometry),l(e.material));break;case"LineSegments":a=new ds(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":a=new JL(o(e.geometry),l(e.material));break;case"Sprite":a=new $L(l(e.material));break;case"Group":a=new Sc;break;case"Bone":a=new yw;break;default:a=new Ft}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let p=0;p<d.length;p++)a.add(this.parseObject(d[p],t,i,r,s))}if(e.animations!==void 0){const d=e.animations;for(let p=0;p<d.length;p++){const g=d[p];a.animations.push(s[g])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const d=e.levels;for(let p=0;p<d.length;p++){const g=d[p],_=a.getObjectByProperty("uuid",g.object);_!==void 0&&a.addLevel(_,g.distance,g.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const r=t[i.skeleton];r===void 0?Ie("ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(r,i.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const i=t.target,r=e.getObjectByProperty("uuid",i);r!==void 0?t.target=r:t.target=new Ft}})}}const f7={UVMapping:N0,CubeReflectionMapping:Ws,CubeRefractionMapping:to,EquirectangularReflectionMapping:hd,EquirectangularRefractionMapping:dd,CubeUVReflectionMapping:mu},_M={RepeatWrapping:fd,ClampToEdgeWrapping:Pi,MirroredRepeatWrapping:pd},xM={NearestFilter:$n,NearestMipmapNearestFilter:iw,NearestMipmapLinearFilter:xc,LinearFilter:sn,LinearMipmapNearestFilter:Mh,LinearMipmapLinearFilter:Yr},ex=new WeakMap;class p7 extends Ui{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&Ie("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&Ie("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Jr.get(`image-bitmap:${e}`);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(c=>{if(ex.has(a)===!0)r&&r(ex.get(a)),s.manager.itemError(e),s.manager.itemEnd(e);else return t&&t(c),s.manager.itemEnd(e),c});return}return setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const l=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Jr.add(`image-bitmap:${e}`,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){r&&r(c),ex.set(l,c),Jr.remove(`image-bitmap:${e}`),s.manager.itemError(e),s.manager.itemEnd(e)});Jr.add(`image-bitmap:${e}`,l),s.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let Sp;class Fw{static getContext(){return Sp===void 0&&(Sp=new(window.AudioContext||window.webkitAudioContext)),Sp}static setContext(e){Sp=e}}class m7 extends Ui{constructor(e){super(e)}load(e,t,i,r){const s=this,a=new qs(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{const c=l.slice(0);Fw.getContext().decodeAudioData(c,function(h){t(h)}).catch(o)}catch(c){o(c)}},i,r);function o(l){r?r(l):lt(l),s.manager.itemError(e)}}}const vM=new ot,SM=new ot,bo=new ot;class g7{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new In,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new In,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,bo.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,a=t.near*Math.tan(Ko*t.fov*.5)/t.zoom;let o,l;SM.elements[12]=-r,vM.elements[12]=r,o=-a*t.aspect+s,l=a*t.aspect+s,bo.elements[0]=2*t.near/(l-o),bo.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(bo),o=-a*t.aspect-s,l=a*t.aspect-s,bo.elements[0]=2*t.near/(l-o),bo.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(bo)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(SM),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(vM)}}class LD extends In{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class DD{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const wo=new F,tx=new ki,y7=new F,To=new F,Eo=new F;class _7 extends Ft{constructor(){super(),this.type="AudioListener",this.context=Fw.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new DD}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(wo,tx,y7),To.set(0,0,-1).applyQuaternion(tx),Eo.set(0,1,0).applyQuaternion(tx),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(wo.x,i),t.positionY.linearRampToValueAtTime(wo.y,i),t.positionZ.linearRampToValueAtTime(wo.z,i),t.forwardX.linearRampToValueAtTime(To.x,i),t.forwardY.linearRampToValueAtTime(To.y,i),t.forwardZ.linearRampToValueAtTime(To.z,i),t.upX.linearRampToValueAtTime(Eo.x,i),t.upY.linearRampToValueAtTime(Eo.y,i),t.upZ.linearRampToValueAtTime(Eo.z,i)}else t.setPosition(wo.x,wo.y,wo.z),t.setOrientation(To.x,To.y,To.z,Eo.x,Eo.y,Eo.z)}}class ND extends Ft{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){Ie("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){Ie("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){Ie("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){Ie("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){Ie("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(Ie("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){Ie("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(Ie("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Ao=new F,bM=new ki,x7=new F,Mo=new F;class v7 extends ND{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Ao,bM,x7),Mo.set(0,0,1).applyQuaternion(bM);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ao.x,i),t.positionY.linearRampToValueAtTime(Ao.y,i),t.positionZ.linearRampToValueAtTime(Ao.z,i),t.orientationX.linearRampToValueAtTime(Mo.x,i),t.orientationY.linearRampToValueAtTime(Mo.y,i),t.orientationZ.linearRampToValueAtTime(Mo.z,i)}else t.setPosition(Ao.x,Ao.y,Ao.z),t.setOrientation(Mo.x,Mo.y,Mo.z)}}class S7{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class OD{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,s,a;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,s=e*r+r;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==r;++o)i[s+o]=i[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(i,s,0,o,r)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(i,r,l,1-s,t)}a>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){o.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let s=i,a=r;s!==a;++s)t[s]=t[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,s){if(r>=.5)for(let a=0;a!==s;++a)e[t+a]=e[i+a]}_slerp(e,t,i,r){ki.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,s){const a=this._workIndex*s;ki.multiplyQuaternionsFlat(e,a,e,t,e,i),ki.slerpFlat(e,t,e,t,e,a,r)}_lerp(e,t,i,r,s){const a=1-r;for(let o=0;o!==s;++o){const l=t+o;e[l]=e[l]*a+e[i+o]*r}}_lerpAdditive(e,t,i,r,s){for(let a=0;a!==s;++a){const o=t+a;e[o]=e[o]+e[i+a]*r}}}const Vw="\\[\\]\\.:\\/",b7=new RegExp("["+Vw+"]","g"),Bw="[^"+Vw+"]",w7="[^"+Vw.replace("\\.","")+"]",T7=/((?:WC+[\/:])*)/.source.replace("WC",Bw),E7=/(WCOD+)?/.source.replace("WCOD",w7),A7=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Bw),M7=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Bw),C7=new RegExp("^"+T7+E7+A7+M7+"$"),I7=["material","materials","bones","map"];class R7{constructor(e,t,i){const r=i||Ot.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Ot{constructor(e,t,i){this.path=t,this.parsedPath=i||Ot.parseTrackName(t),this.node=Ot.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Ot.Composite(e,t,i):new Ot(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(b7,"")}static parseTrackName(e){const t=C7.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);I7.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===t||o.uuid===t)return o;const l=i(o.children);if(l)return l}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=Ot.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){Ie("PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){lt("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){lt("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){lt("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){lt("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){lt("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){lt("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){lt("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[r];if(a===void 0){const c=t.nodeName;lt("PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){lt("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){lt("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ot.Composite=R7;Ot.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ot.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ot.prototype.GetterByBindingType=[Ot.prototype._getValue_direct,Ot.prototype._getValue_array,Ot.prototype._getValue_arrayElement,Ot.prototype._getValue_toArray];Ot.prototype.SetterByBindingTypeAndVersioning=[[Ot.prototype._setValue_direct,Ot.prototype._setValue_direct_setNeedsUpdate,Ot.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ot.prototype._setValue_array,Ot.prototype._setValue_array_setNeedsUpdate,Ot.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ot.prototype._setValue_arrayElement,Ot.prototype._setValue_arrayElement_setNeedsUpdate,Ot.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ot.prototype._setValue_fromArray,Ot.prototype._setValue_fromArray_setNeedsUpdate,Ot.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class P7{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ki(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length;let o,l=e.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],p=d.uuid;let g=t[p];if(g===void 0){g=l++,t[p]=g,e.push(d);for(let _=0,y=a;_!==y;++_)s[_].push(new Ot(d,i[_],r[_]))}else if(g<c){o=e[g];const _=--c,y=e[_];t[y.uuid]=g,e[g]=y,t[p]=_,e[_]=d;for(let m=0,x=a;m!==x;++m){const v=s[m],T=v[_];let R=v[g];v[g]=T,R===void 0&&(R=new Ot(d,i[m],r[m])),v[_]=R}}else e[g]!==o&&lt("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=t[c];if(u!==void 0&&u>=s){const h=s++,d=e[h];t[d.uuid]=u,e[u]=d,t[c]=h,e[h]=l;for(let p=0,g=r;p!==g;++p){const _=i[p],y=_[h],m=_[u];_[u]=y,_[h]=m}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=t[u];if(h!==void 0)if(delete t[u],h<s){const d=--s,p=e[d],g=--a,_=e[g];t[p.uuid]=h,e[h]=p,t[_.uuid]=d,e[d]=_,e.pop();for(let y=0,m=r;y!==m;++y){const x=i[y],v=x[d],T=x[g];x[h]=v,x[d]=T,x.pop()}}else{const d=--a,p=e[d];d>0&&(t[p.uuid]=h),e[h]=p,e.pop();for(let g=0,_=r;g!==_;++g){const y=i[g];y[h]=y[d],y.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let r=i[e];const s=this._bindings;if(r!==void 0)return s[r];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);r=s.length,i[e]=r,a.push(e),o.push(t),s.push(h);for(let d=u,p=l.length;d!==p;++d){const g=l[d];h[d]=new Ot(g,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const r=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=e[o];t[c]=i,a[i]=l,a.pop(),s[i]=s[o],s.pop(),r[i]=r[o],r.pop()}}}class kD{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const s=t.tracks,a=s.length,o=new Array(a),l={endingStart:Bo,endingEnd:Bo};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=TL,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i=!1){if(e.fadeOut(t),this.fadeIn(t),i===!0){const r=this._clip.duration,s=e._clip.duration,a=s/r,o=r/s;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,i=!1){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,s=r.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+i,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case uw:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case H0:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(r,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const a=i===EL;if(e===0)return s===-1?r:a&&(s&1)===1?t-r:r;if(i===wL){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),r>=t||r<0){const o=Math.floor(r/t);r-=t*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(a&&(s&1)===1)return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=zo,r.endingEnd=zo):(e?r.endingStart=this.zeroSlopeAtStart?zo:Bo:r.endingStart=gd,t?r.endingEnd=this.zeroSlopeAtEnd?zo:Bo:r.endingEnd=gd)}_scheduleFading(e,t,i){const r=this._mixer,s=r.time;let a=this._weightInterpolant;a===null&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=t,o[1]=s+e,l[1]=i,this}}const L7=new Float32Array(1);class D7 extends hs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,a=e._propertyBindings,o=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=r[h],p=d.name;let g=u[p];if(g!==void 0)++g.referenceCount,a[h]=g;else{if(g=a[h],g!==void 0){g._cacheIndex===null&&(++g.referenceCount,this._addInactiveBinding(g,l,p));continue}const _=t&&t._propertyBindings[h].binding.parsedPath;g=new OD(Ot.create(i,p,_),d.ValueTypeName,d.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,l,p),a[h]=g}o[h].resultBuffer=g.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=o.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,s=this._bindings;let a=r[t];a===void 0&&(a={},r[t]=a),a[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,a=this._bindingsByRootAndName,o=a[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete o[s],Object.keys(o).length===0&&delete a[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new Pw(new Float32Array(2),new Float32Array(2),1,L7),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const r=t||this._root,s=r.uuid;let a=typeof e=="string"?Ad.findByName(r,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let c=null;if(i===void 0&&(a!==null?i=a.blendMode:i=H0),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===i)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new kD(this,a,t,i);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(e,t){const i=t||this._root,r=i.uuid,s=typeof e=="string"?Ad.findByName(i,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(r,e,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const a in i){const o=i[a].actionByRoot,l=o[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class N7 extends fw{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isRenderTarget3D=!0,this.depth=i,this.texture=new W0(null,e,t,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class zw{constructor(e){this.value=e}clone(){return new zw(this.value.clone===void 0?this.value:this.value.clone())}}let O7=0;class k7 extends hs{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:O7++}),this.name="",this.usage=_d,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,r=t.length;i<r;i++){const s=Array.isArray(t[i])?t[i]:[t[i]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class U7 extends Y0{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class F7{constructor(e,t,i,r,s,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=s,this.normalized=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const wM=new ot;class V7{constructor(e,t,i=0,r=1/0){this.ray=new gu(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new $0,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):lt("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return wM.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(wM),this}intersectObject(e,t=!0,i=[]){return nS(e,this,i,t),i.sort(TM),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)nS(e[r],this,i,t);return i.sort(TM),i}}function TM(n,e){return n.distance-e.distance}function nS(n,e,t,i){let r=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(r=!1),r===!0&&i===!0){const s=n.children;for(let a=0,o=s.length;a<o;a++)nS(s[a],e,t,!0)}}class B7{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=z7.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function z7(){this._document.hidden===!1&&this.reset()}class H7{constructor(e=1,t=0,i=0){this.radius=e,this.phi=t,this.theta=i}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=st(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(st(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class G7{constructor(e=1,t=0,i=0){this.radius=e,this.theta=t,this.y=i}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}class Hw{constructor(e,t,i,r){Hw.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=i,s[3]=r,this}}const EM=new ce;class W7{constructor(e=new ce(1/0,1/0),t=new ce(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=EM.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,EM).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const AM=new F,bp=new F,Zl=new F,Ql=new F,nx=new F,$7=new F,q7=new F;class j7{constructor(e=new F,t=new F){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){AM.subVectors(e,this.start),bp.subVectors(this.end,this.start);const i=bp.dot(bp);let s=bp.dot(AM)/i;return t&&(s=st(s,0,1)),s}closestPointToPoint(e,t,i){const r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}distanceSqToLine3(e,t=$7,i=q7){const r=10000000000000001e-32;let s,a;const o=this.start,l=e.start,c=this.end,u=e.end;Zl.subVectors(c,o),Ql.subVectors(u,l),nx.subVectors(o,l);const h=Zl.dot(Zl),d=Ql.dot(Ql),p=Ql.dot(nx);if(h<=r&&d<=r)return t.copy(o),i.copy(l),t.sub(i),t.dot(t);if(h<=r)s=0,a=p/d,a=st(a,0,1);else{const g=Zl.dot(nx);if(d<=r)a=0,s=st(-g/h,0,1);else{const _=Zl.dot(Ql),y=h*d-_*_;y!==0?s=st((_*p-g*d)/y,0,1):s=0,a=(_*s+p)/d,a<0?(a=0,s=st(-g/h,0,1)):a>1&&(a=1,s=st((_-g)/h,0,1))}}return t.copy(o).add(Zl.multiplyScalar(s)),i.copy(l).add(Ql.multiplyScalar(a)),t.sub(i),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const MM=new F;class X7 extends Ft{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new yt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}i.setAttribute("position",new ze(r,3));const s=new wi({fog:!1,toneMapped:!1});this.cone=new ds(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),MM.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(MM),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ha=new F,wp=new ot,ix=new ot;class K7 extends ds{constructor(e){const t=UD(e),i=new yt,r=[],s=[];for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(0,0,0),s.push(0,0,0))}i.setAttribute("position",new ze(r,3)),i.setAttribute("color",new ze(s,3));const a=new wi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new De(255),l=new De(65280);this.setColors(o,l)}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");ix.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const o=t[s];o.parent&&o.parent.isBone&&(wp.multiplyMatrices(ix,o.matrixWorld),ha.setFromMatrixPosition(wp),r.setXYZ(a,ha.x,ha.y,ha.z),wp.multiplyMatrices(ix,o.parent.matrixWorld),ha.setFromMatrixPosition(wp),r.setXYZ(a+1,ha.x,ha.y,ha.z),a+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const r=this.geometry.getAttribute("color");for(let s=0;s<r.count;s+=2)r.setXYZ(s,e.r,e.g,e.b),r.setXYZ(s+1,t.r,t.g,t.b);return r.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function UD(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push(...UD(n.children[t]));return e}class Y7 extends tn{constructor(e,t,i){const r=new Ns(t,4,2),s=new Pr({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const J7=new F,CM=new De,IM=new De;class Z7 extends Ft{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new Qd(t);r.rotateY(Math.PI*.5),this.material=new Pr({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),a=new Float32Array(s.count*3);r.setAttribute("color",new $t(a,3)),this.add(new tn(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");CM.copy(this.light.color),IM.copy(this.light.groundColor);for(let i=0,r=t.count;i<r;i++){const s=i<r/2?CM:IM;t.setXYZ(i,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(J7.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Q7 extends ds{constructor(e=10,t=10,i=4473924,r=8947848){i=new De(i),r=new De(r);const s=t/2,a=e/t,o=e/2,l=[],c=[];for(let d=0,p=0,g=-o;d<=t;d++,g+=a){l.push(-o,0,g,o,0,g),l.push(g,0,-o,g,0,o);const _=d===s?i:r;_.toArray(c,p),p+=3,_.toArray(c,p),p+=3,_.toArray(c,p),p+=3,_.toArray(c,p),p+=3}const u=new yt;u.setAttribute("position",new ze(l,3)),u.setAttribute("color",new ze(c,3));const h=new wi({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class e$ extends ds{constructor(e=10,t=16,i=8,r=64,s=4473924,a=8947848){s=new De(s),a=new De(a);const o=[],l=[];if(t>1)for(let h=0;h<t;h++){const d=h/t*(Math.PI*2),p=Math.sin(d)*e,g=Math.cos(d)*e;o.push(0,0,0),o.push(p,0,g);const _=h&1?s:a;l.push(_.r,_.g,_.b),l.push(_.r,_.g,_.b)}for(let h=0;h<i;h++){const d=h&1?s:a,p=e-e/i*h;for(let g=0;g<r;g++){let _=g/r*(Math.PI*2),y=Math.sin(_)*p,m=Math.cos(_)*p;o.push(y,0,m),l.push(d.r,d.g,d.b),_=(g+1)/r*(Math.PI*2),y=Math.sin(_)*p,m=Math.cos(_)*p,o.push(y,0,m),l.push(d.r,d.g,d.b)}}const c=new yt;c.setAttribute("position",new ze(o,3)),c.setAttribute("color",new ze(l,3));const u=new wi({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const RM=new F,Tp=new F,PM=new F;class t$ extends Ft{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new yt;r.setAttribute("position",new ze([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new wi({fog:!1,toneMapped:!1});this.lightPlane=new io(r,s),this.add(this.lightPlane),r=new yt,r.setAttribute("position",new ze([0,0,0,0,0,1],3)),this.targetLine=new io(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),RM.setFromMatrixPosition(this.light.matrixWorld),Tp.setFromMatrixPosition(this.light.target.matrixWorld),PM.subVectors(Tp,RM),this.lightPlane.lookAt(Tp),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Tp),this.targetLine.scale.z=PM.length()}}const Ep=new F,un=new q0;class n$ extends ds{constructor(e){const t=new yt,i=new wi({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(g,_){l(g),l(_)}function l(g){r.push(0,0,0),s.push(0,0,0),a[g]===void 0&&(a[g]=[]),a[g].push(r.length/3-1)}t.setAttribute("position",new ze(r,3)),t.setAttribute("color",new ze(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new De(16755200),u=new De(16711680),h=new De(43775),d=new De(16777215),p=new De(3355443);this.setColors(c,u,h,d,p)}setColors(e,t,i,r,s){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,i.r,i.g,i.b),o.setXYZ(33,i.r,i.g,i.b),o.setXYZ(34,i.r,i.g,i.b),o.setXYZ(35,i.r,i.g,i.b),o.setXYZ(36,i.r,i.g,i.b),o.setXYZ(37,i.r,i.g,i.b),o.setXYZ(38,r.r,r.g,r.b),o.setXYZ(39,r.r,r.g,r.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,i=1,r=1;let s,a;if(un.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)s=1,a=0;else if(this.camera.coordinateSystem===ji)s=-1,a=1;else if(this.camera.coordinateSystem===Qc)s=0,a=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);gn("c",t,e,un,0,0,s),gn("t",t,e,un,0,0,a),gn("n1",t,e,un,-i,-r,s),gn("n2",t,e,un,i,-r,s),gn("n3",t,e,un,-i,r,s),gn("n4",t,e,un,i,r,s),gn("f1",t,e,un,-i,-r,a),gn("f2",t,e,un,i,-r,a),gn("f3",t,e,un,-i,r,a),gn("f4",t,e,un,i,r,a),gn("u1",t,e,un,i*.7,r*1.1,s),gn("u2",t,e,un,-i*.7,r*1.1,s),gn("u3",t,e,un,0,r*2,s),gn("cf1",t,e,un,-i,0,a),gn("cf2",t,e,un,i,0,a),gn("cf3",t,e,un,0,-r,a),gn("cf4",t,e,un,0,r,a),gn("cn1",t,e,un,-i,0,s),gn("cn2",t,e,un,i,0,s),gn("cn3",t,e,un,0,-r,s),gn("cn4",t,e,un,0,r,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function gn(n,e,t,i,r,s,a){Ep.set(r,s,a).unproject(i);const o=e[n];if(o!==void 0){const l=t.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],Ep.x,Ep.y,Ep.z)}}const Ap=new ci;class i$ extends ds{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new yt;s.setIndex(new $t(i,1)),s.setAttribute("position",new $t(r,3)),super(s,new wi({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&Ap.setFromObject(this.object),Ap.isEmpty())return;const e=Ap.min,t=Ap.max,i=this.geometry.attributes.position,r=i.array;r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=e.x,r[4]=t.y,r[5]=t.z,r[6]=e.x,r[7]=e.y,r[8]=t.z,r[9]=t.x,r[10]=e.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=e.z,r[15]=e.x,r[16]=t.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=t.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class r$ extends ds{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new yt;s.setIndex(new $t(i,1)),s.setAttribute("position",new ze(r,3)),super(s,new wi({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class s$ extends io{constructor(e,t=1,i=16776960){const r=i,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new yt;a.setAttribute("position",new ze(s,3)),a.computeBoundingSphere(),super(a,new wi({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new yt;l.setAttribute("position",new ze(o,3)),l.computeBoundingSphere(),this.add(new tn(l,new Pr({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const LM=new F;let Mp,rx;class a$ extends Ft{constructor(e=new F(0,0,1),t=new F(0,0,0),i=1,r=16776960,s=i*.2,a=s*.2){super(),this.type="ArrowHelper",Mp===void 0&&(Mp=new yt,Mp.setAttribute("position",new ze([0,0,0,0,1,0],3)),rx=new Zd(.5,1,5,1),rx.translate(0,-.5,0)),this.position.copy(t),this.line=new io(Mp,new wi({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new tn(rx,new Pr({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{LM.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(LM,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class o$ extends ds{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new yt;r.setAttribute("position",new ze(t,3)),r.setAttribute("color",new ze(i,3));const s=new wi({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,i){const r=new De,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class l${constructor(){this.type="ShapePath",this.color=new De,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Hg,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,s,a){return this.currentPath.bezierCurveTo(e,t,i,r,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(m){const x=[];for(let v=0,T=m.length;v<T;v++){const R=m[v],C=new Yo;C.curves=R.curves,x.push(C)}return x}function i(m,x){const v=x.length;let T=!1;for(let R=v-1,C=0;C<v;R=C++){let A=x[R],E=x[C],b=E.x-A.x,S=E.y-A.y;if(Math.abs(S)>Number.EPSILON){if(S<0&&(A=x[C],b=-b,E=x[R],S=-S),m.y<A.y||m.y>E.y)continue;if(m.y===A.y){if(m.x===A.x)return!0}else{const I=S*(m.x-A.x)-b*(m.y-A.y);if(I===0)return!0;if(I<0)continue;T=!T}}else{if(m.y!==A.y)continue;if(E.x<=m.x&&m.x<=A.x||A.x<=m.x&&m.x<=E.x)return!0}}return T}const r=Mr.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new Yo,l.curves=o.curves,c.push(l),c;let u=!r(s[0].getPoints());u=e?!u:u;const h=[],d=[];let p=[],g=0,_;d[g]=void 0,p[g]=[];for(let m=0,x=s.length;m<x;m++)o=s[m],_=o.getPoints(),a=r(_),a=e?!a:a,a?(!u&&d[g]&&g++,d[g]={s:new Yo,p:_},d[g].s.curves=o.curves,u&&g++,p[g]=[]):p[g].push({h:o,p:_[0]});if(!d[0])return t(s);if(d.length>1){let m=!1,x=0;for(let v=0,T=d.length;v<T;v++)h[v]=[];for(let v=0,T=d.length;v<T;v++){const R=p[v];for(let C=0;C<R.length;C++){const A=R[C];let E=!0;for(let b=0;b<d.length;b++)i(A.p,d[b].p)&&(v!==b&&x++,E?(E=!1,h[b].push(A)):m=!0);E&&h[v].push(A)}}x>0&&m===!1&&(p=h)}let y;for(let m=0,x=d.length;m<x;m++){l=d[m].s,c.push(l),y=p[m];for(let v=0,T=y.length;v<T;v++)l.holes.push(y[v].h)}return c}}class c$ extends hs{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Ie("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function u$(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function h$(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function d$(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function iS(n,e,t,i){const r=f$(i);switch(t){case lw:return n*e;case F0:return n*e/r.components*r.byteLength;case Kd:return n*e/r.components*r.byteLength;case V0:return n*e*2/r.components*r.byteLength;case B0:return n*e*2/r.components*r.byteLength;case cw:return n*e*3/r.components*r.byteLength;case li:return n*e*4/r.components*r.byteLength;case z0:return n*e*4/r.components*r.byteLength;case Ch:case Ih:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Rh:case Ph:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case hg:case fg:return Math.max(n,16)*Math.max(e,8)/4;case ug:case dg:return Math.max(n,8)*Math.max(e,8)/2;case pg:case mg:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case gg:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case yg:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case _g:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case xg:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case vg:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case Sg:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case bg:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case wg:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case Tg:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case Eg:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case Ag:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case Mg:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case Cg:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case Ig:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case Rg:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Pg:case Lg:case Dg:return Math.ceil(n/4)*Math.ceil(e/4)*16;case Ng:case Og:return Math.ceil(n/4)*Math.ceil(e/4)*8;case kg:case Ug:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function f$(n){switch(n){case Or:case rw:return{byteLength:1,components:1};case Kc:case sw:case bl:return{byteLength:2,components:1};case k0:case U0:return{byteLength:2,components:4};case $s:case O0:case Li:return{byteLength:4,components:1};case aw:case ow:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}class p${static contain(e,t){return u$(e,t)}static cover(e,t){return h$(e,t)}static fill(e){return d$(e)}static getByteLength(e,t,i,r){return iS(e,t,i,r)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:D0}}));typeof window<"u"&&(window.__THREE__?Ie("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=D0);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function FD(){let n=null,e=!1,t=null,i=null;function r(s,a){t(s,a),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function m$(n){const e=new WeakMap;function t(o,l){const c=o.array,u=o.usage,h=c.byteLength,d=n.createBuffer();n.bindBuffer(l,d),n.bufferData(l,c,u),o.onUploadCallback();let p;if(c instanceof Float32Array)p=n.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)p=n.HALF_FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?p=n.HALF_FLOAT:p=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)p=n.SHORT;else if(c instanceof Uint32Array)p=n.UNSIGNED_INT;else if(c instanceof Int32Array)p=n.INT;else if(c instanceof Int8Array)p=n.BYTE;else if(c instanceof Uint8Array)p=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)p=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:p,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:h}}function i(o,l,c){const u=l.array,h=l.updateRanges;if(n.bindBuffer(c,o),h.length===0)n.bufferSubData(c,0,u);else{h.sort((p,g)=>p.start-g.start);let d=0;for(let p=1;p<h.length;p++){const g=h[d],_=h[p];_.start<=g.start+g.count+1?g.count=Math.max(g.count,_.start+_.count-g.start):(++d,h[d]=_)}h.length=d+1;for(let p=0,g=h.length;p<g;p++){const _=h[p];n.bufferSubData(c,_.start*u.BYTES_PER_ELEMENT,u,_.start,_.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(n.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=e.get(o);(!u||u.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=e.get(o);if(c===void 0)e.set(o,t(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,o,l),c.version=o.version}}return{get:r,remove:s,update:a}}var g$=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,y$=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,_$=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,x$=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,v$=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,S$=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,b$=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,w$=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,T$=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,E$=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,A$=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,M$=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,C$=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,I$=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,R$=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,P$=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,L$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,D$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,N$=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,O$=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,k$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,U$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,F$=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,V$=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,B$=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,z$=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,H$=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,G$=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,W$=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,$$=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,q$="gl_FragColor = linearToOutputTexel( gl_FragColor );",j$=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,X$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,K$=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,Y$=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,J$=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Z$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Q$=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,eq=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,tq=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,nq=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,iq=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,rq=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,sq=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,aq=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,oq=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lq=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,cq=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,uq=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,hq=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,dq=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,fq=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,pq=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 uv = vec2( roughness, dotNV );
	return texture2D( dfgLUT, uv ).rg;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNV * dotNV), 0.0, dotNV), material.roughness );
	vec2 dfgL = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNL * dotNL), 0.0, dotNL), material.roughness );
	vec3 FssEss_V = material.specularColor * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColor * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColor + ( 1.0 - material.specularColor ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,mq=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,gq=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,yq=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,_q=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,xq=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,vq=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Sq=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,bq=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,wq=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Tq=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Eq=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Aq=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Mq=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Cq=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Iq=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Rq=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Pq=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Lq=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Dq=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Nq=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Oq=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,kq=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Uq=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Fq=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Vq=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Bq=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,zq=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Hq=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Gq=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Wq=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,$q=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,qq=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,jq=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Xq=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Kq=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Yq=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Jq=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Zq=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Qq=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,ej=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,tj=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,nj=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,ij=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,rj=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,sj=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,aj=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,oj=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,lj=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,cj=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,uj=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,hj=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,dj=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fj=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,pj=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const mj=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,gj=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,yj=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,_j=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xj=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,vj=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Sj=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,bj=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,wj=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Tj=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Ej=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Aj=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Mj=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Cj=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Ij=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Rj=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Pj=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Lj=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Dj=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Nj=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Oj=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,kj=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Uj=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Fj=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Vj=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Bj=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zj=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Hj=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Gj=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Wj=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,$j=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qj=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,jj=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Xj=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,xt={alphahash_fragment:g$,alphahash_pars_fragment:y$,alphamap_fragment:_$,alphamap_pars_fragment:x$,alphatest_fragment:v$,alphatest_pars_fragment:S$,aomap_fragment:b$,aomap_pars_fragment:w$,batching_pars_vertex:T$,batching_vertex:E$,begin_vertex:A$,beginnormal_vertex:M$,bsdfs:C$,iridescence_fragment:I$,bumpmap_pars_fragment:R$,clipping_planes_fragment:P$,clipping_planes_pars_fragment:L$,clipping_planes_pars_vertex:D$,clipping_planes_vertex:N$,color_fragment:O$,color_pars_fragment:k$,color_pars_vertex:U$,color_vertex:F$,common:V$,cube_uv_reflection_fragment:B$,defaultnormal_vertex:z$,displacementmap_pars_vertex:H$,displacementmap_vertex:G$,emissivemap_fragment:W$,emissivemap_pars_fragment:$$,colorspace_fragment:q$,colorspace_pars_fragment:j$,envmap_fragment:X$,envmap_common_pars_fragment:K$,envmap_pars_fragment:Y$,envmap_pars_vertex:J$,envmap_physical_pars_fragment:lq,envmap_vertex:Z$,fog_vertex:Q$,fog_pars_vertex:eq,fog_fragment:tq,fog_pars_fragment:nq,gradientmap_pars_fragment:iq,lightmap_pars_fragment:rq,lights_lambert_fragment:sq,lights_lambert_pars_fragment:aq,lights_pars_begin:oq,lights_toon_fragment:cq,lights_toon_pars_fragment:uq,lights_phong_fragment:hq,lights_phong_pars_fragment:dq,lights_physical_fragment:fq,lights_physical_pars_fragment:pq,lights_fragment_begin:mq,lights_fragment_maps:gq,lights_fragment_end:yq,logdepthbuf_fragment:_q,logdepthbuf_pars_fragment:xq,logdepthbuf_pars_vertex:vq,logdepthbuf_vertex:Sq,map_fragment:bq,map_pars_fragment:wq,map_particle_fragment:Tq,map_particle_pars_fragment:Eq,metalnessmap_fragment:Aq,metalnessmap_pars_fragment:Mq,morphinstance_vertex:Cq,morphcolor_vertex:Iq,morphnormal_vertex:Rq,morphtarget_pars_vertex:Pq,morphtarget_vertex:Lq,normal_fragment_begin:Dq,normal_fragment_maps:Nq,normal_pars_fragment:Oq,normal_pars_vertex:kq,normal_vertex:Uq,normalmap_pars_fragment:Fq,clearcoat_normal_fragment_begin:Vq,clearcoat_normal_fragment_maps:Bq,clearcoat_pars_fragment:zq,iridescence_pars_fragment:Hq,opaque_fragment:Gq,packing:Wq,premultiplied_alpha_fragment:$q,project_vertex:qq,dithering_fragment:jq,dithering_pars_fragment:Xq,roughnessmap_fragment:Kq,roughnessmap_pars_fragment:Yq,shadowmap_pars_fragment:Jq,shadowmap_pars_vertex:Zq,shadowmap_vertex:Qq,shadowmask_pars_fragment:ej,skinbase_vertex:tj,skinning_pars_vertex:nj,skinning_vertex:ij,skinnormal_vertex:rj,specularmap_fragment:sj,specularmap_pars_fragment:aj,tonemapping_fragment:oj,tonemapping_pars_fragment:lj,transmission_fragment:cj,transmission_pars_fragment:uj,uv_pars_fragment:hj,uv_pars_vertex:dj,uv_vertex:fj,worldpos_vertex:pj,background_vert:mj,background_frag:gj,backgroundCube_vert:yj,backgroundCube_frag:_j,cube_vert:xj,cube_frag:vj,depth_vert:Sj,depth_frag:bj,distanceRGBA_vert:wj,distanceRGBA_frag:Tj,equirect_vert:Ej,equirect_frag:Aj,linedashed_vert:Mj,linedashed_frag:Cj,meshbasic_vert:Ij,meshbasic_frag:Rj,meshlambert_vert:Pj,meshlambert_frag:Lj,meshmatcap_vert:Dj,meshmatcap_frag:Nj,meshnormal_vert:Oj,meshnormal_frag:kj,meshphong_vert:Uj,meshphong_frag:Fj,meshphysical_vert:Vj,meshphysical_frag:Bj,meshtoon_vert:zj,meshtoon_frag:Hj,points_vert:Gj,points_frag:Wj,shadow_vert:$j,shadow_frag:qj,sprite_vert:jj,sprite_frag:Xj},Ce={common:{diffuse:{value:new De(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new gt},alphaMap:{value:null},alphaMapTransform:{value:new gt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new gt}},envmap:{envMap:{value:null},envMapRotation:{value:new gt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new gt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new gt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new gt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new gt},normalScale:{value:new ce(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new gt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new gt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new gt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new gt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new De(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new De(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new gt},alphaTest:{value:0},uvTransform:{value:new gt}},sprite:{diffuse:{value:new De(16777215)},opacity:{value:1},center:{value:new ce(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new gt},alphaMap:{value:null},alphaMapTransform:{value:new gt},alphaTest:{value:0}}},Tr={basic:{uniforms:gi([Ce.common,Ce.specularmap,Ce.envmap,Ce.aomap,Ce.lightmap,Ce.fog]),vertexShader:xt.meshbasic_vert,fragmentShader:xt.meshbasic_frag},lambert:{uniforms:gi([Ce.common,Ce.specularmap,Ce.envmap,Ce.aomap,Ce.lightmap,Ce.emissivemap,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.fog,Ce.lights,{emissive:{value:new De(0)}}]),vertexShader:xt.meshlambert_vert,fragmentShader:xt.meshlambert_frag},phong:{uniforms:gi([Ce.common,Ce.specularmap,Ce.envmap,Ce.aomap,Ce.lightmap,Ce.emissivemap,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.fog,Ce.lights,{emissive:{value:new De(0)},specular:{value:new De(1118481)},shininess:{value:30}}]),vertexShader:xt.meshphong_vert,fragmentShader:xt.meshphong_frag},standard:{uniforms:gi([Ce.common,Ce.envmap,Ce.aomap,Ce.lightmap,Ce.emissivemap,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.roughnessmap,Ce.metalnessmap,Ce.fog,Ce.lights,{emissive:{value:new De(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:xt.meshphysical_vert,fragmentShader:xt.meshphysical_frag},toon:{uniforms:gi([Ce.common,Ce.aomap,Ce.lightmap,Ce.emissivemap,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.gradientmap,Ce.fog,Ce.lights,{emissive:{value:new De(0)}}]),vertexShader:xt.meshtoon_vert,fragmentShader:xt.meshtoon_frag},matcap:{uniforms:gi([Ce.common,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,Ce.fog,{matcap:{value:null}}]),vertexShader:xt.meshmatcap_vert,fragmentShader:xt.meshmatcap_frag},points:{uniforms:gi([Ce.points,Ce.fog]),vertexShader:xt.points_vert,fragmentShader:xt.points_frag},dashed:{uniforms:gi([Ce.common,Ce.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xt.linedashed_vert,fragmentShader:xt.linedashed_frag},depth:{uniforms:gi([Ce.common,Ce.displacementmap]),vertexShader:xt.depth_vert,fragmentShader:xt.depth_frag},normal:{uniforms:gi([Ce.common,Ce.bumpmap,Ce.normalmap,Ce.displacementmap,{opacity:{value:1}}]),vertexShader:xt.meshnormal_vert,fragmentShader:xt.meshnormal_frag},sprite:{uniforms:gi([Ce.sprite,Ce.fog]),vertexShader:xt.sprite_vert,fragmentShader:xt.sprite_frag},background:{uniforms:{uvTransform:{value:new gt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:xt.background_vert,fragmentShader:xt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new gt}},vertexShader:xt.backgroundCube_vert,fragmentShader:xt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:xt.cube_vert,fragmentShader:xt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xt.equirect_vert,fragmentShader:xt.equirect_frag},distanceRGBA:{uniforms:gi([Ce.common,Ce.displacementmap,{referencePosition:{value:new F},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xt.distanceRGBA_vert,fragmentShader:xt.distanceRGBA_frag},shadow:{uniforms:gi([Ce.lights,Ce.fog,{color:{value:new De(0)},opacity:{value:1}}]),vertexShader:xt.shadow_vert,fragmentShader:xt.shadow_frag}};Tr.physical={uniforms:gi([Tr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new gt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new gt},clearcoatNormalScale:{value:new ce(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new gt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new gt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new gt},sheen:{value:0},sheenColor:{value:new De(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new gt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new gt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new gt},transmissionSamplerSize:{value:new ce},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new gt},attenuationDistance:{value:0},attenuationColor:{value:new De(0)},specularColor:{value:new De(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new gt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new gt},anisotropyVector:{value:new ce},anisotropyMap:{value:null},anisotropyMapTransform:{value:new gt}}]),vertexShader:xt.meshphysical_vert,fragmentShader:xt.meshphysical_frag};const Cp={r:0,b:0,g:0},Co=new Ji,Kj=new ot;function Yj(n,e,t,i,r,s,a){const o=new De(0);let l=s===!0?0:1,c,u,h=null,d=0,p=null;function g(v){let T=v.isScene===!0?v.background:null;return T&&T.isTexture&&(T=(v.backgroundBlurriness>0?t:e).get(T)),T}function _(v){let T=!1;const R=g(v);R===null?m(o,l):R&&R.isColor&&(m(R,1),T=!0);const C=n.xr.getEnvironmentBlendMode();C==="additive"?i.buffers.color.setClear(0,0,0,1,a):C==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,a),(n.autoClear||T)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function y(v,T){const R=g(T);R&&(R.isCubeTexture||R.mapping===mu)?(u===void 0&&(u=new tn(new wl(1,1,1),new Zi({name:"BackgroundCubeMaterial",uniforms:nu(Tr.backgroundCube.uniforms),vertexShader:Tr.backgroundCube.vertexShader,fragmentShader:Tr.backgroundCube.fragmentShader,side:vi,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(C,A,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),Co.copy(T.backgroundRotation),Co.x*=-1,Co.y*=-1,Co.z*=-1,R.isCubeTexture&&R.isRenderTargetTexture===!1&&(Co.y*=-1,Co.z*=-1),u.material.uniforms.envMap.value=R,u.material.uniforms.flipEnvMap.value=R.isCubeTexture&&R.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=T.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=T.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Kj.makeRotationFromEuler(Co)),u.material.toneMapped=Lt.getTransfer(R.colorSpace)!==Ht,(h!==R||d!==R.version||p!==n.toneMapping)&&(u.material.needsUpdate=!0,h=R,d=R.version,p=n.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):R&&R.isTexture&&(c===void 0&&(c=new tn(new _u(2,2),new Zi({name:"BackgroundMaterial",uniforms:nu(Tr.background.uniforms),vertexShader:Tr.background.vertexShader,fragmentShader:Tr.background.fragmentShader,side:Gs,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=R,c.material.uniforms.backgroundIntensity.value=T.backgroundIntensity,c.material.toneMapped=Lt.getTransfer(R.colorSpace)!==Ht,R.matrixAutoUpdate===!0&&R.updateMatrix(),c.material.uniforms.uvTransform.value.copy(R.matrix),(h!==R||d!==R.version||p!==n.toneMapping)&&(c.material.needsUpdate=!0,h=R,d=R.version,p=n.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}function m(v,T){v.getRGB(Cp,BL(n)),i.buffers.color.setClear(Cp.r,Cp.g,Cp.b,T,a)}function x(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(v,T=1){o.set(v),l=T,m(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,m(o,l)},render:_,addToRenderList:y,dispose:x}}function Jj(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=d(null);let s=r,a=!1;function o(S,I,D,P,$){let Y=!1;const Z=h(P,D,I);s!==Z&&(s=Z,c(s.object)),Y=p(S,P,D,$),Y&&g(S,P,D,$),$!==null&&e.update($,n.ELEMENT_ARRAY_BUFFER),(Y||a)&&(a=!1,T(S,I,D,P),$!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get($).buffer))}function l(){return n.createVertexArray()}function c(S){return n.bindVertexArray(S)}function u(S){return n.deleteVertexArray(S)}function h(S,I,D){const P=D.wireframe===!0;let $=i[S.id];$===void 0&&($={},i[S.id]=$);let Y=$[I.id];Y===void 0&&(Y={},$[I.id]=Y);let Z=Y[P];return Z===void 0&&(Z=d(l()),Y[P]=Z),Z}function d(S){const I=[],D=[],P=[];for(let $=0;$<t;$++)I[$]=0,D[$]=0,P[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:I,enabledAttributes:D,attributeDivisors:P,object:S,attributes:{},index:null}}function p(S,I,D,P){const $=s.attributes,Y=I.attributes;let Z=0;const fe=D.getAttributes();for(const B in fe)if(fe[B].location>=0){const ee=$[B];let _e=Y[B];if(_e===void 0&&(B==="instanceMatrix"&&S.instanceMatrix&&(_e=S.instanceMatrix),B==="instanceColor"&&S.instanceColor&&(_e=S.instanceColor)),ee===void 0||ee.attribute!==_e||_e&&ee.data!==_e.data)return!0;Z++}return s.attributesNum!==Z||s.index!==P}function g(S,I,D,P){const $={},Y=I.attributes;let Z=0;const fe=D.getAttributes();for(const B in fe)if(fe[B].location>=0){let ee=Y[B];ee===void 0&&(B==="instanceMatrix"&&S.instanceMatrix&&(ee=S.instanceMatrix),B==="instanceColor"&&S.instanceColor&&(ee=S.instanceColor));const _e={};_e.attribute=ee,ee&&ee.data&&(_e.data=ee.data),$[B]=_e,Z++}s.attributes=$,s.attributesNum=Z,s.index=P}function _(){const S=s.newAttributes;for(let I=0,D=S.length;I<D;I++)S[I]=0}function y(S){m(S,0)}function m(S,I){const D=s.newAttributes,P=s.enabledAttributes,$=s.attributeDivisors;D[S]=1,P[S]===0&&(n.enableVertexAttribArray(S),P[S]=1),$[S]!==I&&(n.vertexAttribDivisor(S,I),$[S]=I)}function x(){const S=s.newAttributes,I=s.enabledAttributes;for(let D=0,P=I.length;D<P;D++)I[D]!==S[D]&&(n.disableVertexAttribArray(D),I[D]=0)}function v(S,I,D,P,$,Y,Z){Z===!0?n.vertexAttribIPointer(S,I,D,$,Y):n.vertexAttribPointer(S,I,D,P,$,Y)}function T(S,I,D,P){_();const $=P.attributes,Y=D.getAttributes(),Z=I.defaultAttributeValues;for(const fe in Y){const B=Y[fe];if(B.location>=0){let X=$[fe];if(X===void 0&&(fe==="instanceMatrix"&&S.instanceMatrix&&(X=S.instanceMatrix),fe==="instanceColor"&&S.instanceColor&&(X=S.instanceColor)),X!==void 0){const ee=X.normalized,_e=X.itemSize,Ge=e.get(X);if(Ge===void 0)continue;const ft=Ge.buffer,pt=Ge.type,wt=Ge.bytesPerElement,ne=pt===n.INT||pt===n.UNSIGNED_INT||X.gpuType===O0;if(X.isInterleavedBufferAttribute){const se=X.data,Ne=se.stride,Ye=X.offset;if(se.isInstancedInterleavedBuffer){for(let We=0;We<B.locationSize;We++)m(B.location+We,se.meshPerAttribute);S.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let We=0;We<B.locationSize;We++)y(B.location+We);n.bindBuffer(n.ARRAY_BUFFER,ft);for(let We=0;We<B.locationSize;We++)v(B.location+We,_e/B.locationSize,pt,ee,Ne*wt,(Ye+_e/B.locationSize*We)*wt,ne)}else{if(X.isInstancedBufferAttribute){for(let se=0;se<B.locationSize;se++)m(B.location+se,X.meshPerAttribute);S.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=X.meshPerAttribute*X.count)}else for(let se=0;se<B.locationSize;se++)y(B.location+se);n.bindBuffer(n.ARRAY_BUFFER,ft);for(let se=0;se<B.locationSize;se++)v(B.location+se,_e/B.locationSize,pt,ee,_e*wt,_e/B.locationSize*se*wt,ne)}}else if(Z!==void 0){const ee=Z[fe];if(ee!==void 0)switch(ee.length){case 2:n.vertexAttrib2fv(B.location,ee);break;case 3:n.vertexAttrib3fv(B.location,ee);break;case 4:n.vertexAttrib4fv(B.location,ee);break;default:n.vertexAttrib1fv(B.location,ee)}}}}x()}function R(){E();for(const S in i){const I=i[S];for(const D in I){const P=I[D];for(const $ in P)u(P[$].object),delete P[$];delete I[D]}delete i[S]}}function C(S){if(i[S.id]===void 0)return;const I=i[S.id];for(const D in I){const P=I[D];for(const $ in P)u(P[$].object),delete P[$];delete I[D]}delete i[S.id]}function A(S){for(const I in i){const D=i[I];if(D[S.id]===void 0)continue;const P=D[S.id];for(const $ in P)u(P[$].object),delete P[$];delete D[S.id]}}function E(){b(),a=!0,s!==r&&(s=r,c(s.object))}function b(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:o,reset:E,resetDefaultState:b,dispose:R,releaseStatesOfGeometry:C,releaseStatesOfProgram:A,initAttributes:_,enableAttribute:y,disableUnusedAttributes:x}}function Zj(n,e,t){let i;function r(c){i=c}function s(c,u){n.drawArrays(i,c,u),t.update(u,i,1)}function a(c,u,h){h!==0&&(n.drawArraysInstanced(i,c,u,h),t.update(u,i,h))}function o(c,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,u,0,h);let p=0;for(let g=0;g<h;g++)p+=u[g];t.update(p,i,1)}function l(c,u,h,d){if(h===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let g=0;g<c.length;g++)a(c[g],u[g],d[g]);else{p.multiDrawArraysInstancedWEBGL(i,c,0,u,0,d,0,h);let g=0;for(let _=0;_<h;_++)g+=u[_]*d[_];t.update(g,i,1)}}this.setMode=r,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function Qj(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const A=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(A){return!(A!==li&&i.convert(A)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(A){const E=A===bl&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(A!==Or&&i.convert(A)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&A!==Li&&!E)}function l(A){if(A==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";A="mediump"}return A==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const u=l(c);u!==c&&(Ie("WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=t.logarithmicDepthBuffer===!0,d=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),p=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),g=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_TEXTURE_SIZE),y=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),m=n.getParameter(n.MAX_VERTEX_ATTRIBS),x=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),v=n.getParameter(n.MAX_VARYING_VECTORS),T=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),R=g>0,C=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:h,reversedDepthBuffer:d,maxTextures:p,maxVertexTextures:g,maxTextureSize:_,maxCubemapSize:y,maxAttributes:m,maxVertexUniforms:x,maxVaryings:v,maxFragmentUniforms:T,vertexTextures:R,maxSamples:C}}function eX(n){const e=this;let t=null,i=0,r=!1,s=!1;const a=new ma,o=new gt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||i!==0||r;return r=d,i=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=u(h,d,0)},this.setState=function(h,d,p){const g=h.clippingPlanes,_=h.clipIntersection,y=h.clipShadows,m=n.get(h);if(!r||g===null||g.length===0||s&&!y)s?u(null):c();else{const x=s?0:i,v=x*4;let T=m.clippingState||null;l.value=T,T=u(g,d,v,p);for(let R=0;R!==v;++R)T[R]=t[R];m.clippingState=T,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(h,d,p,g){const _=h!==null?h.length:0;let y=null;if(_!==0){if(y=l.value,g!==!0||y===null){const m=p+_*4,x=d.matrixWorldInverse;o.getNormalMatrix(x),(y===null||y.length<m)&&(y=new Float32Array(m));for(let v=0,T=p;v!==_;++v,T+=4)a.copy(h[v]).applyMatrix4(x,o),a.normal.toArray(y,T),y[T+3]=a.constant}l.value=y,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,y}}function tX(n){let e=new WeakMap;function t(a,o){return o===hd?a.mapping=Ws:o===dd&&(a.mapping=to),a}function i(a){if(a&&a.isTexture){const o=a.mapping;if(o===hd||o===dd)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new GL(l.height);return c.fromEquirectangularTexture(n,a),e.set(a,c),a.addEventListener("dispose",r),t(c.texture,a.mapping)}else return null}}return a}function r(a){const o=a.target;o.removeEventListener("dispose",r);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}const Ia=4,DM=[.125,.215,.35,.446,.526,.582],Oo=20,nX=256,Ju=new fy,NM=new De;let sx=null,ax=0,ox=0,lx=!1;const iX=new F;class rS{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,i=.1,r=100,s={}){const{size:a=256,position:o=iX}=s;sx=this._renderer.getRenderTarget(),ax=this._renderer.getActiveCubeFace(),ox=this._renderer.getActiveMipmapLevel(),lx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,i,r,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=UM(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=kM(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(sx,ax,ox),this._renderer.xr.enabled=lx,e.scissorTest=!1,ec(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ws||e.mapping===to?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),sx=this._renderer.getRenderTarget(),ax=this._renderer.getActiveCubeFace(),ox=this._renderer.getActiveMipmapLevel(),lx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:sn,minFilter:sn,generateMipmaps:!1,type:bl,format:li,colorSpace:cl,depthBuffer:!1},r=OM(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=OM(e,t,i);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=rX(s)),this._blurMaterial=aX(s,e,t),this._ggxMaterial=sX(s,e,t)}return r}_compileMaterial(e){const t=new tn(new yt,e);this._renderer.compile(t,Ju)}_sceneToCubeUV(e,t,i,r,s){const l=new In(90,1,t,i),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,p=h.toneMapping;h.getClearColor(NM),h.toneMapping=Ls,h.autoClear=!1,h.state.buffers.depth.getReversed()&&(h.setRenderTarget(r),h.clearDepth(),h.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new tn(new wl,new Pr({name:"PMREM.Background",side:vi,depthWrite:!1,depthTest:!1})));const _=this._backgroundBox,y=_.material;let m=!1;const x=e.background;x?x.isColor&&(y.color.copy(x),e.background=null,m=!0):(y.color.copy(NM),m=!0);for(let v=0;v<6;v++){const T=v%3;T===0?(l.up.set(0,c[v],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+u[v],s.y,s.z)):T===1?(l.up.set(0,0,c[v]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+u[v],s.z)):(l.up.set(0,c[v],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+u[v]));const R=this._cubeSize;ec(r,T*R,v>2?R:0,R,R),h.setRenderTarget(r),m&&h.render(_,l),h.render(e,l)}h.toneMapping=p,h.autoClear=d,e.background=x}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Ws||e.mapping===to;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=UM()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=kM());const s=r?this._cubemapMaterial:this._equirectMaterial,a=this._lodMeshes[0];a.material=s;const o=s.uniforms;o.envMap.value=e;const l=this._cubeSize;ec(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(a,Ju)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let s=1;s<r;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=i}_applyGGXFilter(e,t,i){const r=this._renderer,s=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[i];o.material=a;const l=a.uniforms,c=i/(this._lodMeshes.length-1),u=t/(this._lodMeshes.length-1),h=Math.sqrt(c*c-u*u),d=.05+c*.95,p=h*d,{_lodMax:g}=this,_=this._sizeLods[i],y=3*_*(i>g-Ia?i-g+Ia:0),m=4*(this._cubeSize-_);l.envMap.value=e.texture,l.roughness.value=p,l.mipInt.value=g-t,ec(s,y,m,3*_,2*_),r.setRenderTarget(s),r.render(o,Ju),l.envMap.value=s.texture,l.roughness.value=0,l.mipInt.value=g-i,ec(e,y,m,3*_,2*_),r.setRenderTarget(e),r.render(o,Ju)}_blur(e,t,i,r,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",s),this._halfBlur(a,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&lt("blur direction must be either latitudinal or longitudinal!");const u=3,h=this._lodMeshes[r];h.material=c;const d=c.uniforms,p=this._sizeLods[i]-1,g=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*Oo-1),_=s/g,y=isFinite(s)?1+Math.floor(u*_):Oo;y>Oo&&Ie(`sigmaRadians, ${s}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${Oo}`);const m=[];let x=0;for(let A=0;A<Oo;++A){const E=A/_,b=Math.exp(-E*E/2);m.push(b),A===0?x+=b:A<y&&(x+=2*b)}for(let A=0;A<m.length;A++)m[A]=m[A]/x;d.envMap.value=e.texture,d.samples.value=y,d.weights.value=m,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:v}=this;d.dTheta.value=g,d.mipInt.value=v-i;const T=this._sizeLods[r],R=3*T*(r>v-Ia?r-v+Ia:0),C=4*(this._cubeSize-T);ec(t,R,C,3*T,2*T),l.setRenderTarget(t),l.render(h,Ju)}}function rX(n){const e=[],t=[],i=[];let r=n;const s=n-Ia+1+DM.length;for(let a=0;a<s;a++){const o=Math.pow(2,r);e.push(o);let l=1/o;a>n-Ia?l=DM[a-n+Ia-1]:a===0&&(l=0),t.push(l);const c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,g=6,_=3,y=2,m=1,x=new Float32Array(_*g*p),v=new Float32Array(y*g*p),T=new Float32Array(m*g*p);for(let C=0;C<p;C++){const A=C%3*2/3-1,E=C>2?0:-1,b=[A,E,0,A+2/3,E,0,A+2/3,E+1,0,A,E,0,A+2/3,E+1,0,A,E+1,0];x.set(b,_*g*C),v.set(d,y*g*C);const S=[C,C,C,C,C,C];T.set(S,m*g*C)}const R=new yt;R.setAttribute("position",new $t(x,_)),R.setAttribute("uv",new $t(v,y)),R.setAttribute("faceIndex",new $t(T,m)),i.push(new tn(R,null)),r>Ia&&r--}return{lodMeshes:i,sizeLods:e,sigmas:t}}function OM(n,e,t){const i=new kr(n,e,t);return i.texture.mapping=mu,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ec(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function sX(n,e,t){return new Zi({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:nX,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:my(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:os,depthTest:!1,depthWrite:!1})}function aX(n,e,t){const i=new Float32Array(Oo),r=new F(0,1,0);return new Zi({name:"SphericalGaussianBlur",defines:{n:Oo,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:my(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:os,depthTest:!1,depthWrite:!1})}function kM(){return new Zi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:my(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:os,depthTest:!1,depthWrite:!1})}function UM(){return new Zi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:my(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:os,depthTest:!1,depthWrite:!1})}function my(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function oX(n){let e=new WeakMap,t=null;function i(o){if(o&&o.isTexture){const l=o.mapping,c=l===hd||l===dd,u=l===Ws||l===to;if(c||u){let h=e.get(o);const d=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return t===null&&(t=new rS(n)),h=c?t.fromEquirectangular(o,h):t.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),h.texture;if(h!==void 0)return h.texture;{const p=o.image;return c&&p&&p.height>0||u&&p&&r(p)?(t===null&&(t=new rS(n)),h=c?t.fromEquirectangular(o):t.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),o.addEventListener("dispose",s),h.texture):null}}}return o}function r(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:a}}function lX(n){const e={};function t(i){if(e[i]!==void 0)return e[i];const r=n.getExtension(i);return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&eu("WebGLRenderer: "+i+" extension not supported."),r}}}function cX(n,e,t,i){const r={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const g in d.attributes)e.remove(d.attributes[g]);d.removeEventListener("dispose",a),delete r[d.id];const p=s.get(d);p&&(e.remove(p),s.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function o(h,d){return r[d.id]===!0||(d.addEventListener("dispose",a),r[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const p in d)e.update(d[p],n.ARRAY_BUFFER)}function c(h){const d=[],p=h.index,g=h.attributes.position;let _=0;if(p!==null){const x=p.array;_=p.version;for(let v=0,T=x.length;v<T;v+=3){const R=x[v+0],C=x[v+1],A=x[v+2];d.push(R,C,C,A,A,R)}}else if(g!==void 0){const x=g.array;_=g.version;for(let v=0,T=x.length/3-1;v<T;v+=3){const R=v+0,C=v+1,A=v+2;d.push(R,C,C,A,A,R)}}else return;const y=new(kL(d)?mw:pw)(d,1);y.version=_;const m=s.get(h);m&&e.remove(m),s.set(h,y)}function u(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function uX(n,e,t){let i;function r(d){i=d}let s,a;function o(d){s=d.type,a=d.bytesPerElement}function l(d,p){n.drawElements(i,p,s,d*a),t.update(p,i,1)}function c(d,p,g){g!==0&&(n.drawElementsInstanced(i,p,s,d*a,g),t.update(p,i,g))}function u(d,p,g){if(g===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,p,0,s,d,0,g);let y=0;for(let m=0;m<g;m++)y+=p[m];t.update(y,i,1)}function h(d,p,g,_){if(g===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let m=0;m<d.length;m++)c(d[m]/a,p[m],_[m]);else{y.multiDrawElementsInstancedWEBGL(i,p,0,s,d,0,_,0,g);let m=0;for(let x=0;x<g;x++)m+=p[x]*_[x];t.update(m,i,1)}}this.setMode=r,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function hX(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,a,o){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=o*(s/3);break;case n.LINES:t.lines+=o*(s/2);break;case n.LINE_STRIP:t.lines+=o*(s-1);break;case n.LINE_LOOP:t.lines+=o*s;break;case n.POINTS:t.points+=o*s;break;default:lt("WebGLInfo: Unknown draw mode:",a);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function dX(n,e,t){const i=new WeakMap,r=new kt;function s(a,o,l){const c=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=u!==void 0?u.length:0;let d=i.get(o);if(d===void 0||d.count!==h){let b=function(){A.dispose(),i.delete(o),o.removeEventListener("dispose",b)};d!==void 0&&d.texture.dispose();const p=o.morphAttributes.position!==void 0,g=o.morphAttributes.normal!==void 0,_=o.morphAttributes.color!==void 0,y=o.morphAttributes.position||[],m=o.morphAttributes.normal||[],x=o.morphAttributes.color||[];let v=0;p===!0&&(v=1),g===!0&&(v=2),_===!0&&(v=3);let T=o.attributes.position.count*v,R=1;T>e.maxTextureSize&&(R=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const C=new Float32Array(T*R*4*h),A=new G0(C,T,R,h);A.type=Li,A.needsUpdate=!0;const E=v*4;for(let S=0;S<h;S++){const I=y[S],D=m[S],P=x[S],$=T*R*4*S;for(let Y=0;Y<I.count;Y++){const Z=Y*E;p===!0&&(r.fromBufferAttribute(I,Y),C[$+Z+0]=r.x,C[$+Z+1]=r.y,C[$+Z+2]=r.z,C[$+Z+3]=0),g===!0&&(r.fromBufferAttribute(D,Y),C[$+Z+4]=r.x,C[$+Z+5]=r.y,C[$+Z+6]=r.z,C[$+Z+7]=0),_===!0&&(r.fromBufferAttribute(P,Y),C[$+Z+8]=r.x,C[$+Z+9]=r.y,C[$+Z+10]=r.z,C[$+Z+11]=P.itemSize===4?r.w:1)}}d={count:h,texture:A,size:new ce(T,R)},i.set(o,d),o.addEventListener("dispose",b)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let p=0;for(let _=0;_<c.length;_++)p+=c[_];const g=o.morphTargetsRelative?1:1-p;l.getUniforms().setValue(n,"morphTargetBaseInfluence",g),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",d.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}return{update:s}}function fX(n,e,t,i){let r=new WeakMap;function s(l){const c=i.render.frame,u=l.geometry,h=e.get(l,u);if(r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),r.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==c&&(d.update(),r.set(d,c))}return h}function a(){r=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:a}}const VD=new fn,FM=new xw(1,1),BD=new G0,zD=new W0,HD=new Yd,VM=[],BM=[],zM=new Float32Array(16),HM=new Float32Array(9),GM=new Float32Array(4);function xu(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=VM[r];if(s===void 0&&(s=new Float32Array(r),VM[r]=s),e!==0){i.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,n[a].toArray(s,o)}return s}function Dn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Nn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function gy(n,e){let t=BM[e];t===void 0&&(t=new Int32Array(e),BM[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function pX(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function mX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Dn(t,e))return;n.uniform2fv(this.addr,e),Nn(t,e)}}function gX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Dn(t,e))return;n.uniform3fv(this.addr,e),Nn(t,e)}}function yX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Dn(t,e))return;n.uniform4fv(this.addr,e),Nn(t,e)}}function _X(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Dn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Nn(t,e)}else{if(Dn(t,i))return;GM.set(i),n.uniformMatrix2fv(this.addr,!1,GM),Nn(t,i)}}function xX(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Dn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Nn(t,e)}else{if(Dn(t,i))return;HM.set(i),n.uniformMatrix3fv(this.addr,!1,HM),Nn(t,i)}}function vX(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Dn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Nn(t,e)}else{if(Dn(t,i))return;zM.set(i),n.uniformMatrix4fv(this.addr,!1,zM),Nn(t,i)}}function SX(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function bX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Dn(t,e))return;n.uniform2iv(this.addr,e),Nn(t,e)}}function wX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Dn(t,e))return;n.uniform3iv(this.addr,e),Nn(t,e)}}function TX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Dn(t,e))return;n.uniform4iv(this.addr,e),Nn(t,e)}}function EX(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function AX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Dn(t,e))return;n.uniform2uiv(this.addr,e),Nn(t,e)}}function MX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Dn(t,e))return;n.uniform3uiv(this.addr,e),Nn(t,e)}}function CX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Dn(t,e))return;n.uniform4uiv(this.addr,e),Nn(t,e)}}function IX(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let s;this.type===n.SAMPLER_2D_SHADOW?(FM.compareFunction=hw,s=FM):s=VD,t.setTexture2D(e||s,r)}function RX(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||zD,r)}function PX(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||HD,r)}function LX(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||BD,r)}function DX(n){switch(n){case 5126:return pX;case 35664:return mX;case 35665:return gX;case 35666:return yX;case 35674:return _X;case 35675:return xX;case 35676:return vX;case 5124:case 35670:return SX;case 35667:case 35671:return bX;case 35668:case 35672:return wX;case 35669:case 35673:return TX;case 5125:return EX;case 36294:return AX;case 36295:return MX;case 36296:return CX;case 35678:case 36198:case 36298:case 36306:case 35682:return IX;case 35679:case 36299:case 36307:return RX;case 35680:case 36300:case 36308:case 36293:return PX;case 36289:case 36303:case 36311:case 36292:return LX}}function NX(n,e){n.uniform1fv(this.addr,e)}function OX(n,e){const t=xu(e,this.size,2);n.uniform2fv(this.addr,t)}function kX(n,e){const t=xu(e,this.size,3);n.uniform3fv(this.addr,t)}function UX(n,e){const t=xu(e,this.size,4);n.uniform4fv(this.addr,t)}function FX(n,e){const t=xu(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function VX(n,e){const t=xu(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function BX(n,e){const t=xu(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function zX(n,e){n.uniform1iv(this.addr,e)}function HX(n,e){n.uniform2iv(this.addr,e)}function GX(n,e){n.uniform3iv(this.addr,e)}function WX(n,e){n.uniform4iv(this.addr,e)}function $X(n,e){n.uniform1uiv(this.addr,e)}function qX(n,e){n.uniform2uiv(this.addr,e)}function jX(n,e){n.uniform3uiv(this.addr,e)}function XX(n,e){n.uniform4uiv(this.addr,e)}function KX(n,e,t){const i=this.cache,r=e.length,s=gy(t,r);Dn(i,s)||(n.uniform1iv(this.addr,s),Nn(i,s));for(let a=0;a!==r;++a)t.setTexture2D(e[a]||VD,s[a])}function YX(n,e,t){const i=this.cache,r=e.length,s=gy(t,r);Dn(i,s)||(n.uniform1iv(this.addr,s),Nn(i,s));for(let a=0;a!==r;++a)t.setTexture3D(e[a]||zD,s[a])}function JX(n,e,t){const i=this.cache,r=e.length,s=gy(t,r);Dn(i,s)||(n.uniform1iv(this.addr,s),Nn(i,s));for(let a=0;a!==r;++a)t.setTextureCube(e[a]||HD,s[a])}function ZX(n,e,t){const i=this.cache,r=e.length,s=gy(t,r);Dn(i,s)||(n.uniform1iv(this.addr,s),Nn(i,s));for(let a=0;a!==r;++a)t.setTexture2DArray(e[a]||BD,s[a])}function QX(n){switch(n){case 5126:return NX;case 35664:return OX;case 35665:return kX;case 35666:return UX;case 35674:return FX;case 35675:return VX;case 35676:return BX;case 5124:case 35670:return zX;case 35667:case 35671:return HX;case 35668:case 35672:return GX;case 35669:case 35673:return WX;case 5125:return $X;case 36294:return qX;case 36295:return jX;case 36296:return XX;case 35678:case 36198:case 36298:case 36306:case 35682:return KX;case 35679:case 36299:case 36307:return YX;case 35680:case 36300:case 36308:case 36293:return JX;case 36289:case 36303:case 36311:case 36292:return ZX}}class eK{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=DX(t.type)}}class tK{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=QX(t.type)}}class nK{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,a=r.length;s!==a;++s){const o=r[s];o.setValue(e,t[o.id],i)}}}const cx=/(\w+)(\])?(\[|\.)?/g;function WM(n,e){n.seq.push(e),n.map[e.id]=e}function iK(n,e,t){const i=n.name,r=i.length;for(cx.lastIndex=0;;){const s=cx.exec(i),a=cx.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===r){WM(t,c===void 0?new eK(o,n,e):new tK(o,n,e));break}else{let h=t.map[o];h===void 0&&(h=new nK(o),WM(t,h)),t=h}}}class rm{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r),a=e.getUniformLocation(t,s.name);iK(s,a,this)}}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,a=t.length;s!==a;++s){const o=t[s],l=i[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const a=e[r];a.id in t&&i.push(a)}return i}}function $M(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const rK=37297;let sK=0;function aK(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=r;a<s;a++){const o=a+1;i.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return i.join(`
`)}const qM=new gt;function oK(n){Lt._getMatrix(qM,Lt.workingColorSpace,n);const e=`mat3( ${qM.elements.map(t=>t.toFixed(4))} )`;switch(Lt.getTransfer(n)){case yd:return[e,"LinearTransferOETF"];case Ht:return[e,"sRGBTransferOETF"];default:return Ie("WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function jM(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=(n.getShaderInfoLog(e)||"").trim();if(i&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+s+`

`+aK(n.getShaderSource(e),o)}else return s}function lK(n,e){const t=oK(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function cK(n,e){let t;switch(e){case mL:t="Linear";break;case gL:t="Reinhard";break;case yL:t="Cineon";break;case _L:t="ACESFilmic";break;case vL:t="AgX";break;case SL:t="Neutral";break;case xL:t="Custom";break;default:Ie("WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Ip=new F;function uK(){Lt.getLuminanceCoefficients(Ip);const n=Ip.x.toFixed(4),e=Ip.y.toFixed(4),t=Ip.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function hK(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ch).join(`
`)}function dK(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function fK(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),a=s.name;let o=1;s.type===n.FLOAT_MAT2&&(o=2),s.type===n.FLOAT_MAT3&&(o=3),s.type===n.FLOAT_MAT4&&(o=4),t[a]={type:s.type,location:n.getAttribLocation(e,a),locationSize:o}}return t}function ch(n){return n!==""}function XM(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function KM(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const pK=/^[ \t]*#include +<([\w\d./]+)>/gm;function sS(n){return n.replace(pK,gK)}const mK=new Map;function gK(n,e){let t=xt[e];if(t===void 0){const i=mK.get(e);if(i!==void 0)t=xt[i],Ie('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return sS(t)}const yK=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function YM(n){return n.replace(yK,_K)}function _K(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function JM(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function xK(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===nw?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===X3?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Wr&&(e="SHADOWMAP_TYPE_VSM"),e}function vK(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ws:case to:e="ENVMAP_TYPE_CUBE";break;case mu:e="ENVMAP_TYPE_CUBE_UV";break}return e}function SK(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case to:e="ENVMAP_MODE_REFRACTION";break}return e}function bK(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Xd:e="ENVMAP_BLENDING_MULTIPLY";break;case fL:e="ENVMAP_BLENDING_MIX";break;case pL:e="ENVMAP_BLENDING_ADD";break}return e}function wK(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function TK(n,e,t,i){const r=n.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=xK(t),c=vK(t),u=SK(t),h=bK(t),d=wK(t),p=hK(t),g=dK(s),_=r.createProgram();let y,m,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(ch).join(`
`),y.length>0&&(y+=`
`),m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(ch).join(`
`),m.length>0&&(m+=`
`)):(y=[JM(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ch).join(`
`),m=[JM(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ls?"#define TONE_MAPPING":"",t.toneMapping!==Ls?xt.tonemapping_pars_fragment:"",t.toneMapping!==Ls?cK("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",xt.colorspace_pars_fragment,lK("linearToOutputTexel",t.outputColorSpace),uK(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(ch).join(`
`)),a=sS(a),a=XM(a,t),a=KM(a,t),o=sS(o),o=XM(o,t),o=KM(o,t),a=YM(a),o=YM(o),t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,y=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,m=["#define varying in",t.glslVersion===Yv?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Yv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const v=x+y+a,T=x+m+o,R=$M(r,r.VERTEX_SHADER,v),C=$M(r,r.FRAGMENT_SHADER,T);r.attachShader(_,R),r.attachShader(_,C),t.index0AttributeName!==void 0?r.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_);function A(I){if(n.debug.checkShaderErrors){const D=r.getProgramInfoLog(_)||"",P=r.getShaderInfoLog(R)||"",$=r.getShaderInfoLog(C)||"",Y=D.trim(),Z=P.trim(),fe=$.trim();let B=!0,X=!0;if(r.getProgramParameter(_,r.LINK_STATUS)===!1)if(B=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,_,R,C);else{const ee=jM(r,R,"vertex"),_e=jM(r,C,"fragment");lt("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+`

Material Name: `+I.name+`
Material Type: `+I.type+`

Program Info Log: `+Y+`
`+ee+`
`+_e)}else Y!==""?Ie("WebGLProgram: Program Info Log:",Y):(Z===""||fe==="")&&(X=!1);X&&(I.diagnostics={runnable:B,programLog:Y,vertexShader:{log:Z,prefix:y},fragmentShader:{log:fe,prefix:m}})}r.deleteShader(R),r.deleteShader(C),E=new rm(r,_),b=fK(r,_)}let E;this.getUniforms=function(){return E===void 0&&A(this),E};let b;this.getAttributes=function(){return b===void 0&&A(this),b};let S=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return S===!1&&(S=r.getProgramParameter(_,rK)),S},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=sK++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=R,this.fragmentShader=C,this}let EK=0;class AK{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new MK(e),t.set(e,i)),i}}class MK{constructor(e){this.id=EK++,this.code=e,this.usedTimes=0}}function CK(n,e,t,i,r,s,a){const o=new $0,l=new AK,c=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(b){return c.add(b),b===0?"uv":`uv${b}`}function y(b,S,I,D,P){const $=D.fog,Y=P.geometry,Z=b.isMeshStandardMaterial?D.environment:null,fe=(b.isMeshStandardMaterial?t:e).get(b.envMap||Z),B=fe&&fe.mapping===mu?fe.image.height:null,X=g[b.type];b.precision!==null&&(p=r.getMaxPrecision(b.precision),p!==b.precision&&Ie("WebGLProgram.getParameters:",b.precision,"not supported, using",p,"instead."));const ee=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,_e=ee!==void 0?ee.length:0;let Ge=0;Y.morphAttributes.position!==void 0&&(Ge=1),Y.morphAttributes.normal!==void 0&&(Ge=2),Y.morphAttributes.color!==void 0&&(Ge=3);let ft,pt,wt,ne;if(X){const Rt=Tr[X];ft=Rt.vertexShader,pt=Rt.fragmentShader}else ft=b.vertexShader,pt=b.fragmentShader,l.update(b),wt=l.getVertexShaderID(b),ne=l.getFragmentShaderID(b);const se=n.getRenderTarget(),Ne=n.state.buffers.depth.getReversed(),Ye=P.isInstancedMesh===!0,We=P.isBatchedMesh===!0,vt=!!b.map,Bt=!!b.matcap,tt=!!fe,de=!!b.aoMap,U=!!b.lightMap,he=!!b.bumpMap,me=!!b.normalMap,ve=!!b.displacementMap,oe=!!b.emissiveMap,Ae=!!b.metalnessMap,be=!!b.roughnessMap,Oe=b.anisotropy>0,k=b.clearcoat>0,L=b.dispersion>0,G=b.iridescence>0,Q=b.sheen>0,le=b.transmission>0,J=Oe&&!!b.anisotropyMap,$e=k&&!!b.clearcoatMap,Me=k&&!!b.clearcoatNormalMap,Xe=k&&!!b.clearcoatRoughnessMap,He=G&&!!b.iridescenceMap,ue=G&&!!b.iridescenceThicknessMap,Se=Q&&!!b.sheenColorMap,Qe=Q&&!!b.sheenRoughnessMap,qe=!!b.specularMap,Le=!!b.specularColorMap,nt=!!b.specularIntensityMap,V=le&&!!b.transmissionMap,Ee=le&&!!b.thicknessMap,we=!!b.gradientMap,pe=!!b.alphaMap,ge=b.alphaTest>0,re=!!b.alphaHash,Fe=!!b.extensions;let ut=Ls;b.toneMapped&&(se===null||se.isXRRenderTarget===!0)&&(ut=n.toneMapping);const qt={shaderID:X,shaderType:b.type,shaderName:b.name,vertexShader:ft,fragmentShader:pt,defines:b.defines,customVertexShaderID:wt,customFragmentShaderID:ne,isRawShaderMaterial:b.isRawShaderMaterial===!0,glslVersion:b.glslVersion,precision:p,batching:We,batchingColor:We&&P._colorsTexture!==null,instancing:Ye,instancingColor:Ye&&P.instanceColor!==null,instancingMorph:Ye&&P.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:se===null?n.outputColorSpace:se.isXRRenderTarget===!0?se.texture.colorSpace:cl,alphaToCoverage:!!b.alphaToCoverage,map:vt,matcap:Bt,envMap:tt,envMapMode:tt&&fe.mapping,envMapCubeUVHeight:B,aoMap:de,lightMap:U,bumpMap:he,normalMap:me,displacementMap:d&&ve,emissiveMap:oe,normalMapObjectSpace:me&&b.normalMapType===CL,normalMapTangentSpace:me&&b.normalMapType===co,metalnessMap:Ae,roughnessMap:be,anisotropy:Oe,anisotropyMap:J,clearcoat:k,clearcoatMap:$e,clearcoatNormalMap:Me,clearcoatRoughnessMap:Xe,dispersion:L,iridescence:G,iridescenceMap:He,iridescenceThicknessMap:ue,sheen:Q,sheenColorMap:Se,sheenRoughnessMap:Qe,specularMap:qe,specularColorMap:Le,specularIntensityMap:nt,transmission:le,transmissionMap:V,thicknessMap:Ee,gradientMap:we,opaque:b.transparent===!1&&b.blending===Xo&&b.alphaToCoverage===!1,alphaMap:pe,alphaTest:ge,alphaHash:re,combine:b.combine,mapUv:vt&&_(b.map.channel),aoMapUv:de&&_(b.aoMap.channel),lightMapUv:U&&_(b.lightMap.channel),bumpMapUv:he&&_(b.bumpMap.channel),normalMapUv:me&&_(b.normalMap.channel),displacementMapUv:ve&&_(b.displacementMap.channel),emissiveMapUv:oe&&_(b.emissiveMap.channel),metalnessMapUv:Ae&&_(b.metalnessMap.channel),roughnessMapUv:be&&_(b.roughnessMap.channel),anisotropyMapUv:J&&_(b.anisotropyMap.channel),clearcoatMapUv:$e&&_(b.clearcoatMap.channel),clearcoatNormalMapUv:Me&&_(b.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Xe&&_(b.clearcoatRoughnessMap.channel),iridescenceMapUv:He&&_(b.iridescenceMap.channel),iridescenceThicknessMapUv:ue&&_(b.iridescenceThicknessMap.channel),sheenColorMapUv:Se&&_(b.sheenColorMap.channel),sheenRoughnessMapUv:Qe&&_(b.sheenRoughnessMap.channel),specularMapUv:qe&&_(b.specularMap.channel),specularColorMapUv:Le&&_(b.specularColorMap.channel),specularIntensityMapUv:nt&&_(b.specularIntensityMap.channel),transmissionMapUv:V&&_(b.transmissionMap.channel),thicknessMapUv:Ee&&_(b.thicknessMap.channel),alphaMapUv:pe&&_(b.alphaMap.channel),vertexTangents:!!Y.attributes.tangent&&(me||Oe),vertexColors:b.vertexColors,vertexAlphas:b.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,pointsUvs:P.isPoints===!0&&!!Y.attributes.uv&&(vt||pe),fog:!!$,useFog:b.fog===!0,fogExp2:!!$&&$.isFogExp2,flatShading:b.flatShading===!0&&b.wireframe===!1,sizeAttenuation:b.sizeAttenuation===!0,logarithmicDepthBuffer:h,reversedDepthBuffer:Ne,skinning:P.isSkinnedMesh===!0,morphTargets:Y.morphAttributes.position!==void 0,morphNormals:Y.morphAttributes.normal!==void 0,morphColors:Y.morphAttributes.color!==void 0,morphTargetsCount:_e,morphTextureStride:Ge,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numLightProbes:S.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:b.dithering,shadowMapEnabled:n.shadowMap.enabled&&I.length>0,shadowMapType:n.shadowMap.type,toneMapping:ut,decodeVideoTexture:vt&&b.map.isVideoTexture===!0&&Lt.getTransfer(b.map.colorSpace)===Ht,decodeVideoTextureEmissive:oe&&b.emissiveMap.isVideoTexture===!0&&Lt.getTransfer(b.emissiveMap.colorSpace)===Ht,premultipliedAlpha:b.premultipliedAlpha,doubleSided:b.side===jr,flipSided:b.side===vi,useDepthPacking:b.depthPacking>=0,depthPacking:b.depthPacking||0,index0AttributeName:b.index0AttributeName,extensionClipCullDistance:Fe&&b.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Fe&&b.extensions.multiDraw===!0||We)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:b.customProgramCacheKey()};return qt.vertexUv1s=c.has(1),qt.vertexUv2s=c.has(2),qt.vertexUv3s=c.has(3),c.clear(),qt}function m(b){const S=[];if(b.shaderID?S.push(b.shaderID):(S.push(b.customVertexShaderID),S.push(b.customFragmentShaderID)),b.defines!==void 0)for(const I in b.defines)S.push(I),S.push(b.defines[I]);return b.isRawShaderMaterial===!1&&(x(S,b),v(S,b),S.push(n.outputColorSpace)),S.push(b.customProgramCacheKey),S.join()}function x(b,S){b.push(S.precision),b.push(S.outputColorSpace),b.push(S.envMapMode),b.push(S.envMapCubeUVHeight),b.push(S.mapUv),b.push(S.alphaMapUv),b.push(S.lightMapUv),b.push(S.aoMapUv),b.push(S.bumpMapUv),b.push(S.normalMapUv),b.push(S.displacementMapUv),b.push(S.emissiveMapUv),b.push(S.metalnessMapUv),b.push(S.roughnessMapUv),b.push(S.anisotropyMapUv),b.push(S.clearcoatMapUv),b.push(S.clearcoatNormalMapUv),b.push(S.clearcoatRoughnessMapUv),b.push(S.iridescenceMapUv),b.push(S.iridescenceThicknessMapUv),b.push(S.sheenColorMapUv),b.push(S.sheenRoughnessMapUv),b.push(S.specularMapUv),b.push(S.specularColorMapUv),b.push(S.specularIntensityMapUv),b.push(S.transmissionMapUv),b.push(S.thicknessMapUv),b.push(S.combine),b.push(S.fogExp2),b.push(S.sizeAttenuation),b.push(S.morphTargetsCount),b.push(S.morphAttributeCount),b.push(S.numDirLights),b.push(S.numPointLights),b.push(S.numSpotLights),b.push(S.numSpotLightMaps),b.push(S.numHemiLights),b.push(S.numRectAreaLights),b.push(S.numDirLightShadows),b.push(S.numPointLightShadows),b.push(S.numSpotLightShadows),b.push(S.numSpotLightShadowsWithMaps),b.push(S.numLightProbes),b.push(S.shadowMapType),b.push(S.toneMapping),b.push(S.numClippingPlanes),b.push(S.numClipIntersection),b.push(S.depthPacking)}function v(b,S){o.disableAll(),S.supportsVertexTextures&&o.enable(0),S.instancing&&o.enable(1),S.instancingColor&&o.enable(2),S.instancingMorph&&o.enable(3),S.matcap&&o.enable(4),S.envMap&&o.enable(5),S.normalMapObjectSpace&&o.enable(6),S.normalMapTangentSpace&&o.enable(7),S.clearcoat&&o.enable(8),S.iridescence&&o.enable(9),S.alphaTest&&o.enable(10),S.vertexColors&&o.enable(11),S.vertexAlphas&&o.enable(12),S.vertexUv1s&&o.enable(13),S.vertexUv2s&&o.enable(14),S.vertexUv3s&&o.enable(15),S.vertexTangents&&o.enable(16),S.anisotropy&&o.enable(17),S.alphaHash&&o.enable(18),S.batching&&o.enable(19),S.dispersion&&o.enable(20),S.batchingColor&&o.enable(21),S.gradientMap&&o.enable(22),b.push(o.mask),o.disableAll(),S.fog&&o.enable(0),S.useFog&&o.enable(1),S.flatShading&&o.enable(2),S.logarithmicDepthBuffer&&o.enable(3),S.reversedDepthBuffer&&o.enable(4),S.skinning&&o.enable(5),S.morphTargets&&o.enable(6),S.morphNormals&&o.enable(7),S.morphColors&&o.enable(8),S.premultipliedAlpha&&o.enable(9),S.shadowMapEnabled&&o.enable(10),S.doubleSided&&o.enable(11),S.flipSided&&o.enable(12),S.useDepthPacking&&o.enable(13),S.dithering&&o.enable(14),S.transmission&&o.enable(15),S.sheen&&o.enable(16),S.opaque&&o.enable(17),S.pointsUvs&&o.enable(18),S.decodeVideoTexture&&o.enable(19),S.decodeVideoTextureEmissive&&o.enable(20),S.alphaToCoverage&&o.enable(21),b.push(o.mask)}function T(b){const S=g[b.type];let I;if(S){const D=Tr[S];I=zL.clone(D.uniforms)}else I=b.uniforms;return I}function R(b,S){let I;for(let D=0,P=u.length;D<P;D++){const $=u[D];if($.cacheKey===S){I=$,++I.usedTimes;break}}return I===void 0&&(I=new TK(n,S,b,s),u.push(I)),I}function C(b){if(--b.usedTimes===0){const S=u.indexOf(b);u[S]=u[u.length-1],u.pop(),b.destroy()}}function A(b){l.remove(b)}function E(){l.dispose()}return{getParameters:y,getProgramCacheKey:m,getUniforms:T,acquireProgram:R,releaseProgram:C,releaseShaderCache:A,programs:u,dispose:E}}function IK(){let n=new WeakMap;function e(a){return n.has(a)}function t(a){let o=n.get(a);return o===void 0&&(o={},n.set(a,o)),o}function i(a){n.delete(a)}function r(a,o,l){n.get(a)[o]=l}function s(){n=new WeakMap}return{has:e,get:t,remove:i,update:r,dispose:s}}function RK(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function ZM(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function QM(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function a(h,d,p,g,_,y){let m=n[e];return m===void 0?(m={id:h.id,object:h,geometry:d,material:p,groupOrder:g,renderOrder:h.renderOrder,z:_,group:y},n[e]=m):(m.id=h.id,m.object=h,m.geometry=d,m.material=p,m.groupOrder=g,m.renderOrder=h.renderOrder,m.z=_,m.group=y),e++,m}function o(h,d,p,g,_,y){const m=a(h,d,p,g,_,y);p.transmission>0?i.push(m):p.transparent===!0?r.push(m):t.push(m)}function l(h,d,p,g,_,y){const m=a(h,d,p,g,_,y);p.transmission>0?i.unshift(m):p.transparent===!0?r.unshift(m):t.unshift(m)}function c(h,d){t.length>1&&t.sort(h||RK),i.length>1&&i.sort(d||ZM),r.length>1&&r.sort(d||ZM)}function u(){for(let h=e,d=n.length;h<d;h++){const p=n[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:o,unshift:l,finish:u,sort:c}}function PK(){let n=new WeakMap;function e(i,r){const s=n.get(i);let a;return s===void 0?(a=new QM,n.set(i,[a])):r>=s.length?(a=new QM,s.push(a)):a=s[r],a}function t(){n=new WeakMap}return{get:e,dispose:t}}function LK(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new F,color:new De};break;case"SpotLight":t={position:new F,direction:new F,color:new De,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new F,color:new De,distance:0,decay:0};break;case"HemisphereLight":t={direction:new F,skyColor:new De,groundColor:new De};break;case"RectAreaLight":t={color:new De,position:new F,halfWidth:new F,halfHeight:new F};break}return n[e.id]=t,t}}}function DK(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let NK=0;function OK(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function kK(n){const e=new LK,t=DK(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new F);const r=new F,s=new ot,a=new ot;function o(c){let u=0,h=0,d=0;for(let b=0;b<9;b++)i.probe[b].set(0,0,0);let p=0,g=0,_=0,y=0,m=0,x=0,v=0,T=0,R=0,C=0,A=0;c.sort(OK);for(let b=0,S=c.length;b<S;b++){const I=c[b],D=I.color,P=I.intensity,$=I.distance,Y=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)u+=D.r*P,h+=D.g*P,d+=D.b*P;else if(I.isLightProbe){for(let Z=0;Z<9;Z++)i.probe[Z].addScaledVector(I.sh.coefficients[Z],P);A++}else if(I.isDirectionalLight){const Z=e.get(I);if(Z.color.copy(I.color).multiplyScalar(I.intensity),I.castShadow){const fe=I.shadow,B=t.get(I);B.shadowIntensity=fe.intensity,B.shadowBias=fe.bias,B.shadowNormalBias=fe.normalBias,B.shadowRadius=fe.radius,B.shadowMapSize=fe.mapSize,i.directionalShadow[p]=B,i.directionalShadowMap[p]=Y,i.directionalShadowMatrix[p]=I.shadow.matrix,x++}i.directional[p]=Z,p++}else if(I.isSpotLight){const Z=e.get(I);Z.position.setFromMatrixPosition(I.matrixWorld),Z.color.copy(D).multiplyScalar(P),Z.distance=$,Z.coneCos=Math.cos(I.angle),Z.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),Z.decay=I.decay,i.spot[_]=Z;const fe=I.shadow;if(I.map&&(i.spotLightMap[R]=I.map,R++,fe.updateMatrices(I),I.castShadow&&C++),i.spotLightMatrix[_]=fe.matrix,I.castShadow){const B=t.get(I);B.shadowIntensity=fe.intensity,B.shadowBias=fe.bias,B.shadowNormalBias=fe.normalBias,B.shadowRadius=fe.radius,B.shadowMapSize=fe.mapSize,i.spotShadow[_]=B,i.spotShadowMap[_]=Y,T++}_++}else if(I.isRectAreaLight){const Z=e.get(I);Z.color.copy(D).multiplyScalar(P),Z.halfWidth.set(I.width*.5,0,0),Z.halfHeight.set(0,I.height*.5,0),i.rectArea[y]=Z,y++}else if(I.isPointLight){const Z=e.get(I);if(Z.color.copy(I.color).multiplyScalar(I.intensity),Z.distance=I.distance,Z.decay=I.decay,I.castShadow){const fe=I.shadow,B=t.get(I);B.shadowIntensity=fe.intensity,B.shadowBias=fe.bias,B.shadowNormalBias=fe.normalBias,B.shadowRadius=fe.radius,B.shadowMapSize=fe.mapSize,B.shadowCameraNear=fe.camera.near,B.shadowCameraFar=fe.camera.far,i.pointShadow[g]=B,i.pointShadowMap[g]=Y,i.pointShadowMatrix[g]=I.shadow.matrix,v++}i.point[g]=Z,g++}else if(I.isHemisphereLight){const Z=e.get(I);Z.skyColor.copy(I.color).multiplyScalar(P),Z.groundColor.copy(I.groundColor).multiplyScalar(P),i.hemi[m]=Z,m++}}y>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ce.LTC_FLOAT_1,i.rectAreaLTC2=Ce.LTC_FLOAT_2):(i.rectAreaLTC1=Ce.LTC_HALF_1,i.rectAreaLTC2=Ce.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=h,i.ambient[2]=d;const E=i.hash;(E.directionalLength!==p||E.pointLength!==g||E.spotLength!==_||E.rectAreaLength!==y||E.hemiLength!==m||E.numDirectionalShadows!==x||E.numPointShadows!==v||E.numSpotShadows!==T||E.numSpotMaps!==R||E.numLightProbes!==A)&&(i.directional.length=p,i.spot.length=_,i.rectArea.length=y,i.point.length=g,i.hemi.length=m,i.directionalShadow.length=x,i.directionalShadowMap.length=x,i.pointShadow.length=v,i.pointShadowMap.length=v,i.spotShadow.length=T,i.spotShadowMap.length=T,i.directionalShadowMatrix.length=x,i.pointShadowMatrix.length=v,i.spotLightMatrix.length=T+R-C,i.spotLightMap.length=R,i.numSpotLightShadowsWithMaps=C,i.numLightProbes=A,E.directionalLength=p,E.pointLength=g,E.spotLength=_,E.rectAreaLength=y,E.hemiLength=m,E.numDirectionalShadows=x,E.numPointShadows=v,E.numSpotShadows=T,E.numSpotMaps=R,E.numLightProbes=A,i.version=NK++)}function l(c,u){let h=0,d=0,p=0,g=0,_=0;const y=u.matrixWorldInverse;for(let m=0,x=c.length;m<x;m++){const v=c[m];if(v.isDirectionalLight){const T=i.directional[h];T.direction.setFromMatrixPosition(v.matrixWorld),r.setFromMatrixPosition(v.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(y),h++}else if(v.isSpotLight){const T=i.spot[p];T.position.setFromMatrixPosition(v.matrixWorld),T.position.applyMatrix4(y),T.direction.setFromMatrixPosition(v.matrixWorld),r.setFromMatrixPosition(v.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(y),p++}else if(v.isRectAreaLight){const T=i.rectArea[g];T.position.setFromMatrixPosition(v.matrixWorld),T.position.applyMatrix4(y),a.identity(),s.copy(v.matrixWorld),s.premultiply(y),a.extractRotation(s),T.halfWidth.set(v.width*.5,0,0),T.halfHeight.set(0,v.height*.5,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),g++}else if(v.isPointLight){const T=i.point[d];T.position.setFromMatrixPosition(v.matrixWorld),T.position.applyMatrix4(y),d++}else if(v.isHemisphereLight){const T=i.hemi[_];T.direction.setFromMatrixPosition(v.matrixWorld),T.direction.transformDirection(y),_++}}}return{setup:o,setupView:l,state:i}}function eC(n){const e=new kK(n),t=[],i=[];function r(u){c.camera=u,t.length=0,i.length=0}function s(u){t.push(u)}function a(u){i.push(u)}function o(){e.setup(t)}function l(u){e.setupView(t,u)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:c,setupLights:o,setupLightsView:l,pushLight:s,pushShadow:a}}function UK(n){let e=new WeakMap;function t(r,s=0){const a=e.get(r);let o;return a===void 0?(o=new eC(n),e.set(r,[o])):s>=a.length?(o=new eC(n),a.push(o)):o=a[s],o}function i(){e=new WeakMap}return{get:t,dispose:i}}const FK=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,VK=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function BK(n,e,t){let i=new yu;const r=new ce,s=new ce,a=new kt,o=new Cw({depthPacking:ML}),l=new Iw,c={},u=t.maxTextureSize,h={[Gs]:vi,[vi]:Gs,[jr]:jr},d=new Zi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ce},radius:{value:4}},vertexShader:FK,fragmentShader:VK}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const g=new yt;g.setAttribute("position",new $t(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new tn(g,d),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=nw;let m=this.type;this.render=function(C,A,E){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||C.length===0)return;const b=n.getRenderTarget(),S=n.getActiveCubeFace(),I=n.getActiveMipmapLevel(),D=n.state;D.setBlending(os),D.buffers.depth.getReversed()===!0?D.buffers.color.setClear(0,0,0,0):D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);const P=m!==Wr&&this.type===Wr,$=m===Wr&&this.type!==Wr;for(let Y=0,Z=C.length;Y<Z;Y++){const fe=C[Y],B=fe.shadow;if(B===void 0){Ie("WebGLShadowMap:",fe,"has no shadow.");continue}if(B.autoUpdate===!1&&B.needsUpdate===!1)continue;r.copy(B.mapSize);const X=B.getFrameExtents();if(r.multiply(X),s.copy(B.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/X.x),r.x=s.x*X.x,B.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/X.y),r.y=s.y*X.y,B.mapSize.y=s.y)),B.map===null||P===!0||$===!0){const _e=this.type!==Wr?{minFilter:$n,magFilter:$n}:{};B.map!==null&&B.map.dispose(),B.map=new kr(r.x,r.y,_e),B.map.texture.name=fe.name+".shadowMap",B.camera.updateProjectionMatrix()}n.setRenderTarget(B.map),n.clear();const ee=B.getViewportCount();for(let _e=0;_e<ee;_e++){const Ge=B.getViewport(_e);a.set(s.x*Ge.x,s.y*Ge.y,s.x*Ge.z,s.y*Ge.w),D.viewport(a),B.updateMatrices(fe,_e),i=B.getFrustum(),T(A,E,B.camera,fe,this.type)}B.isPointLightShadow!==!0&&this.type===Wr&&x(B,E),B.needsUpdate=!1}m=this.type,y.needsUpdate=!1,n.setRenderTarget(b,S,I)};function x(C,A){const E=e.update(_);d.defines.VSM_SAMPLES!==C.blurSamples&&(d.defines.VSM_SAMPLES=C.blurSamples,p.defines.VSM_SAMPLES=C.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new kr(r.x,r.y)),d.uniforms.shadow_pass.value=C.map.texture,d.uniforms.resolution.value=C.mapSize,d.uniforms.radius.value=C.radius,n.setRenderTarget(C.mapPass),n.clear(),n.renderBufferDirect(A,null,E,d,_,null),p.uniforms.shadow_pass.value=C.mapPass.texture,p.uniforms.resolution.value=C.mapSize,p.uniforms.radius.value=C.radius,n.setRenderTarget(C.map),n.clear(),n.renderBufferDirect(A,null,E,p,_,null)}function v(C,A,E,b){let S=null;const I=E.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(I!==void 0)S=I;else if(S=E.isPointLight===!0?l:o,n.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0||A.map&&A.alphaTest>0||A.alphaToCoverage===!0){const D=S.uuid,P=A.uuid;let $=c[D];$===void 0&&($={},c[D]=$);let Y=$[P];Y===void 0&&(Y=S.clone(),$[P]=Y,A.addEventListener("dispose",R)),S=Y}if(S.visible=A.visible,S.wireframe=A.wireframe,b===Wr?S.side=A.shadowSide!==null?A.shadowSide:A.side:S.side=A.shadowSide!==null?A.shadowSide:h[A.side],S.alphaMap=A.alphaMap,S.alphaTest=A.alphaToCoverage===!0?.5:A.alphaTest,S.map=A.map,S.clipShadows=A.clipShadows,S.clippingPlanes=A.clippingPlanes,S.clipIntersection=A.clipIntersection,S.displacementMap=A.displacementMap,S.displacementScale=A.displacementScale,S.displacementBias=A.displacementBias,S.wireframeLinewidth=A.wireframeLinewidth,S.linewidth=A.linewidth,E.isPointLight===!0&&S.isMeshDistanceMaterial===!0){const D=n.properties.get(S);D.light=E}return S}function T(C,A,E,b,S){if(C.visible===!1)return;if(C.layers.test(A.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&S===Wr)&&(!C.frustumCulled||i.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,C.matrixWorld);const P=e.update(C),$=C.material;if(Array.isArray($)){const Y=P.groups;for(let Z=0,fe=Y.length;Z<fe;Z++){const B=Y[Z],X=$[B.materialIndex];if(X&&X.visible){const ee=v(C,X,b,S);C.onBeforeShadow(n,C,A,E,P,ee,B),n.renderBufferDirect(E,null,P,ee,C,B),C.onAfterShadow(n,C,A,E,P,ee,B)}}}else if($.visible){const Y=v(C,$,b,S);C.onBeforeShadow(n,C,A,E,P,Y,null),n.renderBufferDirect(E,null,P,Y,C,null),C.onAfterShadow(n,C,A,E,P,Y,null)}}const D=C.children;for(let P=0,$=D.length;P<$;P++)T(D[P],A,E,b,S)}function R(C){C.target.removeEventListener("dispose",R);for(const E in c){const b=c[E],S=C.target.uuid;S in b&&(b[S].dispose(),delete b[S])}}}const zK={[ig]:rg,[sg]:lg,[ag]:cg,[ll]:og,[rg]:ig,[lg]:sg,[cg]:ag,[og]:ll};function HK(n,e){function t(){let V=!1;const Ee=new kt;let we=null;const pe=new kt(0,0,0,0);return{setMask:function(ge){we!==ge&&!V&&(n.colorMask(ge,ge,ge,ge),we=ge)},setLocked:function(ge){V=ge},setClear:function(ge,re,Fe,ut,qt){qt===!0&&(ge*=ut,re*=ut,Fe*=ut),Ee.set(ge,re,Fe,ut),pe.equals(Ee)===!1&&(n.clearColor(ge,re,Fe,ut),pe.copy(Ee))},reset:function(){V=!1,we=null,pe.set(-1,0,0,0)}}}function i(){let V=!1,Ee=!1,we=null,pe=null,ge=null;return{setReversed:function(re){if(Ee!==re){const Fe=e.get("EXT_clip_control");re?Fe.clipControlEXT(Fe.LOWER_LEFT_EXT,Fe.ZERO_TO_ONE_EXT):Fe.clipControlEXT(Fe.LOWER_LEFT_EXT,Fe.NEGATIVE_ONE_TO_ONE_EXT),Ee=re;const ut=ge;ge=null,this.setClear(ut)}},getReversed:function(){return Ee},setTest:function(re){re?se(n.DEPTH_TEST):Ne(n.DEPTH_TEST)},setMask:function(re){we!==re&&!V&&(n.depthMask(re),we=re)},setFunc:function(re){if(Ee&&(re=zK[re]),pe!==re){switch(re){case ig:n.depthFunc(n.NEVER);break;case rg:n.depthFunc(n.ALWAYS);break;case sg:n.depthFunc(n.LESS);break;case ll:n.depthFunc(n.LEQUAL);break;case ag:n.depthFunc(n.EQUAL);break;case og:n.depthFunc(n.GEQUAL);break;case lg:n.depthFunc(n.GREATER);break;case cg:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}pe=re}},setLocked:function(re){V=re},setClear:function(re){ge!==re&&(Ee&&(re=1-re),n.clearDepth(re),ge=re)},reset:function(){V=!1,we=null,pe=null,ge=null,Ee=!1}}}function r(){let V=!1,Ee=null,we=null,pe=null,ge=null,re=null,Fe=null,ut=null,qt=null;return{setTest:function(Rt){V||(Rt?se(n.STENCIL_TEST):Ne(n.STENCIL_TEST))},setMask:function(Rt){Ee!==Rt&&!V&&(n.stencilMask(Rt),Ee=Rt)},setFunc:function(Rt,tr,Fi){(we!==Rt||pe!==tr||ge!==Fi)&&(n.stencilFunc(Rt,tr,Fi),we=Rt,pe=tr,ge=Fi)},setOp:function(Rt,tr,Fi){(re!==Rt||Fe!==tr||ut!==Fi)&&(n.stencilOp(Rt,tr,Fi),re=Rt,Fe=tr,ut=Fi)},setLocked:function(Rt){V=Rt},setClear:function(Rt){qt!==Rt&&(n.clearStencil(Rt),qt=Rt)},reset:function(){V=!1,Ee=null,we=null,pe=null,ge=null,re=null,Fe=null,ut=null,qt=null}}}const s=new t,a=new i,o=new r,l=new WeakMap,c=new WeakMap;let u={},h={},d=new WeakMap,p=[],g=null,_=!1,y=null,m=null,x=null,v=null,T=null,R=null,C=null,A=new De(0,0,0),E=0,b=!1,S=null,I=null,D=null,P=null,$=null;const Y=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Z=!1,fe=0;const B=n.getParameter(n.VERSION);B.indexOf("WebGL")!==-1?(fe=parseFloat(/^WebGL (\d)/.exec(B)[1]),Z=fe>=1):B.indexOf("OpenGL ES")!==-1&&(fe=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),Z=fe>=2);let X=null,ee={};const _e=n.getParameter(n.SCISSOR_BOX),Ge=n.getParameter(n.VIEWPORT),ft=new kt().fromArray(_e),pt=new kt().fromArray(Ge);function wt(V,Ee,we,pe){const ge=new Uint8Array(4),re=n.createTexture();n.bindTexture(V,re),n.texParameteri(V,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(V,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Fe=0;Fe<we;Fe++)V===n.TEXTURE_3D||V===n.TEXTURE_2D_ARRAY?n.texImage3D(Ee,0,n.RGBA,1,1,pe,0,n.RGBA,n.UNSIGNED_BYTE,ge):n.texImage2D(Ee+Fe,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ge);return re}const ne={};ne[n.TEXTURE_2D]=wt(n.TEXTURE_2D,n.TEXTURE_2D,1),ne[n.TEXTURE_CUBE_MAP]=wt(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),ne[n.TEXTURE_2D_ARRAY]=wt(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),ne[n.TEXTURE_3D]=wt(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),se(n.DEPTH_TEST),a.setFunc(ll),he(!1),me(Wv),se(n.CULL_FACE),de(os);function se(V){u[V]!==!0&&(n.enable(V),u[V]=!0)}function Ne(V){u[V]!==!1&&(n.disable(V),u[V]=!1)}function Ye(V,Ee){return h[V]!==Ee?(n.bindFramebuffer(V,Ee),h[V]=Ee,V===n.DRAW_FRAMEBUFFER&&(h[n.FRAMEBUFFER]=Ee),V===n.FRAMEBUFFER&&(h[n.DRAW_FRAMEBUFFER]=Ee),!0):!1}function We(V,Ee){let we=p,pe=!1;if(V){we=d.get(Ee),we===void 0&&(we=[],d.set(Ee,we));const ge=V.textures;if(we.length!==ge.length||we[0]!==n.COLOR_ATTACHMENT0){for(let re=0,Fe=ge.length;re<Fe;re++)we[re]=n.COLOR_ATTACHMENT0+re;we.length=ge.length,pe=!0}}else we[0]!==n.BACK&&(we[0]=n.BACK,pe=!0);pe&&n.drawBuffers(we)}function vt(V){return g!==V?(n.useProgram(V),g=V,!0):!1}const Bt={[ba]:n.FUNC_ADD,[Y3]:n.FUNC_SUBTRACT,[J3]:n.FUNC_REVERSE_SUBTRACT};Bt[Z3]=n.MIN,Bt[Q3]=n.MAX;const tt={[eL]:n.ZERO,[tL]:n.ONE,[nL]:n.SRC_COLOR,[tg]:n.SRC_ALPHA,[lL]:n.SRC_ALPHA_SATURATE,[aL]:n.DST_COLOR,[rL]:n.DST_ALPHA,[iL]:n.ONE_MINUS_SRC_COLOR,[ng]:n.ONE_MINUS_SRC_ALPHA,[oL]:n.ONE_MINUS_DST_COLOR,[sL]:n.ONE_MINUS_DST_ALPHA,[cL]:n.CONSTANT_COLOR,[uL]:n.ONE_MINUS_CONSTANT_COLOR,[hL]:n.CONSTANT_ALPHA,[dL]:n.ONE_MINUS_CONSTANT_ALPHA};function de(V,Ee,we,pe,ge,re,Fe,ut,qt,Rt){if(V===os){_===!0&&(Ne(n.BLEND),_=!1);return}if(_===!1&&(se(n.BLEND),_=!0),V!==K3){if(V!==y||Rt!==b){if((m!==ba||T!==ba)&&(n.blendEquation(n.FUNC_ADD),m=ba,T=ba),Rt)switch(V){case Xo:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case $v:n.blendFunc(n.ONE,n.ONE);break;case qv:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case jv:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:lt("WebGLState: Invalid blending: ",V);break}else switch(V){case Xo:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case $v:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case qv:lt("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case jv:lt("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:lt("WebGLState: Invalid blending: ",V);break}x=null,v=null,R=null,C=null,A.set(0,0,0),E=0,y=V,b=Rt}return}ge=ge||Ee,re=re||we,Fe=Fe||pe,(Ee!==m||ge!==T)&&(n.blendEquationSeparate(Bt[Ee],Bt[ge]),m=Ee,T=ge),(we!==x||pe!==v||re!==R||Fe!==C)&&(n.blendFuncSeparate(tt[we],tt[pe],tt[re],tt[Fe]),x=we,v=pe,R=re,C=Fe),(ut.equals(A)===!1||qt!==E)&&(n.blendColor(ut.r,ut.g,ut.b,qt),A.copy(ut),E=qt),y=V,b=!1}function U(V,Ee){V.side===jr?Ne(n.CULL_FACE):se(n.CULL_FACE);let we=V.side===vi;Ee&&(we=!we),he(we),V.blending===Xo&&V.transparent===!1?de(os):de(V.blending,V.blendEquation,V.blendSrc,V.blendDst,V.blendEquationAlpha,V.blendSrcAlpha,V.blendDstAlpha,V.blendColor,V.blendAlpha,V.premultipliedAlpha),a.setFunc(V.depthFunc),a.setTest(V.depthTest),a.setMask(V.depthWrite),s.setMask(V.colorWrite);const pe=V.stencilWrite;o.setTest(pe),pe&&(o.setMask(V.stencilWriteMask),o.setFunc(V.stencilFunc,V.stencilRef,V.stencilFuncMask),o.setOp(V.stencilFail,V.stencilZFail,V.stencilZPass)),oe(V.polygonOffset,V.polygonOffsetFactor,V.polygonOffsetUnits),V.alphaToCoverage===!0?se(n.SAMPLE_ALPHA_TO_COVERAGE):Ne(n.SAMPLE_ALPHA_TO_COVERAGE)}function he(V){S!==V&&(V?n.frontFace(n.CW):n.frontFace(n.CCW),S=V)}function me(V){V!==q3?(se(n.CULL_FACE),V!==I&&(V===Wv?n.cullFace(n.BACK):V===j3?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Ne(n.CULL_FACE),I=V}function ve(V){V!==D&&(Z&&n.lineWidth(V),D=V)}function oe(V,Ee,we){V?(se(n.POLYGON_OFFSET_FILL),(P!==Ee||$!==we)&&(n.polygonOffset(Ee,we),P=Ee,$=we)):Ne(n.POLYGON_OFFSET_FILL)}function Ae(V){V?se(n.SCISSOR_TEST):Ne(n.SCISSOR_TEST)}function be(V){V===void 0&&(V=n.TEXTURE0+Y-1),X!==V&&(n.activeTexture(V),X=V)}function Oe(V,Ee,we){we===void 0&&(X===null?we=n.TEXTURE0+Y-1:we=X);let pe=ee[we];pe===void 0&&(pe={type:void 0,texture:void 0},ee[we]=pe),(pe.type!==V||pe.texture!==Ee)&&(X!==we&&(n.activeTexture(we),X=we),n.bindTexture(V,Ee||ne[V]),pe.type=V,pe.texture=Ee)}function k(){const V=ee[X];V!==void 0&&V.type!==void 0&&(n.bindTexture(V.type,null),V.type=void 0,V.texture=void 0)}function L(){try{n.compressedTexImage2D(...arguments)}catch(V){V("WebGLState:",V)}}function G(){try{n.compressedTexImage3D(...arguments)}catch(V){V("WebGLState:",V)}}function Q(){try{n.texSubImage2D(...arguments)}catch(V){V("WebGLState:",V)}}function le(){try{n.texSubImage3D(...arguments)}catch(V){V("WebGLState:",V)}}function J(){try{n.compressedTexSubImage2D(...arguments)}catch(V){V("WebGLState:",V)}}function $e(){try{n.compressedTexSubImage3D(...arguments)}catch(V){V("WebGLState:",V)}}function Me(){try{n.texStorage2D(...arguments)}catch(V){V("WebGLState:",V)}}function Xe(){try{n.texStorage3D(...arguments)}catch(V){V("WebGLState:",V)}}function He(){try{n.texImage2D(...arguments)}catch(V){V("WebGLState:",V)}}function ue(){try{n.texImage3D(...arguments)}catch(V){V("WebGLState:",V)}}function Se(V){ft.equals(V)===!1&&(n.scissor(V.x,V.y,V.z,V.w),ft.copy(V))}function Qe(V){pt.equals(V)===!1&&(n.viewport(V.x,V.y,V.z,V.w),pt.copy(V))}function qe(V,Ee){let we=c.get(Ee);we===void 0&&(we=new WeakMap,c.set(Ee,we));let pe=we.get(V);pe===void 0&&(pe=n.getUniformBlockIndex(Ee,V.name),we.set(V,pe))}function Le(V,Ee){const pe=c.get(Ee).get(V);l.get(Ee)!==pe&&(n.uniformBlockBinding(Ee,pe,V.__bindingPointIndex),l.set(Ee,pe))}function nt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),a.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},X=null,ee={},h={},d=new WeakMap,p=[],g=null,_=!1,y=null,m=null,x=null,v=null,T=null,R=null,C=null,A=new De(0,0,0),E=0,b=!1,S=null,I=null,D=null,P=null,$=null,ft.set(0,0,n.canvas.width,n.canvas.height),pt.set(0,0,n.canvas.width,n.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:se,disable:Ne,bindFramebuffer:Ye,drawBuffers:We,useProgram:vt,setBlending:de,setMaterial:U,setFlipSided:he,setCullFace:me,setLineWidth:ve,setPolygonOffset:oe,setScissorTest:Ae,activeTexture:be,bindTexture:Oe,unbindTexture:k,compressedTexImage2D:L,compressedTexImage3D:G,texImage2D:He,texImage3D:ue,updateUBOMapping:qe,uniformBlockBinding:Le,texStorage2D:Me,texStorage3D:Xe,texSubImage2D:Q,texSubImage3D:le,compressedTexSubImage2D:J,compressedTexSubImage3D:$e,scissor:Se,viewport:Qe,reset:nt}}function GK(n,e,t,i,r,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new ce,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function g(k,L){return p?new OffscreenCanvas(k,L):xd("canvas")}function _(k,L,G){let Q=1;const le=Oe(k);if((le.width>G||le.height>G)&&(Q=G/Math.max(le.width,le.height)),Q<1)if(typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&k instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&k instanceof ImageBitmap||typeof VideoFrame<"u"&&k instanceof VideoFrame){const J=Math.floor(Q*le.width),$e=Math.floor(Q*le.height);h===void 0&&(h=g(J,$e));const Me=L?g(J,$e):h;return Me.width=J,Me.height=$e,Me.getContext("2d").drawImage(k,0,0,J,$e),Ie("WebGLRenderer: Texture has been resized from ("+le.width+"x"+le.height+") to ("+J+"x"+$e+")."),Me}else return"data"in k&&Ie("WebGLRenderer: Image in DataTexture is too big ("+le.width+"x"+le.height+")."),k;return k}function y(k){return k.generateMipmaps}function m(k){n.generateMipmap(k)}function x(k){return k.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:k.isWebGL3DRenderTarget?n.TEXTURE_3D:k.isWebGLArrayRenderTarget||k.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function v(k,L,G,Q,le=!1){if(k!==null){if(n[k]!==void 0)return n[k];Ie("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+k+"'")}let J=L;if(L===n.RED&&(G===n.FLOAT&&(J=n.R32F),G===n.HALF_FLOAT&&(J=n.R16F),G===n.UNSIGNED_BYTE&&(J=n.R8)),L===n.RED_INTEGER&&(G===n.UNSIGNED_BYTE&&(J=n.R8UI),G===n.UNSIGNED_SHORT&&(J=n.R16UI),G===n.UNSIGNED_INT&&(J=n.R32UI),G===n.BYTE&&(J=n.R8I),G===n.SHORT&&(J=n.R16I),G===n.INT&&(J=n.R32I)),L===n.RG&&(G===n.FLOAT&&(J=n.RG32F),G===n.HALF_FLOAT&&(J=n.RG16F),G===n.UNSIGNED_BYTE&&(J=n.RG8)),L===n.RG_INTEGER&&(G===n.UNSIGNED_BYTE&&(J=n.RG8UI),G===n.UNSIGNED_SHORT&&(J=n.RG16UI),G===n.UNSIGNED_INT&&(J=n.RG32UI),G===n.BYTE&&(J=n.RG8I),G===n.SHORT&&(J=n.RG16I),G===n.INT&&(J=n.RG32I)),L===n.RGB_INTEGER&&(G===n.UNSIGNED_BYTE&&(J=n.RGB8UI),G===n.UNSIGNED_SHORT&&(J=n.RGB16UI),G===n.UNSIGNED_INT&&(J=n.RGB32UI),G===n.BYTE&&(J=n.RGB8I),G===n.SHORT&&(J=n.RGB16I),G===n.INT&&(J=n.RGB32I)),L===n.RGBA_INTEGER&&(G===n.UNSIGNED_BYTE&&(J=n.RGBA8UI),G===n.UNSIGNED_SHORT&&(J=n.RGBA16UI),G===n.UNSIGNED_INT&&(J=n.RGBA32UI),G===n.BYTE&&(J=n.RGBA8I),G===n.SHORT&&(J=n.RGBA16I),G===n.INT&&(J=n.RGBA32I)),L===n.RGB&&(G===n.UNSIGNED_INT_5_9_9_9_REV&&(J=n.RGB9_E5),G===n.UNSIGNED_INT_10F_11F_11F_REV&&(J=n.R11F_G11F_B10F)),L===n.RGBA){const $e=le?yd:Lt.getTransfer(Q);G===n.FLOAT&&(J=n.RGBA32F),G===n.HALF_FLOAT&&(J=n.RGBA16F),G===n.UNSIGNED_BYTE&&(J=$e===Ht?n.SRGB8_ALPHA8:n.RGBA8),G===n.UNSIGNED_SHORT_4_4_4_4&&(J=n.RGBA4),G===n.UNSIGNED_SHORT_5_5_5_1&&(J=n.RGB5_A1)}return(J===n.R16F||J===n.R32F||J===n.RG16F||J===n.RG32F||J===n.RGBA16F||J===n.RGBA32F)&&e.get("EXT_color_buffer_float"),J}function T(k,L){let G;return k?L===null||L===$s||L===Yc?G=n.DEPTH24_STENCIL8:L===Li?G=n.DEPTH32F_STENCIL8:L===Kc&&(G=n.DEPTH24_STENCIL8,Ie("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):L===null||L===$s||L===Yc?G=n.DEPTH_COMPONENT24:L===Li?G=n.DEPTH_COMPONENT32F:L===Kc&&(G=n.DEPTH_COMPONENT16),G}function R(k,L){return y(k)===!0||k.isFramebufferTexture&&k.minFilter!==$n&&k.minFilter!==sn?Math.log2(Math.max(L.width,L.height))+1:k.mipmaps!==void 0&&k.mipmaps.length>0?k.mipmaps.length:k.isCompressedTexture&&Array.isArray(k.image)?L.mipmaps.length:1}function C(k){const L=k.target;L.removeEventListener("dispose",C),E(L),L.isVideoTexture&&u.delete(L)}function A(k){const L=k.target;L.removeEventListener("dispose",A),S(L)}function E(k){const L=i.get(k);if(L.__webglInit===void 0)return;const G=k.source,Q=d.get(G);if(Q){const le=Q[L.__cacheKey];le.usedTimes--,le.usedTimes===0&&b(k),Object.keys(Q).length===0&&d.delete(G)}i.remove(k)}function b(k){const L=i.get(k);n.deleteTexture(L.__webglTexture);const G=k.source,Q=d.get(G);delete Q[L.__cacheKey],a.memory.textures--}function S(k){const L=i.get(k);if(k.depthTexture&&(k.depthTexture.dispose(),i.remove(k.depthTexture)),k.isWebGLCubeRenderTarget)for(let Q=0;Q<6;Q++){if(Array.isArray(L.__webglFramebuffer[Q]))for(let le=0;le<L.__webglFramebuffer[Q].length;le++)n.deleteFramebuffer(L.__webglFramebuffer[Q][le]);else n.deleteFramebuffer(L.__webglFramebuffer[Q]);L.__webglDepthbuffer&&n.deleteRenderbuffer(L.__webglDepthbuffer[Q])}else{if(Array.isArray(L.__webglFramebuffer))for(let Q=0;Q<L.__webglFramebuffer.length;Q++)n.deleteFramebuffer(L.__webglFramebuffer[Q]);else n.deleteFramebuffer(L.__webglFramebuffer);if(L.__webglDepthbuffer&&n.deleteRenderbuffer(L.__webglDepthbuffer),L.__webglMultisampledFramebuffer&&n.deleteFramebuffer(L.__webglMultisampledFramebuffer),L.__webglColorRenderbuffer)for(let Q=0;Q<L.__webglColorRenderbuffer.length;Q++)L.__webglColorRenderbuffer[Q]&&n.deleteRenderbuffer(L.__webglColorRenderbuffer[Q]);L.__webglDepthRenderbuffer&&n.deleteRenderbuffer(L.__webglDepthRenderbuffer)}const G=k.textures;for(let Q=0,le=G.length;Q<le;Q++){const J=i.get(G[Q]);J.__webglTexture&&(n.deleteTexture(J.__webglTexture),a.memory.textures--),i.remove(G[Q])}i.remove(k)}let I=0;function D(){I=0}function P(){const k=I;return k>=r.maxTextures&&Ie("WebGLTextures: Trying to use "+k+" texture units while this GPU supports only "+r.maxTextures),I+=1,k}function $(k){const L=[];return L.push(k.wrapS),L.push(k.wrapT),L.push(k.wrapR||0),L.push(k.magFilter),L.push(k.minFilter),L.push(k.anisotropy),L.push(k.internalFormat),L.push(k.format),L.push(k.type),L.push(k.generateMipmaps),L.push(k.premultiplyAlpha),L.push(k.flipY),L.push(k.unpackAlignment),L.push(k.colorSpace),L.join()}function Y(k,L){const G=i.get(k);if(k.isVideoTexture&&Ae(k),k.isRenderTargetTexture===!1&&k.isExternalTexture!==!0&&k.version>0&&G.__version!==k.version){const Q=k.image;if(Q===null)Ie("WebGLRenderer: Texture marked for update but no image data found.");else if(Q.complete===!1)Ie("WebGLRenderer: Texture marked for update but image is incomplete");else{ne(G,k,L);return}}else k.isExternalTexture&&(G.__webglTexture=k.sourceTexture?k.sourceTexture:null);t.bindTexture(n.TEXTURE_2D,G.__webglTexture,n.TEXTURE0+L)}function Z(k,L){const G=i.get(k);if(k.isRenderTargetTexture===!1&&k.version>0&&G.__version!==k.version){ne(G,k,L);return}else k.isExternalTexture&&(G.__webglTexture=k.sourceTexture?k.sourceTexture:null);t.bindTexture(n.TEXTURE_2D_ARRAY,G.__webglTexture,n.TEXTURE0+L)}function fe(k,L){const G=i.get(k);if(k.isRenderTargetTexture===!1&&k.version>0&&G.__version!==k.version){ne(G,k,L);return}t.bindTexture(n.TEXTURE_3D,G.__webglTexture,n.TEXTURE0+L)}function B(k,L){const G=i.get(k);if(k.version>0&&G.__version!==k.version){se(G,k,L);return}t.bindTexture(n.TEXTURE_CUBE_MAP,G.__webglTexture,n.TEXTURE0+L)}const X={[fd]:n.REPEAT,[Pi]:n.CLAMP_TO_EDGE,[pd]:n.MIRRORED_REPEAT},ee={[$n]:n.NEAREST,[iw]:n.NEAREST_MIPMAP_NEAREST,[xc]:n.NEAREST_MIPMAP_LINEAR,[sn]:n.LINEAR,[Mh]:n.LINEAR_MIPMAP_NEAREST,[Yr]:n.LINEAR_MIPMAP_LINEAR},_e={[IL]:n.NEVER,[OL]:n.ALWAYS,[RL]:n.LESS,[hw]:n.LEQUAL,[PL]:n.EQUAL,[NL]:n.GEQUAL,[LL]:n.GREATER,[DL]:n.NOTEQUAL};function Ge(k,L){if(L.type===Li&&e.has("OES_texture_float_linear")===!1&&(L.magFilter===sn||L.magFilter===Mh||L.magFilter===xc||L.magFilter===Yr||L.minFilter===sn||L.minFilter===Mh||L.minFilter===xc||L.minFilter===Yr)&&Ie("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(k,n.TEXTURE_WRAP_S,X[L.wrapS]),n.texParameteri(k,n.TEXTURE_WRAP_T,X[L.wrapT]),(k===n.TEXTURE_3D||k===n.TEXTURE_2D_ARRAY)&&n.texParameteri(k,n.TEXTURE_WRAP_R,X[L.wrapR]),n.texParameteri(k,n.TEXTURE_MAG_FILTER,ee[L.magFilter]),n.texParameteri(k,n.TEXTURE_MIN_FILTER,ee[L.minFilter]),L.compareFunction&&(n.texParameteri(k,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(k,n.TEXTURE_COMPARE_FUNC,_e[L.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(L.magFilter===$n||L.minFilter!==xc&&L.minFilter!==Yr||L.type===Li&&e.has("OES_texture_float_linear")===!1)return;if(L.anisotropy>1||i.get(L).__currentAnisotropy){const G=e.get("EXT_texture_filter_anisotropic");n.texParameterf(k,G.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L.anisotropy,r.getMaxAnisotropy())),i.get(L).__currentAnisotropy=L.anisotropy}}}function ft(k,L){let G=!1;k.__webglInit===void 0&&(k.__webglInit=!0,L.addEventListener("dispose",C));const Q=L.source;let le=d.get(Q);le===void 0&&(le={},d.set(Q,le));const J=$(L);if(J!==k.__cacheKey){le[J]===void 0&&(le[J]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,G=!0),le[J].usedTimes++;const $e=le[k.__cacheKey];$e!==void 0&&(le[k.__cacheKey].usedTimes--,$e.usedTimes===0&&b(L)),k.__cacheKey=J,k.__webglTexture=le[J].texture}return G}function pt(k,L,G){return Math.floor(Math.floor(k/G)/L)}function wt(k,L,G,Q){const J=k.updateRanges;if(J.length===0)t.texSubImage2D(n.TEXTURE_2D,0,0,0,L.width,L.height,G,Q,L.data);else{J.sort((ue,Se)=>ue.start-Se.start);let $e=0;for(let ue=1;ue<J.length;ue++){const Se=J[$e],Qe=J[ue],qe=Se.start+Se.count,Le=pt(Qe.start,L.width,4),nt=pt(Se.start,L.width,4);Qe.start<=qe+1&&Le===nt&&pt(Qe.start+Qe.count-1,L.width,4)===Le?Se.count=Math.max(Se.count,Qe.start+Qe.count-Se.start):(++$e,J[$e]=Qe)}J.length=$e+1;const Me=n.getParameter(n.UNPACK_ROW_LENGTH),Xe=n.getParameter(n.UNPACK_SKIP_PIXELS),He=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,L.width);for(let ue=0,Se=J.length;ue<Se;ue++){const Qe=J[ue],qe=Math.floor(Qe.start/4),Le=Math.ceil(Qe.count/4),nt=qe%L.width,V=Math.floor(qe/L.width),Ee=Le,we=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,nt),n.pixelStorei(n.UNPACK_SKIP_ROWS,V),t.texSubImage2D(n.TEXTURE_2D,0,nt,V,Ee,we,G,Q,L.data)}k.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,Me),n.pixelStorei(n.UNPACK_SKIP_PIXELS,Xe),n.pixelStorei(n.UNPACK_SKIP_ROWS,He)}}function ne(k,L,G){let Q=n.TEXTURE_2D;(L.isDataArrayTexture||L.isCompressedArrayTexture)&&(Q=n.TEXTURE_2D_ARRAY),L.isData3DTexture&&(Q=n.TEXTURE_3D);const le=ft(k,L),J=L.source;t.bindTexture(Q,k.__webglTexture,n.TEXTURE0+G);const $e=i.get(J);if(J.version!==$e.__version||le===!0){t.activeTexture(n.TEXTURE0+G);const Me=Lt.getPrimaries(Lt.workingColorSpace),Xe=L.colorSpace===Ts?null:Lt.getPrimaries(L.colorSpace),He=L.colorSpace===Ts||Me===Xe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,L.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,L.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,He);let ue=_(L.image,!1,r.maxTextureSize);ue=be(L,ue);const Se=s.convert(L.format,L.colorSpace),Qe=s.convert(L.type);let qe=v(L.internalFormat,Se,Qe,L.colorSpace,L.isVideoTexture);Ge(Q,L);let Le;const nt=L.mipmaps,V=L.isVideoTexture!==!0,Ee=$e.__version===void 0||le===!0,we=J.dataReady,pe=R(L,ue);if(L.isDepthTexture)qe=T(L.format===Zc,L.type),Ee&&(V?t.texStorage2D(n.TEXTURE_2D,1,qe,ue.width,ue.height):t.texImage2D(n.TEXTURE_2D,0,qe,ue.width,ue.height,0,Se,Qe,null));else if(L.isDataTexture)if(nt.length>0){V&&Ee&&t.texStorage2D(n.TEXTURE_2D,pe,qe,nt[0].width,nt[0].height);for(let ge=0,re=nt.length;ge<re;ge++)Le=nt[ge],V?we&&t.texSubImage2D(n.TEXTURE_2D,ge,0,0,Le.width,Le.height,Se,Qe,Le.data):t.texImage2D(n.TEXTURE_2D,ge,qe,Le.width,Le.height,0,Se,Qe,Le.data);L.generateMipmaps=!1}else V?(Ee&&t.texStorage2D(n.TEXTURE_2D,pe,qe,ue.width,ue.height),we&&wt(L,ue,Se,Qe)):t.texImage2D(n.TEXTURE_2D,0,qe,ue.width,ue.height,0,Se,Qe,ue.data);else if(L.isCompressedTexture)if(L.isCompressedArrayTexture){V&&Ee&&t.texStorage3D(n.TEXTURE_2D_ARRAY,pe,qe,nt[0].width,nt[0].height,ue.depth);for(let ge=0,re=nt.length;ge<re;ge++)if(Le=nt[ge],L.format!==li)if(Se!==null)if(V){if(we)if(L.layerUpdates.size>0){const Fe=iS(Le.width,Le.height,L.format,L.type);for(const ut of L.layerUpdates){const qt=Le.data.subarray(ut*Fe/Le.data.BYTES_PER_ELEMENT,(ut+1)*Fe/Le.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ge,0,0,ut,Le.width,Le.height,1,Se,qt)}L.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ge,0,0,0,Le.width,Le.height,ue.depth,Se,Le.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,ge,qe,Le.width,Le.height,ue.depth,0,Le.data,0,0);else Ie("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else V?we&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,ge,0,0,0,Le.width,Le.height,ue.depth,Se,Qe,Le.data):t.texImage3D(n.TEXTURE_2D_ARRAY,ge,qe,Le.width,Le.height,ue.depth,0,Se,Qe,Le.data)}else{V&&Ee&&t.texStorage2D(n.TEXTURE_2D,pe,qe,nt[0].width,nt[0].height);for(let ge=0,re=nt.length;ge<re;ge++)Le=nt[ge],L.format!==li?Se!==null?V?we&&t.compressedTexSubImage2D(n.TEXTURE_2D,ge,0,0,Le.width,Le.height,Se,Le.data):t.compressedTexImage2D(n.TEXTURE_2D,ge,qe,Le.width,Le.height,0,Le.data):Ie("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):V?we&&t.texSubImage2D(n.TEXTURE_2D,ge,0,0,Le.width,Le.height,Se,Qe,Le.data):t.texImage2D(n.TEXTURE_2D,ge,qe,Le.width,Le.height,0,Se,Qe,Le.data)}else if(L.isDataArrayTexture)if(V){if(Ee&&t.texStorage3D(n.TEXTURE_2D_ARRAY,pe,qe,ue.width,ue.height,ue.depth),we)if(L.layerUpdates.size>0){const ge=iS(ue.width,ue.height,L.format,L.type);for(const re of L.layerUpdates){const Fe=ue.data.subarray(re*ge/ue.data.BYTES_PER_ELEMENT,(re+1)*ge/ue.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,re,ue.width,ue.height,1,Se,Qe,Fe)}L.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ue.width,ue.height,ue.depth,Se,Qe,ue.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,qe,ue.width,ue.height,ue.depth,0,Se,Qe,ue.data);else if(L.isData3DTexture)V?(Ee&&t.texStorage3D(n.TEXTURE_3D,pe,qe,ue.width,ue.height,ue.depth),we&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ue.width,ue.height,ue.depth,Se,Qe,ue.data)):t.texImage3D(n.TEXTURE_3D,0,qe,ue.width,ue.height,ue.depth,0,Se,Qe,ue.data);else if(L.isFramebufferTexture){if(Ee)if(V)t.texStorage2D(n.TEXTURE_2D,pe,qe,ue.width,ue.height);else{let ge=ue.width,re=ue.height;for(let Fe=0;Fe<pe;Fe++)t.texImage2D(n.TEXTURE_2D,Fe,qe,ge,re,0,Se,Qe,null),ge>>=1,re>>=1}}else if(nt.length>0){if(V&&Ee){const ge=Oe(nt[0]);t.texStorage2D(n.TEXTURE_2D,pe,qe,ge.width,ge.height)}for(let ge=0,re=nt.length;ge<re;ge++)Le=nt[ge],V?we&&t.texSubImage2D(n.TEXTURE_2D,ge,0,0,Se,Qe,Le):t.texImage2D(n.TEXTURE_2D,ge,qe,Se,Qe,Le);L.generateMipmaps=!1}else if(V){if(Ee){const ge=Oe(ue);t.texStorage2D(n.TEXTURE_2D,pe,qe,ge.width,ge.height)}we&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Se,Qe,ue)}else t.texImage2D(n.TEXTURE_2D,0,qe,Se,Qe,ue);y(L)&&m(Q),$e.__version=J.version,L.onUpdate&&L.onUpdate(L)}k.__version=L.version}function se(k,L,G){if(L.image.length!==6)return;const Q=ft(k,L),le=L.source;t.bindTexture(n.TEXTURE_CUBE_MAP,k.__webglTexture,n.TEXTURE0+G);const J=i.get(le);if(le.version!==J.__version||Q===!0){t.activeTexture(n.TEXTURE0+G);const $e=Lt.getPrimaries(Lt.workingColorSpace),Me=L.colorSpace===Ts?null:Lt.getPrimaries(L.colorSpace),Xe=L.colorSpace===Ts||$e===Me?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,L.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,L.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Xe);const He=L.isCompressedTexture||L.image[0].isCompressedTexture,ue=L.image[0]&&L.image[0].isDataTexture,Se=[];for(let re=0;re<6;re++)!He&&!ue?Se[re]=_(L.image[re],!0,r.maxCubemapSize):Se[re]=ue?L.image[re].image:L.image[re],Se[re]=be(L,Se[re]);const Qe=Se[0],qe=s.convert(L.format,L.colorSpace),Le=s.convert(L.type),nt=v(L.internalFormat,qe,Le,L.colorSpace),V=L.isVideoTexture!==!0,Ee=J.__version===void 0||Q===!0,we=le.dataReady;let pe=R(L,Qe);Ge(n.TEXTURE_CUBE_MAP,L);let ge;if(He){V&&Ee&&t.texStorage2D(n.TEXTURE_CUBE_MAP,pe,nt,Qe.width,Qe.height);for(let re=0;re<6;re++){ge=Se[re].mipmaps;for(let Fe=0;Fe<ge.length;Fe++){const ut=ge[Fe];L.format!==li?qe!==null?V?we&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Fe,0,0,ut.width,ut.height,qe,ut.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Fe,nt,ut.width,ut.height,0,ut.data):Ie("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):V?we&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Fe,0,0,ut.width,ut.height,qe,Le,ut.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Fe,nt,ut.width,ut.height,0,qe,Le,ut.data)}}}else{if(ge=L.mipmaps,V&&Ee){ge.length>0&&pe++;const re=Oe(Se[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,pe,nt,re.width,re.height)}for(let re=0;re<6;re++)if(ue){V?we&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,0,0,Se[re].width,Se[re].height,qe,Le,Se[re].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,nt,Se[re].width,Se[re].height,0,qe,Le,Se[re].data);for(let Fe=0;Fe<ge.length;Fe++){const qt=ge[Fe].image[re].image;V?we&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Fe+1,0,0,qt.width,qt.height,qe,Le,qt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Fe+1,nt,qt.width,qt.height,0,qe,Le,qt.data)}}else{V?we&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,0,0,qe,Le,Se[re]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,nt,qe,Le,Se[re]);for(let Fe=0;Fe<ge.length;Fe++){const ut=ge[Fe];V?we&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Fe+1,0,0,qe,Le,ut.image[re]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Fe+1,nt,qe,Le,ut.image[re])}}}y(L)&&m(n.TEXTURE_CUBE_MAP),J.__version=le.version,L.onUpdate&&L.onUpdate(L)}k.__version=L.version}function Ne(k,L,G,Q,le,J){const $e=s.convert(G.format,G.colorSpace),Me=s.convert(G.type),Xe=v(G.internalFormat,$e,Me,G.colorSpace),He=i.get(L),ue=i.get(G);if(ue.__renderTarget=L,!He.__hasExternalTextures){const Se=Math.max(1,L.width>>J),Qe=Math.max(1,L.height>>J);le===n.TEXTURE_3D||le===n.TEXTURE_2D_ARRAY?t.texImage3D(le,J,Xe,Se,Qe,L.depth,0,$e,Me,null):t.texImage2D(le,J,Xe,Se,Qe,0,$e,Me,null)}t.bindFramebuffer(n.FRAMEBUFFER,k),oe(L)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Q,le,ue.__webglTexture,0,ve(L)):(le===n.TEXTURE_2D||le>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&le<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Q,le,ue.__webglTexture,J),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ye(k,L,G){if(n.bindRenderbuffer(n.RENDERBUFFER,k),L.depthBuffer){const Q=L.depthTexture,le=Q&&Q.isDepthTexture?Q.type:null,J=T(L.stencilBuffer,le),$e=L.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Me=ve(L);oe(L)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Me,J,L.width,L.height):G?n.renderbufferStorageMultisample(n.RENDERBUFFER,Me,J,L.width,L.height):n.renderbufferStorage(n.RENDERBUFFER,J,L.width,L.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,$e,n.RENDERBUFFER,k)}else{const Q=L.textures;for(let le=0;le<Q.length;le++){const J=Q[le],$e=s.convert(J.format,J.colorSpace),Me=s.convert(J.type),Xe=v(J.internalFormat,$e,Me,J.colorSpace),He=ve(L);G&&oe(L)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,He,Xe,L.width,L.height):oe(L)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,He,Xe,L.width,L.height):n.renderbufferStorage(n.RENDERBUFFER,Xe,L.width,L.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function We(k,L){if(L&&L.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,k),!(L.depthTexture&&L.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Q=i.get(L.depthTexture);Q.__renderTarget=L,(!Q.__webglTexture||L.depthTexture.image.width!==L.width||L.depthTexture.image.height!==L.height)&&(L.depthTexture.image.width=L.width,L.depthTexture.image.height=L.height,L.depthTexture.needsUpdate=!0),Y(L.depthTexture,0);const le=Q.__webglTexture,J=ve(L);if(L.depthTexture.format===Jc)oe(L)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,le,0,J):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,le,0);else if(L.depthTexture.format===Zc)oe(L)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,le,0,J):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,le,0);else throw new Error("Unknown depthTexture format")}function vt(k){const L=i.get(k),G=k.isWebGLCubeRenderTarget===!0;if(L.__boundDepthTexture!==k.depthTexture){const Q=k.depthTexture;if(L.__depthDisposeCallback&&L.__depthDisposeCallback(),Q){const le=()=>{delete L.__boundDepthTexture,delete L.__depthDisposeCallback,Q.removeEventListener("dispose",le)};Q.addEventListener("dispose",le),L.__depthDisposeCallback=le}L.__boundDepthTexture=Q}if(k.depthTexture&&!L.__autoAllocateDepthBuffer){if(G)throw new Error("target.depthTexture not supported in Cube render targets");const Q=k.texture.mipmaps;Q&&Q.length>0?We(L.__webglFramebuffer[0],k):We(L.__webglFramebuffer,k)}else if(G){L.__webglDepthbuffer=[];for(let Q=0;Q<6;Q++)if(t.bindFramebuffer(n.FRAMEBUFFER,L.__webglFramebuffer[Q]),L.__webglDepthbuffer[Q]===void 0)L.__webglDepthbuffer[Q]=n.createRenderbuffer(),Ye(L.__webglDepthbuffer[Q],k,!1);else{const le=k.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,J=L.__webglDepthbuffer[Q];n.bindRenderbuffer(n.RENDERBUFFER,J),n.framebufferRenderbuffer(n.FRAMEBUFFER,le,n.RENDERBUFFER,J)}}else{const Q=k.texture.mipmaps;if(Q&&Q.length>0?t.bindFramebuffer(n.FRAMEBUFFER,L.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,L.__webglFramebuffer),L.__webglDepthbuffer===void 0)L.__webglDepthbuffer=n.createRenderbuffer(),Ye(L.__webglDepthbuffer,k,!1);else{const le=k.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,J=L.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,J),n.framebufferRenderbuffer(n.FRAMEBUFFER,le,n.RENDERBUFFER,J)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Bt(k,L,G){const Q=i.get(k);L!==void 0&&Ne(Q.__webglFramebuffer,k,k.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),G!==void 0&&vt(k)}function tt(k){const L=k.texture,G=i.get(k),Q=i.get(L);k.addEventListener("dispose",A);const le=k.textures,J=k.isWebGLCubeRenderTarget===!0,$e=le.length>1;if($e||(Q.__webglTexture===void 0&&(Q.__webglTexture=n.createTexture()),Q.__version=L.version,a.memory.textures++),J){G.__webglFramebuffer=[];for(let Me=0;Me<6;Me++)if(L.mipmaps&&L.mipmaps.length>0){G.__webglFramebuffer[Me]=[];for(let Xe=0;Xe<L.mipmaps.length;Xe++)G.__webglFramebuffer[Me][Xe]=n.createFramebuffer()}else G.__webglFramebuffer[Me]=n.createFramebuffer()}else{if(L.mipmaps&&L.mipmaps.length>0){G.__webglFramebuffer=[];for(let Me=0;Me<L.mipmaps.length;Me++)G.__webglFramebuffer[Me]=n.createFramebuffer()}else G.__webglFramebuffer=n.createFramebuffer();if($e)for(let Me=0,Xe=le.length;Me<Xe;Me++){const He=i.get(le[Me]);He.__webglTexture===void 0&&(He.__webglTexture=n.createTexture(),a.memory.textures++)}if(k.samples>0&&oe(k)===!1){G.__webglMultisampledFramebuffer=n.createFramebuffer(),G.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,G.__webglMultisampledFramebuffer);for(let Me=0;Me<le.length;Me++){const Xe=le[Me];G.__webglColorRenderbuffer[Me]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,G.__webglColorRenderbuffer[Me]);const He=s.convert(Xe.format,Xe.colorSpace),ue=s.convert(Xe.type),Se=v(Xe.internalFormat,He,ue,Xe.colorSpace,k.isXRRenderTarget===!0),Qe=ve(k);n.renderbufferStorageMultisample(n.RENDERBUFFER,Qe,Se,k.width,k.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Me,n.RENDERBUFFER,G.__webglColorRenderbuffer[Me])}n.bindRenderbuffer(n.RENDERBUFFER,null),k.depthBuffer&&(G.__webglDepthRenderbuffer=n.createRenderbuffer(),Ye(G.__webglDepthRenderbuffer,k,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(J){t.bindTexture(n.TEXTURE_CUBE_MAP,Q.__webglTexture),Ge(n.TEXTURE_CUBE_MAP,L);for(let Me=0;Me<6;Me++)if(L.mipmaps&&L.mipmaps.length>0)for(let Xe=0;Xe<L.mipmaps.length;Xe++)Ne(G.__webglFramebuffer[Me][Xe],k,L,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Xe);else Ne(G.__webglFramebuffer[Me],k,L,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0);y(L)&&m(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if($e){for(let Me=0,Xe=le.length;Me<Xe;Me++){const He=le[Me],ue=i.get(He);let Se=n.TEXTURE_2D;(k.isWebGL3DRenderTarget||k.isWebGLArrayRenderTarget)&&(Se=k.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Se,ue.__webglTexture),Ge(Se,He),Ne(G.__webglFramebuffer,k,He,n.COLOR_ATTACHMENT0+Me,Se,0),y(He)&&m(Se)}t.unbindTexture()}else{let Me=n.TEXTURE_2D;if((k.isWebGL3DRenderTarget||k.isWebGLArrayRenderTarget)&&(Me=k.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Me,Q.__webglTexture),Ge(Me,L),L.mipmaps&&L.mipmaps.length>0)for(let Xe=0;Xe<L.mipmaps.length;Xe++)Ne(G.__webglFramebuffer[Xe],k,L,n.COLOR_ATTACHMENT0,Me,Xe);else Ne(G.__webglFramebuffer,k,L,n.COLOR_ATTACHMENT0,Me,0);y(L)&&m(Me),t.unbindTexture()}k.depthBuffer&&vt(k)}function de(k){const L=k.textures;for(let G=0,Q=L.length;G<Q;G++){const le=L[G];if(y(le)){const J=x(k),$e=i.get(le).__webglTexture;t.bindTexture(J,$e),m(J),t.unbindTexture()}}}const U=[],he=[];function me(k){if(k.samples>0){if(oe(k)===!1){const L=k.textures,G=k.width,Q=k.height;let le=n.COLOR_BUFFER_BIT;const J=k.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,$e=i.get(k),Me=L.length>1;if(Me)for(let He=0;He<L.length;He++)t.bindFramebuffer(n.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+He,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,$e.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+He,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,$e.__webglMultisampledFramebuffer);const Xe=k.texture.mipmaps;Xe&&Xe.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,$e.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,$e.__webglFramebuffer);for(let He=0;He<L.length;He++){if(k.resolveDepthBuffer&&(k.depthBuffer&&(le|=n.DEPTH_BUFFER_BIT),k.stencilBuffer&&k.resolveStencilBuffer&&(le|=n.STENCIL_BUFFER_BIT)),Me){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,$e.__webglColorRenderbuffer[He]);const ue=i.get(L[He]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,ue,0)}n.blitFramebuffer(0,0,G,Q,0,0,G,Q,le,n.NEAREST),l===!0&&(U.length=0,he.length=0,U.push(n.COLOR_ATTACHMENT0+He),k.depthBuffer&&k.resolveDepthBuffer===!1&&(U.push(J),he.push(J),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,he)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,U))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Me)for(let He=0;He<L.length;He++){t.bindFramebuffer(n.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+He,n.RENDERBUFFER,$e.__webglColorRenderbuffer[He]);const ue=i.get(L[He]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,$e.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+He,n.TEXTURE_2D,ue,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,$e.__webglMultisampledFramebuffer)}else if(k.depthBuffer&&k.resolveDepthBuffer===!1&&l){const L=k.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[L])}}}function ve(k){return Math.min(r.maxSamples,k.samples)}function oe(k){const L=i.get(k);return k.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&L.__useRenderToTexture!==!1}function Ae(k){const L=a.render.frame;u.get(k)!==L&&(u.set(k,L),k.update())}function be(k,L){const G=k.colorSpace,Q=k.format,le=k.type;return k.isCompressedTexture===!0||k.isVideoTexture===!0||G!==cl&&G!==Ts&&(Lt.getTransfer(G)===Ht?(Q!==li||le!==Or)&&Ie("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):lt("WebGLTextures: Unsupported texture color space:",G)),L}function Oe(k){return typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement?(c.width=k.naturalWidth||k.width,c.height=k.naturalHeight||k.height):typeof VideoFrame<"u"&&k instanceof VideoFrame?(c.width=k.displayWidth,c.height=k.displayHeight):(c.width=k.width,c.height=k.height),c}this.allocateTextureUnit=P,this.resetTextureUnits=D,this.setTexture2D=Y,this.setTexture2DArray=Z,this.setTexture3D=fe,this.setTextureCube=B,this.rebindTextures=Bt,this.setupRenderTarget=tt,this.updateRenderTargetMipmap=de,this.updateMultisampleRenderTarget=me,this.setupDepthRenderbuffer=vt,this.setupFrameBufferTexture=Ne,this.useMultisampledRTT=oe}function GD(n,e){function t(i,r=Ts){let s;const a=Lt.getTransfer(r);if(i===Or)return n.UNSIGNED_BYTE;if(i===k0)return n.UNSIGNED_SHORT_4_4_4_4;if(i===U0)return n.UNSIGNED_SHORT_5_5_5_1;if(i===aw)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===ow)return n.UNSIGNED_INT_10F_11F_11F_REV;if(i===rw)return n.BYTE;if(i===sw)return n.SHORT;if(i===Kc)return n.UNSIGNED_SHORT;if(i===O0)return n.INT;if(i===$s)return n.UNSIGNED_INT;if(i===Li)return n.FLOAT;if(i===bl)return n.HALF_FLOAT;if(i===lw)return n.ALPHA;if(i===cw)return n.RGB;if(i===li)return n.RGBA;if(i===Jc)return n.DEPTH_COMPONENT;if(i===Zc)return n.DEPTH_STENCIL;if(i===F0)return n.RED;if(i===Kd)return n.RED_INTEGER;if(i===V0)return n.RG;if(i===B0)return n.RG_INTEGER;if(i===z0)return n.RGBA_INTEGER;if(i===Ch||i===Ih||i===Rh||i===Ph)if(a===Ht)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===Ch)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Ih)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Rh)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Ph)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===Ch)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Ih)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Rh)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Ph)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===ug||i===hg||i===dg||i===fg)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===ug)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===hg)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===dg)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===fg)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===pg||i===mg||i===gg)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===pg||i===mg)return a===Ht?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===gg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===yg||i===_g||i===xg||i===vg||i===Sg||i===bg||i===wg||i===Tg||i===Eg||i===Ag||i===Mg||i===Cg||i===Ig||i===Rg)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===yg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===_g)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===xg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===vg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Sg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===bg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===wg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Tg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===Eg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Ag)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Mg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Cg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Ig)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Rg)return a===Ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Pg||i===Lg||i===Dg)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===Pg)return a===Ht?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Lg)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Dg)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===Ng||i===Og||i===kg||i===Ug)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===Ng)return s.COMPRESSED_RED_RGTC1_EXT;if(i===Og)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===kg)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Ug)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Yc?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}const WK=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,$K=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class qK{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const i=new vw(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new Zi({vertexShader:WK,fragmentShader:$K,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new tn(new _u(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class jK extends hs{constructor(e,t){super();const i=this;let r=null,s=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,d=null,p=null,g=null;const _=typeof XRWebGLBinding<"u",y=new qK,m={},x=t.getContextAttributes();let v=null,T=null;const R=[],C=[],A=new ce;let E=null;const b=new In;b.viewport=new kt;const S=new In;S.viewport=new kt;const I=[b,S],D=new LD;let P=null,$=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ne){let se=R[ne];return se===void 0&&(se=new im,R[ne]=se),se.getTargetRaySpace()},this.getControllerGrip=function(ne){let se=R[ne];return se===void 0&&(se=new im,R[ne]=se),se.getGripSpace()},this.getHand=function(ne){let se=R[ne];return se===void 0&&(se=new im,R[ne]=se),se.getHandSpace()};function Y(ne){const se=C.indexOf(ne.inputSource);if(se===-1)return;const Ne=R[se];Ne!==void 0&&(Ne.update(ne.inputSource,ne.frame,c||a),Ne.dispatchEvent({type:ne.type,data:ne.inputSource}))}function Z(){r.removeEventListener("select",Y),r.removeEventListener("selectstart",Y),r.removeEventListener("selectend",Y),r.removeEventListener("squeeze",Y),r.removeEventListener("squeezestart",Y),r.removeEventListener("squeezeend",Y),r.removeEventListener("end",Z),r.removeEventListener("inputsourceschange",fe);for(let ne=0;ne<R.length;ne++){const se=C[ne];se!==null&&(C[ne]=null,R[ne].disconnect(se))}P=null,$=null,y.reset();for(const ne in m)delete m[ne];e.setRenderTarget(v),p=null,d=null,h=null,r=null,T=null,wt.stop(),i.isPresenting=!1,e.setPixelRatio(E),e.setSize(A.width,A.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ne){s=ne,i.isPresenting===!0&&Ie("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ne){o=ne,i.isPresenting===!0&&Ie("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(ne){c=ne},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h===null&&_&&(h=new XRWebGLBinding(r,t)),h},this.getFrame=function(){return g},this.getSession=function(){return r},this.setSession=async function(ne){if(r=ne,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",Y),r.addEventListener("selectstart",Y),r.addEventListener("selectend",Y),r.addEventListener("squeeze",Y),r.addEventListener("squeezestart",Y),r.addEventListener("squeezeend",Y),r.addEventListener("end",Z),r.addEventListener("inputsourceschange",fe),x.xrCompatible!==!0&&await t.makeXRCompatible(),E=e.getPixelRatio(),e.getSize(A),_&&"createProjectionLayer"in XRWebGLBinding.prototype){let Ne=null,Ye=null,We=null;x.depth&&(We=x.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ne=x.stencil?Zc:Jc,Ye=x.stencil?Yc:$s);const vt={colorFormat:t.RGBA8,depthFormat:We,scaleFactor:s};h=this.getBinding(),d=h.createProjectionLayer(vt),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),T=new kr(d.textureWidth,d.textureHeight,{format:li,type:Or,depthTexture:new xw(d.textureWidth,d.textureHeight,Ye,void 0,void 0,void 0,void 0,void 0,void 0,Ne),stencilBuffer:x.stencil,colorSpace:e.outputColorSpace,samples:x.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const Ne={antialias:x.antialias,alpha:!0,depth:x.depth,stencil:x.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(r,t,Ne),r.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),T=new kr(p.framebufferWidth,p.framebufferHeight,{format:li,type:Or,colorSpace:e.outputColorSpace,stencilBuffer:x.stencil,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}T.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await r.requestReferenceSpace(o),wt.setContext(r),wt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return y.getDepthTexture()};function fe(ne){for(let se=0;se<ne.removed.length;se++){const Ne=ne.removed[se],Ye=C.indexOf(Ne);Ye>=0&&(C[Ye]=null,R[Ye].disconnect(Ne))}for(let se=0;se<ne.added.length;se++){const Ne=ne.added[se];let Ye=C.indexOf(Ne);if(Ye===-1){for(let vt=0;vt<R.length;vt++)if(vt>=C.length){C.push(Ne),Ye=vt;break}else if(C[vt]===null){C[vt]=Ne,Ye=vt;break}if(Ye===-1)break}const We=R[Ye];We&&We.connect(Ne)}}const B=new F,X=new F;function ee(ne,se,Ne){B.setFromMatrixPosition(se.matrixWorld),X.setFromMatrixPosition(Ne.matrixWorld);const Ye=B.distanceTo(X),We=se.projectionMatrix.elements,vt=Ne.projectionMatrix.elements,Bt=We[14]/(We[10]-1),tt=We[14]/(We[10]+1),de=(We[9]+1)/We[5],U=(We[9]-1)/We[5],he=(We[8]-1)/We[0],me=(vt[8]+1)/vt[0],ve=Bt*he,oe=Bt*me,Ae=Ye/(-he+me),be=Ae*-he;if(se.matrixWorld.decompose(ne.position,ne.quaternion,ne.scale),ne.translateX(be),ne.translateZ(Ae),ne.matrixWorld.compose(ne.position,ne.quaternion,ne.scale),ne.matrixWorldInverse.copy(ne.matrixWorld).invert(),We[10]===-1)ne.projectionMatrix.copy(se.projectionMatrix),ne.projectionMatrixInverse.copy(se.projectionMatrixInverse);else{const Oe=Bt+Ae,k=tt+Ae,L=ve-be,G=oe+(Ye-be),Q=de*tt/k*Oe,le=U*tt/k*Oe;ne.projectionMatrix.makePerspective(L,G,Q,le,Oe,k),ne.projectionMatrixInverse.copy(ne.projectionMatrix).invert()}}function _e(ne,se){se===null?ne.matrixWorld.copy(ne.matrix):ne.matrixWorld.multiplyMatrices(se.matrixWorld,ne.matrix),ne.matrixWorldInverse.copy(ne.matrixWorld).invert()}this.updateCamera=function(ne){if(r===null)return;let se=ne.near,Ne=ne.far;y.texture!==null&&(y.depthNear>0&&(se=y.depthNear),y.depthFar>0&&(Ne=y.depthFar)),D.near=S.near=b.near=se,D.far=S.far=b.far=Ne,(P!==D.near||$!==D.far)&&(r.updateRenderState({depthNear:D.near,depthFar:D.far}),P=D.near,$=D.far),D.layers.mask=ne.layers.mask|6,b.layers.mask=D.layers.mask&3,S.layers.mask=D.layers.mask&5;const Ye=ne.parent,We=D.cameras;_e(D,Ye);for(let vt=0;vt<We.length;vt++)_e(We[vt],Ye);We.length===2?ee(D,b,S):D.projectionMatrix.copy(b.projectionMatrix),Ge(ne,D,Ye)};function Ge(ne,se,Ne){Ne===null?ne.matrix.copy(se.matrixWorld):(ne.matrix.copy(Ne.matrixWorld),ne.matrix.invert(),ne.matrix.multiply(se.matrixWorld)),ne.matrix.decompose(ne.position,ne.quaternion,ne.scale),ne.updateMatrixWorld(!0),ne.projectionMatrix.copy(se.projectionMatrix),ne.projectionMatrixInverse.copy(se.projectionMatrixInverse),ne.isPerspectiveCamera&&(ne.fov=tu*2*Math.atan(1/ne.projectionMatrix.elements[5]),ne.zoom=1)}this.getCamera=function(){return D},this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function(ne){l=ne,d!==null&&(d.fixedFoveation=ne),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=ne)},this.hasDepthSensing=function(){return y.texture!==null},this.getDepthSensingMesh=function(){return y.getMesh(D)},this.getCameraTexture=function(ne){return m[ne]};let ft=null;function pt(ne,se){if(u=se.getViewerPose(c||a),g=se,u!==null){const Ne=u.views;p!==null&&(e.setRenderTargetFramebuffer(T,p.framebuffer),e.setRenderTarget(T));let Ye=!1;Ne.length!==D.cameras.length&&(D.cameras.length=0,Ye=!0);for(let tt=0;tt<Ne.length;tt++){const de=Ne[tt];let U=null;if(p!==null)U=p.getViewport(de);else{const me=h.getViewSubImage(d,de);U=me.viewport,tt===0&&(e.setRenderTargetTextures(T,me.colorTexture,me.depthStencilTexture),e.setRenderTarget(T))}let he=I[tt];he===void 0&&(he=new In,he.layers.enable(tt),he.viewport=new kt,I[tt]=he),he.matrix.fromArray(de.transform.matrix),he.matrix.decompose(he.position,he.quaternion,he.scale),he.projectionMatrix.fromArray(de.projectionMatrix),he.projectionMatrixInverse.copy(he.projectionMatrix).invert(),he.viewport.set(U.x,U.y,U.width,U.height),tt===0&&(D.matrix.copy(he.matrix),D.matrix.decompose(D.position,D.quaternion,D.scale)),Ye===!0&&D.cameras.push(he)}const We=r.enabledFeatures;if(We&&We.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&_){h=i.getBinding();const tt=h.getDepthInformation(Ne[0]);tt&&tt.isValid&&tt.texture&&y.init(tt,r.renderState)}if(We&&We.includes("camera-access")&&_){e.state.unbindTexture(),h=i.getBinding();for(let tt=0;tt<Ne.length;tt++){const de=Ne[tt].camera;if(de){let U=m[de];U||(U=new vw,m[de]=U);const he=h.getCameraImage(de);U.sourceTexture=he}}}}for(let Ne=0;Ne<R.length;Ne++){const Ye=C[Ne],We=R[Ne];Ye!==null&&We!==void 0&&We.update(Ye,se,c||a)}ft&&ft(ne,se),se.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:se}),g=null}const wt=new FD;wt.setAnimationLoop(pt),this.setAnimationLoop=function(ne){ft=ne},this.dispose=function(){}}}const Io=new Ji,XK=new ot;function KK(n,e){function t(y,m){y.matrixAutoUpdate===!0&&y.updateMatrix(),m.value.copy(y.matrix)}function i(y,m){m.color.getRGB(y.fogColor.value,BL(n)),m.isFog?(y.fogNear.value=m.near,y.fogFar.value=m.far):m.isFogExp2&&(y.fogDensity.value=m.density)}function r(y,m,x,v,T){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(y,m):m.isMeshToonMaterial?(s(y,m),h(y,m)):m.isMeshPhongMaterial?(s(y,m),u(y,m)):m.isMeshStandardMaterial?(s(y,m),d(y,m),m.isMeshPhysicalMaterial&&p(y,m,T)):m.isMeshMatcapMaterial?(s(y,m),g(y,m)):m.isMeshDepthMaterial?s(y,m):m.isMeshDistanceMaterial?(s(y,m),_(y,m)):m.isMeshNormalMaterial?s(y,m):m.isLineBasicMaterial?(a(y,m),m.isLineDashedMaterial&&o(y,m)):m.isPointsMaterial?l(y,m,x,v):m.isSpriteMaterial?c(y,m):m.isShadowMaterial?(y.color.value.copy(m.color),y.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function s(y,m){y.opacity.value=m.opacity,m.color&&y.diffuse.value.copy(m.color),m.emissive&&y.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(y.map.value=m.map,t(m.map,y.mapTransform)),m.alphaMap&&(y.alphaMap.value=m.alphaMap,t(m.alphaMap,y.alphaMapTransform)),m.bumpMap&&(y.bumpMap.value=m.bumpMap,t(m.bumpMap,y.bumpMapTransform),y.bumpScale.value=m.bumpScale,m.side===vi&&(y.bumpScale.value*=-1)),m.normalMap&&(y.normalMap.value=m.normalMap,t(m.normalMap,y.normalMapTransform),y.normalScale.value.copy(m.normalScale),m.side===vi&&y.normalScale.value.negate()),m.displacementMap&&(y.displacementMap.value=m.displacementMap,t(m.displacementMap,y.displacementMapTransform),y.displacementScale.value=m.displacementScale,y.displacementBias.value=m.displacementBias),m.emissiveMap&&(y.emissiveMap.value=m.emissiveMap,t(m.emissiveMap,y.emissiveMapTransform)),m.specularMap&&(y.specularMap.value=m.specularMap,t(m.specularMap,y.specularMapTransform)),m.alphaTest>0&&(y.alphaTest.value=m.alphaTest);const x=e.get(m),v=x.envMap,T=x.envMapRotation;v&&(y.envMap.value=v,Io.copy(T),Io.x*=-1,Io.y*=-1,Io.z*=-1,v.isCubeTexture&&v.isRenderTargetTexture===!1&&(Io.y*=-1,Io.z*=-1),y.envMapRotation.value.setFromMatrix4(XK.makeRotationFromEuler(Io)),y.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=m.reflectivity,y.ior.value=m.ior,y.refractionRatio.value=m.refractionRatio),m.lightMap&&(y.lightMap.value=m.lightMap,y.lightMapIntensity.value=m.lightMapIntensity,t(m.lightMap,y.lightMapTransform)),m.aoMap&&(y.aoMap.value=m.aoMap,y.aoMapIntensity.value=m.aoMapIntensity,t(m.aoMap,y.aoMapTransform))}function a(y,m){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity,m.map&&(y.map.value=m.map,t(m.map,y.mapTransform))}function o(y,m){y.dashSize.value=m.dashSize,y.totalSize.value=m.dashSize+m.gapSize,y.scale.value=m.scale}function l(y,m,x,v){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity,y.size.value=m.size*x,y.scale.value=v*.5,m.map&&(y.map.value=m.map,t(m.map,y.uvTransform)),m.alphaMap&&(y.alphaMap.value=m.alphaMap,t(m.alphaMap,y.alphaMapTransform)),m.alphaTest>0&&(y.alphaTest.value=m.alphaTest)}function c(y,m){y.diffuse.value.copy(m.color),y.opacity.value=m.opacity,y.rotation.value=m.rotation,m.map&&(y.map.value=m.map,t(m.map,y.mapTransform)),m.alphaMap&&(y.alphaMap.value=m.alphaMap,t(m.alphaMap,y.alphaMapTransform)),m.alphaTest>0&&(y.alphaTest.value=m.alphaTest)}function u(y,m){y.specular.value.copy(m.specular),y.shininess.value=Math.max(m.shininess,1e-4)}function h(y,m){m.gradientMap&&(y.gradientMap.value=m.gradientMap)}function d(y,m){y.metalness.value=m.metalness,m.metalnessMap&&(y.metalnessMap.value=m.metalnessMap,t(m.metalnessMap,y.metalnessMapTransform)),y.roughness.value=m.roughness,m.roughnessMap&&(y.roughnessMap.value=m.roughnessMap,t(m.roughnessMap,y.roughnessMapTransform)),m.envMap&&(y.envMapIntensity.value=m.envMapIntensity)}function p(y,m,x){y.ior.value=m.ior,m.sheen>0&&(y.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),y.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(y.sheenColorMap.value=m.sheenColorMap,t(m.sheenColorMap,y.sheenColorMapTransform)),m.sheenRoughnessMap&&(y.sheenRoughnessMap.value=m.sheenRoughnessMap,t(m.sheenRoughnessMap,y.sheenRoughnessMapTransform))),m.clearcoat>0&&(y.clearcoat.value=m.clearcoat,y.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(y.clearcoatMap.value=m.clearcoatMap,t(m.clearcoatMap,y.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,t(m.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(y.clearcoatNormalMap.value=m.clearcoatNormalMap,t(m.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===vi&&y.clearcoatNormalScale.value.negate())),m.dispersion>0&&(y.dispersion.value=m.dispersion),m.iridescence>0&&(y.iridescence.value=m.iridescence,y.iridescenceIOR.value=m.iridescenceIOR,y.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(y.iridescenceMap.value=m.iridescenceMap,t(m.iridescenceMap,y.iridescenceMapTransform)),m.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=m.iridescenceThicknessMap,t(m.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),m.transmission>0&&(y.transmission.value=m.transmission,y.transmissionSamplerMap.value=x.texture,y.transmissionSamplerSize.value.set(x.width,x.height),m.transmissionMap&&(y.transmissionMap.value=m.transmissionMap,t(m.transmissionMap,y.transmissionMapTransform)),y.thickness.value=m.thickness,m.thicknessMap&&(y.thicknessMap.value=m.thicknessMap,t(m.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=m.attenuationDistance,y.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(y.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(y.anisotropyMap.value=m.anisotropyMap,t(m.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=m.specularIntensity,y.specularColor.value.copy(m.specularColor),m.specularColorMap&&(y.specularColorMap.value=m.specularColorMap,t(m.specularColorMap,y.specularColorMapTransform)),m.specularIntensityMap&&(y.specularIntensityMap.value=m.specularIntensityMap,t(m.specularIntensityMap,y.specularIntensityMapTransform))}function g(y,m){m.matcap&&(y.matcap.value=m.matcap)}function _(y,m){const x=e.get(m).light;y.referencePosition.value.setFromMatrixPosition(x.matrixWorld),y.nearDistance.value=x.shadow.camera.near,y.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function YK(n,e,t,i){let r={},s={},a=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(x,v){const T=v.program;i.uniformBlockBinding(x,T)}function c(x,v){let T=r[x.id];T===void 0&&(g(x),T=u(x),r[x.id]=T,x.addEventListener("dispose",y));const R=v.program;i.updateUBOMapping(x,R);const C=e.render.frame;s[x.id]!==C&&(d(x),s[x.id]=C)}function u(x){const v=h();x.__bindingPointIndex=v;const T=n.createBuffer(),R=x.__size,C=x.usage;return n.bindBuffer(n.UNIFORM_BUFFER,T),n.bufferData(n.UNIFORM_BUFFER,R,C),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,v,T),T}function h(){for(let x=0;x<o;x++)if(a.indexOf(x)===-1)return a.push(x),x;return lt("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(x){const v=r[x.id],T=x.uniforms,R=x.__cache;n.bindBuffer(n.UNIFORM_BUFFER,v);for(let C=0,A=T.length;C<A;C++){const E=Array.isArray(T[C])?T[C]:[T[C]];for(let b=0,S=E.length;b<S;b++){const I=E[b];if(p(I,C,b,R)===!0){const D=I.__offset,P=Array.isArray(I.value)?I.value:[I.value];let $=0;for(let Y=0;Y<P.length;Y++){const Z=P[Y],fe=_(Z);typeof Z=="number"||typeof Z=="boolean"?(I.__data[0]=Z,n.bufferSubData(n.UNIFORM_BUFFER,D+$,I.__data)):Z.isMatrix3?(I.__data[0]=Z.elements[0],I.__data[1]=Z.elements[1],I.__data[2]=Z.elements[2],I.__data[3]=0,I.__data[4]=Z.elements[3],I.__data[5]=Z.elements[4],I.__data[6]=Z.elements[5],I.__data[7]=0,I.__data[8]=Z.elements[6],I.__data[9]=Z.elements[7],I.__data[10]=Z.elements[8],I.__data[11]=0):(Z.toArray(I.__data,$),$+=fe.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,D,I.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function p(x,v,T,R){const C=x.value,A=v+"_"+T;if(R[A]===void 0)return typeof C=="number"||typeof C=="boolean"?R[A]=C:R[A]=C.clone(),!0;{const E=R[A];if(typeof C=="number"||typeof C=="boolean"){if(E!==C)return R[A]=C,!0}else if(E.equals(C)===!1)return E.copy(C),!0}return!1}function g(x){const v=x.uniforms;let T=0;const R=16;for(let A=0,E=v.length;A<E;A++){const b=Array.isArray(v[A])?v[A]:[v[A]];for(let S=0,I=b.length;S<I;S++){const D=b[S],P=Array.isArray(D.value)?D.value:[D.value];for(let $=0,Y=P.length;$<Y;$++){const Z=P[$],fe=_(Z),B=T%R,X=B%fe.boundary,ee=B+X;T+=X,ee!==0&&R-ee<fe.storage&&(T+=R-ee),D.__data=new Float32Array(fe.storage/Float32Array.BYTES_PER_ELEMENT),D.__offset=T,T+=fe.storage}}}const C=T%R;return C>0&&(T+=R-C),x.__size=T,x.__cache={},this}function _(x){const v={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(v.boundary=4,v.storage=4):x.isVector2?(v.boundary=8,v.storage=8):x.isVector3||x.isColor?(v.boundary=16,v.storage=12):x.isVector4?(v.boundary=16,v.storage=16):x.isMatrix3?(v.boundary=48,v.storage=48):x.isMatrix4?(v.boundary=64,v.storage=64):x.isTexture?Ie("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Ie("WebGLRenderer: Unsupported uniform value type.",x),v}function y(x){const v=x.target;v.removeEventListener("dispose",y);const T=a.indexOf(v.__bindingPointIndex);a.splice(T,1),n.deleteBuffer(r[v.id]),delete r[v.id],delete s[v.id]}function m(){for(const x in r)n.deleteBuffer(r[x]);a=[],r={},s={}}return{bind:l,update:c,dispose:m}}const JK=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let vs=null;function ZK(){return vs===null&&(vs=new Lr(JK,32,32,V0,bl),vs.minFilter=sn,vs.magFilter=sn,vs.wrapS=Pi,vs.wrapT=Pi,vs.generateMipmaps=!1,vs.needsUpdate=!0),vs}class WD{constructor(e={}){const{canvas:t=UL(),context:i=null,depth:r=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reversedDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let p;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=i.getContextAttributes().alpha}else p=a;const g=new Set([z0,B0,Kd]),_=new Set([Or,$s,Kc,Yc,k0,U0]),y=new Uint32Array(4),m=new Int32Array(4);let x=null,v=null;const T=[],R=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Ls,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const C=this;let A=!1;this._outputColorSpace=si;let E=0,b=0,S=null,I=-1,D=null;const P=new kt,$=new kt;let Y=null;const Z=new De(0);let fe=0,B=t.width,X=t.height,ee=1,_e=null,Ge=null;const ft=new kt(0,0,B,X),pt=new kt(0,0,B,X);let wt=!1;const ne=new yu;let se=!1,Ne=!1;const Ye=new ot,We=new F,vt=new kt,Bt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let tt=!1;function de(){return S===null?ee:1}let U=i;function he(N,z){return t.getContext(N,z)}try{const N={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${D0}`),t.addEventListener("webglcontextlost",ge,!1),t.addEventListener("webglcontextrestored",re,!1),t.addEventListener("webglcontextcreationerror",Fe,!1),U===null){const z="webgl2";if(U=he(z,N),U===null)throw he(z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(N){throw N("WebGLRenderer: "+N.message),N}let me,ve,oe,Ae,be,Oe,k,L,G,Q,le,J,$e,Me,Xe,He,ue,Se,Qe,qe,Le,nt,V,Ee;function we(){me=new lX(U),me.init(),nt=new GD(U,me),ve=new Qj(U,me,e,nt),oe=new HK(U,me),ve.reversedDepthBuffer&&d&&oe.buffers.depth.setReversed(!0),Ae=new hX(U),be=new IK,Oe=new GK(U,me,oe,be,ve,nt,Ae),k=new tX(C),L=new oX(C),G=new m$(U),V=new Jj(U,G),Q=new cX(U,G,Ae,V),le=new fX(U,Q,G,Ae),Qe=new dX(U,ve,Oe),He=new eX(be),J=new CK(C,k,L,me,ve,V,He),$e=new KK(C,be),Me=new PK,Xe=new UK(me),Se=new Yj(C,k,L,oe,le,p,l),ue=new BK(C,le,ve),Ee=new YK(U,Ae,ve,oe),qe=new Zj(U,me,Ae),Le=new uX(U,me,Ae),Ae.programs=J.programs,C.capabilities=ve,C.extensions=me,C.properties=be,C.renderLists=Me,C.shadowMap=ue,C.state=oe,C.info=Ae}we();const pe=new jK(C,U);this.xr=pe,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){const N=me.get("WEBGL_lose_context");N&&N.loseContext()},this.forceContextRestore=function(){const N=me.get("WEBGL_lose_context");N&&N.restoreContext()},this.getPixelRatio=function(){return ee},this.setPixelRatio=function(N){N!==void 0&&(ee=N,this.setSize(B,X,!1))},this.getSize=function(N){return N.set(B,X)},this.setSize=function(N,z,q=!0){if(pe.isPresenting){Ie("WebGLRenderer: Can't change size while VR device is presenting.");return}B=N,X=z,t.width=Math.floor(N*ee),t.height=Math.floor(z*ee),q===!0&&(t.style.width=N+"px",t.style.height=z+"px"),this.setViewport(0,0,N,z)},this.getDrawingBufferSize=function(N){return N.set(B*ee,X*ee).floor()},this.setDrawingBufferSize=function(N,z,q){B=N,X=z,ee=q,t.width=Math.floor(N*q),t.height=Math.floor(z*q),this.setViewport(0,0,N,z)},this.getCurrentViewport=function(N){return N.copy(P)},this.getViewport=function(N){return N.copy(ft)},this.setViewport=function(N,z,q,K){N.isVector4?ft.set(N.x,N.y,N.z,N.w):ft.set(N,z,q,K),oe.viewport(P.copy(ft).multiplyScalar(ee).round())},this.getScissor=function(N){return N.copy(pt)},this.setScissor=function(N,z,q,K){N.isVector4?pt.set(N.x,N.y,N.z,N.w):pt.set(N,z,q,K),oe.scissor($.copy(pt).multiplyScalar(ee).round())},this.getScissorTest=function(){return wt},this.setScissorTest=function(N){oe.setScissorTest(wt=N)},this.setOpaqueSort=function(N){_e=N},this.setTransparentSort=function(N){Ge=N},this.getClearColor=function(N){return N.copy(Se.getClearColor())},this.setClearColor=function(){Se.setClearColor(...arguments)},this.getClearAlpha=function(){return Se.getClearAlpha()},this.setClearAlpha=function(){Se.setClearAlpha(...arguments)},this.clear=function(N=!0,z=!0,q=!0){let K=0;if(N){let H=!1;if(S!==null){const xe=S.texture.format;H=g.has(xe)}if(H){const xe=S.texture.type,Re=_.has(xe),Be=Se.getClearColor(),ke=Se.getClearAlpha(),et=Be.r,it=Be.g,Ke=Be.b;Re?(y[0]=et,y[1]=it,y[2]=Ke,y[3]=ke,U.clearBufferuiv(U.COLOR,0,y)):(m[0]=et,m[1]=it,m[2]=Ke,m[3]=ke,U.clearBufferiv(U.COLOR,0,m))}else K|=U.COLOR_BUFFER_BIT}z&&(K|=U.DEPTH_BUFFER_BIT),q&&(K|=U.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),U.clear(K)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ge,!1),t.removeEventListener("webglcontextrestored",re,!1),t.removeEventListener("webglcontextcreationerror",Fe,!1),Se.dispose(),Me.dispose(),Xe.dispose(),be.dispose(),k.dispose(),L.dispose(),le.dispose(),V.dispose(),Ee.dispose(),J.dispose(),pe.dispose(),pe.removeEventListener("sessionstart",vu),pe.removeEventListener("sessionend",Su),pr.stop()};function ge(N){N.preventDefault(),vd("WebGLRenderer: Context Lost."),A=!0}function re(){vd("WebGLRenderer: Context Restored."),A=!1;const N=Ae.autoReset,z=ue.enabled,q=ue.autoUpdate,K=ue.needsUpdate,H=ue.type;we(),Ae.autoReset=N,ue.enabled=z,ue.autoUpdate=q,ue.needsUpdate=K,ue.type=H}function Fe(N){lt("WebGLRenderer: A WebGL context could not be created. Reason: ",N.statusMessage)}function ut(N){const z=N.target;z.removeEventListener("dispose",ut),qt(z)}function qt(N){Rt(N),be.remove(N)}function Rt(N){const z=be.get(N).programs;z!==void 0&&(z.forEach(function(q){J.releaseProgram(q)}),N.isShaderMaterial&&J.releaseShaderCache(N))}this.renderBufferDirect=function(N,z,q,K,H,xe){z===null&&(z=Bt);const Re=H.isMesh&&H.matrixWorld.determinant()<0,Be=_y(N,z,q,K,H);oe.setMaterial(K,Re);let ke=q.index,et=1;if(K.wireframe===!0){if(ke=Q.getWireframeAttribute(q),ke===void 0)return;et=2}const it=q.drawRange,Ke=q.attributes.position;let bt=it.start*et,Tt=(it.start+it.count)*et;xe!==null&&(bt=Math.max(bt,xe.start*et),Tt=Math.min(Tt,(xe.start+xe.count)*et)),ke!==null?(bt=Math.max(bt,0),Tt=Math.min(Tt,ke.count)):Ke!=null&&(bt=Math.max(bt,0),Tt=Math.min(Tt,Ke.count));const Dt=Tt-bt;if(Dt<0||Dt===1/0)return;V.setup(H,K,Be,q,ke);let Wt,Nt=qe;if(ke!==null&&(Wt=G.get(ke),Nt=Le,Nt.setIndex(Wt)),H.isMesh)K.wireframe===!0?(oe.setLineWidth(K.wireframeLinewidth*de()),Nt.setMode(U.LINES)):Nt.setMode(U.TRIANGLES);else if(H.isLine){let Je=K.linewidth;Je===void 0&&(Je=1),oe.setLineWidth(Je*de()),H.isLineSegments?Nt.setMode(U.LINES):H.isLineLoop?Nt.setMode(U.LINE_LOOP):Nt.setMode(U.LINE_STRIP)}else H.isPoints?Nt.setMode(U.POINTS):H.isSprite&&Nt.setMode(U.TRIANGLES);if(H.isBatchedMesh)if(H._multiDrawInstances!==null)eu("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Nt.renderMultiDrawInstances(H._multiDrawStarts,H._multiDrawCounts,H._multiDrawCount,H._multiDrawInstances);else if(me.get("WEBGL_multi_draw"))Nt.renderMultiDraw(H._multiDrawStarts,H._multiDrawCounts,H._multiDrawCount);else{const Je=H._multiDrawStarts,rt=H._multiDrawCounts,Et=H._multiDrawCount,An=ke?G.get(ke).bytesPerElement:1,nr=be.get(K).currentProgram.getUniforms();for(let fi=0;fi<Et;fi++)nr.setValue(U,"_gl_DrawID",fi),Nt.render(Je[fi]/An,rt[fi])}else if(H.isInstancedMesh)Nt.renderInstances(bt,Dt,H.count);else if(q.isInstancedBufferGeometry){const Je=q._maxInstanceCount!==void 0?q._maxInstanceCount:1/0,rt=Math.min(q.instanceCount,Je);Nt.renderInstances(bt,Dt,rt)}else Nt.render(bt,Dt)};function tr(N,z,q){N.transparent===!0&&N.side===jr&&N.forceSinglePass===!1?(N.side=vi,N.needsUpdate=!0,Ys(N,z,q),N.side=Gs,N.needsUpdate=!0,Ys(N,z,q),N.side=jr):Ys(N,z,q)}this.compile=function(N,z,q=null){q===null&&(q=N),v=Xe.get(q),v.init(z),R.push(v),q.traverseVisible(function(H){H.isLight&&H.layers.test(z.layers)&&(v.pushLight(H),H.castShadow&&v.pushShadow(H))}),N!==q&&N.traverseVisible(function(H){H.isLight&&H.layers.test(z.layers)&&(v.pushLight(H),H.castShadow&&v.pushShadow(H))}),v.setupLights();const K=new Set;return N.traverse(function(H){if(!(H.isMesh||H.isPoints||H.isLine||H.isSprite))return;const xe=H.material;if(xe)if(Array.isArray(xe))for(let Re=0;Re<xe.length;Re++){const Be=xe[Re];tr(Be,q,H),K.add(Be)}else tr(xe,q,H),K.add(xe)}),v=R.pop(),K},this.compileAsync=function(N,z,q=null){const K=this.compile(N,z,q);return new Promise(H=>{function xe(){if(K.forEach(function(Re){be.get(Re).currentProgram.isReady()&&K.delete(Re)}),K.size===0){H(N);return}setTimeout(xe,10)}me.get("KHR_parallel_shader_compile")!==null?xe():setTimeout(xe,10)})};let Fi=null;function Al(N){Fi&&Fi(N)}function vu(){pr.stop()}function Su(){pr.start()}const pr=new FD;pr.setAnimationLoop(Al),typeof self<"u"&&pr.setContext(self),this.setAnimationLoop=function(N){Fi=N,pe.setAnimationLoop(N),N===null?pr.stop():pr.start()},pe.addEventListener("sessionstart",vu),pe.addEventListener("sessionend",Su),this.render=function(N,z){if(z!==void 0&&z.isCamera!==!0){lt("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(A===!0)return;if(N.matrixWorldAutoUpdate===!0&&N.updateMatrixWorld(),z.parent===null&&z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),pe.enabled===!0&&pe.isPresenting===!0&&(pe.cameraAutoUpdate===!0&&pe.updateCamera(z),z=pe.getCamera()),N.isScene===!0&&N.onBeforeRender(C,N,z,S),v=Xe.get(N,R.length),v.init(z),R.push(v),Ye.multiplyMatrices(z.projectionMatrix,z.matrixWorldInverse),ne.setFromProjectionMatrix(Ye,ji,z.reversedDepth),Ne=this.localClippingEnabled,se=He.init(this.clippingPlanes,Ne),x=Me.get(N,T.length),x.init(),T.push(x),pe.enabled===!0&&pe.isPresenting===!0){const xe=C.xr.getDepthSensingMesh();xe!==null&&fs(xe,z,-1/0,C.sortObjects)}fs(N,z,0,C.sortObjects),x.finish(),C.sortObjects===!0&&x.sort(_e,Ge),tt=pe.enabled===!1||pe.isPresenting===!1||pe.hasDepthSensing()===!1,tt&&Se.addToRenderList(x,N),this.info.render.frame++,se===!0&&He.beginShadows();const q=v.state.shadowsArray;ue.render(q,N,z),se===!0&&He.endShadows(),this.info.autoReset===!0&&this.info.reset();const K=x.opaque,H=x.transmissive;if(v.setupLights(),z.isArrayCamera){const xe=z.cameras;if(H.length>0)for(let Re=0,Be=xe.length;Re<Be;Re++){const ke=xe[Re];mr(K,H,N,ke)}tt&&Se.render(N);for(let Re=0,Be=xe.length;Re<Be;Re++){const ke=xe[Re];nf(x,N,ke,ke.viewport)}}else H.length>0&&mr(K,H,N,z),tt&&Se.render(N),nf(x,N,z);S!==null&&b===0&&(Oe.updateMultisampleRenderTarget(S),Oe.updateRenderTargetMipmap(S)),N.isScene===!0&&N.onAfterRender(C,N,z),V.resetDefaultState(),I=-1,D=null,R.pop(),R.length>0?(v=R[R.length-1],se===!0&&He.setGlobalState(C.clippingPlanes,v.state.camera)):v=null,T.pop(),T.length>0?x=T[T.length-1]:x=null};function fs(N,z,q,K){if(N.visible===!1)return;if(N.layers.test(z.layers)){if(N.isGroup)q=N.renderOrder;else if(N.isLOD)N.autoUpdate===!0&&N.update(z);else if(N.isLight)v.pushLight(N),N.castShadow&&v.pushShadow(N);else if(N.isSprite){if(!N.frustumCulled||ne.intersectsSprite(N)){K&&vt.setFromMatrixPosition(N.matrixWorld).applyMatrix4(Ye);const Re=le.update(N),Be=N.material;Be.visible&&x.push(N,Re,Be,q,vt.z,null)}}else if((N.isMesh||N.isLine||N.isPoints)&&(!N.frustumCulled||ne.intersectsObject(N))){const Re=le.update(N),Be=N.material;if(K&&(N.boundingSphere!==void 0?(N.boundingSphere===null&&N.computeBoundingSphere(),vt.copy(N.boundingSphere.center)):(Re.boundingSphere===null&&Re.computeBoundingSphere(),vt.copy(Re.boundingSphere.center)),vt.applyMatrix4(N.matrixWorld).applyMatrix4(Ye)),Array.isArray(Be)){const ke=Re.groups;for(let et=0,it=ke.length;et<it;et++){const Ke=ke[et],bt=Be[Ke.materialIndex];bt&&bt.visible&&x.push(N,Re,bt,q,vt.z,Ke)}}else Be.visible&&x.push(N,Re,Be,q,vt.z,null)}}const xe=N.children;for(let Re=0,Be=xe.length;Re<Be;Re++)fs(xe[Re],z,q,K)}function nf(N,z,q,K){const{opaque:H,transmissive:xe,transparent:Re}=N;v.setupLightsView(q),se===!0&&He.setGlobalState(C.clippingPlanes,q),K&&oe.viewport(P.copy(K)),H.length>0&&fo(H,z,q),xe.length>0&&fo(xe,z,q),Re.length>0&&fo(Re,z,q),oe.buffers.depth.setTest(!0),oe.buffers.depth.setMask(!0),oe.buffers.color.setMask(!0),oe.setPolygonOffset(!1)}function mr(N,z,q,K){if((q.isScene===!0?q.overrideMaterial:null)!==null)return;v.state.transmissionRenderTarget[K.id]===void 0&&(v.state.transmissionRenderTarget[K.id]=new kr(1,1,{generateMipmaps:!0,type:me.has("EXT_color_buffer_half_float")||me.has("EXT_color_buffer_float")?bl:Or,minFilter:Yr,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Lt.workingColorSpace}));const xe=v.state.transmissionRenderTarget[K.id],Re=K.viewport||P;xe.setSize(Re.z*C.transmissionResolutionScale,Re.w*C.transmissionResolutionScale);const Be=C.getRenderTarget(),ke=C.getActiveCubeFace(),et=C.getActiveMipmapLevel();C.setRenderTarget(xe),C.getClearColor(Z),fe=C.getClearAlpha(),fe<1&&C.setClearColor(16777215,.5),C.clear(),tt&&Se.render(q);const it=C.toneMapping;C.toneMapping=Ls;const Ke=K.viewport;if(K.viewport!==void 0&&(K.viewport=void 0),v.setupLightsView(K),se===!0&&He.setGlobalState(C.clippingPlanes,K),fo(N,q,K),Oe.updateMultisampleRenderTarget(xe),Oe.updateRenderTargetMipmap(xe),me.has("WEBGL_multisampled_render_to_texture")===!1){let bt=!1;for(let Tt=0,Dt=z.length;Tt<Dt;Tt++){const Wt=z[Tt],{object:Nt,geometry:Je,material:rt,group:Et}=Wt;if(rt.side===jr&&Nt.layers.test(K.layers)){const An=rt.side;rt.side=vi,rt.needsUpdate=!0,bu(Nt,q,K,Je,rt,Et),rt.side=An,rt.needsUpdate=!0,bt=!0}}bt===!0&&(Oe.updateMultisampleRenderTarget(xe),Oe.updateRenderTargetMipmap(xe))}C.setRenderTarget(Be,ke,et),C.setClearColor(Z,fe),Ke!==void 0&&(K.viewport=Ke),C.toneMapping=it}function fo(N,z,q){const K=z.isScene===!0?z.overrideMaterial:null;for(let H=0,xe=N.length;H<xe;H++){const Re=N[H],{object:Be,geometry:ke,group:et}=Re;let it=Re.material;it.allowOverride===!0&&K!==null&&(it=K),Be.layers.test(q.layers)&&bu(Be,z,q,ke,it,et)}}function bu(N,z,q,K,H,xe){N.onBeforeRender(C,z,q,K,H,xe),N.modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,N.matrixWorld),N.normalMatrix.getNormalMatrix(N.modelViewMatrix),H.onBeforeRender(C,z,q,K,N,xe),H.transparent===!0&&H.side===jr&&H.forceSinglePass===!1?(H.side=vi,H.needsUpdate=!0,C.renderBufferDirect(q,z,K,H,N,xe),H.side=Gs,H.needsUpdate=!0,C.renderBufferDirect(q,z,K,H,N,xe),H.side=jr):C.renderBufferDirect(q,z,K,H,N,xe),N.onAfterRender(C,z,q,K,H,xe)}function Ys(N,z,q){z.isScene!==!0&&(z=Bt);const K=be.get(N),H=v.state.lights,xe=v.state.shadowsArray,Re=H.state.version,Be=J.getParameters(N,H.state,xe,z,q),ke=J.getProgramCacheKey(Be);let et=K.programs;K.environment=N.isMeshStandardMaterial?z.environment:null,K.fog=z.fog,K.envMap=(N.isMeshStandardMaterial?L:k).get(N.envMap||K.environment),K.envMapRotation=K.environment!==null&&N.envMap===null?z.environmentRotation:N.envMapRotation,et===void 0&&(N.addEventListener("dispose",ut),et=new Map,K.programs=et);let it=et.get(ke);if(it!==void 0){if(K.currentProgram===it&&K.lightsStateVersion===Re)return wu(N,Be),it}else Be.uniforms=J.getUniforms(N),N.onBeforeCompile(Be,C),it=J.acquireProgram(Be,ke),et.set(ke,it),K.uniforms=Be.uniforms;const Ke=K.uniforms;return(!N.isShaderMaterial&&!N.isRawShaderMaterial||N.clipping===!0)&&(Ke.clippingPlanes=He.uniform),wu(N,Be),K.needsLights=xy(N),K.lightsStateVersion=Re,K.needsLights&&(Ke.ambientLightColor.value=H.state.ambient,Ke.lightProbe.value=H.state.probe,Ke.directionalLights.value=H.state.directional,Ke.directionalLightShadows.value=H.state.directionalShadow,Ke.spotLights.value=H.state.spot,Ke.spotLightShadows.value=H.state.spotShadow,Ke.rectAreaLights.value=H.state.rectArea,Ke.ltc_1.value=H.state.rectAreaLTC1,Ke.ltc_2.value=H.state.rectAreaLTC2,Ke.pointLights.value=H.state.point,Ke.pointLightShadows.value=H.state.pointShadow,Ke.hemisphereLights.value=H.state.hemi,Ke.directionalShadowMap.value=H.state.directionalShadowMap,Ke.directionalShadowMatrix.value=H.state.directionalShadowMatrix,Ke.spotShadowMap.value=H.state.spotShadowMap,Ke.spotLightMatrix.value=H.state.spotLightMatrix,Ke.spotLightMap.value=H.state.spotLightMap,Ke.pointShadowMap.value=H.state.pointShadowMap,Ke.pointShadowMatrix.value=H.state.pointShadowMatrix),K.currentProgram=it,K.uniformsList=null,it}function Ml(N){if(N.uniformsList===null){const z=N.currentProgram.getUniforms();N.uniformsList=rm.seqWithValue(z.seq,N.uniforms)}return N.uniformsList}function wu(N,z){const q=be.get(N);q.outputColorSpace=z.outputColorSpace,q.batching=z.batching,q.batchingColor=z.batchingColor,q.instancing=z.instancing,q.instancingColor=z.instancingColor,q.instancingMorph=z.instancingMorph,q.skinning=z.skinning,q.morphTargets=z.morphTargets,q.morphNormals=z.morphNormals,q.morphColors=z.morphColors,q.morphTargetsCount=z.morphTargetsCount,q.numClippingPlanes=z.numClippingPlanes,q.numIntersection=z.numClipIntersection,q.vertexAlphas=z.vertexAlphas,q.vertexTangents=z.vertexTangents,q.toneMapping=z.toneMapping}function _y(N,z,q,K,H){z.isScene!==!0&&(z=Bt),Oe.resetTextureUnits();const xe=z.fog,Re=K.isMeshStandardMaterial?z.environment:null,Be=S===null?C.outputColorSpace:S.isXRRenderTarget===!0?S.texture.colorSpace:cl,ke=(K.isMeshStandardMaterial?L:k).get(K.envMap||Re),et=K.vertexColors===!0&&!!q.attributes.color&&q.attributes.color.itemSize===4,it=!!q.attributes.tangent&&(!!K.normalMap||K.anisotropy>0),Ke=!!q.morphAttributes.position,bt=!!q.morphAttributes.normal,Tt=!!q.morphAttributes.color;let Dt=Ls;K.toneMapped&&(S===null||S.isXRRenderTarget===!0)&&(Dt=C.toneMapping);const Wt=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,Nt=Wt!==void 0?Wt.length:0,Je=be.get(K),rt=v.state.lights;if(se===!0&&(Ne===!0||N!==D)){const Bn=N===D&&K.id===I;He.setState(K,N,Bn)}let Et=!1;K.version===Je.__version?(Je.needsLights&&Je.lightsStateVersion!==rt.state.version||Je.outputColorSpace!==Be||H.isBatchedMesh&&Je.batching===!1||!H.isBatchedMesh&&Je.batching===!0||H.isBatchedMesh&&Je.batchingColor===!0&&H.colorTexture===null||H.isBatchedMesh&&Je.batchingColor===!1&&H.colorTexture!==null||H.isInstancedMesh&&Je.instancing===!1||!H.isInstancedMesh&&Je.instancing===!0||H.isSkinnedMesh&&Je.skinning===!1||!H.isSkinnedMesh&&Je.skinning===!0||H.isInstancedMesh&&Je.instancingColor===!0&&H.instanceColor===null||H.isInstancedMesh&&Je.instancingColor===!1&&H.instanceColor!==null||H.isInstancedMesh&&Je.instancingMorph===!0&&H.morphTexture===null||H.isInstancedMesh&&Je.instancingMorph===!1&&H.morphTexture!==null||Je.envMap!==ke||K.fog===!0&&Je.fog!==xe||Je.numClippingPlanes!==void 0&&(Je.numClippingPlanes!==He.numPlanes||Je.numIntersection!==He.numIntersection)||Je.vertexAlphas!==et||Je.vertexTangents!==it||Je.morphTargets!==Ke||Je.morphNormals!==bt||Je.morphColors!==Tt||Je.toneMapping!==Dt||Je.morphTargetsCount!==Nt)&&(Et=!0):(Et=!0,Je.__version=K.version);let An=Je.currentProgram;Et===!0&&(An=Ys(K,z,H));let nr=!1,fi=!1,Js=!1;const Yt=An.getUniforms(),Yn=Je.uniforms;if(oe.useProgram(An.program)&&(nr=!0,fi=!0,Js=!0),K.id!==I&&(I=K.id,fi=!0),nr||D!==N){oe.buffers.depth.getReversed()&&N.reversedDepth!==!0&&(N._reversedDepth=!0,N.updateProjectionMatrix()),Yt.setValue(U,"projectionMatrix",N.projectionMatrix),Yt.setValue(U,"viewMatrix",N.matrixWorldInverse);const xn=Yt.map.cameraPosition;xn!==void 0&&xn.setValue(U,We.setFromMatrixPosition(N.matrixWorld)),ve.logarithmicDepthBuffer&&Yt.setValue(U,"logDepthBufFC",2/(Math.log(N.far+1)/Math.LN2)),(K.isMeshPhongMaterial||K.isMeshToonMaterial||K.isMeshLambertMaterial||K.isMeshBasicMaterial||K.isMeshStandardMaterial||K.isShaderMaterial)&&Yt.setValue(U,"isOrthographic",N.isOrthographicCamera===!0),D!==N&&(D=N,fi=!0,Js=!0)}if(H.isSkinnedMesh){Yt.setOptional(U,H,"bindMatrix"),Yt.setOptional(U,H,"bindMatrixInverse");const Bn=H.skeleton;Bn&&(Bn.boneTexture===null&&Bn.computeBoneTexture(),Yt.setValue(U,"boneTexture",Bn.boneTexture,Oe))}H.isBatchedMesh&&(Yt.setOptional(U,H,"batchingTexture"),Yt.setValue(U,"batchingTexture",H._matricesTexture,Oe),Yt.setOptional(U,H,"batchingIdTexture"),Yt.setValue(U,"batchingIdTexture",H._indirectTexture,Oe),Yt.setOptional(U,H,"batchingColorTexture"),H._colorsTexture!==null&&Yt.setValue(U,"batchingColorTexture",H._colorsTexture,Oe));const Ti=q.morphAttributes;if((Ti.position!==void 0||Ti.normal!==void 0||Ti.color!==void 0)&&Qe.update(H,q,An),(fi||Je.receiveShadow!==H.receiveShadow)&&(Je.receiveShadow=H.receiveShadow,Yt.setValue(U,"receiveShadow",H.receiveShadow)),K.isMeshGouraudMaterial&&K.envMap!==null&&(Yn.envMap.value=ke,Yn.flipEnvMap.value=ke.isCubeTexture&&ke.isRenderTargetTexture===!1?-1:1),K.isMeshStandardMaterial&&K.envMap===null&&z.environment!==null&&(Yn.envMapIntensity.value=z.environmentIntensity),Yn.dfgLUT!==void 0&&(Yn.dfgLUT.value=ZK()),fi&&(Yt.setValue(U,"toneMappingExposure",C.toneMappingExposure),Je.needsLights&&rf(Yn,Js),xe&&K.fog===!0&&$e.refreshFogUniforms(Yn,xe),$e.refreshMaterialUniforms(Yn,K,ee,X,v.state.transmissionRenderTarget[N.id]),rm.upload(U,Ml(Je),Yn,Oe)),K.isShaderMaterial&&K.uniformsNeedUpdate===!0&&(rm.upload(U,Ml(Je),Yn,Oe),K.uniformsNeedUpdate=!1),K.isSpriteMaterial&&Yt.setValue(U,"center",H.center),Yt.setValue(U,"modelViewMatrix",H.modelViewMatrix),Yt.setValue(U,"normalMatrix",H.normalMatrix),Yt.setValue(U,"modelMatrix",H.matrixWorld),K.isShaderMaterial||K.isRawShaderMaterial){const Bn=K.uniformsGroups;for(let xn=0,gr=Bn.length;xn<gr;xn++){const Fr=Bn[xn];Ee.update(Fr,An),Ee.bind(Fr,An)}}return An}function rf(N,z){N.ambientLightColor.needsUpdate=z,N.lightProbe.needsUpdate=z,N.directionalLights.needsUpdate=z,N.directionalLightShadows.needsUpdate=z,N.pointLights.needsUpdate=z,N.pointLightShadows.needsUpdate=z,N.spotLights.needsUpdate=z,N.spotLightShadows.needsUpdate=z,N.rectAreaLights.needsUpdate=z,N.hemisphereLights.needsUpdate=z}function xy(N){return N.isMeshLambertMaterial||N.isMeshToonMaterial||N.isMeshPhongMaterial||N.isMeshStandardMaterial||N.isShadowMaterial||N.isShaderMaterial&&N.lights===!0}this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(N,z,q){const K=be.get(N);K.__autoAllocateDepthBuffer=N.resolveDepthBuffer===!1,K.__autoAllocateDepthBuffer===!1&&(K.__useRenderToTexture=!1),be.get(N.texture).__webglTexture=z,be.get(N.depthTexture).__webglTexture=K.__autoAllocateDepthBuffer?void 0:q,K.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(N,z){const q=be.get(N);q.__webglFramebuffer=z,q.__useDefaultFramebuffer=z===void 0};const Cl=U.createFramebuffer();this.setRenderTarget=function(N,z=0,q=0){S=N,E=z,b=q;let K=!0,H=null,xe=!1,Re=!1;if(N){const ke=be.get(N);if(ke.__useDefaultFramebuffer!==void 0)oe.bindFramebuffer(U.FRAMEBUFFER,null),K=!1;else if(ke.__webglFramebuffer===void 0)Oe.setupRenderTarget(N);else if(ke.__hasExternalTextures)Oe.rebindTextures(N,be.get(N.texture).__webglTexture,be.get(N.depthTexture).__webglTexture);else if(N.depthBuffer){const Ke=N.depthTexture;if(ke.__boundDepthTexture!==Ke){if(Ke!==null&&be.has(Ke)&&(N.width!==Ke.image.width||N.height!==Ke.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Oe.setupDepthRenderbuffer(N)}}const et=N.texture;(et.isData3DTexture||et.isDataArrayTexture||et.isCompressedArrayTexture)&&(Re=!0);const it=be.get(N).__webglFramebuffer;N.isWebGLCubeRenderTarget?(Array.isArray(it[z])?H=it[z][q]:H=it[z],xe=!0):N.samples>0&&Oe.useMultisampledRTT(N)===!1?H=be.get(N).__webglMultisampledFramebuffer:Array.isArray(it)?H=it[q]:H=it,P.copy(N.viewport),$.copy(N.scissor),Y=N.scissorTest}else P.copy(ft).multiplyScalar(ee).floor(),$.copy(pt).multiplyScalar(ee).floor(),Y=wt;if(q!==0&&(H=Cl),oe.bindFramebuffer(U.FRAMEBUFFER,H)&&K&&oe.drawBuffers(N,H),oe.viewport(P),oe.scissor($),oe.setScissorTest(Y),xe){const ke=be.get(N.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+z,ke.__webglTexture,q)}else if(Re){const ke=z;for(let et=0;et<N.textures.length;et++){const it=be.get(N.textures[et]);U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0+et,it.__webglTexture,q,ke)}}else if(N!==null&&q!==0){const ke=be.get(N.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,ke.__webglTexture,q)}I=-1},this.readRenderTargetPixels=function(N,z,q,K,H,xe,Re,Be=0){if(!(N&&N.isWebGLRenderTarget)){lt("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ke=be.get(N).__webglFramebuffer;if(N.isWebGLCubeRenderTarget&&Re!==void 0&&(ke=ke[Re]),ke){oe.bindFramebuffer(U.FRAMEBUFFER,ke);try{const et=N.textures[Be],it=et.format,Ke=et.type;if(!ve.textureFormatReadable(it)){lt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!ve.textureTypeReadable(Ke)){lt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}z>=0&&z<=N.width-K&&q>=0&&q<=N.height-H&&(N.textures.length>1&&U.readBuffer(U.COLOR_ATTACHMENT0+Be),U.readPixels(z,q,K,H,nt.convert(it),nt.convert(Ke),xe))}finally{const et=S!==null?be.get(S).__webglFramebuffer:null;oe.bindFramebuffer(U.FRAMEBUFFER,et)}}},this.readRenderTargetPixelsAsync=async function(N,z,q,K,H,xe,Re,Be=0){if(!(N&&N.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ke=be.get(N).__webglFramebuffer;if(N.isWebGLCubeRenderTarget&&Re!==void 0&&(ke=ke[Re]),ke)if(z>=0&&z<=N.width-K&&q>=0&&q<=N.height-H){oe.bindFramebuffer(U.FRAMEBUFFER,ke);const et=N.textures[Be],it=et.format,Ke=et.type;if(!ve.textureFormatReadable(it))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!ve.textureTypeReadable(Ke))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const bt=U.createBuffer();U.bindBuffer(U.PIXEL_PACK_BUFFER,bt),U.bufferData(U.PIXEL_PACK_BUFFER,xe.byteLength,U.STREAM_READ),N.textures.length>1&&U.readBuffer(U.COLOR_ATTACHMENT0+Be),U.readPixels(z,q,K,H,nt.convert(it),nt.convert(Ke),0);const Tt=S!==null?be.get(S).__webglFramebuffer:null;oe.bindFramebuffer(U.FRAMEBUFFER,Tt);const Dt=U.fenceSync(U.SYNC_GPU_COMMANDS_COMPLETE,0);return U.flush(),await pG(U,Dt,4),U.bindBuffer(U.PIXEL_PACK_BUFFER,bt),U.getBufferSubData(U.PIXEL_PACK_BUFFER,0,xe),U.deleteBuffer(bt),U.deleteSync(Dt),xe}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(N,z=null,q=0){const K=Math.pow(2,-q),H=Math.floor(N.image.width*K),xe=Math.floor(N.image.height*K),Re=z!==null?z.x:0,Be=z!==null?z.y:0;Oe.setTexture2D(N,0),U.copyTexSubImage2D(U.TEXTURE_2D,q,0,0,Re,Be,H,xe),oe.unbindTexture()};const sf=U.createFramebuffer(),Tu=U.createFramebuffer();this.copyTextureToTexture=function(N,z,q=null,K=null,H=0,xe=null){xe===null&&(H!==0?(eu("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),xe=H,H=0):xe=0);let Re,Be,ke,et,it,Ke,bt,Tt,Dt;const Wt=N.isCompressedTexture?N.mipmaps[xe]:N.image;if(q!==null)Re=q.max.x-q.min.x,Be=q.max.y-q.min.y,ke=q.isBox3?q.max.z-q.min.z:1,et=q.min.x,it=q.min.y,Ke=q.isBox3?q.min.z:0;else{const Ti=Math.pow(2,-H);Re=Math.floor(Wt.width*Ti),Be=Math.floor(Wt.height*Ti),N.isDataArrayTexture?ke=Wt.depth:N.isData3DTexture?ke=Math.floor(Wt.depth*Ti):ke=1,et=0,it=0,Ke=0}K!==null?(bt=K.x,Tt=K.y,Dt=K.z):(bt=0,Tt=0,Dt=0);const Nt=nt.convert(z.format),Je=nt.convert(z.type);let rt;z.isData3DTexture?(Oe.setTexture3D(z,0),rt=U.TEXTURE_3D):z.isDataArrayTexture||z.isCompressedArrayTexture?(Oe.setTexture2DArray(z,0),rt=U.TEXTURE_2D_ARRAY):(Oe.setTexture2D(z,0),rt=U.TEXTURE_2D),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,z.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,z.unpackAlignment);const Et=U.getParameter(U.UNPACK_ROW_LENGTH),An=U.getParameter(U.UNPACK_IMAGE_HEIGHT),nr=U.getParameter(U.UNPACK_SKIP_PIXELS),fi=U.getParameter(U.UNPACK_SKIP_ROWS),Js=U.getParameter(U.UNPACK_SKIP_IMAGES);U.pixelStorei(U.UNPACK_ROW_LENGTH,Wt.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,Wt.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,et),U.pixelStorei(U.UNPACK_SKIP_ROWS,it),U.pixelStorei(U.UNPACK_SKIP_IMAGES,Ke);const Yt=N.isDataArrayTexture||N.isData3DTexture,Yn=z.isDataArrayTexture||z.isData3DTexture;if(N.isDepthTexture){const Ti=be.get(N),Bn=be.get(z),xn=be.get(Ti.__renderTarget),gr=be.get(Bn.__renderTarget);oe.bindFramebuffer(U.READ_FRAMEBUFFER,xn.__webglFramebuffer),oe.bindFramebuffer(U.DRAW_FRAMEBUFFER,gr.__webglFramebuffer);for(let Fr=0;Fr<ke;Fr++)Yt&&(U.framebufferTextureLayer(U.READ_FRAMEBUFFER,U.COLOR_ATTACHMENT0,be.get(N).__webglTexture,H,Ke+Fr),U.framebufferTextureLayer(U.DRAW_FRAMEBUFFER,U.COLOR_ATTACHMENT0,be.get(z).__webglTexture,xe,Dt+Fr)),U.blitFramebuffer(et,it,Re,Be,bt,Tt,Re,Be,U.DEPTH_BUFFER_BIT,U.NEAREST);oe.bindFramebuffer(U.READ_FRAMEBUFFER,null),oe.bindFramebuffer(U.DRAW_FRAMEBUFFER,null)}else if(H!==0||N.isRenderTargetTexture||be.has(N)){const Ti=be.get(N),Bn=be.get(z);oe.bindFramebuffer(U.READ_FRAMEBUFFER,sf),oe.bindFramebuffer(U.DRAW_FRAMEBUFFER,Tu);for(let xn=0;xn<ke;xn++)Yt?U.framebufferTextureLayer(U.READ_FRAMEBUFFER,U.COLOR_ATTACHMENT0,Ti.__webglTexture,H,Ke+xn):U.framebufferTexture2D(U.READ_FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,Ti.__webglTexture,H),Yn?U.framebufferTextureLayer(U.DRAW_FRAMEBUFFER,U.COLOR_ATTACHMENT0,Bn.__webglTexture,xe,Dt+xn):U.framebufferTexture2D(U.DRAW_FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,Bn.__webglTexture,xe),H!==0?U.blitFramebuffer(et,it,Re,Be,bt,Tt,Re,Be,U.COLOR_BUFFER_BIT,U.NEAREST):Yn?U.copyTexSubImage3D(rt,xe,bt,Tt,Dt+xn,et,it,Re,Be):U.copyTexSubImage2D(rt,xe,bt,Tt,et,it,Re,Be);oe.bindFramebuffer(U.READ_FRAMEBUFFER,null),oe.bindFramebuffer(U.DRAW_FRAMEBUFFER,null)}else Yn?N.isDataTexture||N.isData3DTexture?U.texSubImage3D(rt,xe,bt,Tt,Dt,Re,Be,ke,Nt,Je,Wt.data):z.isCompressedArrayTexture?U.compressedTexSubImage3D(rt,xe,bt,Tt,Dt,Re,Be,ke,Nt,Wt.data):U.texSubImage3D(rt,xe,bt,Tt,Dt,Re,Be,ke,Nt,Je,Wt):N.isDataTexture?U.texSubImage2D(U.TEXTURE_2D,xe,bt,Tt,Re,Be,Nt,Je,Wt.data):N.isCompressedTexture?U.compressedTexSubImage2D(U.TEXTURE_2D,xe,bt,Tt,Wt.width,Wt.height,Nt,Wt.data):U.texSubImage2D(U.TEXTURE_2D,xe,bt,Tt,Re,Be,Nt,Je,Wt);U.pixelStorei(U.UNPACK_ROW_LENGTH,Et),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,An),U.pixelStorei(U.UNPACK_SKIP_PIXELS,nr),U.pixelStorei(U.UNPACK_SKIP_ROWS,fi),U.pixelStorei(U.UNPACK_SKIP_IMAGES,Js),xe===0&&z.generateMipmaps&&U.generateMipmap(rt),oe.unbindTexture()},this.initRenderTarget=function(N){be.get(N).__webglFramebuffer===void 0&&Oe.setupRenderTarget(N)},this.initTexture=function(N){N.isCubeTexture?Oe.setTextureCube(N,0):N.isData3DTexture?Oe.setTexture3D(N,0):N.isDataArrayTexture||N.isCompressedArrayTexture?Oe.setTexture2DArray(N,0):Oe.setTexture2D(N,0),oe.unbindTexture()},this.resetState=function(){E=0,b=0,S=null,oe.reset(),V.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ji}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Lt._getDrawingBufferColorSpace(e),t.unpackColorSpace=Lt._getUnpackColorSpace()}}const yJ=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:_L,AddEquation:ba,AddOperation:pL,AdditiveAnimationBlendMode:uw,AdditiveBlending:$v,AgXToneMapping:vL,AlphaFormat:lw,AlwaysCompare:OL,AlwaysDepth:rg,AlwaysStencilFunc:Kv,AmbientLight:Uw,AnimationAction:kD,AnimationClip:Ad,AnimationLoader:r7,AnimationMixer:D7,AnimationObjectGroup:P7,AnimationUtils:e7,ArcCurve:eD,ArrayCamera:LD,ArrowHelper:a$,AttachedBindMode:Xv,Audio:ND,AudioAnalyser:S7,AudioContext:Fw,AudioListener:_7,AudioLoader:m7,AxesHelper:o$,BackSide:vi,BasicDepthPacking:AL,BasicShadowMap:CH,BatchedMesh:KL,Bone:yw,BooleanKeyframeTrack:Tl,Box2:W7,Box3:ci,Box3Helper:r$,BoxGeometry:wl,BoxHelper:i$,BufferAttribute:$t,BufferGeometry:yt,BufferGeometryLoader:PD,ByteType:rw,Cache:Jr,Camera:q0,CameraHelper:n$,CanvasTexture:wW,CapsuleGeometry:ey,CatmullRomCurve3:tD,CineonToneMapping:yL,CircleGeometry:ty,ClampToEdgeWrapping:Pi,Clock:DD,Color:De,ColorKeyframeTrack:Lw,ColorManagement:Lt,CompressedArrayTexture:SW,CompressedCubeTexture:bW,CompressedTexture:Q0,CompressedTextureLoader:s7,ConeGeometry:Zd,ConstantAlphaFactor:hL,ConstantColorFactor:cL,Controls:c$,CubeCamera:HL,CubeReflectionMapping:Ws,CubeRefractionMapping:to,CubeTexture:Yd,CubeTextureLoader:a7,CubeUVReflectionMapping:mu,CubicBezierCurve:bw,CubicBezierCurve3:nD,CubicInterpolant:SD,CullFaceBack:Wv,CullFaceFront:j3,CullFaceFrontBack:MH,CullFaceNone:q3,Curve:Ur,CurvePath:rD,CustomBlending:K3,CustomToneMapping:xL,CylinderGeometry:Jd,Cylindrical:G7,Data3DTexture:W0,DataArrayTexture:G0,DataTexture:Lr,DataTextureLoader:o7,DataUtils:qG,DecrementStencilOp:HH,DecrementWrapStencilOp:WH,DefaultLoadingManager:TD,DepthFormat:Jc,DepthStencilFormat:Zc,DepthTexture:xw,DetachedBindMode:bL,DirectionalLight:kw,DirectionalLightHelper:t$,DiscreteInterpolant:bD,DodecahedronGeometry:ny,DoubleSide:jr,DstAlphaFactor:rL,DstColorFactor:aL,DynamicCopyUsage:sG,DynamicDrawUsage:QH,DynamicReadUsage:nG,EdgesGeometry:QL,EllipseCurve:iy,EqualCompare:PL,EqualDepth:ag,EqualStencilFunc:XH,EquirectangularReflectionMapping:hd,EquirectangularRefractionMapping:dd,Euler:Ji,EventDispatcher:hs,ExternalTexture:vw,ExtrudeGeometry:ry,FileLoader:qs,Float16BufferAttribute:QG,Float32BufferAttribute:ze,FloatType:Li,Fog:X0,FogExp2:j0,FramebufferTexture:vW,FrontSide:Gs,Frustum:yu,FrustumArray:Z0,GLBufferAttribute:F7,GLSL1:oG,GLSL3:Yv,GreaterCompare:LL,GreaterDepth:lg,GreaterEqualCompare:NL,GreaterEqualDepth:og,GreaterEqualStencilFunc:ZH,GreaterStencilFunc:YH,GridHelper:Q7,Group:Sc,HalfFloatType:bl,HemisphereLight:Nw,HemisphereLightHelper:Z7,IcosahedronGeometry:sy,ImageBitmapLoader:p7,ImageLoader:Md,ImageUtils:FL,IncrementStencilOp:zH,IncrementWrapStencilOp:GH,InstancedBufferAttribute:iu,InstancedBufferGeometry:RD,InstancedInterleavedBuffer:U7,InstancedMesh:XL,Int16BufferAttribute:JG,Int32BufferAttribute:ZG,Int8BufferAttribute:XG,IntType:O0,InterleavedBuffer:Y0,InterleavedBufferAttribute:ul,Interpolant:ef,InterpolateDiscrete:md,InterpolateLinear:Fg,InterpolateSmooth:nm,InterpolationSamplingMode:uG,InterpolationSamplingType:cG,InvertStencilOp:$H,KeepStencilOp:Do,KeyframeTrack:fr,LOD:qL,LatheGeometry:ay,Layers:$0,LessCompare:RL,LessDepth:sg,LessEqualCompare:hw,LessEqualDepth:ll,LessEqualStencilFunc:KH,LessStencilFunc:jH,Light:ho,LightProbe:ID,Line:io,Line3:j7,LineBasicMaterial:wi,LineCurve:ww,LineCurve3:iD,LineDashedMaterial:_D,LineLoop:YL,LineSegments:ds,LinearFilter:sn,LinearInterpolant:Pw,LinearMipMapLinearFilter:LH,LinearMipMapNearestFilter:PH,LinearMipmapLinearFilter:Yr,LinearMipmapNearestFilter:Mh,LinearSRGBColorSpace:cl,LinearToneMapping:mL,LinearTransfer:yd,Loader:Ui,LoaderUtils:tS,LoadingManager:Dw,LoopOnce:wL,LoopPingPong:EL,LoopRepeat:TL,MOUSE:EH,Material:Kn,MaterialLoader:py,MathUtils:PG,Matrix2:Hw,Matrix3:gt,Matrix4:ot,MaxEquation:Q3,Mesh:tn,MeshBasicMaterial:Pr,MeshDepthMaterial:Cw,MeshDistanceMaterial:Iw,MeshLambertMaterial:gD,MeshMatcapMaterial:yD,MeshNormalMaterial:mD,MeshPhongMaterial:fD,MeshPhysicalMaterial:dD,MeshStandardMaterial:Mw,MeshToonMaterial:pD,MinEquation:Z3,MirroredRepeatWrapping:pd,MixOperation:fL,MultiplyBlending:jv,MultiplyOperation:Xd,NearestFilter:$n,NearestMipMapLinearFilter:RH,NearestMipMapNearestFilter:IH,NearestMipmapLinearFilter:xc,NearestMipmapNearestFilter:iw,NeutralToneMapping:SL,NeverCompare:IL,NeverDepth:ig,NeverStencilFunc:qH,NoBlending:os,NoColorSpace:Ts,NoToneMapping:Ls,NormalAnimationBlendMode:H0,NormalBlending:Xo,NotEqualCompare:DL,NotEqualDepth:cg,NotEqualStencilFunc:JH,NumberKeyframeTrack:Td,Object3D:Ft,ObjectLoader:d7,ObjectSpaceNormalMap:CL,OctahedronGeometry:Qd,OneFactor:tL,OneMinusConstantAlphaFactor:dL,OneMinusConstantColorFactor:uL,OneMinusDstAlphaFactor:sL,OneMinusDstColorFactor:oL,OneMinusSrcAlphaFactor:ng,OneMinusSrcColorFactor:iL,OrthographicCamera:fy,PCFShadowMap:nw,PCFSoftShadowMap:X3,PMREMGenerator:rS,Path:Hg,PerspectiveCamera:In,Plane:ma,PlaneGeometry:_u,PlaneHelper:s$,PointLight:AD,PointLightHelper:Y7,Points:JL,PointsMaterial:_w,PolarGridHelper:e$,PolyhedronGeometry:uo,PositionalAudio:v7,PropertyBinding:Ot,PropertyMixer:OD,QuadraticBezierCurve:Tw,QuadraticBezierCurve3:Ew,Quaternion:ki,QuaternionKeyframeTrack:tf,QuaternionLinearInterpolant:wD,RED_GREEN_RGTC2_Format:kg,RED_RGTC1_Format:Ng,REVISION:D0,RGBADepthPacking:ML,RGBAFormat:li,RGBAIntegerFormat:z0,RGBA_ASTC_10x10_Format:Cg,RGBA_ASTC_10x5_Format:Eg,RGBA_ASTC_10x6_Format:Ag,RGBA_ASTC_10x8_Format:Mg,RGBA_ASTC_12x10_Format:Ig,RGBA_ASTC_12x12_Format:Rg,RGBA_ASTC_4x4_Format:yg,RGBA_ASTC_5x4_Format:_g,RGBA_ASTC_5x5_Format:xg,RGBA_ASTC_6x5_Format:vg,RGBA_ASTC_6x6_Format:Sg,RGBA_ASTC_8x5_Format:bg,RGBA_ASTC_8x6_Format:wg,RGBA_ASTC_8x8_Format:Tg,RGBA_BPTC_Format:Pg,RGBA_ETC2_EAC_Format:gg,RGBA_PVRTC_2BPPV1_Format:fg,RGBA_PVRTC_4BPPV1_Format:dg,RGBA_S3TC_DXT1_Format:Ih,RGBA_S3TC_DXT3_Format:Rh,RGBA_S3TC_DXT5_Format:Ph,RGBDepthPacking:UH,RGBFormat:cw,RGBIntegerFormat:DH,RGB_BPTC_SIGNED_Format:Lg,RGB_BPTC_UNSIGNED_Format:Dg,RGB_ETC1_Format:pg,RGB_ETC2_Format:mg,RGB_PVRTC_2BPPV1_Format:hg,RGB_PVRTC_4BPPV1_Format:ug,RGB_S3TC_DXT1_Format:Ch,RGDepthPacking:FH,RGFormat:V0,RGIntegerFormat:B0,RawShaderMaterial:hD,Ray:gu,Raycaster:V7,RectAreaLight:MD,RedFormat:F0,RedIntegerFormat:Kd,ReinhardToneMapping:gL,RenderTarget:fw,RenderTarget3D:N7,RepeatWrapping:fd,ReplaceStencilOp:BH,ReverseSubtractEquation:J3,RingGeometry:oy,SIGNED_RED_GREEN_RGTC2_Format:Ug,SIGNED_RED_RGTC1_Format:Og,SRGBColorSpace:si,SRGBTransfer:Ht,Scene:K0,ShaderChunk:xt,ShaderLib:Tr,ShaderMaterial:Zi,ShadowMaterial:uD,Shape:Yo,ShapeGeometry:ly,ShapePath:l$,ShapeUtils:Mr,ShortType:sw,Skeleton:J0,SkeletonHelper:K7,SkinnedMesh:jL,Source:Ca,Sphere:qn,SphereGeometry:Ns,Spherical:H7,SphericalHarmonics3:CD,SplineCurve:Aw,SpotLight:ED,SpotLightHelper:X7,Sprite:$L,SpriteMaterial:gw,SrcAlphaFactor:tg,SrcAlphaSaturateFactor:lL,SrcColorFactor:nL,StaticCopyUsage:rG,StaticDrawUsage:_d,StaticReadUsage:tG,StereoCamera:g7,StreamCopyUsage:aG,StreamDrawUsage:eG,StreamReadUsage:iG,StringKeyframeTrack:El,SubtractEquation:Y3,SubtractiveBlending:qv,TOUCH:AH,TangentSpaceNormalMap:co,TetrahedronGeometry:cy,Texture:fn,TextureLoader:l7,TextureUtils:p$,Timer:B7,TimestampQuery:lG,TorusGeometry:uy,TorusKnotGeometry:hy,Triangle:Ii,TriangleFanDrawMode:kH,TriangleStripDrawMode:OH,TrianglesDrawMode:NH,TubeGeometry:dy,UVMapping:N0,Uint16BufferAttribute:pw,Uint32BufferAttribute:mw,Uint8BufferAttribute:KG,Uint8ClampedBufferAttribute:YG,Uniform:zw,UniformsGroup:k7,UniformsLib:Ce,UniformsUtils:zL,UnsignedByteType:Or,UnsignedInt101111Type:ow,UnsignedInt248Type:Yc,UnsignedInt5999Type:aw,UnsignedIntType:$s,UnsignedShort4444Type:k0,UnsignedShort5551Type:U0,UnsignedShortType:Kc,VSMShadowMap:Wr,Vector2:ce,Vector3:F,Vector4:kt,VectorKeyframeTrack:Ed,VideoFrameTexture:xW,VideoTexture:ZL,WebGL3DRenderTarget:kG,WebGLArrayRenderTarget:OG,WebGLCoordinateSystem:ji,WebGLCubeRenderTarget:GL,WebGLRenderTarget:kr,WebGLRenderer:WD,WebGLUtils:GD,WebGPUCoordinateSystem:Qc,WebXRController:im,WireframeGeometry:cD,WrapAroundEnding:gd,ZeroCurvatureEnding:Bo,ZeroFactor:eL,ZeroSlopeEnding:zo,ZeroStencilOp:VH,createCanvasElement:UL,error:lt,getConsoleFunction:fG,log:vd,setConsoleFunction:dG,warn:Ie,warnOnce:eu},Symbol.toStringTag,{value:"Module"})),tc={ERROR:1,WARN:2,INFO:3,DEBUG:4,TRACE:5},QK="info",tC="sandbox_logging_filters",nC=["themeswitcher","codemirroreditor","editoradapter"];class eY{constructor(e={}){this.enabled=e.enabled!==!1,this.level=e.level||QK,this.prefix=e.prefix||"",this.component=this.prefix,this.redactSecrets=e.redactSecrets||!1,this.showTimestamp=e.showTimestamp!==!1,this.format=e.format||"[{timestamp}] [{prefix}] {message}",this.currentLevel=tc[this.level.toUpperCase()]??tc.INFO,this.loggingManager=e.loggingManager,this.console=e.console||console,this.component&&this.loggingManager&&this.loggingManager.registerComponent(this.component)}shouldLog(e){if(e.toUpperCase()==="ERROR")return this.enabled&&tc[e.toUpperCase()]<=this.currentLevel;const t=!this.component||!this.loggingManager||this.loggingManager.isComponentEnabled(this.component);return this.enabled&&t&&tc[e.toUpperCase()]<=this.currentLevel}redactArgs(e){return this.redactSecrets?e.map(t=>this.redactValue(t)):e}redactValue(e){if(typeof e=="string")return e.replace(/\b[a-zA-Z0-9_-]{20,}\b/g,"[REDACTED]");if(Array.isArray(e))return e.map(t=>this.redactValue(t));if(e&&typeof e=="object"&&e.constructor===Object){const t={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=this.redactValue(e[i]));return t}return e}getTimestamp(){return new Date().toISOString()}formatMessage(e,...t){const i=this.showTimestamp?this.getTimestamp():"",r=this.prefix;let s=this.format.replace("{timestamp}",i).replace("{prefix}",r).replace("{message}",e);this.showTimestamp||(s=s.replace(/\s*\[?\]\s*/g," ").replace(/\s+/g," ").trim());const a=this.redactArgs(t);return[s,...a]}error(e,...t){this.shouldLog("error")&&this.console.error(...this.formatMessage(e,...t))}warn(e,...t){this.shouldLog("warn")&&this.console.warn(...this.formatMessage(e,...t))}info(e,...t){this.shouldLog("info")&&this.console.info(...this.formatMessage(e,...t))}log(e,...t){this.shouldLog("info")&&this.console.log(...this.formatMessage(e,...t))}debug(e,...t){this.shouldLog("debug")&&this.console.debug(...this.formatMessage(e,...t))}trace(e,...t){if(this.shouldLog("trace")){const i=this.redactSecrets;this.redactSecrets=!0;const r=this.formatMessage(e,...t);this.redactSecrets=i,this.console.trace(...r)}}table(e,t){if(this.shouldLog("info")){const i=this.prefix?`[${this.prefix}]`:"";i&&this.console.log(i),this.console.table(e,t)}}group(e){this.shouldLog("info")&&this.console.group(...this.formatMessage(e))}groupCollapsed(e){this.shouldLog("info")&&this.console.groupCollapsed(...this.formatMessage(e))}groupEnd(){this.shouldLog("info")&&this.console.groupEnd()}time(e){this.shouldLog("debug")&&this.console.time(this.prefix?`[${this.prefix}] ${e}`:e)}timeEnd(e){this.shouldLog("debug")&&this.console.timeEnd(this.prefix?`[${this.prefix}] ${e}`:e)}setLevel(e){this.level=e,this.currentLevel=tc[e.toUpperCase()]??tc.INFO}enable(){this.enabled=!0}disable(){this.enabled=!1}isEnabled(){return this.enabled}}class tY{constructor(e={}){this.storage=e.storage,this.console=e.console||console,this.allowedComponents=new Set,this.globalEnabled=!0,this.allowAll=!1,this.registeredComponents=new Set,this.storage&&this.loadFromStorage()}enable(...e){e.forEach(t=>this.allowedComponents.add(t.toLowerCase())),this.saveToStorage(),this.console.log(" Logging enabled for:",e.join(", "))}disable(...e){e.forEach(t=>this.allowedComponents.delete(t.toLowerCase())),this.saveToStorage(),this.console.log(" Logging disabled for:",e.join(", "))}enableAll(){this.allowAll=!0,this.saveToStorage(),this.console.log(" Logging enabled for ALL components")}disableAll(){this.allowAll=!1,this.allowedComponents.clear(),this.saveToStorage(),this.console.log(" Logging disabled for ALL components (errors still show)")}status(){this.console.log(" Logging Status:"),this.console.log("  Global enabled:",this.globalEnabled),this.console.log("  Allow all:",this.allowAll),this.console.log("  Enabled components:",Array.from(this.allowedComponents).join(", ")||"none")}listComponents(){this.console.log(" Available components to filter:"),Array.from(this.registeredComponents).sort().forEach(e=>{const t=this.isComponentEnabled(e);this.console.log(`  ${t?"":""} ${e}`)})}isComponentEnabled(e){return this.globalEnabled?this.allowAll?!0:this.allowedComponents.has(e.toLowerCase()):!1}registerComponent(e){this.registeredComponents.add(e)}saveToStorage(){if(this.storage)try{const e={allowedComponents:Array.from(this.allowedComponents),allowAll:this.allowAll,globalEnabled:this.globalEnabled};this.storage.setItem(tC,JSON.stringify(e))}catch{}}loadFromStorage(){if(this.storage)try{const e=this.storage.getItem(tC),t=JSON.parse(e||"{}");this.allowedComponents=new Set(t.allowedComponents||[]),this.allowAll=t.allowAll||!1,this.globalEnabled=t.globalEnabled!==!1,e||(this.allowedComponents=new Set(nC))}catch{this.allowedComponents=new Set(nC)}}}class $D{getItem(e){throw new Error("StorageAdapter.getItem must be implemented")}setItem(e,t){throw new Error("StorageAdapter.setItem must be implemented")}removeItem(e){throw new Error("StorageAdapter.removeItem must be implemented")}}class nY extends $D{constructor(){super(),this.storage=new Map}getItem(e){return this.storage.get(e)??null}setItem(e,t){this.storage.set(e,t)}removeItem(e){this.storage.delete(e)}}class iY extends $D{getItem(e){try{return localStorage.getItem(e)}catch{return null}}setItem(e,t){try{localStorage.setItem(e,t)}catch{}}removeItem(e){try{localStorage.removeItem(e)}catch{}}}function rY(){return typeof localStorage<"u"?new iY:new nY}class qD{getGlobal(){throw new Error("GlobalAdapter.getGlobal must be implemented")}setGlobalProperty(e,t){throw new Error("GlobalAdapter.setGlobalProperty must be implemented")}hasGlobalProperty(e){throw new Error("GlobalAdapter.hasGlobalProperty must be implemented")}}class sY extends qD{getGlobal(){return window}setGlobalProperty(e,t){window[e]=t}hasGlobalProperty(e){return e in window}}class aY extends qD{getGlobal(){return globalThis}setGlobalProperty(e,t){globalThis[e]=t}hasGlobalProperty(e){return e in globalThis}}function oY(){return typeof window<"u"?new sY:new aY}const lY=rY(),iC=oY(),No=new tY({storage:lY,console});if(typeof window<"u"){const n={enable:(...e)=>No.enable(...e),disable:(...e)=>No.disable(...e),enableAll:()=>No.enableAll(),disableAll:()=>No.disableAll(),status:()=>No.status(),list:()=>No.listComponents()};iC.setGlobalProperty("logFilter",n),iC.setGlobalProperty("loggerjs",n)}function yy(n={}){return new eY({...n,loggingManager:No})}const Zu=yy({prefix:"ShaderService"}),cY=/#include\s+["<]([^">]+)[">]/g,rC=10;class uY{constructor(){ir(this,"shaders",new Map);ir(this,"rawShaders",new Map);ir(this,"utilityShaders",new Map);ir(this,"loaded",!1);ir(this,"loadingPromise",null)}async loadShaders(){if(!this.loaded)return this.loadingPromise?this.loadingPromise:(this.loadingPromise=this.doLoadShaders(),this.loadingPromise)}async doLoadShaders(){try{const e=await fetch(`/shaders/manifest.json?t=${Date.now()}`);if(!e.ok)throw new Error(`Failed to load shader manifest: ${e.status}`);const t=await e.json(),i=t.shaders.filter(o=>o.utility),r=t.shaders.filter(o=>!o.utility);await this.loadUtilityShaders(i),await this.loadRegularShaders(r),this.loaded=!0;const s=this.utilityShaders.size,a=this.shaders.size;Zu.info(`Loaded ${a} shaders, ${s} utility files`)}catch(e){throw this.loadingPromise=null,Zu.error("Shader loading failed:",e),e}}async loadUtilityShaders(e){const t=`?t=${Date.now()}`,i=e.map(async r=>{const s=r.path.replace(/\\/g,"/"),a=await fetch(`/shaders/${s}${t}`);if(!a.ok)throw new Error(`Failed to load utility shader ${s}: ${a.status}`);const o=await a.text();this.utilityShaders.set(s,o),Zu.debug(`Loaded utility: ${s}`)});await Promise.all(i)}async loadRegularShaders(e){const t=`?t=${Date.now()}`,i=e.map(async r=>{const s=await fetch(`/shaders/${r.path}${t}`);if(!s.ok)throw new Error(`Failed to load shader ${r.name}: ${s.status}`);const a=await s.text();this.rawShaders.set(r.name,a);const o=new Set,l=this.resolveIncludes(a,r.path,0,o);this.shaders.set(r.name,l)});await Promise.all(i)}resolveIncludes(e,t,i,r){if(i>rC)throw Zu.error(`Max include depth exceeded in ${t}`),new Error(`Max include depth (${rC}) exceeded. Check for circular includes.`);return e.replace(cY,(a,o)=>{const l=o.replace(/\\/g,"/");if(r.has(l))return`// === SKIPPED (already included): ${l} ===`;r.add(l);const c=this.utilityShaders.get(l);if(!c)throw Zu.error(`Include not found: ${o} (referenced in ${t})`),new Error(`Include not found: ${o}. Make sure it's in the manifest with utility: true`);const u=this.resolveIncludes(c,o,i+1,r);return`// === BEGIN INCLUDE: ${o} ===
${u}
// === END INCLUDE: ${o} ===`})}get(e){if(!this.loaded)throw new Error("Shaders not loaded. Call loadShaders() first.");const t=this.shaders.get(e);if(!t)throw new Error(`Shader not found: ${e}. Available: ${Array.from(this.shaders.keys()).join(", ")}`);return t}getRaw(e){if(!this.loaded)throw new Error("Shaders not loaded. Call loadShaders() first.");const t=this.rawShaders.get(e);if(!t)throw new Error(`Shader not found: ${e}`);return t}getUtility(e){if(!this.loaded)throw new Error("Shaders not loaded. Call loadShaders() first.");const t=this.utilityShaders.get(e);if(!t)throw new Error(`Utility shader not found: ${e}`);return t}isLoaded(){return this.loaded}getAvailableShaders(){return Array.from(this.shaders.keys())}getAvailableUtilities(){return Array.from(this.utilityShaders.keys())}}const Cd=new uY,dl={SOLAR_RADIUS_AU:.00465047,EARTH_GRAVITY:9.80665,EQUILIBRIUM_TEMP_ALBEDO:0,TEMPERATURE_DEFAULT_FALLBACK:150,TEMPERATURE_UNKNOWN_THRESHOLD:0,RING_COLOR_THRESHOLD_VERY_COLD:120,RING_COLOR_THRESHOLD_COLD:200,RING_COLOR_THRESHOLD_COOL:350,RING_COLOR_THRESHOLD_WARM:600,EARTH_RADIUS_RELATIVE:1,EARTH_MASS_RELATIVE:1,EARTH_DENSITY:5.51,EARTH_EQUILIBRIUM_TEMP:255,HZ_INNER_AU:.95,HZ_OUTER_AU:1.67,COMPARISON_MAX_SIZE:120,COMPARISON_MIN_SIZE:12,COMPARISON_MAX_RADIUS_FACTOR:15};function _J(n,e){if(!n||!e||e===0)return null;const t=n/(e*e);return{gravityMs2:t*dl.EARTH_GRAVITY,gravityEarth:t}}function hY(n,e,t){if(!n||!e||!t)return null;const i=e*dl.SOLAR_RADIUS_AU,r=n*Math.sqrt(i/(2*t));return{temperatureK:Math.round(r),isCalculated:!0,albedo:dl.EQUILIBRIUM_TEMP_ALBEDO}}function dY(n){if(!n||n<=0)return null;const e=Math.sqrt(n)*255;return{temperatureK:Math.round(e),isCalculated:!0,method:"insolation"}}function fY(n){if(n.pl_eqt&&n.pl_eqt>dl.TEMPERATURE_UNKNOWN_THRESHOLD)return{temperatureK:n.pl_eqt,isApproximate:!1,method:"observed"};const e=hY(n.st_teff,n.st_rad,n.pl_orbsmax);if(e)return{temperatureK:e.temperatureK,isApproximate:!0,method:"calculated"};const t=dY(n.pl_insol);return t?{temperatureK:t.temperatureK,isApproximate:!0,method:"insolation"}:{temperatureK:dl.TEMPERATURE_DEFAULT_FALLBACK,isApproximate:!0,method:"fallback"}}function xJ(n){const t=Math.pow(10,n??0),i=Math.sqrt(Math.max(t,.001));return{inner:dl.HZ_INNER_AU*i,outer:dl.HZ_OUTER_AU*i}}const pY=.3,mY=13,gY=.01,yY=1e4,da=200,_Y=250,xY=350,vY=400,aS=800,SY=30,bY={"Gas Giant":"#d4a854","Neptune-like":"#3b8fd9","Sub-Neptune":"#4eb8e0","Super-Earth":"#b5885a","Earth-sized":"#5a9668","Sub-Earth":"#c4623a",Terrestrial:"#d9a050"};function sC(n,e,t,i=.5){return n==null||isNaN(n)?i:Math.max(0,Math.min(1,(n-e)/(t-e)))}function wY(n){const e=bY[n.planet_type||"Terrestrial"]||"#888888";return new De(e)}function TY(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);e=(e<<5)-e+i,e=e&e}return Math.abs(e%1e3)/1e3}function vJ(n){var i;const e=((i=n==null?void 0:n.charAt(0))==null?void 0:i.toUpperCase())??"G";return{M:.95,K:.65,G:.55,F:.35,A:.25,B:.85,O:.9,L:.2,T:.15,Y:.1}[e]??.5}function jD(n){const e=n.planet_type,t=n.pl_dens;if(e==="Gas Giant"||e==="Neptune-like")return 1;if(e==="Sub-Neptune")return .8;if(t!==null){if(t<3)return .7;if(t<5)return .5;if(t>7)return .2}return e==="Super-Earth"?.5:e==="Earth-sized"?.6:.2}function EY(n){return!!(n.is_likely_tidally_locked||n.pl_orbper!==null&&n.pl_orbper<SY&&n.st_teff!==null&&n.st_teff<4e3)}function AY(n){const e=n.pl_eqt,t=n.pl_dens,i=jD(n)>.3;return e===null||e<_Y||e>xY?!1:t!==null&&t<3.5&&t>1?i:!1}function MY(n){const e=n.pl_eqt,t=n.pl_dens;return e===null||e<vY||e>aS?!1:t!==null&&t>3.5}function CY(n){const{planet:e,detailLevel:t="simple",starTemp:i,showTerminator:r=!0}=n,s=sC(e.pl_dens,pY,mY,.5),a=sC(e.pl_insol,gY,yY,.5),o=e.pl_eqt??300,l=jD(e),c=TY(e.pl_name),u=i??e.st_teff??5778,h=r?1:0,d=e.color_temp_factor??.5,p=e.color_composition_factor??.5,g=e.color_irradiation_factor??.5,_=e.color_metallicity_factor??.5;return{uBaseColor:{value:wY(e)},uTime:{value:0},uTemperature:{value:o},uHasAtmosphere:{value:l},uSeed:{value:c},uDensity:{value:s},uInsolation:{value:a},uStarTemp:{value:u},uDetailLevel:{value:t==="detailed"?1:0},uEnableTerminator:{value:h},uColorTempFactor:{value:d},uColorCompositionFactor:{value:p},uColorIrradiationFactor:{value:g},uColorMetallicityFactor:{value:_}}}function IY(n){const e=n.planet_subtype,t=n.planet_type,r=fY(n).temperatureK;if(console.log(` SHADER DEBUG: ${n.pl_name}`,{type:t,subtype:e,temp:r,density:n.pl_dens,pl_eqt:n.pl_eqt}),e)switch(e){case"Hot Jupiter":return console.log("   Selected shader: hotJupiter (subtype)"),"hotJupiter";case"Jovian":case"Brown Dwarf Candidate":return r<da?(console.log(`   Selected shader: iceGiant (cold Jovian, temp ${r}K < ${da}K)`),"iceGiant"):(console.log("   Selected shader: gasGiant (subtype)"),"gasGiant");case"Ice Giant":return console.log("   Selected shader: iceGiant (subtype)"),"iceGiant";case"Mini-Neptune":case"Hot Neptune":return r<da?(console.log(`   Selected shader: iceGiant (cold Neptune, temp ${r}K < ${da}K)`),"iceGiant"):(console.log("   Selected shader: subNeptune (subtype)"),"subNeptune");case"Lava World":return console.log("   Selected shader: lavaWorld (subtype)"),"lavaWorld";case"Ice World":return console.log("   Selected shader: icyWorld (subtype)"),"icyWorld"}switch(t){case"Gas Giant":return r>1e3?(console.log("   Selected shader: hotJupiter (hot gas giant)"),"hotJupiter"):r<da?(console.log(`   Selected shader: iceGiant (cold gas giant, temp ${r}K)`),"iceGiant"):(console.log("   Selected shader: gasGiant (type)"),"gasGiant");case"Neptune-like":return console.log("   Selected shader: iceGiant (Neptune-like type)"),"iceGiant";case"Sub-Neptune":return r<da?(console.log(`   Selected shader: iceGiant (cold sub-Neptune, temp ${r}K)`),"iceGiant"):(console.log("   Selected shader: subNeptune (type)"),"subNeptune");default:return r>aS?(console.log(`   Selected shader: lavaWorld (temp > ${aS}K)`),"lavaWorld"):r<da?(console.log(`   Selected shader: icyWorld (temp < ${da}K)`),"icyWorld"):EY(n)?(console.log("   Selected shader: tidallyLocked"),"tidallyLocked"):AY(n)?(console.log("   Selected shader: oceanWorld"),"oceanWorld"):MY(n)?(console.log("   Selected shader: desertWorld"),"desertWorld"):(console.log("   Selected shader: rocky (default)"),"rocky")}}function RY(n){return{hotJupiter:"v2HotJupiterFrag",gasGiant:"v2GasGiantFrag",iceGiant:"v2IceGiantFrag",subNeptune:"v2SubNeptuneFrag",lavaWorld:"v2LavaWorldFrag",icyWorld:"v2IcyWorldFrag",rocky:"v2RockyFrag",oceanWorld:"v2OceanWorldFrag",desertWorld:"v2DesertWorldFrag",tidallyLocked:"v2TidallyLockedFrag"}[n]}function PY(n="v1"){return n==="v2"?"v2PlanetVert":"planetVert"}function SJ(n="v1"){return n==="v2"?{vert:"v2StarSurfaceVert",frag:"v2StarSurfaceFrag"}:{vert:"starSurfaceVert",frag:"starSurfaceFrag"}}function bJ(n="v1"){return n==="v2"?{vert:"v2StarCoronaVert",frag:"v2StarCoronaFrag"}:{vert:"starCoronaVert",frag:"starCoronaFrag"}}function wJ(){return{vert:"v2StarRaysVert",frag:"v2StarRaysFrag"}}function TJ(){return{vert:"v2StarFlareVert",frag:"v2StarFlareFrag"}}function EJ(){return{vert:"ringsVert",frag:"ringsFrag"}}let nc=null,ux=null;const Oh=[];let hx=!1;function XD(){return nc||(nc=new WD({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),nc.setSize(Vt,Vt),nc.setPixelRatio(1),nc.outputColorSpace=si),nc}function KD(){return ux||(ux=new kr(Vt,Vt,{minFilter:sn,magFilter:sn,format:li,colorSpace:si})),ux}async function YD(){if(!(hx||Oh.length===0)){for(hx=!0;Oh.length>0;){const n=Oh.shift();n&&await new Promise(e=>{n(),setTimeout(e,10)})}hx=!1}}function JD(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);e=(e<<5)-e+i,e=e&e}return Math.abs(e%1e3)/1e3}function LY(n){const e=new Ns(1,32,32),t=IY(n),i=RY(t),r=PY("v2"),s=CY({planet:n,detailLevel:"simple",starTemp:n.st_teff??void 0}),a=JD(n.pl_name);s.uTime.value=a*10;const o=new Zi({vertexShader:Cd.get(r),fragmentShader:Cd.get(i),uniforms:s});return new tn(e,o)}function DY(n){const e=new K0;e.background=null;const t=LY(n),i=JD(n.pl_name);t.rotation.y=i*Math.PI*2,t.rotation.x=(i-.5)*.3,e.add(t);const r=new Uw(16777215,.5);e.add(r);const s=new Nw(16777215,4473924,.4);e.add(s);const a=new kw(16777215,1);return a.position.set(3,2,4),e.add(a),e}async function NY(n){return Cd.isLoaded()||await Cd.loadShaders(),new Promise((e,t)=>{Oh.push(()=>{try{const i=XD(),r=KD(),s=DY(n),a=new In(50,1,.1,100);a.position.set(0,0,2.5),a.lookAt(0,0,0),i.setRenderTarget(r),i.render(s,a),i.setRenderTarget(null);const o=new Uint8Array(Vt*Vt*4);i.readRenderTargetPixels(r,0,0,Vt,Vt,o);const l=document.createElement("canvas");l.width=Vt,l.height=Vt;const c=l.getContext("2d");if(!c)throw new Error("Failed to get canvas context");const u=c.createImageData(Vt,Vt);for(let h=0;h<Vt;h++)for(let d=0;d<Vt;d++){const p=((Vt-1-h)*Vt+d)*4,g=(h*Vt+d)*4;u.data[g]=o[p],u.data[g+1]=o[p+1],u.data[g+2]=o[p+2],u.data[g+3]=o[p+3]}c.putImageData(u,0,0),l.toBlob(h=>{s.traverse(d=>{d instanceof tn&&(d.geometry.dispose(),d.material instanceof Kn&&d.material.dispose())}),h?e(h):t(new Error("Failed to create blob from canvas"))},"image/png",1)}catch(i){t(i)}}),YD()})}async function OY(n,e){return new Promise((t,i)=>{Oh.push(()=>{try{const r=XD(),s=KD(),a=new K0;a.background=null;const o=kY(n),l=new Ns(.8,32,32),c=new Pr({color:o,transparent:!0,opacity:1}),u=new tn(l,c);a.add(u);const h=new Ns(1.2,32,32),d=new Pr({color:o,transparent:!0,opacity:.3}),p=new tn(h,d);a.add(p);const g=new Ns(1.5,32,32),_=new Pr({color:o,transparent:!0,opacity:.15}),y=new tn(g,_);a.add(y);const m=new In(50,1,.1,100);m.position.set(0,0,3),m.lookAt(0,0,0),r.setRenderTarget(s),r.render(a,m),r.setRenderTarget(null);const x=new Uint8Array(Vt*Vt*4);r.readRenderTargetPixels(s,0,0,Vt,Vt,x);const v=document.createElement("canvas");v.width=Vt,v.height=Vt;const T=v.getContext("2d");if(!T)throw new Error("Failed to get canvas context");const R=T.createImageData(Vt,Vt);for(let C=0;C<Vt;C++)for(let A=0;A<Vt;A++){const E=((Vt-1-C)*Vt+A)*4,b=(C*Vt+A)*4;R.data[b]=x[E],R.data[b+1]=x[E+1],R.data[b+2]=x[E+2],R.data[b+3]=x[E+3]}T.putImageData(R,0,0),v.toBlob(C=>{l.dispose(),c.dispose(),h.dispose(),d.dispose(),g.dispose(),_.dispose(),C?t(C):i(new Error("Failed to create blob from canvas"))},"image/png",1)}catch(r){i(r)}}),YD()})}function kY(n){let e,t,i;return n<3500?(e=1,t=.5+(n-2500)/2e3,i=.3):n<5e3?(e=1,t=.7+(n-3500)/3e3,i=.4+(n-3500)/3e3):n<6500?(e=1,t=.95,i=.8+(n-5e3)/7500):n<1e4?(e=.9+(1e4-n)/35e3,t=.95,i=1):(e=.7,t=.85,i=1),new De(Math.min(1,Math.max(0,e)),Math.min(1,Math.max(0,t)),Math.min(1,Math.max(0,i)))}function UY(n){return{"Gas Giant":"#d4a854","Neptune-like":"#3b8fd9","Sub-Neptune":"#4eb8e0","Super-Earth":"#b5885a","Earth-sized":"#5a9668","Sub-Earth":"#c4623a",Terrestrial:"#d9a050"}[n||"Terrestrial"]||"#888888"}function FY(n){const e=n||5778;return e<3500?"#ff6b35":e<5e3?"#ffa44f":e<6500?"#fff4e0":e<1e4?"#f0f4ff":"#a8c8ff"}function ZD({size:n,color:e,isGenerating:t,type:i}){return je.jsxs("div",{className:"celestial-thumbnail-placeholder",style:{width:n,height:n,backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",position:"relative"},children:[je.jsx("div",{style:{width:n*.7,height:n*.7,borderRadius:"50%",backgroundColor:e,boxShadow:i==="star"?`0 0 ${n*.3}px ${e}, 0 0 ${n*.5}px ${e}40`:`0 0 ${n*.15}px ${e}40`,animation:t?"pulse 1.5s ease-in-out infinite":void 0}}),t&&je.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:n*.3,height:n*.3,border:`2px solid ${e}40`,borderTopColor:e,borderRadius:"50%",animation:"spin 1s linear infinite"}})]})}function QD(n,e,t,i){const[r,s]=te.useState("loading"),[a,o]=te.useState(null),l=te.useRef(!1),c=te.useCallback(async()=>{if(!l.current){l.current=!0;try{const u=ra.getCachedUrl(n,e);if(u){o(u),s("loaded");return}if(!jd()){s("generating");try{const d=await t(),p=URL.createObjectURL(d);o(p),s("loaded")}catch{s("error")}return}s("loading");const h=await ra.getThumbnailUrl(n,e);if(h){o(h),s("loaded");return}if(ra.isGenerating(n,e)){s("generating");const d=await ra.waitForGeneration(n,e);d?(o(d),s("loaded")):s("error");return}s("generating"),ra.markGenerating(n,e);try{const d=await t(),p=await ra.uploadThumbnail(n,e,d);o(p),s("loaded"),ra.markGenerationComplete(n,e,p)}catch(d){console.error(`Failed to generate thumbnail for ${n}:`,d),s("error"),ra.markGenerationComplete(n,e,null)}}catch(u){console.error(`Thumbnail error for ${n}:`,u),s("error")}}},[n,e,t]);return te.useEffect(()=>{i&&!l.current&&c()},[i,c]),{state:r,imageUrl:a}}function AJ({planet:n,size:e=64,className:t}){const i=te.useRef(null),[r,s]=te.useState(!1);te.useEffect(()=>{const u=new IntersectionObserver(([h])=>{h.isIntersecting&&(s(!0),u.disconnect())},{rootMargin:"100px"});return i.current&&u.observe(i.current),()=>u.disconnect()},[]);const a=te.useCallback(()=>NY(n),[n]),{state:o,imageUrl:l}=QD(n.pl_name,"planet",a,r),c=UY(n.planet_type);return je.jsx("div",{ref:i,className:`celestial-thumbnail ${t||""}`,style:{width:e,height:e,display:"flex",alignItems:"center",justifyContent:"center"},children:o==="loaded"&&l?je.jsx("img",{src:l,alt:n.pl_name,style:{width:e,height:e,borderRadius:"50%",objectFit:"cover"}}):je.jsx(ZD,{size:e,color:c,isGenerating:o==="generating",type:"planet"})})}function MJ({star:n,size:e=64,className:t}){const i=te.useRef(null),[r,s]=te.useState(!1);te.useEffect(()=>{const u=new IntersectionObserver(([h])=>{h.isIntersecting&&(s(!0),u.disconnect())},{rootMargin:"100px"});return i.current&&u.observe(i.current),()=>u.disconnect()},[]);const a=te.useCallback(()=>OY(n.st_teff||5778,n.hostname),[n.st_teff,n.hostname]),{state:o,imageUrl:l}=QD(n.hostname,"star",a,r),c=FY(n.st_teff);return je.jsx("div",{ref:i,className:`celestial-thumbnail ${t||""}`,style:{width:e,height:e,display:"flex",alignItems:"center",justifyContent:"center"},children:o==="loaded"&&l?je.jsx("img",{src:l,alt:n.hostname,style:{width:e,height:e,borderRadius:"50%",objectFit:"cover"}}):je.jsx(ZD,{size:e,color:c,isGenerating:o==="generating",type:"star"})})}if(typeof document<"u"){const n="celestial-thumbnail-styles";if(!document.getElementById(n)){const e=document.createElement("style");e.id=n,e.textContent=`
      @keyframes pulse {
        0%, 100% { opacity: 0.6; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.05); }
      }
      @keyframes spin {
        from { transform: translate(-50%, -50%) rotate(0deg); }
        to { transform: translate(-50%, -50%) rotate(360deg); }
      }
    `,document.head.appendChild(e)}}const VY=yy({prefix:"DataService"}),BY="./data/exoplanets.csv";class zY{constructor(){ir(this,"planets",[]);ir(this,"stars",new Map);ir(this,"planetsByName",new Map);ir(this,"planetsBySlug",new Map);ir(this,"starsBySlug",new Map);ir(this,"loaded",!1)}async loadData(){if(this.loaded)return;const e=await fetch(BY);if(!e.ok)throw new Error(`Failed to load data: ${e.statusText}`);const t=await e.text();this.planets=this.parseCSV(t),this.buildIndexes(),this.loaded=!0,VY.info(`Loaded ${this.planets.length} planets and ${this.stars.size} stars`)}parseCSV(e){const t=e.trim().split(`
`),i=this.parseCSVLine(t[0]),r=[];for(let s=1;s<t.length;s++){const a=this.parseCSVLine(t[s]),o={};i.forEach((l,c)=>{const u=a[c];o[l]=this.parseValue(l,u)}),r.push(o)}return r}parseCSVLine(e){const t=[];let i="",r=!1;for(let s=0;s<e.length;s++){const a=e[s];a==='"'?r=!r:a===","&&!r?(t.push(i),i=""):i+=a}return t.push(i),t}parseValue(e,t){if(t===""||t==="null"||t==="NaN")return null;if(e.startsWith("is_")||e.startsWith("has_"))return t==="True"||t==="true"||t==="1";if(["disc_year","sy_snum","sy_pnum","sy_mnum","cb_flag","pl_controv_flag","tran_flag","rv_flag","ttv_flag"].includes(e))return parseInt(t,10);if(["pl_rade","pl_radj","pl_bmasse","pl_bmassj","pl_dens","pl_eqt","pl_insol","pl_orbper","pl_orbsmax","pl_orbeccen","pl_orbincl","pl_trandep","pl_trandur","pl_ratror","pl_ratdor","pl_imppar","st_teff","st_rad","st_mass","st_lum","st_logg","st_age","st_dens","st_met","st_rotp","sy_dist","ra","dec","glat","glon","x","y","z","sy_vmag","sy_kmag","sy_gaiamag","sy_tmag","habitability_score","x_pc","y_pc","z_pc","distance_ly"].includes(e)){const s=parseFloat(t);return isNaN(s)?null:s}return t}buildIndexes(){for(const t of this.planets){this.planetsByName.set(t.pl_name,t);const i=yv(t.pl_name);this.planetsBySlug.set(i,t.pl_name)}const e=new Map;for(const t of this.planets){const i=e.get(t.hostname)||[];i.push(t),e.set(t.hostname,i)}for(const[t,i]of e){const r=i[0],s={id:t,hostname:t,planets:i.map(o=>o.pl_name),st_teff:r.st_teff,st_rad:r.st_rad,st_mass:r.st_mass,st_lum:r.st_lum,st_logg:r.st_logg,st_age:r.st_age,st_dens:r.st_dens,st_met:r.st_met,st_rotp:r.st_rotp,st_spectype:r.st_spectype,star_class:r.star_class,sy_snum:r.sy_snum,sy_pnum:r.sy_pnum,sy_mnum:r.sy_mnum,sy_dist:r.sy_dist,distance_ly:r.distance_ly,distance_display:r.distance_display,ra:r.ra,dec:r.dec,rastr:r.rastr,decstr:r.decstr,glat:r.glat,glon:r.glon,x:r.x,y:r.y,z:r.z,x_pc:r.x_pc,y_pc:r.y_pc,z_pc:r.z_pc,sy_vmag:r.sy_vmag,sy_kmag:r.sy_kmag,sy_gaiamag:r.sy_gaiamag,sy_tmag:r.sy_tmag,cb_flag:i.some(o=>o.cb_flag===1)};this.stars.set(t,s);const a=yv(t);this.starsBySlug.set(a,t)}}isLoaded(){return this.loaded}getAllPlanets(){return this.planets}getPlanetByName(e){return this.planetsByName.get(e)}getPlanetBySlug(e){const t=this.planetsBySlug.get(e);return t?this.planetsByName.get(t):void 0}getPlanetsByHost(e){return this.planets.filter(t=>t.hostname===e)}filterPlanets(e){return this.planets.filter(t=>!(e.planetType&&t.planet_type!==e.planetType||e.starClass&&t.star_class!==e.starClass||e.discoveryMethod&&t.discoverymethod!==e.discoveryMethod||e.minYear&&t.disc_year<e.minYear||e.maxYear&&t.disc_year>e.maxYear||e.habitableOnly&&!t.is_habitable_zone||e.earthLikeOnly&&!t.is_earth_like||e.maxDistance&&t.distance_ly&&t.distance_ly>e.maxDistance))}sortPlanets(e,t){return[...e].sort((i,r)=>{const s=i[t.field],a=r[t.field];if(s==null)return 1;if(a==null)return-1;let o=0;return typeof s=="string"&&typeof a=="string"?o=s.localeCompare(a):typeof s=="number"&&typeof a=="number"&&(o=s-a),t.direction==="desc"?-o:o})}getAllStars(){return Array.from(this.stars.values())}getStarByName(e){return this.stars.get(e)}getStarBySlug(e){const t=this.starsBySlug.get(e);return t?this.stars.get(t):void 0}getStats(){const e=this.planets;return{totalPlanets:e.length,totalStars:this.stars.size,habitableZone:e.filter(t=>t.is_habitable_zone).length,earthLike:e.filter(t=>t.is_earth_like).length,circumbinary:e.filter(t=>t.cb_flag===1).length,byType:this.groupBy(e,"planet_type"),byMethod:this.groupBy(e,"discoverymethod"),byStarClass:this.groupBy(e,"star_class")}}groupBy(e,t){const i={};for(const r of e){const s=String(r[t]??"Unknown");i[s]=(i[s]||0)+1}return i}getTopHabitable(e=10){return[...this.planets].sort((t,i)=>i.habitability_score-t.habitability_score).slice(0,e)}getClosestPlanets(e=10){return[...this.planets].filter(t=>t.distance_ly!==null).sort((t,i)=>(t.distance_ly??1/0)-(i.distance_ly??1/0)).slice(0,e)}getRecentDiscoveries(e=10){return[...this.planets].sort((t,i)=>i.disc_year-t.disc_year).slice(0,e)}searchPlanets(e){const t=e.toLowerCase();return this.planets.filter(i=>i.pl_name.toLowerCase().includes(t)||i.hostname.toLowerCase().includes(t))}searchStars(e){const t=e.toLowerCase();return this.getAllStars().filter(i=>i.hostname.toLowerCase().includes(t))}}const ii=new zY;let Nc=null,Rp=null;async function HY(){return Nc||Rp||(Rp=fetch("/data/binary.json").then(n=>n.json()).then(n=>{const e=new Map;for(const t of n.systems)e.set(t.hostname,t);return Nc=e,e}).catch(n=>(console.warn("Failed to load binary.json:",n),new Map)),Rp)}function GY(n){return Nc==null?void 0:Nc.get(n)}const Hi={O:"#9bb0ff",B:"#aabfff",A:"#cad7ff",F:"#f8f7ff",G:"#fff4ea",K:"#ffd2a1",M:"#ffcc6f",L:"#ff8c42",T:"#ff6b35",Y:"#ff4500"},dx={O:"#aabfff",B:"#cad7ff",A:"#f8f7ff",F:"#fff4ea",G:"#ffd2a1",K:"#ffcc6f",M:"#ff8c42",L:"#ff6b35",T:"#ff4500",Y:"#cc3700"},aC={"Gas Giant":["#c9a86c","#deb887","#d4a574","#c19a6b","#b8860b"],"Neptune-like":["#4a90d9","#5ba3e0","#6bb5e8","#3d7fc4","#2e6eb0"],"Sub-Neptune":["#5fa8d3","#7ab8db","#8ec8e3","#4a98c9","#3a88b9"],"Super-Earth":["#8b7355","#9c8a6e","#7a6548","#6b5a3e","#5c4d35"],"Earth-sized":["#4a7c59","#5a8c69","#6a9c79","#3a6c49","#2a5c39"],"Sub-Earth":["#a0522d","#b0623d","#c0724d","#90421d","#80320d"],Terrestrial:["#cd853f","#d4956a","#daa576","#c0764a","#b06640"]};function oC(n){if(!n)return Hi.G;const e=n.charAt(0).toUpperCase();return Hi[e]||Hi.G}function lC(n){if(!n)return dx.K;const e=n.charAt(0).toUpperCase();return dx[e]||dx.K}function Pp(n){return n>=3e4?Hi.O:n>=1e4?Hi.B:n>=7500?Hi.A:n>=6e3?Hi.F:n>=5200?Hi.G:n>=3700?Hi.K:n>=2400?Hi.M:n>=1300?Hi.L:n>=550?Hi.T:Hi.Y}function cC(n){return n>=3e4?"O":n>=1e4?"B":n>=7500?"A":n>=6e3?"F":n>=5200?"G":n>=3700?"K":n>=2400?"M":n>=1300?"L":n>=550?"T":"Y"}const WY=18;function fx(n){let e;return n<=5?e=2+n*1.5:e=2+5*1.5+Math.log10(n/5)*8,Math.min(e,WY)}function uC(n,e=5){return Math.max(e,5+Math.log10(1+n*10)*8)}function $Y(n,e){const t=aC[n]||aC.Terrestrial;return t[e%t.length]}function Gw(n,e,t){return Math.min(Math.max(n,e),t)}const qY=332946,jY=1496e5,XY=6371,KY=1;function hC(n){return n<1.23?Math.pow(n,3.7):n<2?1.9*Math.pow(n,1.7):n<4?2.7*Math.pow(n,.5)*3:17.5*Math.pow(n/4,.59)*17.8}function dC(n,e,t){const i=e/(3*t*qY);return n*Math.pow(i,1/3)*jY}function fC(n,e,t=KY){const i=n*XY,r=e/t;return 2.456*i*Math.pow(r,1/3)}function YY(n){const e=n.pl_rade??1;if(e<2)return 0;if(e<4){const y=n.pl_orbsmax??1,m=n.st_mass??1,x=n.pl_bmasse??hC(e);let v=n.pl_dens;if(!v){const I=n.planet_type||"Terrestrial";I==="Gas Giant"?v=1.3:I==="Neptune-like"||I==="Sub-Neptune"?v=1.6:v=5.5}const T=dC(y,x,m),R=fC(e,v),A=T/R>8,b=(n.pl_eqt??(n.pl_insol?255*Math.pow(n.pl_insol,.25):300))<200,S=n.st_age?n.st_age<.5:!1;return!A||!b&&!S?0:.02}let t;e>8?t=1:e>6?t=.5:e>4?t=.25:t=.005;const i=n.pl_orbsmax??1,r=n.st_mass??1,s=n.pl_bmasse??hC(e);let a=n.pl_dens;if(!a){const y=n.planet_type||"Terrestrial";y==="Gas Giant"?a=1.3:y==="Neptune-like"||y==="Sub-Neptune"?a=1.6:a=5.5}const o=dC(i,s,r),l=fC(e,a),c=o/l;let u;c>10?u=1:c>5?u=.8:c>2?u=.4:u=.05;let h=n.pl_eqt;!h&&n.pl_insol&&(h=255*Math.pow(n.pl_insol,.25)),h=h??300;let d;h<150?d=1:h<250?d=.7:h<400?d=.2:d=.05;let p;n.is_young_system||n.st_age!==null&&n.st_age<.3?p=1:n.st_age!==null&&n.st_age<1?p=.8:n.st_age!==null&&n.st_age<3?p=.4:p=.2;const g={giantness:.5,hillRoche:.35,temperature:.1,youth:.05},_=g.giantness*t+g.hillRoche*u+g.temperature*d+g.youth*p;return Gw(_,0,1)}function JY(n){const e=n.planet_type||"Terrestrial";if(e!=="Gas Giant"&&e!=="Neptune-like"&&e!=="Sub-Neptune")return!1;const t=YY(n);return Gg(n.pl_name+"-rings")<t}const pC=Math.PI/180;function Gg(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);e=(e<<5)-e+i,e=e&e}return Math.abs(e%1e3)/1e3}const ZY={"Gas Giant":.6,"Neptune-like":.4,"Sub-Neptune":.3,"Super-Earth":.15,"Earth-sized":.15,"Sub-Earth":.1,Terrestrial:.12};function QY(n){const e=n.planet_type||"Terrestrial",t=ZY[e]??.12;if(n.is_likely_tidally_locked)return 0;const i=Gg(n.pl_name)*.3-.15;return t*(1+i)}function eJ(n){let e=23.4;if(n.is_likely_tidally_locked)return Gg(n.pl_name)*3*pC;const t=n.pl_orbsmax??1;t<.1?e*=.3:t<.3?e*=.5:t<.5&&(e*=.7);const i=n.pl_eqt??300;i>1500?e*=.4:i>1e3&&(e*=.6);const r=n.planet_type||"Terrestrial";(r==="Gas Giant"||r==="Neptune-like")&&(e*=.7);const s=n.pl_orbeccen??.05;s>.3&&(e*=1+s*.5);const o=(Gg(n.pl_name)-.5)*.6;return e*=1+o,e=Gw(e,0,45),e*pC}function CJ(n,e){const t=[],i=n.sy_snum>1,r=GY(n.hostname);if(i&&r){const{starA:l,starB:c,orbit:u}=r,h=fx(l.radius),d=fx(c.radius),p=l.mass+c.mass,g=c.mass/p,_=l.mass/p,y=2,m=(h/2+y)/Math.max(g,.1),x=(d/2+y)/Math.max(_,.1),v=Math.max(m,x,h+d+y*2),T=uC(u.semiMajorAxis,v),R=120*Math.log10(1+u.period/40),C=u.argOfPeriastron*Math.PI/180;t.push({id:n.id,name:n.hostname,displayName:`${n.hostname} A (Primary)`,type:"star",diameter:h,color:Pp(l.temperature),emissive:Pp(l.temperature),emissiveIntensity:.8+Math.min(l.luminosity*.1,.5),temperature:l.temperature,spectralType:n.st_spectype??n.star_class??void 0,orbitRadius:T*g,orbitPeriod:R,orbitTilt:(90-u.inclination)*Math.PI/180,orbitEccentricity:u.eccentricity,orbitArgOfPeriastron:C,isPrimaryStar:!0,isCompanionStar:!1,rotationSpeed:.1,axialTilt:0,isTidallyLocked:!1});const A=cC(c.temperature);t.push({id:`${n.id}-B`,name:`${n.hostname} B`,displayName:`${n.hostname} B (Companion)`,type:"star",diameter:d,color:Pp(c.temperature),emissive:Pp(c.temperature),emissiveIntensity:.8+Math.min(c.luminosity*.1,.5),temperature:c.temperature,spectralType:A,orbitRadius:T*_,orbitPeriod:R,orbitTilt:(90-u.inclination)*Math.PI/180,orbitEccentricity:u.eccentricity,orbitArgOfPeriastron:C+Math.PI,isPrimaryStar:!1,isCompanionStar:!0,rotationSpeed:.1,axialTilt:0,isTidallyLocked:!1})}else{const l=n.st_rad??1,c=n.st_lum??0,u=fx(l),h=u*.7,d=i?(u+h)*1.2+4:0,p=Math.pow(10,c),g=Math.min(.8+p*.15,1.5),_=Math.min(.6+Math.pow(10,c*.7)*.1,1.3);if(t.push({id:n.id,name:n.hostname,displayName:i?`${n.hostname} A (Primary)`:n.hostname,type:"star",diameter:u,color:oC(n.star_class),emissive:oC(n.star_class),emissiveIntensity:g,temperature:n.st_teff??5778,spectralType:n.st_spectype??n.star_class??void 0,orbitRadius:i?d*.4:0,orbitPeriod:i?120:0,orbitTilt:0,orbitEccentricity:.1,isPrimaryStar:!0,isCompanionStar:!1,rotationSpeed:.1,axialTilt:0,isTidallyLocked:!1}),i){const y=(n.st_teff??5778)*.85;t.push({id:`${n.id}-B`,name:`${n.hostname} B`,displayName:`${n.hostname} B (Companion)`,type:"star",diameter:h,color:lC(n.star_class),emissive:lC(n.star_class),emissiveIntensity:_,temperature:y,spectralType:cC(y),orbitRadius:d*.6,orbitPeriod:120,orbitTilt:0,orbitEccentricity:.1,isPrimaryStar:!1,isCompanionStar:!0,rotationSpeed:.1,axialTilt:0,isTidallyLocked:!1})}}const s=t.filter(l=>l.type==="star").reduce((l,c)=>Math.max(l,c.orbitRadius+c.diameter/2),0),a=[...e].sort((l,c)=>{const u=l.pl_orbsmax??999,h=c.pl_orbsmax??999;return u-h}),o=s*2.5+2;return a.forEach((l,c)=>{const u=l.pl_radj??(l.pl_rade?l.pl_rade/11.2:.1),h=l.pl_orbsmax??(c+1)*.5,d=l.pl_orbper??Math.pow(h,1.5)*365,p=l.pl_orbeccen??.05,g=uC(h),_=Math.max(g,o+c*2),y=200+Math.sqrt(d)*5,m=l.planet_type||"Terrestrial",x=Gw(.3+u*.8,.2,2.5),v=JY(l);let T=0;m==="Gas Giant"||m==="Neptune-like"?T=1:m==="Sub-Neptune"?T=.8:m==="Super-Earth"?T=.5:m==="Earth-sized"?T=.6:T=.2;const R=QY(l),C=eJ(l),A=l.is_likely_tidally_locked??!1;t.push({id:l.pl_name,name:l.pl_name,displayName:`${l.pl_name} (${m})`,type:"planet",diameter:x,color:$Y(m,c),temperature:l.pl_eqt??300,planetType:m,hasAtmosphere:T,orbitRadius:_,orbitPeriod:y,orbitTilt:p*.3,orbitEccentricity:p,hasRings:v,planetData:l,rotationSpeed:R,axialTilt:C,isTidallyLocked:A})}),t}const tJ=yy({prefix:"DataContext"}),eN=te.createContext(null);function nJ({children:n}){const[e,t]=te.useState(!0),[i,r]=te.useState(null);te.useEffect(()=>{async function a(){try{t(!0),r(null),await Promise.all([ii.loadData(),Cd.loadShaders(),HY()])}catch(o){tJ.error("Failed to load data:",o),r(o instanceof Error?o.message:"Failed to load data")}finally{t(!1)}}a()},[]);const s={isLoading:e,error:i,getAllPlanets:()=>ii.getAllPlanets(),getPlanetByName:a=>ii.getPlanetByName(a),getPlanetBySlug:a=>ii.getPlanetBySlug(a),getPlanetsByHost:a=>ii.getPlanetsByHost(a),filterPlanets:a=>ii.filterPlanets(a),sortPlanets:(a,o)=>ii.sortPlanets(a,o),searchPlanets:a=>ii.searchPlanets(a),getAllStars:()=>ii.getAllStars(),getStarByName:a=>ii.getStarByName(a),getStarBySlug:a=>ii.getStarBySlug(a),searchStars:a=>ii.searchStars(a),getTopHabitable:a=>ii.getTopHabitable(a),getClosestPlanets:a=>ii.getClosestPlanets(a),getRecentDiscoveries:a=>ii.getRecentDiscoveries(a),getStats:()=>ii.getStats()};return je.jsx(eN.Provider,{value:s,children:n})}function iJ(){const n=te.useContext(eN);if(!n)throw new Error("useData must be used within a DataProvider");return n}function rJ(){const{t:n}=h0(),{isLoading:e,error:t}=iJ();return e?je.jsx(qE,{}):t?je.jsx("div",{className:"error-container",children:je.jsxs("div",{className:"error-content",children:[je.jsx("h1",{className:"error-title",children:n("common.error")}),je.jsx("p",{className:"error-message",children:t})]})}):je.jsxs("div",{className:"app-container",children:[je.jsx(oV,{}),je.jsx("main",{children:je.jsx(te.Suspense,{fallback:je.jsx(qE,{}),children:je.jsx(LU,{})})})]})}const sm=yy({prefix:"AuthContext"}),tN=te.createContext(null);function sJ(n){return`https://api.dicebear.com/7.x/bottts-neutral/svg?seed=${n}`}async function Lp(n,e,t){const i=B3(),r=$b(i,"users",n.uid),s=await U3(r);if(s.exists())return s.data();const a={uid:n.uid,authProvider:e,name:t||n.displayName||"Space Traveler",email:n.email||"",avatar:n.photoURL||sJ(n.uid)};return await mH(r,a),sm.info("Created user profile:",a.uid),a}function aJ({children:n}){const[e,t]=te.useState(null),[i,r]=te.useState(null),[s,a]=te.useState(!0),o=jd();te.useEffect(()=>{if(!o){a(!1);return}const p=Vf(),g=qz(p,async _=>{t(_),_?r(y=>y&&y.uid===_.uid?(a(!1),y):(l(_.uid),y)):(r(null),a(!1))});return()=>g()},[o]);const l=async p=>{try{const g=B3(),_=$b(g,"users",p),y=await U3(_);y.exists()&&r(y.data())}catch(g){sm.error("Failed to fetch user profile:",g)}finally{a(!1)}},c=te.useCallback(async()=>{var _;if(!o)throw new Error("Firebase is not configured");const p=Vf(),g=yH();try{if((_=p.currentUser)!=null&&_.isAnonymous){sm.info("Linking anonymous account with Google");const y=await f5(p.currentUser,g),m=await Lp(y.user,"google");r(m)}else{const y=await x1(p,g),m=await Lp(y.user,"google");r(m)}}catch(y){if(y&&typeof y=="object"&&"code"in y&&y.code==="auth/credential-already-in-use"){sm.warn("Google account already in use, signing in directly");const m=await x1(p,g),x=await Lp(m.user,"google");r(x)}else throw y}},[o]),u=te.useCallback(async p=>{if(!o)throw new Error("Firebase is not configured");const g=Vf(),_=await Bz(g),y=await Lp(_.user,"anonymous",p);r(y)},[o]),h=te.useCallback(async()=>{if(!o)return;const p=Vf();await jz(p),r(null)},[o]),d={user:e,profile:i,loading:s,isConfigured:o,signInWithGoogle:c,signInAnonymously:u,signOut:h};return je.jsx(tN.Provider,{value:d,children:n})}function IJ(){const n=te.useContext(tN);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n}MR(document.getElementById("root")).render(je.jsx(te.StrictMode,{children:je.jsx(aJ,{children:je.jsx(nJ,{children:je.jsx(GU,{children:je.jsx(NU,{children:je.jsx(lv,{path:"/",element:je.jsx(rJ,{}),children:qR.map(n=>je.jsx(lv,{path:n.path,element:je.jsx(n.element,{})},n.path))})})})})})}));export{qn as $,$v as A,$t as B,De as C,jr as D,QY as E,Gs as F,eJ as G,fY as H,JY as I,IJ as J,dl as K,qU as L,PG as M,_J as N,hY as O,AJ as P,ki as Q,xJ as R,MJ as S,D0 as T,RD as U,F as V,ze as W,U7 as X,ul as Y,cD as Z,ci as _,wW as a,Zi as a0,zL as a1,Ce as a2,ce as a3,tn as a4,kt as a5,j7 as a6,ot as a7,Iw as a8,Cw as a9,q0 as aA,DD as aB,$0 as aC,li as aD,Or as aE,yJ as aF,yy as aG,jd as aH,B3 as aI,$b as aJ,Zt as aK,mH as aL,hJ as aM,mJ as aN,dJ as aO,fJ as aP,U3 as aQ,pJ as aR,gJ as aS,ML as aa,xt as ab,Pr as ac,iu as ad,fn as ae,sn as af,gt as ag,_u as ah,qE as ai,H7 as aj,fy as ak,In as al,EH as am,AH as an,gu as ao,ma as ap,fN as aq,V7 as ar,K0 as as,X3 as at,Wr as au,nw as av,CH as aw,Ls as ax,_L as ay,WD as az,vi as b,iJ as c,kR as d,cJ as e,TJ as f,TY as g,vJ as h,CY as i,je as j,IY as k,RY as l,SJ as m,yv as n,bJ as o,wJ as p,EJ as q,te as r,Cd as s,PY as t,h0 as u,yt as v,wi as w,io as x,CJ as y,lJ as z};
