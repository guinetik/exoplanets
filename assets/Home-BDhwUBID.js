import{r as i,C as _e,V as ne,B as X,j as e,A as Ae,a as Te,b as oe,s as q,u as Ie,c as he,L as me,d as Se,e as Re,n as fe}from"./index-BO05hWw5.js";import{u as ue,a as Z,C as pe}from"./react-three-fiber.esm-Q1vZgvkd.js";const d={DEGREES_TO_RADIANS:Math.PI/180,RADIANS_TO_DEGREES:180/Math.PI,FULL_CIRCLE:360,HALF_CIRCLE:180,MILLISECONDS_PER_DAY:864e5,JULIAN_DATE_OFFSET:24405875e-1,J2000_JULIAN_DATE:2451545,JULIAN_CENTURIES_PER_CENTURY:36525,GMST_CONSTANT:280.46061837,GMST_RATE:360.98564736629,GMST_T_SQUARED_COEFF:387933e-9,GMST_T_CUBED_DIVISOR:3871e4,HOUR_ANGLE_MIN:-180,HOUR_ANGLE_MAX:180,MIN_MAGNITUDE:0,MAX_MAGNITUDE:20,MAGNITUDE_CLAMP_MIN:.1,MAGNITUDE_CLAMP_MAX:3,MAGNITUDE_SIZE_COEFFICIENT:2.5,MAGNITUDE_EXPONENT_DIVISOR:10,COORDINATE_DECIMAL_PLACES:2,DEFAULT_SPHERE_RADIUS:1,DEFAULT_STAR_RADIUS:100,HORIZON_ALTITUDE_THRESHOLD:-5,COSINE_MAX:1,COSINE_MIN:-1},Le={O:5995775,B:8101887,A:13293567,F:16316415,G:16774378,K:16765601,M:16737860,L:13386786,T:10044586,Y:6697847},ae=16777215;function W(t){return t*d.DEGREES_TO_RADIANS}function re(t){return t*d.RADIANS_TO_DEGREES}function Ne(t){return t.getTime()/d.MILLISECONDS_PER_DAY+d.JULIAN_DATE_OFFSET}function Me(t){const s=Ne(t),n=(s-d.J2000_JULIAN_DATE)/d.JULIAN_CENTURIES_PER_CENTURY;let o=d.GMST_CONSTANT+d.GMST_RATE*(s-d.J2000_JULIAN_DATE)+d.GMST_T_SQUARED_COEFF*n*n-n*n*n/d.GMST_T_CUBED_DIVISOR;return o=(o%d.FULL_CIRCLE+d.FULL_CIRCLE)%d.FULL_CIRCLE,o}function Ce(t,s){return((Me(t)+s)%d.FULL_CIRCLE+d.FULL_CIRCLE)%d.FULL_CIRCLE}function Oe(t,s,n=new Date){const{ra:o,dec:a}=t,{latitude:c,longitude:u}=s;let r=Ce(n,u)-o;r<d.HOUR_ANGLE_MIN&&(r+=d.FULL_CIRCLE),r>d.HOUR_ANGLE_MAX&&(r-=d.FULL_CIRCLE);const m=W(r),_=W(a),T=W(c),R=Math.sin(_)*Math.sin(T)+Math.cos(_)*Math.cos(T)*Math.cos(m),C=re(Math.asin(R)),h=(Math.sin(_)-Math.sin(W(C))*Math.sin(T))/(Math.cos(W(C))*Math.cos(T));let f;return Math.abs(h)>d.COSINE_MAX?f=h>0?0:d.HALF_CIRCLE:f=re(Math.acos(Math.max(d.COSINE_MIN,Math.min(d.COSINE_MAX,h)))),Math.sin(m)>0&&(f=d.FULL_CIRCLE-f),{altitude:C,azimuth:f}}function xe(t,s=d.DEFAULT_SPHERE_RADIUS){const n=W(t.altitude),o=W(t.azimuth),a=Math.sin(n)*s,c=Math.cos(n)*s,u=-Math.sin(o)*c,l=-Math.cos(o)*c;return{x:u,y:a,z:l}}function ge(t,s,n,o=new Date,a=d.DEFAULT_STAR_RADIUS){const c=Oe({ra:t,dec:s},n,o);return{...xe(c,a),visible:c.altitude>d.HORIZON_ALTITUDE_THRESHOLD}}function De(t){if(!t)return ae;const s=t.charAt(0).toUpperCase();return Le[s]??ae}function ve(t){if(t===null||isNaN(t))return .5;const s=Math.max(d.MIN_MAGNITUDE,Math.min(d.MAX_MAGNITUDE,t)),n=d.MAGNITUDE_SIZE_COEFFICIENT*Math.pow(10,-s/d.MAGNITUDE_EXPONENT_DIVISOR);return Math.max(d.MAGNITUDE_CLAMP_MIN,Math.min(d.MAGNITUDE_CLAMP_MAX,n))}function Pe(t){const s=Math.abs(t),n=t>=0?"N":"S";return`${s.toFixed(d.COORDINATE_DECIMAL_PLACES)}°${n}`}function Ue(t){const s=Math.abs(t),n=t>=0?"E":"W";return`${s.toFixed(d.COORDINATE_DECIMAL_PLACES)}°${n}`}function ye(t){return`${t.toFixed(d.COORDINATE_DECIMAL_PLACES)}°`}function je(t){return`${t.toFixed(d.COORDINATE_DECIMAL_PLACES)}°`}const ie={"New York":{latitude:40.7128,longitude:-74.006},London:{latitude:51.5074,longitude:-.1278},Tokyo:{latitude:35.6762,longitude:139.6503},Sydney:{latitude:-33.8688,longitude:151.2093},"São Paulo":{latitude:-23.5505,longitude:-46.6333},"Cape Town":{latitude:-33.9249,longitude:18.4241},"Rio de Janeiro":{latitude:-22.9068,longitude:-43.1729},Greenwich:{latitude:51.4772,longitude:0}},H={EARTH_SPIN_DURATION:5e3,CAMERA_SWOOP_DURATION:2500,STARS_FADE_DURATION:2e3,WELCOME_CARD_DELAY:300,WELCOME_CARD_DISMISS_DURATION:300,LETTER_ANIMATION_DELAY:.25,PLANETS_LINE_START_OFFSET:3},x={BASE_RADIUS:580,SCALE_MULTIPLIER:.35,INITIAL_Z:-600,Z_MOVEMENT_DISTANCE:500,ROTATION_SPEED:.15,ATMOSPHERE_SCALE:1.05,ATMOSPHERE_OPACITY:.15,OUTER_GLOW_SCALE:1.12,OUTER_GLOW_OPACITY:.08,ATMOSPHERE_COLOR:4491519,OUTER_GLOW_COLOR:6728447},g={INITIAL_AZIMUTH:180,INITIAL_ALTITUDE:10,LOOKAT_DISTANCE:100,DRAG_SENSITIVITY:.3,MIN_ALTITUDE:-10,MAX_ALTITUDE:90,DEFAULT_CURSOR:"grab",DRAGGING_CURSOR:"grabbing"},Q={COUNT:3e3,SPHERE_RADIUS:800,POINT_SIZE:.8,COLOR:8947848,OPACITY_MULTIPLIER:.5},ce={STAR_DISTANCE:500,BASE_SCALE:20},K={MIN_SPEED:.5,SPEED_MODULO:100,SPEED_DIVISOR:50,MIN_INTENSITY:.15,INTENSITY_MODULO:50,INTENSITY_DIVISOR:200},V={BASE_HIT_THRESHOLD:15,SIZE_SCALE_MULTIPLIER:.3,HOVER_LERP:.15,CLICK_DISTANCE_THRESHOLD:5,POINTER_CURSOR:"pointer",DEFAULT_CURSOR:"grab"},ee={MIN_INTERVAL_MS:5e3,MAX_INTERVAL_MS:12e3,MAX_ACTIVE:3,INITIAL_DELAY_MS:3e3},G={LIFETIME_S:20,BASE_SIZE:.8,ALTITUDE:80,SPEED:15,SPEED_MIN_FACTOR:.8,SPEED_VARIATION:.4,TUMBLE_X:.01,TUMBLE_Y:.02},J={START_Y_BASE:10,START_Y_RANGE:40,START_Z_LOWER:.3,START_Z_RANGE:.7,DIR_Y_SCALE:.3,DIR_Z_SCALE:.5},$=[{name:"ISS",color:"#ffffff",size:1,panels:!0,spawnProbability:.15},{name:"Satellite",color:"#aaaaaa",size:.6,panels:!0,spawnProbability:.55},{name:"Debris",color:"#666666",size:.3,panels:!1,spawnProbability:.3}],b={BODY_HEIGHT_MULTIPLIER:.5,BODY_DEPTH_MULTIPLIER:.5,PANEL_X_OFFSET:.8,PANEL_WIDTH:.8,PANEL_THICKNESS:.05,PANEL_DEPTH:.4,PANEL_COLOR:"#1a3a5c"},Y={ORBITAL_RADIUS:610,ANGULAR_VELOCITY:2*Math.PI/90,START_ANGLE:-Math.PI/2,ORBIT_DIRECTION:1,SIZE_MULTIPLIER:8,ROTATION_X:0,ROTATION_Y:5e-4},be={DURATION_MS:2e3},le={INOUT_BACK_C1:1.70158,INOUT_BACK_C2_MULTIPLIER:1.525},M={RADIUS:580,POSITION_Y:-600,WIDTH_SEGMENTS:64,HEIGHT_SEGMENTS_SURFACE:64,HEIGHT_SEGMENTS_ATMOSPHERE:64,ATMOSPHERE_SCALE:1.02,FALLBACK_COLOR:8432354,SHADER_RETRY_DELAY_MS:100,ROTATION_LERP:.05},k={BACKGROUND_COLOR:"#000",BACKGROUND_COLOR_ALT:"#000000",CAMERA_FOV:60,CAMERA_NEAR:.1,CAMERA_FAR:2e3,CAMERA_INITIAL_X:0,CAMERA_INITIAL_Y:50,CAMERA_INITIAL_Z:400,AMBIENT_LIGHT_INTENSITY:.3};function we(t){return t<$[0].spawnProbability?$[0]:t<$[0].spawnProbability+$[1].spawnProbability?$[1]:$[2]}function Ge(){const s=document.createElement("canvas");s.width=128,s.height=128;const n=s.getContext("2d"),o=128/2;n.clearRect(0,0,128,128);const a=n.createRadialGradient(o,o,0,o,o,o);a.addColorStop(0,"rgba(255, 255, 255, 1)"),a.addColorStop(.1,"rgba(255, 255, 255, 0.8)"),a.addColorStop(.3,"rgba(255, 255, 255, 0.3)"),a.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=a,n.fillRect(0,0,128,128),n.save(),n.translate(o,o);for(let l=0;l<4;l++){n.rotate(Math.PI/2);const r=n.createLinearGradient(0,0,0,-o);r.addColorStop(0,"rgba(255, 255, 255, 0.8)"),r.addColorStop(.3,"rgba(255, 255, 255, 0.3)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=r,n.beginPath(),n.moveTo(-2,0),n.lineTo(0,-o*.9),n.lineTo(2,0),n.closePath(),n.fill()}n.restore();const c=n.createRadialGradient(o,o,0,o,o,128*.15);c.addColorStop(0,"rgba(255, 255, 255, 1)"),c.addColorStop(.5,"rgba(255, 255, 255, 0.8)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=c,n.fillRect(0,0,128,128);const u=new Te(s);return u.needsUpdate=!0,u}function Fe(t){let s=0;for(let n=0;n<t.length;n++){const o=t.charCodeAt(n);s=(s<<5)-s+o,s=s&s}return Math.abs(s)}const ke=`
  attribute vec3 starColor;
  attribute float starSize;
  attribute float twinkleSpeed;
  attribute float twinklePhase;
  attribute float twinkleIntensity;
  attribute float isHovered;

  uniform float uTime;

  varying vec3 vColor;
  varying float vOpacity;

  void main() {
    vColor = starColor;

    // Subtle twinkle - very gentle brightness variation
    float twinkle = sin(uTime * twinkleSpeed * 0.3 + twinklePhase);
    float twinkleScale = 1.0 + twinkle * twinkleIntensity * 0.15;

    // Stable opacity - minimal twinkle effect
    float baseOpacity = isHovered > 0.5 ? 1.0 : 0.95;
    vOpacity = baseOpacity;

    // Calculate final size - interpolate between base and hover scale
    float baseScale = starSize * 20.0;
    float hoverScale = 40.0;
    float targetScale = mix(baseScale, hoverScale, isHovered);
    float finalSize = targetScale * twinkleScale;

    // Position
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * mvPosition;

    // Size attenuation - scale by distance from camera
    // Using higher multiplier to match original sprite sizes
    gl_PointSize = finalSize * (1500.0 / -mvPosition.z);
  }
`,He=`
  uniform sampler2D uTexture;

  varying vec3 vColor;
  varying float vOpacity;

  void main() {
    vec4 texColor = texture2D(uTexture, gl_PointCoord);
    gl_FragColor = vec4(vColor * texColor.rgb, texColor.a * vOpacity);
  }
`;function Ye({stars:t,observer:s,date:n,onStarClick:o,onStarHover:a}){const c=i.useRef(null),u=i.useRef(null),l=i.useRef(null),[r,m]=i.useState(-1),_=i.useRef(null),{gl:T,camera:R}=ue(),C=i.useMemo(()=>Ge(),[]),h=i.useMemo(()=>{const E=[];for(const I of t){if(I.ra===null||I.dec===null)continue;const A=ge(I.ra,I.dec,s,n,ce.STAR_DISTANCE);if(!A.visible)continue;const O=Fe(I.hostname);E.push({star:I,position:new ne(A.x,A.y,A.z),color:new _e(De(I.star_class)),size:ve(I.sy_vmag),twinkleSpeed:K.MIN_SPEED+O%K.SPEED_MODULO/K.SPEED_DIVISOR,twinklePhase:O%1e3/1e3*Math.PI*2,twinkleIntensity:K.MIN_INTENSITY+O%K.INTENSITY_MODULO/K.INTENSITY_DIVISOR})}return E},[t,s,n]),f=i.useMemo(()=>{const E=h.length,I=new Float32Array(E*3),A=new Float32Array(E*3),O=new Float32Array(E),y=new Float32Array(E),w=new Float32Array(E),F=new Float32Array(E),z=new Float32Array(E);return h.forEach((D,j)=>{I[j*3]=D.position.x,I[j*3+1]=D.position.y,I[j*3+2]=D.position.z,A[j*3]=D.color.r,A[j*3+1]=D.color.g,A[j*3+2]=D.color.b,O[j]=D.size,y[j]=D.twinkleSpeed,w[j]=D.twinklePhase,F[j]=D.twinkleIntensity,z[j]=0}),{positions:I,colors:A,sizes:O,twinkleSpeeds:y,twinklePhases:w,twinkleIntensities:F,isHovered:z}},[h]),v=i.useRef(null);i.useEffect(()=>{if(!l.current)return;const E=l.current;E.setAttribute("position",new X(f.positions,3)),E.setAttribute("starColor",new X(f.colors,3)),E.setAttribute("starSize",new X(f.sizes,1)),E.setAttribute("twinkleSpeed",new X(f.twinkleSpeeds,1)),E.setAttribute("twinklePhase",new X(f.twinklePhases,1)),E.setAttribute("twinkleIntensity",new X(f.twinkleIntensities,1));const I=new X(f.isHovered,1);E.setAttribute("isHovered",I),v.current=I,E.computeBoundingSphere()},[f]),Z(E=>{if(u.current&&(u.current.uniforms.uTime.value=E.clock.elapsedTime),v.current){const I=v.current.array;let A=!1;for(let O=0;O<I.length;O++){const w=(O===r?1:0)-I[O];Math.abs(w)>.001&&(I[O]+=w*V.HOVER_LERP,A=!0)}A&&(v.current.needsUpdate=!0)}});const S=i.useCallback(E=>{if(h.length===0)return;const I=T.domElement.getBoundingClientRect(),A=E.clientX-I.left,O=E.clientY-I.top;let y=-1,w=1/0;for(let F=0;F<h.length;F++){const z=h[F],D=z.position.clone().project(R);if(D.z>1)continue;const j=(D.x+1)/2*I.width,se=(1-D.y)/2*I.height,B=A-j,p=O-se,N=Math.sqrt(B*B+p*p),de=V.BASE_HIT_THRESHOLD+z.size*ce.BASE_SCALE*V.SIZE_SCALE_MULTIPLIER;N<de&&N<w&&(y=F,w=N)}y!==r?(m(y),y>=0?(T.domElement.style.cursor=V.POINTER_CURSOR,a==null||a(h[y].star,{x:E.clientX,y:E.clientY})):(T.domElement.style.cursor=V.DEFAULT_CURSOR,a==null||a(null))):y>=0&&(a==null||a(h[y].star,{x:E.clientX,y:E.clientY}))},[h,r,T,R,a]),L=i.useCallback(E=>{_.current={x:E.clientX,y:E.clientY}},[]),P=i.useCallback(E=>{if(_.current){const I=E.clientX-_.current.x,A=E.clientY-_.current.y;if(Math.sqrt(I*I+A*A)>V.CLICK_DISTANCE_THRESHOLD)return}r>=0&&h[r]&&(o==null||o(h[r].star))},[r,h,o]),U=i.useCallback(()=>{m(-1),T.domElement.style.cursor=V.DEFAULT_CURSOR,a==null||a(null)},[T,a]);return i.useEffect(()=>{const E=T.domElement;return E.addEventListener("pointerdown",L),E.addEventListener("pointermove",S),E.addEventListener("click",P),E.addEventListener("pointerleave",U),()=>{E.removeEventListener("pointerdown",L),E.removeEventListener("pointermove",S),E.removeEventListener("click",P),E.removeEventListener("pointerleave",U)}},[T,L,S,P,U]),i.useEffect(()=>()=>{C.dispose()},[C]),h.length===0?null:e.jsxs("points",{ref:c,frustumCulled:!1,children:[e.jsx("bufferGeometry",{ref:l}),e.jsx("shaderMaterial",{ref:u,vertexShader:ke,fragmentShader:He,uniforms:{uTime:{value:0},uTexture:{value:C}},transparent:!0,depthWrite:!1,blending:Ae})]})}function ze({longitude:t=0}){const[s,n]=i.useState(!1),[o,a]=i.useState(null),c=i.useRef(0),u=i.useRef(0),l=i.useMemo(()=>({uRotation:{value:0}}),[]);return i.useEffect(()=>{const r=()=>{try{q.isLoaded()?(a({surfaceVert:q.get("earthSurfaceVert"),surfaceFrag:q.get("earthSurfaceFrag"),atmosphereVert:q.get("atmosphereVert"),atmosphereFrag:q.get("atmosphereFrag")}),n(!0)):setTimeout(r,M.SHADER_RETRY_DELAY_MS)}catch(m){console.warn("Earth shaders not available, using fallback:",m),n(!0)}};r()},[]),i.useEffect(()=>{c.current=-t*Math.PI/180},[t]),Z(()=>{const r=c.current-u.current;u.current+=r*M.ROTATION_LERP,l.uRotation.value=u.current}),!s||!o?e.jsx("group",{children:e.jsxs("mesh",{position:[0,M.POSITION_Y,0],children:[e.jsx("sphereGeometry",{args:[M.RADIUS,M.WIDTH_SEGMENTS,M.HEIGHT_SEGMENTS_SURFACE]}),e.jsx("meshBasicMaterial",{color:M.FALLBACK_COLOR})]})}):e.jsxs("group",{children:[e.jsxs("mesh",{position:[0,M.POSITION_Y,0],children:[e.jsx("sphereGeometry",{args:[M.RADIUS,M.WIDTH_SEGMENTS,M.HEIGHT_SEGMENTS_SURFACE]}),e.jsx("shaderMaterial",{vertexShader:o.surfaceVert,fragmentShader:o.surfaceFrag,uniforms:l})]}),e.jsxs("mesh",{position:[0,M.POSITION_Y,0],scale:[M.ATMOSPHERE_SCALE,M.ATMOSPHERE_SCALE,M.ATMOSPHERE_SCALE],children:[e.jsx("sphereGeometry",{args:[M.RADIUS,M.WIDTH_SEGMENTS,M.HEIGHT_SEGMENTS_ATMOSPHERE]}),e.jsx("shaderMaterial",{vertexShader:o.atmosphereVert,fragmentShader:o.atmosphereFrag,transparent:!0,side:oe,depthWrite:!1})]})]})}function Be({satellite:t,onExpired:s}){const n=i.useRef(null),o=i.useRef(t.createdAt);Z(c=>{if(!n.current)return;const u=c.clock.elapsedTime-o.current;if(u>G.LIFETIME_S){s(t.id);return}const l=u*t.speed,r=t.startPosition.clone().add(t.direction.clone().multiplyScalar(l));n.current.position.copy(r),n.current.rotation.x+=G.TUMBLE_X,n.current.rotation.y+=G.TUMBLE_Y});const a=G.BASE_SIZE*t.type.size;return e.jsxs("group",{ref:n,position:t.startPosition,children:[e.jsxs("mesh",{children:[e.jsx("boxGeometry",{args:[a,a*b.BODY_HEIGHT_MULTIPLIER,a*b.BODY_DEPTH_MULTIPLIER]}),e.jsx("meshBasicMaterial",{color:t.type.color})]}),t.type.panels&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[a*b.PANEL_X_OFFSET,0,0],children:[e.jsx("boxGeometry",{args:[a*b.PANEL_WIDTH,a*b.PANEL_THICKNESS,a*b.PANEL_DEPTH]}),e.jsx("meshBasicMaterial",{color:b.PANEL_COLOR})]}),e.jsxs("mesh",{position:[-a*b.PANEL_X_OFFSET,0,0],children:[e.jsx("boxGeometry",{args:[a*b.PANEL_WIDTH,a*b.PANEL_THICKNESS,a*b.PANEL_DEPTH]}),e.jsx("meshBasicMaterial",{color:b.PANEL_COLOR})]})]})]})}function Xe(){const[t,s]=i.useState([]),n=i.useRef(0),o=i.useRef(null);Z(c=>{o.current||(o.current=c.clock)}),i.useEffect(()=>{const c=()=>{o.current&&s(r=>{var U;if(r.length>=ee.MAX_ACTIVE)return r;const m=Math.random()>.5,_=m?-80:G.ALTITUDE,T=J.START_Y_BASE+Math.random()*J.START_Y_RANGE,R=-80*(J.START_Z_LOWER+Math.random()*J.START_Z_RANGE),C=m?1:-1,h=(Math.random()-.5)*J.DIR_Y_SCALE,f=(Math.random()-.5)*J.DIR_Z_SCALE,v=new ne(C,h,f).normalize(),S=Math.random(),L=we(S),P={id:n.current++,type:L,startPosition:new ne(_,T,R),direction:v,speed:G.SPEED*(G.SPEED_MIN_FACTOR+Math.random()*G.SPEED_VARIATION),createdAt:((U=o.current)==null?void 0:U.elapsedTime)??0,altitude:G.ALTITUDE};return[...r,P]})},u=()=>{const r=ee.MIN_INTERVAL_MS+Math.random()*(ee.MAX_INTERVAL_MS-ee.MIN_INTERVAL_MS);return setTimeout(()=>{c(),l=u()},r)};let l=setTimeout(()=>{c(),l=u()},ee.INITIAL_DELAY_MS);return()=>clearTimeout(l)},[]);const a=c=>{s(u=>u.filter(l=>l.id!==c))};return e.jsx("group",{children:t.map(c=>e.jsx(Be,{satellite:c,onExpired:a},c.id))})}function Ve(){const t=i.useRef(null);Z(n=>{if(!t.current)return;const o=Y.START_ANGLE+Y.ORBIT_DIRECTION*n.clock.elapsedTime*Y.ANGULAR_VELOCITY,a=Y.ORBITAL_RADIUS*Math.sin(o),c=M.POSITION_Y+Y.ORBITAL_RADIUS*Math.cos(o);t.current.position.set(a,c,0),t.current.rotation.x+=Y.ROTATION_X,t.current.rotation.y+=Y.ROTATION_Y});const s=G.BASE_SIZE*Y.SIZE_MULTIPLIER;return e.jsxs("group",{ref:t,children:[e.jsxs("mesh",{children:[e.jsx("boxGeometry",{args:[s*.3,s*.15,s*1.2]}),e.jsx("meshBasicMaterial",{color:"#d3d3d3",toneMapped:!1})]}),e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("boxGeometry",{args:[s*.6,s*.4,s*.5]}),e.jsx("meshBasicMaterial",{color:"#e8e8e8",toneMapped:!1})]}),e.jsxs("mesh",{position:[s*2,s*.1,0],children:[e.jsx("boxGeometry",{args:[s*3,s*.08,s*.6]}),e.jsx("meshBasicMaterial",{color:"#1e90ff",toneMapped:!1})]}),e.jsxs("mesh",{position:[-s*2,s*.1,0],children:[e.jsx("boxGeometry",{args:[s*3,s*.08,s*.6]}),e.jsx("meshBasicMaterial",{color:"#1e90ff",toneMapped:!1})]}),e.jsxs("mesh",{position:[0,0,s*.7],children:[e.jsx("boxGeometry",{args:[s*.4,s*.3,s*.3]}),e.jsx("meshBasicMaterial",{color:"#d3d3d3",toneMapped:!1})]}),e.jsxs("mesh",{position:[0,0,-s*.7],children:[e.jsx("boxGeometry",{args:[s*.4,s*.3,s*.3]}),e.jsx("meshBasicMaterial",{color:"#d3d3d3",toneMapped:!1})]}),e.jsxs("mesh",{position:[-s*1.2,-s*.08,0],children:[e.jsx("boxGeometry",{args:[s*.15,s*.15,s*.8]}),e.jsx("meshBasicMaterial",{color:"#a9a9a9",toneMapped:!1})]}),e.jsxs("mesh",{position:[s*1.2,-s*.08,0],children:[e.jsx("boxGeometry",{args:[s*.15,s*.15,s*.8]}),e.jsx("meshBasicMaterial",{color:"#a9a9a9",toneMapped:!1})]})]})}function Ee(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}let te=!1;function We(t){const n=le.INOUT_BACK_C1*le.INOUT_BACK_C2_MULTIPLIER;return t<.5?Math.pow(2*t,2)*((n+1)*2*t-n)/2:(Math.pow(2*t-2,2)*((n+1)*(t*2-2)+n)+2)/2}const Ze=`
  varying vec3 vNormal;
  varying vec3 vPosition;
  varying vec2 vUv;

  void main() {
    vNormal = normalize(normalMatrix * normal);
    vPosition = position;
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,Ke=`
  uniform float uTime;
  uniform float uOpacity;

  varying vec3 vNormal;
  varying vec3 vPosition;
  varying vec2 vUv;

  // Simple noise function
  float hash(vec2 p) {
    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
  }

  float noise(vec2 p) {
    vec2 i = floor(p);
    vec2 f = fract(p);
    f = f * f * (3.0 - 2.0 * f);

    float a = hash(i);
    float b = hash(i + vec2(1.0, 0.0));
    float c = hash(i + vec2(0.0, 1.0));
    float d = hash(i + vec2(1.0, 1.0));

    return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
  }

  float fbm(vec2 p) {
    float sum = 0.0;
    float amp = 0.5;
    for(int i = 0; i < 4; i++) {
      sum += noise(p) * amp;
      p *= 2.0;
      amp *= 0.5;
    }
    return sum;
  }

  void main() {
    // Convert position to spherical coordinates for texture mapping
    vec3 nPos = normalize(vPosition);
    float longitude = atan(nPos.x, nPos.z) + uTime * 0.1;
    float latitude = asin(nPos.y);
    vec2 uv = vec2(longitude / 3.14159, latitude / 1.5708 + 0.5);

    // Ocean base color
    vec3 oceanColor = vec3(0.02, 0.08, 0.15);
    vec3 oceanHighlight = vec3(0.05, 0.15, 0.3);

    // Land generation using noise
    float landNoise = fbm(uv * 8.0);
    float landMask = smoothstep(0.45, 0.55, landNoise);

    // Land colors
    vec3 landLow = vec3(0.08, 0.25, 0.05); // Green lowlands
    vec3 landHigh = vec3(0.3, 0.2, 0.1);   // Brown highlands
    vec3 landColor = mix(landLow, landHigh, fbm(uv * 16.0));

    // Ice caps at poles
    float iceMask = smoothstep(0.7, 0.9, abs(nPos.y));
    vec3 iceColor = vec3(0.9, 0.95, 1.0);

    // Clouds
    float cloudNoise = fbm(uv * 6.0 + uTime * 0.05);
    float cloudMask = smoothstep(0.5, 0.7, cloudNoise);
    vec3 cloudColor = vec3(1.0, 1.0, 1.0);

    // Combine layers
    vec3 surfaceColor = mix(oceanColor, landColor, landMask);
    surfaceColor = mix(surfaceColor, iceColor, iceMask);
    surfaceColor = mix(surfaceColor, cloudColor, cloudMask * 0.7);

    // Simple lighting from camera direction
    vec3 lightDir = normalize(vec3(0.5, 0.3, 1.0));
    float light = max(0.0, dot(vNormal, lightDir));
    float ambient = 0.15;

    // Atmosphere rim lighting
    float rim = 1.0 - max(0.0, dot(vNormal, vec3(0.0, 0.0, 1.0)));
    vec3 atmosphereColor = vec3(0.3, 0.6, 1.0);
    vec3 rimGlow = atmosphereColor * pow(rim, 3.0) * 0.5;

    vec3 finalColor = surfaceColor * (light + ambient) + rimGlow;

    gl_FragColor = vec4(finalColor, uOpacity);
  }
`;function Je({progress:t}){const s=i.useRef(null),n=i.useMemo(()=>({uTime:{value:0},uOpacity:{value:1}}),[]);if(Z((c,u)=>{s.current&&(s.current.rotation.y+=u*x.ROTATION_SPEED),n.uTime.value=c.clock.elapsedTime}),t>=1)return null;const o=x.SCALE_MULTIPLIER*(1-t),a=x.INITIAL_Z-t*x.Z_MOVEMENT_DISTANCE;return e.jsxs("group",{ref:s,position:[0,0,a],scale:[o,o,o],children:[e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[x.BASE_RADIUS,64,64]}),e.jsx("shaderMaterial",{vertexShader:Ze,fragmentShader:Ke,uniforms:n,transparent:!0})]}),e.jsxs("mesh",{scale:[x.ATMOSPHERE_SCALE,x.ATMOSPHERE_SCALE,x.ATMOSPHERE_SCALE],children:[e.jsx("sphereGeometry",{args:[x.BASE_RADIUS,32,32]}),e.jsx("meshBasicMaterial",{color:x.ATMOSPHERE_COLOR,transparent:!0,opacity:x.ATMOSPHERE_OPACITY,side:oe})]}),e.jsxs("mesh",{scale:[x.OUTER_GLOW_SCALE,x.OUTER_GLOW_SCALE,x.OUTER_GLOW_SCALE],children:[e.jsx("sphereGeometry",{args:[x.BASE_RADIUS,32,32]}),e.jsx("meshBasicMaterial",{color:x.OUTER_GLOW_COLOR,transparent:!0,opacity:x.OUTER_GLOW_OPACITY,side:oe})]})]})}function $e({introState:t,onBearingChange:s,controlsEnabled:n}){const{camera:o,gl:a}=ue(),c=i.useRef(!1),u=i.useRef({x:0,y:0}),l=i.useRef({azimuth:g.INITIAL_AZIMUTH,altitude:g.INITIAL_ALTITUDE});return Z(()=>{const{phase:r}=t;if(r==="earth-spin"||r==="camera-swoop")o.position.set(0,0,0),o.lookAt(0,0,-100),o.updateProjectionMatrix();else if((r==="stars-fade"||r==="complete")&&!n){o.position.set(0,0,0);const m=l.current.azimuth*Math.PI/180,_=l.current.altitude*Math.PI/180;o.lookAt(-Math.sin(m)*Math.cos(_)*g.LOOKAT_DISTANCE,Math.sin(_)*g.LOOKAT_DISTANCE,-Math.cos(m)*Math.cos(_)*g.LOOKAT_DISTANCE),o.updateProjectionMatrix()}}),i.useEffect(()=>{if(!n)return;const r=a.domElement,m=()=>{const{azimuth:S,altitude:L}=l.current,P=S*Math.PI/180,U=L*Math.PI/180;o.position.set(0,0,0),o.lookAt(-Math.sin(P)*Math.cos(U)*100,Math.sin(U)*100,-Math.cos(P)*Math.cos(U)*100),o.updateProjectionMatrix(),s(S,L)},_=S=>{c.current=!0,u.current={x:S.clientX,y:S.clientY},r.style.cursor=g.DRAGGING_CURSOR},T=()=>{c.current=!1,r.style.cursor=g.DEFAULT_CURSOR},R=S=>{if(!c.current)return;const L=S.clientX-u.current.x,P=S.clientY-u.current.y;l.current.azimuth-=L*g.DRAG_SENSITIVITY,l.current.altitude+=P*g.DRAG_SENSITIVITY,l.current.azimuth=(l.current.azimuth%360+360)%360,l.current.altitude=Math.max(g.MIN_ALTITUDE,Math.min(g.MAX_ALTITUDE,l.current.altitude)),u.current={x:S.clientX,y:S.clientY},m()},C=()=>{c.current=!1,r.style.cursor=g.DEFAULT_CURSOR},h=S=>{if(S.touches.length!==1)return;c.current=!0;const L=S.touches[0];u.current={x:L.clientX,y:L.clientY}},f=()=>{c.current=!1},v=S=>{if(!c.current||S.touches.length!==1)return;S.preventDefault();const L=S.touches[0],P=L.clientX-u.current.x,U=L.clientY-u.current.y;l.current.azimuth-=P*g.DRAG_SENSITIVITY,l.current.altitude+=U*g.DRAG_SENSITIVITY,l.current.azimuth=(l.current.azimuth%360+360)%360,l.current.altitude=Math.max(g.MIN_ALTITUDE,Math.min(g.MAX_ALTITUDE,l.current.altitude)),u.current={x:L.clientX,y:L.clientY},m()};return r.style.cursor=g.DEFAULT_CURSOR,r.addEventListener("mousedown",_),r.addEventListener("mouseup",T),r.addEventListener("mousemove",R),r.addEventListener("mouseleave",C),r.addEventListener("touchstart",h),r.addEventListener("touchend",f),r.addEventListener("touchmove",v,{passive:!1}),m(),()=>{r.removeEventListener("mousedown",_),r.removeEventListener("mouseup",T),r.removeEventListener("mousemove",R),r.removeEventListener("mouseleave",C),r.removeEventListener("touchstart",h),r.removeEventListener("touchend",f),r.removeEventListener("touchmove",v)}},[a,o,n,s]),null}function qe({opacity:t}){const s=Q.COUNT,n=i.useMemo(()=>{const o=new Float32Array(s*3);for(let a=0;a<s;a++){const c=Math.random()*Math.PI*2,u=Math.acos(2*Math.random()-1),l=Q.SPHERE_RADIUS;o[a*3]=l*Math.sin(u)*Math.cos(c),o[a*3+1]=l*Math.sin(u)*Math.sin(c),o[a*3+2]=l*Math.cos(u)}return o},[]);return e.jsxs("points",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:s,array:n,itemSize:3})}),e.jsx("pointsMaterial",{size:Q.POINT_SIZE,color:Q.COLOR,transparent:!0,opacity:t*Q.OPACITY_MULTIPLIER,sizeAttenuation:!1})]})}function Qe(){const[t,s]=i.useState({phase:te?"complete":"earth-spin",progress:te?1:0}),n=i.useRef(Date.now()),o=i.useCallback(()=>{s({phase:"complete",progress:1})},[]);i.useEffect(()=>{let l;const r=()=>{const m=Date.now(),_=m-n.current;s(T=>{if(T.phase==="complete")return T;if(T.phase==="earth-spin"){const R=Math.min(_/H.EARTH_SPIN_DURATION,1);return R>=1?(n.current=m,{phase:"camera-swoop",progress:0}):{...T,progress:R}}if(T.phase==="camera-swoop"){const R=Math.min(_/H.CAMERA_SWOOP_DURATION,1);return R>=1?(n.current=m,{phase:"stars-fade",progress:0}):{...T,progress:R}}if(T.phase==="stars-fade"){const R=Math.min(_/H.STARS_FADE_DURATION,1);return R>=1?{phase:"complete",progress:1}:{...T,progress:R}}return T}),t.phase!=="complete"&&(l=requestAnimationFrame(r))};return l=requestAnimationFrame(r),()=>cancelAnimationFrame(l)},[t.phase]);const a=t.phase==="stars-fade"?Ee(t.progress):t.phase==="complete"?1:0,c=t.phase==="camera-swoop"?We(t.progress):t.phase==="stars-fade"||t.phase==="complete"?1:0,u=t.phase==="complete";return{state:t,introEarthExitProgress:c,starsOpacity:a,controlsEnabled:u,skipIntro:o}}function et(t){const[s,n]=i.useState(t),[o,a]=i.useState(t),[c,u]=i.useState(!1),l=i.useRef(Date.now()),r=i.useRef(t);i.useEffect(()=>{if(!c)return;let _;const T=()=>{const R=Date.now()-l.current,C=Math.min(R/be.DURATION_MS,1),h=Ee(C),f=r.current.latitude+(o.latitude-r.current.latitude)*h,v=r.current.longitude+(o.longitude-r.current.longitude)*h;n({latitude:f,longitude:v}),C<1?_=requestAnimationFrame(T):(u(!1),n(o))};return _=requestAnimationFrame(T),()=>cancelAnimationFrame(_)},[c,o]);const m=i.useCallback(_=>{r.current=s,l.current=Date.now(),a(_),u(!0)},[s]);return{currentLocation:s,changeLocation:m,isAnimating:c}}function tt({starCount:t,planetCount:s,onDismiss:n,isExiting:o,onTrackCTA:a}){const{t:c}=he(),u=()=>{a("take_tour"),n()},l=()=>{a("explore"),n()};return e.jsx("div",{className:`welcome-card-container ${o?"exiting":""}`,children:e.jsxs("div",{className:"welcome-card",children:[e.jsx("h2",{className:"welcome-title",children:c("pages.home.infoCard.title")}),e.jsx("p",{className:"welcome-description",children:c("pages.home.infoCard.description")}),e.jsx("div",{className:"welcome-stats",children:c("pages.home.infoCard.stats",{starCount:t.toLocaleString(),planetCount:s.toLocaleString()})}),e.jsx("p",{className:"welcome-hint",children:c("pages.home.infoCard.hint")}),e.jsxs("div",{className:"welcome-actions",children:[e.jsx(me,{to:"/tour",className:"welcome-tour-btn",onClick:u,children:c("pages.home.infoCard.takeTour")}),e.jsx("button",{className:"welcome-dismiss",onClick:l,children:c("pages.home.infoCard.dismiss")})]})]})})}function st({stars:t,onStarClick:s}){const{currentLocation:n,changeLocation:o,isAnimating:a}=et(ie["São Paulo"]),[c]=i.useState(()=>new Date),[u,l]=i.useState({azimuth:180,altitude:-10}),[r,m]=i.useState(!1),[_,T]=i.useState(null),[R,C]=i.useState(null),[h,f]=i.useState("São Paulo"),[v,S]=i.useState(!1),[L,P]=i.useState(!1),U=i.useRef(te),{trackCTAClick:E,trackLocationChange:I}=Ie(),{state:A,introEarthExitProgress:O,starsOpacity:y,controlsEnabled:w,skipIntro:F}=Qe();i.useEffect(()=>{const p=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=p}},[]),i.useEffect(()=>{if(A.phase==="complete"&&!U.current&&!v){const p=setTimeout(()=>{S(!0)},H.WELCOME_CARD_DELAY);return()=>clearTimeout(p)}},[A.phase,v]);const z=i.useCallback(()=>{te=!0,U.current=!0,P(!0),setTimeout(()=>{S(!1),P(!1)},H.WELCOME_CARD_DISMISS_DURATION)},[]),D=i.useCallback((p,N)=>{l({azimuth:p,altitude:N})},[]),j=i.useCallback((p,N)=>{o(N),f(p),m(!1),I(p)},[o,I]),se=i.useCallback((p,N)=>{T(p),C(N??null)},[]),B=A.phase==="complete";return e.jsxs("div",{className:"starfield-container",children:[e.jsxs(pe,{camera:{fov:k.CAMERA_FOV,near:k.CAMERA_NEAR,far:k.CAMERA_FAR,position:[k.CAMERA_INITIAL_X,k.CAMERA_INITIAL_Y,k.CAMERA_INITIAL_Z]},gl:{antialias:!0,alpha:!1},style:{background:k.BACKGROUND_COLOR},children:[e.jsx("color",{attach:"background",args:[k.BACKGROUND_COLOR_ALT]}),e.jsx($e,{introState:A,onBearingChange:D,controlsEnabled:w}),e.jsx("ambientLight",{intensity:k.AMBIENT_LIGHT_INTENSITY}),e.jsx(Je,{progress:O}),(A.phase==="stars-fade"||A.phase==="complete")&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{opacity:1}),e.jsx(Ye,{stars:t,observer:n,date:c,onStarClick:s,onStarHover:se}),e.jsx(ze,{longitude:n.longitude}),A.phase==="complete"&&e.jsx(Xe,{}),A.phase==="complete"&&e.jsx(Ve,{})]})]}),(A.phase==="stars-fade"||A.phase==="complete")&&e.jsx("div",{className:"scene-fade-overlay",style:{opacity:1-y,pointerEvents:y>=1?"none":"auto"}}),B&&e.jsxs("div",{className:"starfield-bearing",children:[e.jsx("div",{className:"bearing-title",children:"Telescope Bearing"}),e.jsxs("div",{className:"bearing-value",children:[e.jsx("span",{className:"bearing-icon",children:"↔"})," ",ye(u.azimuth)]}),e.jsxs("div",{className:"bearing-value",children:[e.jsx("span",{className:"bearing-icon",children:"↕"})," ",je(u.altitude)]})]}),_&&R&&B&&e.jsxs("div",{className:"starfield-tooltip",style:{left:`${R.x+20}px`,top:`${R.y-10}px`},children:[e.jsx("div",{className:"tooltip-name",children:_.hostname}),e.jsxs("div",{className:"tooltip-info",children:[_.sy_pnum," planet",_.sy_pnum!==1?"s":"",_.distance_ly&&e.jsxs(e.Fragment,{children:[" · ",_.distance_ly.toFixed(1)," ly"]})]}),e.jsx("div",{className:"tooltip-hint",children:"Click to explore"})]}),B&&e.jsxs("div",{className:"starfield-location",children:[a?e.jsxs("span",{className:"location-coords location-animating",children:["Traveling to ",h,"..."]}):e.jsxs("span",{className:"location-coords",children:[h," · ",Pe(n.latitude),","," ",Ue(n.longitude)]}),e.jsx("button",{className:"location-button",onClick:()=>m(!r),disabled:a,children:"CHANGE LOCATION"}),r&&!a&&e.jsx("div",{className:"location-picker",children:Object.entries(ie).map(([p,N])=>e.jsx("button",{className:"location-option",onClick:()=>j(p,N),children:p},p))})]}),B&&e.jsx("div",{className:"starfield-info",children:e.jsxs("span",{children:[t.length.toLocaleString()," exoplanet host stars"]})}),A.phase!=="complete"&&e.jsxs("div",{className:"intro-overlay",onClick:F,children:[A.phase==="earth-spin"&&e.jsx("div",{className:"intro-text",children:e.jsxs("div",{className:"intro-title-container",children:[e.jsx("div",{className:"intro-title-line intro-title-line-exo",children:"EXO".split("").map((p,N)=>e.jsx("span",{className:"intro-letter",style:{animationDelay:`${N*H.LETTER_ANIMATION_DELAY}s`},children:p},N))}),e.jsx("div",{className:"intro-title-line intro-title-line-planets",children:"PLANETS".split("").map((p,N)=>e.jsx("span",{className:"intro-letter",style:{animationDelay:`${H.PLANETS_LINE_START_OFFSET*H.LETTER_ANIMATION_DELAY+N*H.LETTER_ANIMATION_DELAY}s`},children:p},N))})]})}),(A.phase==="camera-swoop"||A.phase==="stars-fade")&&e.jsx("div",{className:"intro-text",style:{opacity:A.phase==="stars-fade"?1-y:1},children:e.jsx("span",{className:"intro-subtitle",children:"Explore the cosmos"})}),A.phase!=="stars-fade"&&e.jsx("div",{className:"intro-skip",children:"Click anywhere to skip"})]}),v&&e.jsx(tt,{starCount:t.length,planetCount:t.reduce((p,N)=>p+(N.sy_pnum||0),0),onDismiss:z,isExiting:L,onTrackCTA:E})]})}function at(){const{getAllStars:t}=Se(),s=Re(),n=t(),o=i.useCallback(a=>{s(`/stars/${fe(a.hostname)}`)},[s]);return e.jsx(st,{stars:n,onStarClick:o})}export{at as default};
