import{at as i,as as g,au as l,av as w,aw as d,ax as y,ay as p,az as f,aA as h,aB as b}from"./index-XZ3gHdqT.js";const s=g({prefix:"PollService"}),u="exoplanets_poll";async function v(e,t){if(!i())return s.warn("Firebase not configured, creating local-only vote"),{id:t,planet:e,userid:t,timestamp:Date.now()};const r=l(),n=w(r,u,t),c={planet:e,userid:t,timestamp:d.now()};return await y(n,c),s.info("Vote cast:",{planet:e,userid:t}),{id:t,planet:e,userid:t,timestamp:Date.now()}}async function F(e){if(!i())return s.warn("Firebase not configured, returning null"),null;try{const t=l(),r=p(t,u),n=h(r,b("userid","==",e)),c=await f(n);if(c.empty)return null;const a=c.docs[0],o=a.data();return{id:a.id,planet:o.planet,userid:o.userid,timestamp:o.timestamp instanceof d?o.timestamp.toMillis():o.timestamp}}catch(t){return s.error("Failed to fetch user vote:",t),null}}async function D(){if(!i())return s.warn("Firebase not configured, returning empty counts"),[];try{const e=l(),t=p(e,u),r=await f(t),n=new Map;return r.forEach(a=>{const m=a.data().planet;n.set(m,(n.get(m)||0)+1)}),Array.from(n.entries()).map(([a,o])=>({planet:a,count:o})).sort((a,o)=>o.count-a.count)}catch(e){return s.error("Failed to fetch vote counts:",e),[]}}async function C(){if(!i())return 0;try{const e=l(),t=p(e,u);return(await f(t)).size}catch(e){return s.error("Failed to fetch total votes:",e),0}}const x={castVote:v,getUserVote:F,getVoteCounts:D,getTotalVotes:C};export{x as p};
