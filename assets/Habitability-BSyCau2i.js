import{W as Qa,X as Aa,Y as Zn,Z as hn,_ as It,$ as $a,a0 as or,a1 as xn,V as We,a2 as ei,a3 as pn,a4 as Kn,a5 as Pt,a6 as Or,a7 as mt,a8 as ti,a9 as Ea,M as ri,r as ae,C as at,aa as ni,ab as ai,ac as ii,ad as oi,ae as si,af as li,ag as ci,ah as Jn,ai as fi,D as ui,aj as Sn,B as nn,j as _,A as di,a as hi,u as Ke,d as pi,n as Cr,E as vi,c as gi,S as mi}from"./index-Dpijfcqm.js";import{u as _n,C as yi}from"./react-three-fiber.esm-C3h5-tzJ.js";import{f as bi,a as xi,b as Si,c as _i,d as Ti,e as Ai,h as Ei,i as wi,j as Ui,k as Ci,g as ki}from"./habitabilityAnalytics-CzP9HgSM.js";import{_ as vn,l as Di,a as wa,k as Li,n as Ri,o as Fi,O as Oi,s as ot,b as nr,d as Gt,m as ar,f as ft,e as Ct,g as Mi,p as Ii}from"./transform-CuBf05nE.js";import{w as Ni,c as ze,d as Pi,m as qn,a as Qn,b as xr,l as $n}from"./monotone-CvAkBM_g.js";const Gi=l=>typeof l=="object"&&typeof l.then=="function",Sr=[];function Bi(l,r,c=(u,t)=>u===t){if(l===r)return!0;if(!l||!r)return!1;const u=l.length;if(r.length!==u)return!1;for(let t=0;t<u;t++)if(!c(l[t],r[t]))return!1;return!0}function ji(l,r=null,c=!1,u={}){r===null&&(r=[l]);for(const e of Sr)if(Bi(r,e.keys,e.equal)){if(c)return;if(Object.prototype.hasOwnProperty.call(e,"error"))throw e.error;if(Object.prototype.hasOwnProperty.call(e,"response"))return u.lifespan&&u.lifespan>0&&(e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(e.remove,u.lifespan)),e.response;if(!c)throw e.promise}const t={keys:r,equal:u.equal,remove:()=>{const e=Sr.indexOf(t);e!==-1&&Sr.splice(e,1)},promise:(Gi(l)?l:l(...r)).then(e=>{t.response=e,u.lifespan&&u.lifespan>0&&(t.timeout=setTimeout(t.remove,u.lifespan))}).catch(e=>t.error=e)};if(Sr.push(t),!c)throw t.promise}const zi=(l,r,c)=>ji(l,r,!1,c),Ua=parseInt(Qa.replace(/\D+/g,"")),Ca=Ua>=125?"uv1":"uv2",ea=new or,_r=new We;class Tn extends Aa{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const r=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],c=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],u=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(u),this.setAttribute("position",new Zn(r,3)),this.setAttribute("uv",new Zn(c,2))}applyMatrix4(r){const c=this.attributes.instanceStart,u=this.attributes.instanceEnd;return c!==void 0&&(c.applyMatrix4(r),u.applyMatrix4(r),c.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(r){let c;r instanceof Float32Array?c=r:Array.isArray(r)&&(c=new Float32Array(r));const u=new hn(c,6,1);return this.setAttribute("instanceStart",new It(u,3,0)),this.setAttribute("instanceEnd",new It(u,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(r,c=3){let u;r instanceof Float32Array?u=r:Array.isArray(r)&&(u=new Float32Array(r));const t=new hn(u,c*2,1);return this.setAttribute("instanceColorStart",new It(t,c,0)),this.setAttribute("instanceColorEnd",new It(t,c,c)),this}fromWireframeGeometry(r){return this.setPositions(r.attributes.position.array),this}fromEdgesGeometry(r){return this.setPositions(r.attributes.position.array),this}fromMesh(r){return this.fromWireframeGeometry(new $a(r.geometry)),this}fromLineSegments(r){const c=r.geometry;return this.setPositions(c.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new or);const r=this.attributes.instanceStart,c=this.attributes.instanceEnd;r!==void 0&&c!==void 0&&(this.boundingBox.setFromBufferAttribute(r),ea.setFromBufferAttribute(c),this.boundingBox.union(ea))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new xn),this.boundingBox===null&&this.computeBoundingBox();const r=this.attributes.instanceStart,c=this.attributes.instanceEnd;if(r!==void 0&&c!==void 0){const u=this.boundingSphere.center;this.boundingBox.getCenter(u);let t=0;for(let e=0,a=r.count;e<a;e++)_r.fromBufferAttribute(r,e),t=Math.max(t,u.distanceToSquared(_r)),_r.fromBufferAttribute(c,e),t=Math.max(t,u.distanceToSquared(_r));this.boundingSphere.radius=Math.sqrt(t),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(r){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(r)}}class ka extends Tn{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(r){const c=r.length-3,u=new Float32Array(2*c);for(let t=0;t<c;t+=3)u[2*t]=r[t],u[2*t+1]=r[t+1],u[2*t+2]=r[t+2],u[2*t+3]=r[t+3],u[2*t+4]=r[t+4],u[2*t+5]=r[t+5];return super.setPositions(u),this}setColors(r,c=3){const u=r.length-c,t=new Float32Array(2*u);if(c===3)for(let e=0;e<u;e+=c)t[2*e]=r[e],t[2*e+1]=r[e+1],t[2*e+2]=r[e+2],t[2*e+3]=r[e+3],t[2*e+4]=r[e+4],t[2*e+5]=r[e+5];else for(let e=0;e<u;e+=c)t[2*e]=r[e],t[2*e+1]=r[e+1],t[2*e+2]=r[e+2],t[2*e+3]=r[e+3],t[2*e+4]=r[e+4],t[2*e+5]=r[e+5],t[2*e+6]=r[e+6],t[2*e+7]=r[e+7];return super.setColors(t,c),this}fromLine(r){const c=r.geometry;return this.setPositions(c.attributes.position.array),this}}class An extends ei{constructor(r){super({type:"LineMaterial",uniforms:pn.clone(pn.merge([Kn.common,Kn.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Pt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${Ua>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(c){this.uniforms.diffuse.value=c}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(c){c===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(c){this.uniforms.linewidth.value=c}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(c){!!c!="USE_DASH"in this.defines&&(this.needsUpdate=!0),c===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(c){this.uniforms.dashScale.value=c}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(c){this.uniforms.dashSize.value=c}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(c){this.uniforms.dashOffset.value=c}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(c){this.uniforms.gapSize.value=c}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(c){this.uniforms.opacity.value=c}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(c){this.uniforms.resolution.value.copy(c)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(c){!!c!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),c===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(r)}}const an=new mt,ta=new We,ra=new We,Oe=new mt,Me=new mt,tt=new mt,on=new We,sn=new Ea,Ne=new ti,na=new We,Tr=new or,Ar=new xn,rt=new mt;let it,Et;function aa(l,r,c){return rt.set(0,0,-r,1).applyMatrix4(l.projectionMatrix),rt.multiplyScalar(1/rt.w),rt.x=Et/c.width,rt.y=Et/c.height,rt.applyMatrix4(l.projectionMatrixInverse),rt.multiplyScalar(1/rt.w),Math.abs(Math.max(rt.x,rt.y))}function Wi(l,r){const c=l.matrixWorld,u=l.geometry,t=u.attributes.instanceStart,e=u.attributes.instanceEnd,a=Math.min(u.instanceCount,t.count);for(let i=0,n=a;i<n;i++){Ne.start.fromBufferAttribute(t,i),Ne.end.fromBufferAttribute(e,i),Ne.applyMatrix4(c);const o=new We,s=new We;it.distanceSqToSegment(Ne.start,Ne.end,s,o),s.distanceTo(o)<Et*.5&&r.push({point:s,pointOnLine:o,distance:it.origin.distanceTo(s),object:l,face:null,faceIndex:i,uv:null,[Ca]:null})}}function Hi(l,r,c){const u=r.projectionMatrix,e=l.material.resolution,a=l.matrixWorld,i=l.geometry,n=i.attributes.instanceStart,o=i.attributes.instanceEnd,s=Math.min(i.instanceCount,n.count),f=-r.near;it.at(1,tt),tt.w=1,tt.applyMatrix4(r.matrixWorldInverse),tt.applyMatrix4(u),tt.multiplyScalar(1/tt.w),tt.x*=e.x/2,tt.y*=e.y/2,tt.z=0,on.copy(tt),sn.multiplyMatrices(r.matrixWorldInverse,a);for(let d=0,h=s;d<h;d++){if(Oe.fromBufferAttribute(n,d),Me.fromBufferAttribute(o,d),Oe.w=1,Me.w=1,Oe.applyMatrix4(sn),Me.applyMatrix4(sn),Oe.z>f&&Me.z>f)continue;if(Oe.z>f){const g=Oe.z-Me.z,m=(Oe.z-f)/g;Oe.lerp(Me,m)}else if(Me.z>f){const g=Me.z-Oe.z,m=(Me.z-f)/g;Me.lerp(Oe,m)}Oe.applyMatrix4(u),Me.applyMatrix4(u),Oe.multiplyScalar(1/Oe.w),Me.multiplyScalar(1/Me.w),Oe.x*=e.x/2,Oe.y*=e.y/2,Me.x*=e.x/2,Me.y*=e.y/2,Ne.start.copy(Oe),Ne.start.z=0,Ne.end.copy(Me),Ne.end.z=0;const v=Ne.closestPointToPointParameter(on,!0);Ne.at(v,na);const y=ri.lerp(Oe.z,Me.z,v),U=y>=-1&&y<=1,x=on.distanceTo(na)<Et*.5;if(U&&x){Ne.start.fromBufferAttribute(n,d),Ne.end.fromBufferAttribute(o,d),Ne.start.applyMatrix4(a),Ne.end.applyMatrix4(a);const g=new We,m=new We;it.distanceSqToSegment(Ne.start,Ne.end,m,g),c.push({point:m,pointOnLine:g,distance:it.origin.distanceTo(m),object:l,face:null,faceIndex:d,uv:null,[Ca]:null})}}}class Da extends Or{constructor(r=new Tn,c=new An({color:Math.random()*16777215})){super(r,c),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const r=this.geometry,c=r.attributes.instanceStart,u=r.attributes.instanceEnd,t=new Float32Array(2*c.count);for(let a=0,i=0,n=c.count;a<n;a++,i+=2)ta.fromBufferAttribute(c,a),ra.fromBufferAttribute(u,a),t[i]=i===0?0:t[i-1],t[i+1]=t[i]+ta.distanceTo(ra);const e=new hn(t,2,1);return r.setAttribute("instanceDistanceStart",new It(e,1,0)),r.setAttribute("instanceDistanceEnd",new It(e,1,1)),this}raycast(r,c){const u=this.material.worldUnits,t=r.camera;t===null&&!u&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const e=r.params.Line2!==void 0&&r.params.Line2.threshold||0;it=r.ray;const a=this.matrixWorld,i=this.geometry,n=this.material;Et=n.linewidth+e,i.boundingSphere===null&&i.computeBoundingSphere(),Ar.copy(i.boundingSphere).applyMatrix4(a);let o;if(u)o=Et*.5;else{const f=Math.max(t.near,Ar.distanceToPoint(it.origin));o=aa(t,f,n.resolution)}if(Ar.radius+=o,it.intersectsSphere(Ar)===!1)return;i.boundingBox===null&&i.computeBoundingBox(),Tr.copy(i.boundingBox).applyMatrix4(a);let s;if(u)s=Et*.5;else{const f=Math.max(t.near,Tr.distanceToPoint(it.origin));s=aa(t,f,n.resolution)}Tr.expandByScalar(s),it.intersectsBox(Tr)!==!1&&(u?Wi(this,c):Hi(this,t,c))}onBeforeRender(r){const c=this.material.uniforms;c&&c.resolution&&(r.getViewport(an),this.material.uniforms.resolution.value.set(an.z,an.w))}}class Vi extends Da{constructor(r=new ka,c=new An({color:Math.random()*16777215})){super(r,c),this.isLine2=!0,this.type="Line2"}}const kr=ae.forwardRef(function({points:r,color:c=16777215,vertexColors:u,linewidth:t,lineWidth:e,segments:a,dashed:i,...n},o){var s,f;const d=_n(U=>U.size),h=ae.useMemo(()=>a?new Da:new Vi,[a]),[p]=ae.useState(()=>new An),v=(u==null||(s=u[0])==null?void 0:s.length)===4?4:3,y=ae.useMemo(()=>{const U=a?new Tn:new ka,x=r.map(g=>{const m=Array.isArray(g);return g instanceof We||g instanceof mt?[g.x,g.y,g.z]:g instanceof Pt?[g.x,g.y,0]:m&&g.length===3?[g[0],g[1],g[2]]:m&&g.length===2?[g[0],g[1],0]:g});if(U.setPositions(x.flat()),u){c=16777215;const g=u.map(m=>m instanceof at?m.toArray():m);U.setColors(g.flat(),v)}return U},[r,a,u,v]);return ae.useLayoutEffect(()=>{h.computeLineDistances()},[r,h]),ae.useLayoutEffect(()=>{i?p.defines.USE_DASH="":delete p.defines.USE_DASH,p.needsUpdate=!0},[i,p]),ae.useEffect(()=>()=>{y.dispose(),p.dispose()},[y]),ae.createElement("primitive",vn({object:h,ref:o},n),ae.createElement("primitive",{object:y,attach:"geometry"}),ae.createElement("primitive",vn({object:p,attach:"material",color:c,vertexColors:!!u,resolution:[d.width,d.height],linewidth:(f=t??e)!==null&&f!==void 0?f:1,dashed:i,transparent:v===4},n)))});function Xi(){var l=Object.create(null);function r(t,e){var a=t.id,i=t.name,n=t.dependencies;n===void 0&&(n=[]);var o=t.init;o===void 0&&(o=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!l[a])try{n=n.map(function(d){return d&&d.isWorkerModule&&(r(d,function(h){if(h instanceof Error)throw h}),d=l[d.id].value),d}),o=u("<"+i+">.init",o),s&&(s=u("<"+i+">.getTransferables",s));var f=null;typeof o=="function"?f=o.apply(void 0,n):console.error("worker module init function failed to rehydrate"),l[a]={id:a,value:f,getTransferables:s},e(f)}catch(d){d&&d.noLog||console.error(d),e(d)}}function c(t,e){var a,i=t.id,n=t.args;(!l[i]||typeof l[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var o=(a=l[i]).value.apply(a,n);o&&typeof o.then=="function"?o.then(s,function(f){return e(f instanceof Error?f:new Error(""+f))}):s(o)}catch(f){e(f)}function s(f){try{var d=l[i].getTransferables&&l[i].getTransferables(f);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),e(f,d)}catch(h){console.error(h),e(h)}}}function u(t,e){var a=void 0;self.troikaDefine=function(n){return a=n};var i=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(n){console.error(n)}return URL.revokeObjectURL(i),delete self.troikaDefine,a}self.addEventListener("message",function(t){var e=t.data,a=e.messageId,i=e.action,n=e.data;try{i==="registerModule"&&r(n,function(o){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof o=="function"}})}),i==="callModule"&&c(n,function(o,s){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:o},s||void 0)})}catch(o){postMessage({messageId:a,success:!1,error:o.stack})}})}function Yi(l){var r=function(){for(var c=[],u=arguments.length;u--;)c[u]=arguments[u];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,c);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var c=l.dependencies,u=l.init;c=Array.isArray(c)?c.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var t=Promise.all(c).then(function(e){return u.apply(null,e)});return r._getInitResult=function(){return t},t},r}var La=function(){var l=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),l=!0}catch(c){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+c.message+"]")}return La=function(){return l},l},Zi=0,Ki=0,ln=!1,tr=Object.create(null),rr=Object.create(null),gn=Object.create(null);function Bt(l){if((!l||typeof l.init!="function")&&!ln)throw new Error("requires `options.init` function");var r=l.dependencies,c=l.init,u=l.getTransferables,t=l.workerId,e=Yi(l);t==null&&(t="#default");var a="workerModule"+ ++Zi,i=l.name||a,n=null;r=r&&r.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(ln=!0,s=Bt({workerId:t,name:"<"+i+"> function dependency: "+s.name,init:`function(){return (
`+Dr(s)+`
)}`}),ln=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function o(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(!La())return e.apply(void 0,s);if(!n){n=ia(t,"registerModule",o.workerModuleData);var d=function(){n=null,rr[t].delete(d)};(rr[t]||(rr[t]=new Set)).add(d)}return n.then(function(h){var p=h.isCallable;if(p)return ia(t,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return o.workerModuleData={isWorkerModule:!0,id:a,name:i,dependencies:r,init:Dr(c),getTransferables:u&&Dr(u)},o.onMainThread=e,o}function Ji(l){rr[l]&&rr[l].forEach(function(r){r()}),tr[l]&&(tr[l].terminate(),delete tr[l])}function Dr(l){var r=l.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function qi(l){var r=tr[l];if(!r){var c=Dr(Xi);r=tr[l]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+l.replace(/\*/g,"")+` **/

;(`+c+")()"],{type:"application/javascript"}))),r.onmessage=function(u){var t=u.data,e=t.messageId,a=gn[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete gn[e],a(t)}}return r}function ia(l,r,c){return new Promise(function(u,t){var e=++Ki;gn[e]=function(a){a.success?u(a.result):t(new Error("Error in worker "+r+" call: "+a.error))},qi(l).postMessage({messageId:e,action:r,data:c})})}function Ra(){var l=function(r){function c(P,I,b,E,R,F,D,j){var M=1-D;j.x=M*M*P+2*M*D*b+D*D*R,j.y=M*M*I+2*M*D*E+D*D*F}function u(P,I,b,E,R,F,D,j,M,G){var Z=1-M;G.x=Z*Z*Z*P+3*Z*Z*M*b+3*Z*M*M*R+M*M*M*D,G.y=Z*Z*Z*I+3*Z*Z*M*E+3*Z*M*M*F+M*M*M*j}function t(P,I){for(var b=/([MLQCZ])([^MLQCZ]*)/g,E,R,F,D,j;E=b.exec(P);){var M=E[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(G){return parseFloat(G)});switch(E[1]){case"M":D=R=M[0],j=F=M[1];break;case"L":(M[0]!==D||M[1]!==j)&&I("L",D,j,D=M[0],j=M[1]);break;case"Q":{I("Q",D,j,D=M[2],j=M[3],M[0],M[1]);break}case"C":{I("C",D,j,D=M[4],j=M[5],M[0],M[1],M[2],M[3]);break}case"Z":(D!==R||j!==F)&&I("L",D,j,R,F);break}}}function e(P,I,b){b===void 0&&(b=16);var E={x:0,y:0};t(P,function(R,F,D,j,M,G,Z,ee,V){switch(R){case"L":I(F,D,j,M);break;case"Q":{for(var W=F,ye=D,he=1;he<b;he++)c(F,D,G,Z,j,M,he/(b-1),E),I(W,ye,E.x,E.y),W=E.x,ye=E.y;break}case"C":{for(var $=F,re=D,fe=1;fe<b;fe++)u(F,D,G,Z,ee,V,j,M,fe/(b-1),E),I($,re,E.x,E.y),$=E.x,re=E.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(P,I){var b=P.getContext?P.getContext("webgl",o):P,E=n.get(b);if(!E){let Z=function($){var re=F[$];if(!re&&(re=F[$]=b.getExtension($),!re))throw new Error($+" not supported");return re},ee=function($,re){var fe=b.createShader(re);return b.shaderSource(fe,$),b.compileShader(fe),fe},V=function($,re,fe,X){if(!D[$]){var ne={},te={},B=b.createProgram();b.attachShader(B,ee(re,b.VERTEX_SHADER)),b.attachShader(B,ee(fe,b.FRAGMENT_SHADER)),b.linkProgram(B),D[$]={program:B,transaction:function(q){b.useProgram(B),q({setUniform:function(J,_e){for(var ie=[],se=arguments.length-2;se-- >0;)ie[se]=arguments[se+2];var de=te[_e]||(te[_e]=b.getUniformLocation(B,_e));b["uniform"+J].apply(b,[de].concat(ie))},setAttribute:function(J,_e,ie,se,de){var ge=ne[J];ge||(ge=ne[J]={buf:b.createBuffer(),loc:b.getAttribLocation(B,J),data:null}),b.bindBuffer(b.ARRAY_BUFFER,ge.buf),b.vertexAttribPointer(ge.loc,_e,b.FLOAT,!1,0,0),b.enableVertexAttribArray(ge.loc),R?b.vertexAttribDivisor(ge.loc,se):Z("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ge.loc,se),de!==ge.data&&(b.bufferData(b.ARRAY_BUFFER,de,ie),ge.data=de)}})}}}D[$].transaction(X)},W=function($,re){M++;try{b.activeTexture(b.TEXTURE0+M);var fe=j[$];fe||(fe=j[$]=b.createTexture(),b.bindTexture(b.TEXTURE_2D,fe),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST)),b.bindTexture(b.TEXTURE_2D,fe),re(fe,M)}finally{M--}},ye=function($,re,fe){var X=b.createFramebuffer();G.push(X),b.bindFramebuffer(b.FRAMEBUFFER,X),b.activeTexture(b.TEXTURE0+re),b.bindTexture(b.TEXTURE_2D,$),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,$,0);try{fe(X)}finally{b.deleteFramebuffer(X),b.bindFramebuffer(b.FRAMEBUFFER,G[--G.length-1]||null)}},he=function(){F={},D={},j={},M=-1,G.length=0};var R=typeof WebGL2RenderingContext<"u"&&b instanceof WebGL2RenderingContext,F={},D={},j={},M=-1,G=[];b.canvas.addEventListener("webglcontextlost",function($){he(),$.preventDefault()},!1),n.set(b,E={gl:b,isWebGL2:R,getExtension:Z,withProgram:V,withTexture:W,withTextureFramebuffer:ye,handleContextLoss:he})}I(E)}function f(P,I,b,E,R,F,D,j){D===void 0&&(D=15),j===void 0&&(j=null),s(P,function(M){var G=M.gl,Z=M.withProgram,ee=M.withTexture;ee("copy",function(V,W){G.texImage2D(G.TEXTURE_2D,0,G.RGBA,R,F,0,G.RGBA,G.UNSIGNED_BYTE,I),Z("copy",a,i,function(ye){var he=ye.setUniform,$=ye.setAttribute;$("aUV",2,G.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),he("1i","image",W),G.bindFramebuffer(G.FRAMEBUFFER,j||null),G.disable(G.BLEND),G.colorMask(D&8,D&4,D&2,D&1),G.viewport(b,E,R,F),G.scissor(b,E,R,F),G.drawArrays(G.TRIANGLES,0,3)})})})}function d(P,I,b){var E=P.width,R=P.height;s(P,function(F){var D=F.gl,j=new Uint8Array(E*R*4);D.readPixels(0,0,E,R,D.RGBA,D.UNSIGNED_BYTE,j),P.width=I,P.height=b,f(D,j,0,0,E,R)})}var h=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:f,resizeWebGLCanvasWithoutClearing:d});function p(P,I,b,E,R,F){F===void 0&&(F=1);var D=new Uint8Array(P*I),j=E[2]-E[0],M=E[3]-E[1],G=[];e(b,function($,re,fe,X){G.push({x1:$,y1:re,x2:fe,y2:X,minX:Math.min($,fe),minY:Math.min(re,X),maxX:Math.max($,fe),maxY:Math.max(re,X)})}),G.sort(function($,re){return $.maxX-re.maxX});for(var Z=0;Z<P;Z++)for(var ee=0;ee<I;ee++){var V=ye(E[0]+j*(Z+.5)/P,E[1]+M*(ee+.5)/I),W=Math.pow(1-Math.abs(V)/R,F)/2;V<0&&(W=1-W),W=Math.max(0,Math.min(255,Math.round(W*255))),D[ee*P+Z]=W}return D;function ye($,re){for(var fe=1/0,X=1/0,ne=G.length;ne--;){var te=G[ne];if(te.maxX+X<=$)break;if($+X>te.minX&&re-X<te.maxY&&re+X>te.minY){var B=U($,re,te.x1,te.y1,te.x2,te.y2);B<fe&&(fe=B,X=Math.sqrt(fe))}}return he($,re)&&(X=-X),X}function he($,re){for(var fe=0,X=G.length;X--;){var ne=G[X];if(ne.maxX<=$)break;var te=ne.y1>re!=ne.y2>re&&$<(ne.x2-ne.x1)*(re-ne.y1)/(ne.y2-ne.y1)+ne.x1;te&&(fe+=ne.y1<ne.y2?1:-1)}return fe!==0}}function v(P,I,b,E,R,F,D,j,M,G){F===void 0&&(F=1),j===void 0&&(j=0),M===void 0&&(M=0),G===void 0&&(G=0),y(P,I,b,E,R,F,D,null,j,M,G)}function y(P,I,b,E,R,F,D,j,M,G,Z){F===void 0&&(F=1),M===void 0&&(M=0),G===void 0&&(G=0),Z===void 0&&(Z=0);for(var ee=p(P,I,b,E,R,F),V=new Uint8Array(ee.length*4),W=0;W<ee.length;W++)V[W*4+Z]=ee[W];f(D,V,M,G,P,I,1<<3-Z,j)}function U(P,I,b,E,R,F){var D=R-b,j=F-E,M=D*D+j*j,G=M?Math.max(0,Math.min(1,((P-b)*D+(I-E)*j)/M)):0,Z=P-(b+G*D),ee=I-(E+G*j);return Z*Z+ee*ee}var x=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:v,generateIntoFramebuffer:y}),g="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",m="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",C="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",L=new Float32Array([0,0,2,0,0,2]),w=null,k=!1,N={},O=new WeakMap;function Y(P){if(!k&&!H(P))throw new Error("WebGL generation not supported")}function S(P,I,b,E,R,F,D){if(F===void 0&&(F=1),D===void 0&&(D=null),!D&&(D=w,!D)){var j=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!j)throw new Error("OffscreenCanvas or DOM canvas not supported");D=w=j.getContext("webgl",{depth:!1})}Y(D);var M=new Uint8Array(P*I*4);s(D,function(V){var W=V.gl,ye=V.withTexture,he=V.withTextureFramebuffer;ye("readable",function($,re){W.texImage2D(W.TEXTURE_2D,0,W.RGBA,P,I,0,W.RGBA,W.UNSIGNED_BYTE,null),he($,re,function(fe){T(P,I,b,E,R,F,W,fe,0,0,0),W.readPixels(0,0,P,I,W.RGBA,W.UNSIGNED_BYTE,M)})})});for(var G=new Uint8Array(P*I),Z=0,ee=0;Z<M.length;Z+=4)G[ee++]=M[Z];return G}function A(P,I,b,E,R,F,D,j,M,G){F===void 0&&(F=1),j===void 0&&(j=0),M===void 0&&(M=0),G===void 0&&(G=0),T(P,I,b,E,R,F,D,null,j,M,G)}function T(P,I,b,E,R,F,D,j,M,G,Z){F===void 0&&(F=1),M===void 0&&(M=0),G===void 0&&(G=0),Z===void 0&&(Z=0),Y(D);var ee=[];e(b,function(V,W,ye,he){ee.push(V,W,ye,he)}),ee=new Float32Array(ee),s(D,function(V){var W=V.gl,ye=V.isWebGL2,he=V.getExtension,$=V.withProgram,re=V.withTexture,fe=V.withTextureFramebuffer,X=V.handleContextLoss;if(re("rawDistances",function(ne,te){(P!==ne._lastWidth||I!==ne._lastHeight)&&W.texImage2D(W.TEXTURE_2D,0,W.RGBA,ne._lastWidth=P,ne._lastHeight=I,0,W.RGBA,W.UNSIGNED_BYTE,null),$("main",g,m,function(B){var ve=B.setAttribute,q=B.setUniform,oe=!ye&&he("ANGLE_instanced_arrays"),J=!ye&&he("EXT_blend_minmax");ve("aUV",2,W.STATIC_DRAW,0,L),ve("aLineSegment",4,W.DYNAMIC_DRAW,1,ee),q.apply(void 0,["4f","uGlyphBounds"].concat(E)),q("1f","uMaxDistance",R),q("1f","uExponent",F),fe(ne,te,function(_e){W.enable(W.BLEND),W.colorMask(!0,!0,!0,!0),W.viewport(0,0,P,I),W.scissor(0,0,P,I),W.blendFunc(W.ONE,W.ONE),W.blendEquationSeparate(W.FUNC_ADD,ye?W.MAX:J.MAX_EXT),W.clear(W.COLOR_BUFFER_BIT),ye?W.drawArraysInstanced(W.TRIANGLES,0,3,ee.length/4):oe.drawArraysInstancedANGLE(W.TRIANGLES,0,3,ee.length/4)})}),$("post",a,C,function(B){B.setAttribute("aUV",2,W.STATIC_DRAW,0,L),B.setUniform("1i","tex",te),W.bindFramebuffer(W.FRAMEBUFFER,j),W.disable(W.BLEND),W.colorMask(Z===0,Z===1,Z===2,Z===3),W.viewport(M,G,P,I),W.scissor(M,G,P,I),W.drawArrays(W.TRIANGLES,0,3)})}),W.isContextLost())throw X(),new Error("webgl context lost")})}function H(P){var I=!P||P===w?N:P.canvas||P,b=O.get(I);if(b===void 0){k=!0;var E=null;try{var R=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],F=S(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,P);b=F&&R.length===F.length&&F.every(function(D,j){return D===R[j]}),b||(E="bad trial run results",console.info(R,F))}catch(D){b=!1,E=D.message}E&&console.warn("WebGL SDF generation not supported:",E),k=!1,O.set(I,b)}return b}var z=Object.freeze({__proto__:null,generate:S,generateIntoCanvas:A,generateIntoFramebuffer:T,isSupported:H});function K(P,I,b,E,R,F){R===void 0&&(R=Math.max(E[2]-E[0],E[3]-E[1])/2),F===void 0&&(F=1);try{return S.apply(z,arguments)}catch(D){return console.info("WebGL SDF generation failed, falling back to JS",D),p.apply(x,arguments)}}function Q(P,I,b,E,R,F,D,j,M,G){R===void 0&&(R=Math.max(E[2]-E[0],E[3]-E[1])/2),F===void 0&&(F=1),j===void 0&&(j=0),M===void 0&&(M=0),G===void 0&&(G=0);try{return A.apply(z,arguments)}catch(Z){return console.info("WebGL SDF generation failed, falling back to JS",Z),v.apply(x,arguments)}}return r.forEachPathCommand=t,r.generate=K,r.generateIntoCanvas=Q,r.javascript=x,r.pathToLineSegments=e,r.webgl=z,r.webglUtils=h,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}function Qi(){var l=function(r){var c={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},u={},t={};u.L=1,t[1]="L",Object.keys(c).forEach(function(X,ne){u[X]=1<<ne+1,t[u[X]]=X}),Object.freeze(u);var e=u.LRI|u.RLI|u.FSI,a=u.L|u.R|u.AL,i=u.B|u.S|u.WS|u.ON|u.FSI|u.LRI|u.RLI|u.PDI,n=u.BN|u.RLE|u.LRE|u.RLO|u.LRO|u.PDF,o=u.S|u.WS|u.B|e|u.PDI|n,s=null;function f(){if(!s){s=new Map;var X=function(te){if(c.hasOwnProperty(te)){var B=0;c[te].split(",").forEach(function(ve){var q=ve.split("+"),oe=q[0],J=q[1];oe=parseInt(oe,36),J=J?parseInt(J,36):0,s.set(B+=oe,u[te]);for(var _e=0;_e<J;_e++)s.set(++B,u[te])})}};for(var ne in c)X(ne)}}function d(X){return f(),s.get(X.codePointAt(0))||u.L}function h(X){return t[d(X)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function v(X,ne){var te=36,B=0,ve=new Map,q=ne&&new Map,oe;return X.split(",").forEach(function J(_e){if(_e.indexOf("+")!==-1)for(var ie=+_e;ie--;)J(oe);else{oe=_e;var se=_e.split(">"),de=se[0],ge=se[1];de=String.fromCodePoint(B+=parseInt(de,te)),ge=String.fromCodePoint(B+=parseInt(ge,te)),ve.set(de,ge),ne&&q.set(ge,de)}}),{map:ve,reverseMap:q}}var y,U,x;function g(){if(!y){var X=v(p.pairs,!0),ne=X.map,te=X.reverseMap;y=ne,U=te,x=v(p.canonical,!1).map}}function m(X){return g(),y.get(X)||null}function C(X){return g(),U.get(X)||null}function L(X){return g(),x.get(X)||null}var w=u.L,k=u.R,N=u.EN,O=u.ES,Y=u.ET,S=u.AN,A=u.CS,T=u.B,H=u.S,z=u.ON,K=u.BN,Q=u.NSM,P=u.AL,I=u.LRO,b=u.RLO,E=u.LRE,R=u.RLE,F=u.PDF,D=u.LRI,j=u.RLI,M=u.FSI,G=u.PDI;function Z(X,ne){for(var te=125,B=new Uint32Array(X.length),ve=0;ve<X.length;ve++)B[ve]=d(X[ve]);var q=new Map;function oe(Ve,$e){var Xe=B[Ve];B[Ve]=$e,q.set(Xe,q.get(Xe)-1),Xe&i&&q.set(i,q.get(i)-1),q.set($e,(q.get($e)||0)+1),$e&i&&q.set(i,(q.get(i)||0)+1)}for(var J=new Uint8Array(X.length),_e=new Map,ie=[],se=null,de=0;de<X.length;de++)se||ie.push(se={start:de,end:X.length-1,level:ne==="rtl"?1:ne==="ltr"?0:Xn(de,!1)}),B[de]&T&&(se.end=de,se=null);for(var ge=R|E|b|I|e|G|F|T,Ee=function(Ve){return Ve+(Ve&1?1:2)},De=function(Ve){return Ve+(Ve&1?2:1)},be=0;be<ie.length;be++){se=ie[be];var xe=[{_level:se.level,_override:0,_isolate:0}],ue=void 0,Le=0,Ue=0,He=0;q.clear();for(var we=se.start;we<=se.end;we++){var pe=B[we];if(ue=xe[xe.length-1],q.set(pe,(q.get(pe)||0)+1),pe&i&&q.set(i,(q.get(i)||0)+1),pe&ge)if(pe&(R|E)){J[we]=ue._level;var Te=(pe===R?De:Ee)(ue._level);Te<=te&&!Le&&!Ue?xe.push({_level:Te,_override:0,_isolate:0}):Le||Ue++}else if(pe&(b|I)){J[we]=ue._level;var ut=(pe===b?De:Ee)(ue._level);ut<=te&&!Le&&!Ue?xe.push({_level:ut,_override:pe&b?k:w,_isolate:0}):Le||Ue++}else if(pe&e){pe&M&&(pe=Xn(we+1,!0)===1?j:D),J[we]=ue._level,ue._override&&oe(we,ue._override);var Ae=(pe===j?De:Ee)(ue._level);Ae<=te&&Le===0&&Ue===0?(He++,xe.push({_level:Ae,_override:0,_isolate:1,_isolInitIndex:we})):Le++}else if(pe&G){if(Le>0)Le--;else if(He>0){for(Ue=0;!xe[xe.length-1]._isolate;)xe.pop();var Se=xe[xe.length-1]._isolInitIndex;Se!=null&&(_e.set(Se,we),_e.set(we,Se)),xe.pop(),He--}ue=xe[xe.length-1],J[we]=ue._level,ue._override&&oe(we,ue._override)}else pe&F?(Le===0&&(Ue>0?Ue--:!ue._isolate&&xe.length>1&&(xe.pop(),ue=xe[xe.length-1])),J[we]=ue._level):pe&T&&(J[we]=se.level);else J[we]=ue._level,ue._override&&pe!==K&&oe(we,ue._override)}for(var Re=[],Ce=null,me=se.start;me<=se.end;me++){var ke=B[me];if(!(ke&n)){var Be=J[me],Pe=ke&e,Fe=ke===G;Ce&&Be===Ce._level?(Ce._end=me,Ce._endsWithIsolInit=Pe):Re.push(Ce={_start:me,_end:me,_level:Be,_startsWithPDI:Fe,_endsWithIsolInit:Pe})}}for(var qe=[],dt=0;dt<Re.length;dt++){var st=Re[dt];if(!st._startsWithPDI||st._startsWithPDI&&!_e.has(st._start)){for(var ht=[Ce=st],yt=void 0;Ce&&Ce._endsWithIsolInit&&(yt=_e.get(Ce._end))!=null;)for(var lt=dt+1;lt<Re.length;lt++)if(Re[lt]._start===yt){ht.push(Ce=Re[lt]);break}for(var je=[],bt=0;bt<ht.length;bt++)for(var wn=ht[bt],Nr=wn._start;Nr<=wn._end;Nr++)je.push(Nr);for(var Xa=J[je[0]],Un=se.level,sr=je[0]-1;sr>=0;sr--)if(!(B[sr]&n)){Un=J[sr];break}var Pr=je[je.length-1],Ya=J[Pr],Cn=se.level;if(!(B[Pr]&e)){for(var lr=Pr+1;lr<=se.end;lr++)if(!(B[lr]&n)){Cn=J[lr];break}}qe.push({_seqIndices:je,_sosType:Math.max(Un,Xa)%2?k:w,_eosType:Math.max(Cn,Ya)%2?k:w})}}for(var Gr=0;Gr<qe.length;Gr++){var Br=qe[Gr],le=Br._seqIndices,jt=Br._sosType,Za=Br._eosType,Dt=J[le[0]]&1?k:w;if(q.get(Q))for(var cr=0;cr<le.length;cr++){var kn=le[cr];if(B[kn]&Q){for(var jr=jt,fr=cr-1;fr>=0;fr--)if(!(B[le[fr]]&n)){jr=B[le[fr]];break}oe(kn,jr&(e|G)?z:jr)}}if(q.get(N))for(var ur=0;ur<le.length;ur++){var Dn=le[ur];if(B[Dn]&N)for(var dr=ur-1;dr>=-1;dr--){var Ln=dr===-1?jt:B[le[dr]];if(Ln&a){Ln===P&&oe(Dn,S);break}}}if(q.get(P))for(var zr=0;zr<le.length;zr++){var Rn=le[zr];B[Rn]&P&&oe(Rn,k)}if(q.get(O)||q.get(A))for(var zt=1;zt<le.length-1;zt++){var Wr=le[zt];if(B[Wr]&(O|A)){for(var Lt=0,Hr=0,Vr=zt-1;Vr>=0&&(Lt=B[le[Vr]],!!(Lt&n));Vr--);for(var Xr=zt+1;Xr<le.length&&(Hr=B[le[Xr]],!!(Hr&n));Xr++);Lt===Hr&&(B[Wr]===O?Lt===N:Lt&(N|S))&&oe(Wr,Lt)}}if(q.get(N))for(var et=0;et<le.length;et++){var Ka=le[et];if(B[Ka]&N){for(var hr=et-1;hr>=0&&B[le[hr]]&(Y|n);hr--)oe(le[hr],N);for(et++;et<le.length&&B[le[et]]&(Y|n|N);et++)B[le[et]]!==N&&oe(le[et],N)}}if(q.get(Y)||q.get(O)||q.get(A))for(var Wt=0;Wt<le.length;Wt++){var Fn=le[Wt];if(B[Fn]&(Y|O|A)){oe(Fn,z);for(var pr=Wt-1;pr>=0&&B[le[pr]]&n;pr--)oe(le[pr],z);for(var vr=Wt+1;vr<le.length&&B[le[vr]]&n;vr++)oe(le[vr],z)}}if(q.get(N))for(var Yr=0,On=jt;Yr<le.length;Yr++){var Mn=le[Yr],Zr=B[Mn];Zr&N?On===w&&oe(Mn,w):Zr&a&&(On=Zr)}if(q.get(i)){var Ht=k|N|S,In=Ht|w,gr=[];{for(var Rt=[],Ft=0;Ft<le.length;Ft++)if(B[le[Ft]]&i){var Vt=X[le[Ft]],Nn=void 0;if(m(Vt)!==null)if(Rt.length<63)Rt.push({char:Vt,seqIndex:Ft});else break;else if((Nn=C(Vt))!==null)for(var Xt=Rt.length-1;Xt>=0;Xt--){var Kr=Rt[Xt].char;if(Kr===Nn||Kr===C(L(Vt))||m(L(Kr))===Vt){gr.push([Rt[Xt].seqIndex,Ft]),Rt.length=Xt;break}}}gr.sort(function(Ve,$e){return Ve[0]-$e[0]})}for(var Jr=0;Jr<gr.length;Jr++){for(var Pn=gr[Jr],mr=Pn[0],qr=Pn[1],Gn=!1,Qe=0,Qr=mr+1;Qr<qr;Qr++){var Bn=le[Qr];if(B[Bn]&In){Gn=!0;var jn=B[Bn]&Ht?k:w;if(jn===Dt){Qe=jn;break}}}if(Gn&&!Qe){Qe=jt;for(var $r=mr-1;$r>=0;$r--){var zn=le[$r];if(B[zn]&In){var Wn=B[zn]&Ht?k:w;Wn!==Dt?Qe=Wn:Qe=Dt;break}}}if(Qe){if(B[le[mr]]=B[le[qr]]=Qe,Qe!==Dt){for(var Yt=mr+1;Yt<le.length;Yt++)if(!(B[le[Yt]]&n)){d(X[le[Yt]])&Q&&(B[le[Yt]]=Qe);break}}if(Qe!==Dt){for(var Zt=qr+1;Zt<le.length;Zt++)if(!(B[le[Zt]]&n)){d(X[le[Zt]])&Q&&(B[le[Zt]]=Qe);break}}}}for(var pt=0;pt<le.length;pt++)if(B[le[pt]]&i){for(var Hn=pt,en=pt,tn=jt,Kt=pt-1;Kt>=0;Kt--)if(B[le[Kt]]&n)Hn=Kt;else{tn=B[le[Kt]]&Ht?k:w;break}for(var Vn=Za,Jt=pt+1;Jt<le.length;Jt++)if(B[le[Jt]]&(i|n))en=Jt;else{Vn=B[le[Jt]]&Ht?k:w;break}for(var rn=Hn;rn<=en;rn++)B[le[rn]]=tn===Vn?tn:Dt;pt=en}}}for(var Ze=se.start;Ze<=se.end;Ze++){var Ja=J[Ze],yr=B[Ze];if(Ja&1?yr&(w|N|S)&&J[Ze]++:yr&k?J[Ze]++:yr&(S|N)&&(J[Ze]+=2),yr&n&&(J[Ze]=Ze===0?se.level:J[Ze-1]),Ze===se.end||d(X[Ze])&(H|T))for(var br=Ze;br>=0&&d(X[br])&o;br--)J[br]=se.level}}return{levels:J,paragraphs:ie};function Xn(Ve,$e){for(var Xe=Ve;Xe<X.length;Xe++){var vt=B[Xe];if(vt&(k|P))return 1;if(vt&(T|w)||$e&&vt===G)return 0;if(vt&e){var Yn=qa(Xe);Xe=Yn===-1?X.length:Yn}}return 0}function qa(Ve){for(var $e=1,Xe=Ve+1;Xe<X.length;Xe++){var vt=B[Xe];if(vt&T)break;if(vt&G){if(--$e===0)return Xe}else vt&e&&$e++}return-1}}var ee="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",V;function W(){if(!V){var X=v(ee,!0),ne=X.map,te=X.reverseMap;te.forEach(function(B,ve){ne.set(ve,B)}),V=ne}}function ye(X){return W(),V.get(X)||null}function he(X,ne,te,B){var ve=X.length;te=Math.max(0,te==null?0:+te),B=Math.min(ve-1,B==null?ve-1:+B);for(var q=new Map,oe=te;oe<=B;oe++)if(ne[oe]&1){var J=ye(X[oe]);J!==null&&q.set(oe,J)}return q}function $(X,ne,te,B){var ve=X.length;te=Math.max(0,te==null?0:+te),B=Math.min(ve-1,B==null?ve-1:+B);var q=[];return ne.paragraphs.forEach(function(oe){var J=Math.max(te,oe.start),_e=Math.min(B,oe.end);if(J<_e){for(var ie=ne.levels.slice(J,_e+1),se=_e;se>=J&&d(X[se])&o;se--)ie[se]=oe.level;for(var de=oe.level,ge=1/0,Ee=0;Ee<ie.length;Ee++){var De=ie[Ee];De>de&&(de=De),De<ge&&(ge=De|1)}for(var be=de;be>=ge;be--)for(var xe=0;xe<ie.length;xe++)if(ie[xe]>=be){for(var ue=xe;xe+1<ie.length&&ie[xe+1]>=be;)xe++;xe>ue&&q.push([ue+J,xe+J])}}}),q}function re(X,ne,te,B){var ve=fe(X,ne,te,B),q=[].concat(X);return ve.forEach(function(oe,J){q[J]=(ne.levels[oe]&1?ye(X[oe]):null)||X[oe]}),q.join("")}function fe(X,ne,te,B){for(var ve=$(X,ne,te,B),q=[],oe=0;oe<X.length;oe++)q[oe]=oe;return ve.forEach(function(J){for(var _e=J[0],ie=J[1],se=q.slice(_e,ie+1),de=se.length;de--;)q[ie-de]=se[de]}),q}return r.closingToOpeningBracket=C,r.getBidiCharType=d,r.getBidiCharTypeName=h,r.getCanonicalBracket=L,r.getEmbeddingLevels=Z,r.getMirroredCharacter=ye,r.getMirroredCharactersMap=he,r.getReorderSegments=$,r.getReorderedIndices=fe,r.getReorderedString=re,r.openingToClosingBracket=m,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}const Fa=/\bvoid\s+main\s*\(\s*\)\s*{/g;function mn(l){const r=/^[ \t]*#include +<([\w\d./]+)>/gm;function c(u,t){let e=oi[t];return e?mn(e):u}return l.replace(r,c)}const Ie=[];for(let l=0;l<256;l++)Ie[l]=(l<16?"0":"")+l.toString(16);function $i(){const l=Math.random()*4294967295|0,r=Math.random()*4294967295|0,c=Math.random()*4294967295|0,u=Math.random()*4294967295|0;return(Ie[l&255]+Ie[l>>8&255]+Ie[l>>16&255]+Ie[l>>24&255]+"-"+Ie[r&255]+Ie[r>>8&255]+"-"+Ie[r>>16&15|64]+Ie[r>>24&255]+"-"+Ie[c&63|128]+Ie[c>>8&255]+"-"+Ie[c>>16&255]+Ie[c>>24&255]+Ie[u&255]+Ie[u>>8&255]+Ie[u>>16&255]+Ie[u>>24&255]).toUpperCase()}const xt=Object.assign||function(){let l=arguments[0];for(let r=1,c=arguments.length;r<c;r++){let u=arguments[r];if(u)for(let t in u)Object.prototype.hasOwnProperty.call(u,t)&&(l[t]=u[t])}return l},eo=Date.now(),oa=new WeakMap,sa=new Map;let to=1e10;function yn(l,r){const c=io(r);let u=oa.get(l);if(u||oa.set(l,u=Object.create(null)),u[c])return new u[c];const t=`_onBeforeCompile${c}`,e=function(o,s){l.onBeforeCompile.call(this,o,s);const f=this.customProgramCacheKey()+"|"+o.vertexShader+"|"+o.fragmentShader;let d=sa[f];if(!d){const h=ro(this,o,r,c);d=sa[f]=h}o.vertexShader=d.vertexShader,o.fragmentShader=d.fragmentShader,xt(o.uniforms,this.uniforms),r.timeUniform&&(o.uniforms[r.timeUniform]={get value(){return Date.now()-eo}}),this[t]&&this[t](o)},a=function(){return i(r.chained?l:l.clone())},i=function(o){const s=Object.create(o,n);return Object.defineProperty(s,"baseMaterial",{value:l}),Object.defineProperty(s,"id",{value:to++}),s.uuid=$i(),s.uniforms=xt({},o.uniforms,r.uniforms),s.defines=xt({},o.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${c}`]="",s.extensions=xt({},o.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>l.type,set:o=>{l.type=o}},isDerivedFrom:{writable:!0,configurable:!0,value:function(o){const s=this.baseMaterial;return o===s||s.isDerivedMaterial&&s.isDerivedFrom(o)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return l.customProgramCacheKey()+"|"+c}},onBeforeCompile:{get(){return e},set(o){this[t]=o}},copy:{writable:!0,configurable:!0,value:function(o){return l.copy.call(this,o),!l.isShaderMaterial&&!l.isDerivedMaterial&&(xt(this.extensions,o.extensions),xt(this.defines,o.defines),xt(this.uniforms,pn.clone(o.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const o=new l.constructor;return i(o).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let o=this._depthMaterial;return o||(o=this._depthMaterial=yn(l.isDerivedMaterial?l.getDepthMaterial():new ai({depthPacking:ii}),r),o.defines.IS_DEPTH_MATERIAL="",o.uniforms=this.uniforms),o}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let o=this._distanceMaterial;return o||(o=this._distanceMaterial=yn(l.isDerivedMaterial?l.getDistanceMaterial():new ni,r),o.defines.IS_DISTANCE_MATERIAL="",o.uniforms=this.uniforms),o}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:o,_distanceMaterial:s}=this;o&&o.dispose(),s&&s.dispose(),l.dispose.call(this)}}};return u[c]=a,new a}function ro(l,{vertexShader:r,fragmentShader:c},u,t){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:i,vertexTransform:n,fragmentDefs:o,fragmentMainIntro:s,fragmentMainOutro:f,fragmentColorTransform:d,customRewriter:h,timeUniform:p}=u;if(e=e||"",a=a||"",i=i||"",o=o||"",s=s||"",f=f||"",(n||h)&&(r=mn(r)),(d||h)&&(c=c.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),c=mn(c)),h){let v=h({vertexShader:r,fragmentShader:c});r=v.vertexShader,c=v.fragmentShader}if(d){let v=[];c=c.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,y=>(v.push(y),"")),f=`${d}
${v.join(`
`)}
${f}`}if(p){const v=`
uniform float ${p};
`;e=v+e,o=v+o}return n&&(r=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${r}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${a}
`,r=r.replace(/\b(position|normal|uv)\b/g,(v,y,U,x)=>/\battribute\s+vec[23]\s+$/.test(x.substr(0,U))?y:`troika_${y}_${t}`),l.map&&l.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),r=la(r,t,e,a,i),c=la(c,t,o,s,f),{vertexShader:r,fragmentShader:c}}function la(l,r,c,u,t){return(u||t||c)&&(l=l.replace(Fa,`
${c}
void troikaOrigMain${r}() {`),l+=`
void main() {
  ${u}
  troikaOrigMain${r}();
  ${t}
}`),l}function no(l,r){return l==="uniforms"?void 0:typeof r=="function"?r.toString():r}let ao=0;const ca=new Map;function io(l){const r=JSON.stringify(l,no);let c=ca.get(r);return c==null&&ca.set(r,c=++ao),c}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function oo(){return typeof window>"u"&&(self.window=self),function(l){var r={parse:function(t){var e=r._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var i=4;e.readUshort(a,i),i+=2,e.readUshort(a,i),i+=2;var n=e.readUint(a,i);i+=4;for(var o=[],s=0;s<n;s++){var f=e.readUint(a,i);i+=4,o.push(r._readFont(a,f))}return o}return[r._readFont(a,0)]},_readFont:function(t,e){var a=r._bin,i=e;a.readFixed(t,e),e+=4;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:i},f={},d=0;d<n;d++){var h=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var p=a.readUint(t,e);e+=4;var v=a.readUint(t,e);e+=4,f[h]={offset:p,length:v}}for(d=0;d<o.length;d++){var y=o[d];f[y]&&(s[y.trim()]=r[y.trim()].parse(t,f[y].offset,f[y].length,s))}return s},_tabOffset:function(t,e,a){for(var i=r._bin,n=i.readUshort(t,a+4),o=a+12,s=0;s<n;s++){var f=i.readASCII(t,o,4);o+=4,i.readUint(t,o),o+=4;var d=i.readUint(t,o);if(o+=4,i.readUint(t,o),o+=4,f==e)return d}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(r._bin.readUshort(t,e+2*n));return i},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var i="",n=0;n<a;n++)i+=String.fromCharCode(t[e+n]);return i},readUnicode:function(t,e,a){for(var i="",n=0;n<a;n++){var o=t[e++]<<8|t[e++];i+=String.fromCharCode(o)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var i=r._bin._tdec;return i&&e==0&&a==t.length?i.decode(t):r._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(t[e+n]);return i},readASCIIArray:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(String.fromCharCode(t[e+n]));return i},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,a,i,n){var o=r._bin,s={},f=e;o.readFixed(t,e),e+=4;var d=o.readUshort(t,e);e+=2;var h=o.readUshort(t,e);e+=2;var p=o.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,f+d),s.featureList=r._lctf.readFeatureList(t,f+h),s.lookupList=r._lctf.readLookupList(t,f+p,n),s},r._lctf.readLookupList=function(t,e,a){var i=r._bin,n=e,o=[],s=i.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var d=i.readUshort(t,e);e+=2;var h=r._lctf.readLookupTable(t,n+d,a);o.push(h)}return o},r._lctf.readLookupTable=function(t,e,a){var i=r._bin,n=e,o={tabs:[]};o.ltype=i.readUshort(t,e),e+=2,o.flag=i.readUshort(t,e),e+=2;var s=i.readUshort(t,e);e+=2;for(var f=o.ltype,d=0;d<s;d++){var h=i.readUshort(t,e);e+=2;var p=a(t,f,n+h,o);o.tabs.push(p)}return o},r._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},r._lctf.readClassDef=function(t,e){var a=r._bin,i=[],n=a.readUshort(t,e);if(e+=2,n==1){var o=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++)i.push(o+f),i.push(o+f),i.push(a.readUshort(t,e)),e+=2}if(n==2){var d=a.readUshort(t,e);for(e+=2,f=0;f<d;f++)i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2}return i},r._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var i=t[a],n=t[a+1];if(t[a+2],i<=e&&e<=n)return a}return-1},r._lctf.readCoverage=function(t,e){var a=r._bin,i={};i.fmt=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.fmt==1&&(i.tab=a.readUshorts(t,e,n)),i.fmt==2&&(i.tab=a.readUshorts(t,e,3*n)),i},r._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var i=r._lctf.getInterval(a,e);if(i!=-1)return a[i+2]+(e-a[i])}return-1},r._lctf.readFeatureList=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2;var h=r._lctf.readFeatureTable(t,i+d);h.tag=f.trim(),n.push(h)}return n},r._lctf.readFeatureTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.featureParams=i+o);var s=a.readUshort(t,e);e+=2,n.tab=[];for(var f=0;f<s;f++)n.tab.push(a.readUshort(t,e+2*f));return n},r._lctf.readScriptList=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2,n[f.trim()]=r._lctf.readScriptTable(t,i+d)}return n},r._lctf.readScriptTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.default=r._lctf.readLangSysTable(t,i+o));var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var d=a.readASCII(t,e,4);e+=4;var h=a.readUshort(t,e);e+=2,n[d.trim()]=r._lctf.readLangSysTable(t,i+h)}return n},r._lctf.readLangSysTable=function(t,e){var a=r._bin,i={};a.readUshort(t,e),e+=2,i.reqFeature=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.features=a.readUshorts(t,e,n),i},r.CFF={},r.CFF.parse=function(t,e,a){var i=r._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var o=[],s=0;s<n.length-1;s++)o.push(i.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var f=[];e=r.CFF.readIndex(t,e,f);var d=[];for(s=0;s<f.length-1;s++)d.push(r.CFF.readDict(t,e+f[s],e+f[s+1]));e+=f[f.length-1];var h=d[0],p=[];e=r.CFF.readIndex(t,e,p);var v=[];for(s=0;s<p.length-1;s++)v.push(i.readASCII(t,e+p[s],p[s+1]-p[s]));if(e+=p[p.length-1],r.CFF.readSubrs(t,e,h),h.CharStrings){e=h.CharStrings,p=[],e=r.CFF.readIndex(t,e,p);var y=[];for(s=0;s<p.length-1;s++)y.push(i.readBytes(t,e+p[s],p[s+1]-p[s]));h.CharStrings=y}if(h.ROS){e=h.FDArray;var U=[];for(e=r.CFF.readIndex(t,e,U),h.FDArray=[],s=0;s<U.length-1;s++){var x=r.CFF.readDict(t,e+U[s],e+U[s+1]);r.CFF._readFDict(t,x,v),h.FDArray.push(x)}e+=U[U.length-1],e=h.FDSelect,h.FDSelect=[];var g=t[e];if(e++,g!=3)throw g;var m=i.readUshort(t,e);for(e+=2,s=0;s<m+1;s++)h.FDSelect.push(i.readUshort(t,e),t[e+2]),e+=3}return h.Encoding&&(h.Encoding=r.CFF.readEncoding(t,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=r.CFF.readCharset(t,h.charset,h.CharStrings.length)),r.CFF._readFDict(t,h,v),h},r.CFF._readFDict=function(t,e,a){var i;for(var n in e.Private&&(i=e.Private[1],e.Private=r.CFF.readDict(t,i,i+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},r.CFF.readSubrs=function(t,e,a){var i=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var o,s=n.length;o=s<1240?107:s<33900?1131:32768,a.Bias=o,a.Subrs=[];for(var f=0;f<n.length-1;f++)a.Subrs.push(i.readBytes(t,e+n[f],n[f+1]-n[f]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,a){r._bin;var i=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var o=t[e];e++;for(var s=0;s<o;s++)i.push(t[e+s]);return i},r.CFF.readCharset=function(t,e,a){var i=r._bin,n=[".notdef"],o=t[e];if(e++,o==0)for(var s=0;s<a;s++){var f=i.readUshort(t,e);e+=2,n.push(f)}else{if(o!=1&&o!=2)throw"error: format: "+o;for(;n.length<a;){f=i.readUshort(t,e),e+=2;var d=0;for(o==1?(d=t[e],e++):(d=i.readUshort(t,e),e+=2),s=0;s<=d;s++)n.push(f),f++}}return n},r.CFF.readIndex=function(t,e,a){var i=r._bin,n=i.readUshort(t,e)+1,o=t[e+=2];if(e++,o==1)for(var s=0;s<n;s++)a.push(t[e+s]);else if(o==2)for(s=0;s<n;s++)a.push(i.readUshort(t,e+2*s));else if(o==3)for(s=0;s<n;s++)a.push(16777215&i.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+o+", count: "+n;return(e+=n*o)-1},r.CFF.getCharString=function(t,e,a){var i=r._bin,n=t[e],o=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,f=null,d=null;n<=20&&(f=n,s=1),n==12&&(f=100*n+o,s=2),21<=n&&n<=27&&(f=n,s=1),n==28&&(d=i.readShort(t,e+1),s=3),29<=n&&n<=31&&(f=n,s=1),32<=n&&n<=246&&(d=n-139,s=1),247<=n&&n<=250&&(d=256*(n-247)+o+108,s=2),251<=n&&n<=254&&(d=256*-(n-251)-o-108,s=2),n==255&&(d=i.readInt(t,e+1)/65535,s=5),a.val=d??"o"+f,a.size=s},r.CFF.readCharString=function(t,e,a){for(var i=e+a,n=r._bin,o=[];e<i;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var d=1,h=null,p=null;s<=20&&(h=s,d=1),s==12&&(h=100*s+f,d=2),s!=19&&s!=20||(h=s,d=2),21<=s&&s<=27&&(h=s,d=1),s==28&&(p=n.readShort(t,e+1),d=3),29<=s&&s<=31&&(h=s,d=1),32<=s&&s<=246&&(p=s-139,d=1),247<=s&&s<=250&&(p=256*(s-247)+f+108,d=2),251<=s&&s<=254&&(p=256*-(s-251)-f-108,d=2),s==255&&(p=n.readInt(t,e+1)/65535,d=5),o.push(p??"o"+h),e+=d}return o},r.CFF.readDict=function(t,e,a){for(var i=r._bin,n={},o=[];e<a;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var d=1,h=null,p=null;if(s==28&&(p=i.readShort(t,e+1),d=3),s==29&&(p=i.readInt(t,e+1),d=5),32<=s&&s<=246&&(p=s-139,d=1),247<=s&&s<=250&&(p=256*(s-247)+f+108,d=2),251<=s&&s<=254&&(p=256*-(s-251)-f-108,d=2),s==255)throw p=i.readInt(t,e+1)/65535,d=5,"unknown number";if(s==30){var v=[];for(d=1;;){var y=t[e+d];d++;var U=y>>4,x=15&y;if(U!=15&&v.push(U),x!=15&&v.push(x),x==15)break}for(var g="",m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],C=0;C<v.length;C++)g+=m[v[C]];p=parseFloat(g)}s<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],d=1,s==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],d=2)),h!=null?(n[h]=o.length==1?o[0]:o,o=[]):o.push(p),e+=d}return n},r.cmap={},r.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var f=0;f<o;f++){var d=i.readUshort(t,e);e+=2;var h=i.readUshort(t,e);e+=2;var p=i.readUint(t,e);e+=4;var v="p"+d+"e"+h,y=s.indexOf(p);if(y==-1){var U;y=n.tables.length,s.push(p);var x=i.readUshort(t,p);x==0?U=r.cmap.parse0(t,p):x==4?U=r.cmap.parse4(t,p):x==6?U=r.cmap.parse6(t,p):x==12?U=r.cmap.parse12(t,p):console.debug("unknown format: "+x,d,h,p),n.tables.push(U)}if(n[v]!=null)throw"multiple tables for one platform+encoding";n[v]=y}return n},r.cmap.parse0=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,i.map=[];for(var o=0;o<n-6;o++)i.map.push(t[e+o]);return i},r.cmap.parse4=function(t,e){var a=r._bin,i=e,n={};n.format=a.readUshort(t,e),e+=2;var o=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var f=s/2;n.searchRange=a.readUshort(t,e),e+=2,n.entrySelector=a.readUshort(t,e),e+=2,n.rangeShift=a.readUshort(t,e),e+=2,n.endCount=a.readUshorts(t,e,f),e+=2*f,e+=2,n.startCount=a.readUshorts(t,e,f),e+=2*f,n.idDelta=[];for(var d=0;d<f;d++)n.idDelta.push(a.readShort(t,e)),e+=2;for(n.idRangeOffset=a.readUshorts(t,e,f),e+=2*f,n.glyphIdArray=[];e<i+o;)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,i.firstCode=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,i.glyphIdArray=[];for(var o=0;o<n;o++)i.glyphIdArray.push(a.readUshort(t,e)),e+=2;return i},r.cmap.parse12=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var n=a.readUint(t,e);e+=4,i.groups=[];for(var o=0;o<n;o++){var s=e+12*o,f=a.readUint(t,s+0),d=a.readUint(t,s+4),h=a.readUint(t,s+8);i.groups.push([f,d,h])}return i},r.glyf={},r.glyf.parse=function(t,e,a,i){for(var n=[],o=0;o<i.maxp.numGlyphs;o++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var a=r._bin,i=t._data,n=r._tabOffset(i,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var o={};if(o.noc=a.readShort(i,n),n+=2,o.xMin=a.readShort(i,n),n+=2,o.yMin=a.readShort(i,n),n+=2,o.xMax=a.readShort(i,n),n+=2,o.yMax=a.readShort(i,n),n+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(a.readUshort(i,n)),n+=2;var f=a.readUshort(i,n);if(n+=2,i.length-n<f)return null;o.instructions=a.readBytes(i,n,f),n+=f;var d=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<d;s++){var h=i[n];if(n++,o.flags.push(h),(8&h)!=0){var p=i[n];n++;for(var v=0;v<p;v++)o.flags.push(h),s++}}for(o.xs=[],s=0;s<d;s++){var y=(2&o.flags[s])!=0,U=(16&o.flags[s])!=0;y?(o.xs.push(U?i[n]:-i[n]),n++):U?o.xs.push(0):(o.xs.push(a.readShort(i,n)),n+=2)}for(o.ys=[],s=0;s<d;s++)y=(4&o.flags[s])!=0,U=(32&o.flags[s])!=0,y?(o.ys.push(U?i[n]:-i[n]),n++):U?o.ys.push(0):(o.ys.push(a.readShort(i,n)),n+=2);var x=0,g=0;for(s=0;s<d;s++)x+=o.xs[s],g+=o.ys[s],o.xs[s]=x,o.ys[s]=g}else{var m;o.parts=[];do{m=a.readUshort(i,n),n+=2;var C={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(C),C.glyphIndex=a.readUshort(i,n),n+=2,1&m){var L=a.readShort(i,n);n+=2;var w=a.readShort(i,n);n+=2}else L=a.readInt8(i,n),n++,w=a.readInt8(i,n),n++;2&m?(C.m.tx=L,C.m.ty=w):(C.p1=L,C.p2=w),8&m?(C.m.a=C.m.d=a.readF2dot14(i,n),n+=2):64&m?(C.m.a=a.readF2dot14(i,n),n+=2,C.m.d=a.readF2dot14(i,n),n+=2):128&m&&(C.m.a=a.readF2dot14(i,n),n+=2,C.m.b=a.readF2dot14(i,n),n+=2,C.m.c=a.readF2dot14(i,n),n+=2,C.m.d=a.readF2dot14(i,n),n+=2)}while(32&m);if(256&m){var k=a.readUshort(i,n);for(n+=2,o.instr=[],s=0;s<k;s++)o.instr.push(i[n]),n++}}return o},r.GDEF={},r.GDEF.parse=function(t,e,a,i){var n=e;e+=4;var o=r._bin.readUshort(t,e);return{glyphClassDef:o===0?null:r._lctf.readClassDef(t,n+o)}},r.GPOS={},r.GPOS.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GPOS.subt)},r.GPOS.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,f+o)}if(e==1&&s.fmt==1){var d=n.readUshort(t,a);a+=2,d!=0&&(s.pos=r.GPOS.readValueRecord(t,a,d))}else if(e==2&&s.fmt>=1&&s.fmt<=2){d=n.readUshort(t,a),a+=2;var h=n.readUshort(t,a);a+=2;var p=r._lctf.numOfOnes(d),v=r._lctf.numOfOnes(h);if(s.fmt==1){s.pairsets=[];var y=n.readUshort(t,a);a+=2;for(var U=0;U<y;U++){var x=o+n.readUshort(t,a);a+=2;var g=n.readUshort(t,x);x+=2;for(var m=[],C=0;C<g;C++){var L=n.readUshort(t,x);x+=2,d!=0&&(S=r.GPOS.readValueRecord(t,x,d),x+=2*p),h!=0&&(A=r.GPOS.readValueRecord(t,x,h),x+=2*v),m.push({gid2:L,val1:S,val2:A})}s.pairsets.push(m)}}if(s.fmt==2){var w=n.readUshort(t,a);a+=2;var k=n.readUshort(t,a);a+=2;var N=n.readUshort(t,a);a+=2;var O=n.readUshort(t,a);for(a+=2,s.classDef1=r._lctf.readClassDef(t,o+w),s.classDef2=r._lctf.readClassDef(t,o+k),s.matrix=[],U=0;U<N;U++){var Y=[];for(C=0;C<O;C++){var S=null,A=null;d!=0&&(S=r.GPOS.readValueRecord(t,a,d),a+=2*p),h!=0&&(A=r.GPOS.readValueRecord(t,a,h),a+=2*v),Y.push({val1:S,val2:A})}s.matrix.push(Y)}}}else if(e==4&&s.fmt==1)s.markCoverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.baseCoverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.markArray=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.baseArray=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.mark2Coverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.mark1Array=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.mark2Array=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else{if(e==9&&s.fmt==1){var T=n.readUshort(t,a);a+=2;var H=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=T;else if(i.ltype!=T)throw"invalid extension substitution";return r.GPOS.subt(t,i.ltype,o+H)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,a){var i=r._bin,n=[];return n.push(1&a?i.readShort(t,e):0),e+=1&a?2:0,n.push(2&a?i.readShort(t,e):0),e+=2&a?2:0,n.push(4&a?i.readShort(t,e):0),e+=4&a?2:0,n.push(8&a?i.readShort(t,e):0),e+=8&a?2:0,n},r.GPOS.readBaseArray=function(t,e,a){var i=r._bin,n=[],o=e,s=i.readUshort(t,e);e+=2;for(var f=0;f<s;f++){for(var d=[],h=0;h<a;h++)d.push(r.GPOS.readAnchorRecord(t,o+i.readUshort(t,e))),e+=2;n.push(d)}return n},r.GPOS.readMarkArray=function(t,e){var a=r._bin,i=[],n=e,o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=r.GPOS.readAnchorRecord(t,a.readUshort(t,e+2)+n);f.markClass=a.readUshort(t,e),i.push(f),e+=4}return i},r.GPOS.readAnchorRecord=function(t,e){var a=r._bin,i={};return i.fmt=a.readUshort(t,e),i.x=a.readShort(t,e+2),i.y=a.readShort(t,e+4),i},r.GSUB={},r.GSUB.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GSUB.subt)},r.GSUB.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,o+f)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,a),a+=2;else if(s.fmt==2){var d=n.readUshort(t,a);a+=2,s.newg=n.readUshorts(t,a,d),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){d=n.readUshort(t,a),a+=2,s.seqs=[];for(var h=0;h<d;h++){var p=n.readUshort(t,a)+o;a+=2;var v=n.readUshort(t,p);s.seqs.push(n.readUshorts(t,p+2,v))}}else if(e==4)for(s.vals=[],d=n.readUshort(t,a),a+=2,h=0;h<d;h++){var y=n.readUshort(t,a);a+=2,s.vals.push(r.GSUB.readLigatureSet(t,o+y))}else if(e==5&&s.fmt==2){if(s.fmt==2){var U=n.readUshort(t,a);a+=2,s.cDef=r._lctf.readClassDef(t,o+U),s.scset=[];var x=n.readUshort(t,a);for(a+=2,h=0;h<x;h++){var g=n.readUshort(t,a);a+=2,s.scset.push(g==0?null:r.GSUB.readSubClassSet(t,o+g))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(h=0;h<3;h++){d=n.readUshort(t,a),a+=2;for(var m=[],C=0;C<d;C++)m.push(r._lctf.readCoverage(t,o+n.readUshort(t,a+2*C)));a+=2*d,h==0&&(s.backCvg=m),h==1&&(s.inptCvg=m),h==2&&(s.ahedCvg=m)}d=n.readUshort(t,a),a+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,a,d)}}else{if(e==7&&s.fmt==1){var L=n.readUshort(t,a);a+=2;var w=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=L;else if(i.ltype!=L)throw"invalid extension substitution";return r.GSUB.subt(t,i.ltype,o+w)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var a=r._bin.readUshort,i=e,n=[],o=a(t,e);e+=2;for(var s=0;s<o;s++){var f=a(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,i+f))}return n},r.GSUB.readSubClassRule=function(t,e){var a=r._bin.readUshort,i={},n=a(t,e),o=a(t,e+=2);e+=2,i.input=[];for(var s=0;s<n-1;s++)i.input.push(a(t,e)),e+=2;return i.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,o),i},r.GSUB.readSubstLookupRecords=function(t,e,a){for(var i=r._bin.readUshort,n=[],o=0;o<a;o++)n.push(i(t,e),i(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,i+f))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var a=r._bin,i={},n=["backtrack","input","lookahead"],o=0;o<n.length;o++){var s=a.readUshort(t,e);e+=2,o==1&&s--,i[n[o]]=a.readUshorts(t,e,s),e+=2*i[n[o]].length}return s=a.readUshort(t,e),e+=2,i.subst=a.readUshorts(t,e,2*s),e+=2*i.subst.length,i},r.GSUB.readLigatureSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,i+f))}return n},r.GSUB.readLigature=function(t,e){var a=r._bin,i={chain:[]};i.nglyph=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2;for(var o=0;o<n-1;o++)i.chain.push(a.readUshort(t,e)),e+=2;return i},r.head={},r.head.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.fontRevision=i.readFixed(t,e),e+=4,i.readUint(t,e),e+=4,i.readUint(t,e),e+=4,n.flags=i.readUshort(t,e),e+=2,n.unitsPerEm=i.readUshort(t,e),e+=2,n.created=i.readUint64(t,e),e+=8,n.modified=i.readUint64(t,e),e+=8,n.xMin=i.readShort(t,e),e+=2,n.yMin=i.readShort(t,e),e+=2,n.xMax=i.readShort(t,e),e+=2,n.yMax=i.readShort(t,e),e+=2,n.macStyle=i.readUshort(t,e),e+=2,n.lowestRecPPEM=i.readUshort(t,e),e+=2,n.fontDirectionHint=i.readShort(t,e),e+=2,n.indexToLocFormat=i.readShort(t,e),e+=2,n.glyphDataFormat=i.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.ascender=i.readShort(t,e),e+=2,n.descender=i.readShort(t,e),e+=2,n.lineGap=i.readShort(t,e),e+=2,n.advanceWidthMax=i.readUshort(t,e),e+=2,n.minLeftSideBearing=i.readShort(t,e),e+=2,n.minRightSideBearing=i.readShort(t,e),e+=2,n.xMaxExtent=i.readShort(t,e),e+=2,n.caretSlopeRise=i.readShort(t,e),e+=2,n.caretSlopeRun=i.readShort(t,e),e+=2,n.caretOffset=i.readShort(t,e),e+=2,e+=8,n.metricDataFormat=i.readShort(t,e),e+=2,n.numberOfHMetrics=i.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,a,i){for(var n=r._bin,o={aWidth:[],lsBearing:[]},s=0,f=0,d=0;d<i.maxp.numGlyphs;d++)d<i.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,f=n.readShort(t,e),e+=2),o.aWidth.push(s),o.lsBearing.push(f);return o},r.kern={},r.kern.parse=function(t,e,a,i){var n=r._bin,o=n.readUshort(t,e);if(e+=2,o==1)return r.kern.parseV1(t,e-2,a,i);var s=n.readUshort(t,e);e+=2;for(var f={glyph1:[],rval:[]},d=0;d<s;d++){e+=2,a=n.readUshort(t,e),e+=2;var h=n.readUshort(t,e);e+=2;var p=h>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;e=r.kern.readFormat0(t,e,f)}return f},r.kern.parseV1=function(t,e,a,i){var n=r._bin;n.readFixed(t,e),e+=4;var o=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},f=0;f<o;f++){n.readUint(t,e),e+=4;var d=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var h=d>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,a){var i=r._bin,n=-1,o=i.readUshort(t,e);e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2;for(var s=0;s<o;s++){var f=i.readUshort(t,e);e+=2;var d=i.readUshort(t,e);e+=2;var h=i.readShort(t,e);e+=2,f!=n&&(a.glyph1.push(f),a.rval.push({glyph2:[],vals:[]}));var p=a.rval[a.rval.length-1];p.glyph2.push(d),p.vals.push(h),n=f}return e},r.loca={},r.loca.parse=function(t,e,a,i){var n=r._bin,o=[],s=i.head.indexToLocFormat,f=i.maxp.numGlyphs+1;if(s==0)for(var d=0;d<f;d++)o.push(n.readUshort(t,e+(d<<1))<<1);if(s==1)for(d=0;d<f;d++)o.push(n.readUint(t,e+(d<<2)));return o},r.maxp={},r.maxp.parse=function(t,e,a){var i=r._bin,n={},o=i.readUint(t,e);return e+=4,n.numGlyphs=i.readUshort(t,e),e+=2,o==65536&&(n.maxPoints=i.readUshort(t,e),e+=2,n.maxContours=i.readUshort(t,e),e+=2,n.maxCompositePoints=i.readUshort(t,e),e+=2,n.maxCompositeContours=i.readUshort(t,e),e+=2,n.maxZones=i.readUshort(t,e),e+=2,n.maxTwilightPoints=i.readUshort(t,e),e+=2,n.maxStorage=i.readUshort(t,e),e+=2,n.maxFunctionDefs=i.readUshort(t,e),e+=2,n.maxInstructionDefs=i.readUshort(t,e),e+=2,n.maxStackElements=i.readUshort(t,e),e+=2,n.maxSizeOfInstructions=i.readUshort(t,e),e+=2,n.maxComponentElements=i.readUshort(t,e),e+=2,n.maxComponentDepth=i.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,a){var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2,i.readUshort(t,e);for(var s,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=e+=2,h=0;h<o;h++){var p=i.readUshort(t,e);e+=2;var v=i.readUshort(t,e);e+=2;var y=i.readUshort(t,e);e+=2;var U=i.readUshort(t,e);e+=2;var x=i.readUshort(t,e);e+=2;var g=i.readUshort(t,e);e+=2;var m,C=f[U],L=d+12*o+g;if(p==0)m=i.readUnicode(t,L,x/2);else if(p==3&&v==0)m=i.readUnicode(t,L,x/2);else if(v==0)m=i.readASCII(t,L,x);else if(v==1)m=i.readUnicode(t,L,x/2);else if(v==3)m=i.readUnicode(t,L,x/2);else{if(p!=1)throw"unknown encoding "+v+", platformID: "+p;m=i.readASCII(t,L,x),console.debug("reading unknown MAC encoding "+v+" as ASCII")}var w="p"+p+","+y.toString(16);n[w]==null&&(n[w]={}),n[w][C!==void 0?C:U]=m,n[w]._lang=y}for(var k in n)if(n[k].postScriptName!=null&&n[k]._lang==1033)return n[k];for(var k in n)if(n[k].postScriptName!=null&&n[k]._lang==0)return n[k];for(var k in n)if(n[k].postScriptName!=null&&n[k]._lang==3084)return n[k];for(var k in n)if(n[k].postScriptName!=null)return n[k];for(var k in n){s=k;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,a){var i=r._bin.readUshort(t,e);e+=2;var n={};if(i==0)r["OS/2"].version0(t,e,n);else if(i==1)r["OS/2"].version1(t,e,n);else if(i==2||i==3||i==4)r["OS/2"].version2(t,e,n);else{if(i!=5)throw"unknown OS/2 table version: "+i;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,a){var i=r._bin;return a.xAvgCharWidth=i.readShort(t,e),e+=2,a.usWeightClass=i.readUshort(t,e),e+=2,a.usWidthClass=i.readUshort(t,e),e+=2,a.fsType=i.readUshort(t,e),e+=2,a.ySubscriptXSize=i.readShort(t,e),e+=2,a.ySubscriptYSize=i.readShort(t,e),e+=2,a.ySubscriptXOffset=i.readShort(t,e),e+=2,a.ySubscriptYOffset=i.readShort(t,e),e+=2,a.ySuperscriptXSize=i.readShort(t,e),e+=2,a.ySuperscriptYSize=i.readShort(t,e),e+=2,a.ySuperscriptXOffset=i.readShort(t,e),e+=2,a.ySuperscriptYOffset=i.readShort(t,e),e+=2,a.yStrikeoutSize=i.readShort(t,e),e+=2,a.yStrikeoutPosition=i.readShort(t,e),e+=2,a.sFamilyClass=i.readShort(t,e),e+=2,a.panose=i.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=i.readUint(t,e),e+=4,a.ulUnicodeRange2=i.readUint(t,e),e+=4,a.ulUnicodeRange3=i.readUint(t,e),e+=4,a.ulUnicodeRange4=i.readUint(t,e),e+=4,a.achVendID=[i.readInt8(t,e),i.readInt8(t,e+1),i.readInt8(t,e+2),i.readInt8(t,e+3)],e+=4,a.fsSelection=i.readUshort(t,e),e+=2,a.usFirstCharIndex=i.readUshort(t,e),e+=2,a.usLastCharIndex=i.readUshort(t,e),e+=2,a.sTypoAscender=i.readShort(t,e),e+=2,a.sTypoDescender=i.readShort(t,e),e+=2,a.sTypoLineGap=i.readShort(t,e),e+=2,a.usWinAscent=i.readUshort(t,e),e+=2,a.usWinDescent=i.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,a){var i=r._bin;return e=r["OS/2"].version0(t,e,a),a.ulCodePageRange1=i.readUint(t,e),e+=4,a.ulCodePageRange2=i.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,a){var i=r._bin;return e=r["OS/2"].version1(t,e,a),a.sxHeight=i.readShort(t,e),e+=2,a.sCapHeight=i.readShort(t,e),e+=2,a.usDefault=i.readUshort(t,e),e+=2,a.usBreak=i.readUshort(t,e),e+=2,a.usMaxContext=i.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,a){var i=r._bin;return e=r["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=i.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=i.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,a){var i=r._bin,n={};return n.version=i.readFixed(t,e),e+=4,n.italicAngle=i.readFixed(t,e),e+=4,n.underlinePosition=i.readShort(t,e),e+=2,n.underlineThickness=i.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var a=t.cmap,i=-1;if(a.p0e4!=null?i=a.p0e4:a.p3e1!=null?i=a.p3e1:a.p1e0!=null?i=a.p1e0:a.p0e3!=null&&(i=a.p0e3),i==-1)throw"no familiar platform and encoding!";var n=a.tables[i];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var o=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){o=s;break}return o==-1||n.startCount[o]>e?0:65535&(n.idRangeOffset[o]!=0?n.glyphIdArray[e-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:e+n.idDelta[o])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var f=n.groups[s];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var i=t.SVG.entries[e];return i==null?a:(typeof i=="string"&&(i=r.SVG.toPath(i),t.SVG.entries[e]=i),i)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},o=t.CFF,s=t.CFF.Private;if(o.ROS){for(var f=0;o.FDSelect[f+2]<=e;)f+=2;s=o.FDArray[o.FDSelect[f+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,o,s,a)}else t.glyf&&r.U._drawGlyf(e,t,a);return a},r.U._drawGlyf=function(t,e,a){var i=e.glyf[t];i==null&&(i=e.glyf[t]=r.glyf._parseGlyf(e,t)),i!=null&&(i.noc>-1?r.U._simpleGlyph(i,a):r.U._compoGlyph(i,e,a))},r.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var i=a==0?0:t.endPts[a-1]+1,n=t.endPts[a],o=i;o<=n;o++){var s=o==i?n:o-1,f=o==n?i:o+1,d=1&t.flags[o],h=1&t.flags[s],p=1&t.flags[f],v=t.xs[o],y=t.ys[o];if(o==i)if(d){if(!h){r.U.P.moveTo(e,v,y);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else h?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+v)/2,(t.ys[s]+y)/2);d?h&&r.U.P.lineTo(e,v,y):p?r.U.P.qcurveTo(e,v,y,t.xs[f],t.ys[f]):r.U.P.qcurveTo(e,v,y,(v+t.xs[f])/2,(y+t.ys[f])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,a){for(var i=0;i<t.parts.length;i++){var n={cmds:[],crds:[]},o=t.parts[i];r.U._drawGlyf(o.glyphIndex,e,n);for(var s=o.m,f=0;f<n.crds.length;f+=2){var d=n.crds[f],h=n.crds[f+1];a.crds.push(d*s.a+h*s.b+s.tx),a.crds.push(d*s.c+h*s.d+s.ty)}for(f=0;f<n.cmds.length;f++)a.cmds.push(n.cmds[f])}},r.U._getGlyphClass=function(t,e){var a=r._lctf.getInterval(e,t);return a==-1?0:e[a+2]},r.U._applySubs=function(t,e,a,i){for(var n=t.length-e-1,o=0;o<a.tabs.length;o++)if(a.tabs[o]!=null){var s,f=a.tabs[o];if(!f.coverage||(s=r._lctf.coverageIndex(f.coverage,t[e]))!=-1){if(a.ltype==1)t[e],f.fmt==1?t[e]=t[e]+f.delta:t[e]=f.newg[s];else if(a.ltype==4)for(var d=f.vals[s],h=0;h<d.length;h++){var p=d[h],v=p.chain.length;if(!(v>n)){for(var y=!0,U=0,x=0;x<v;x++){for(;t[e+U+(1+x)]==-1;)U++;p.chain[x]!=t[e+U+(1+x)]&&(y=!1)}if(y){for(t[e]=p.nglyph,x=0;x<v+U;x++)t[e+x+1]=-1;break}}}else if(a.ltype==5&&f.fmt==2)for(var g=r._lctf.getInterval(f.cDef,t[e]),m=f.cDef[g+2],C=f.scset[m],L=0;L<C.length;L++){var w=C[L],k=w.input;if(!(k.length>n)){for(y=!0,x=0;x<k.length;x++){var N=r._lctf.getInterval(f.cDef,t[e+1+x]);if(g==-1&&f.cDef[N+2]!=k[x]){y=!1;break}}if(y){var O=w.substLookupRecords;for(h=0;h<O.length;h+=2)O[h],O[h+1]}}}else if(a.ltype==6&&f.fmt==3){if(!r.U._glsCovered(t,f.backCvg,e-f.backCvg.length)||!r.U._glsCovered(t,f.inptCvg,e)||!r.U._glsCovered(t,f.ahedCvg,e+f.inptCvg.length))continue;var Y=f.lookupRec;for(L=0;L<Y.length;L+=2){g=Y[L];var S=i[Y[L+1]];r.U._applySubs(t,e+g,S,i)}}}}},r.U._glsCovered=function(t,e,a){for(var i=0;i<e.length;i++)if(r._lctf.coverageIndex(e[i],t[a+i])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,a){for(var i={cmds:[],crds:[]},n=0,o=0;o<e.length;o++){var s=e[o];if(s!=-1){for(var f=o<e.length-1&&e[o+1]!=-1?e[o+1]:0,d=r.U.glyphToPath(t,s),h=0;h<d.crds.length;h+=2)i.crds.push(d.crds[h]+n),i.crds.push(d.crds[h+1]);for(a&&i.cmds.push(a),h=0;h<d.cmds.length;h++)i.cmds.push(d.cmds[h]);a&&i.cmds.push("X"),n+=t.hmtx.aWidth[s],o<e.length-1&&(n+=r.U.getPairAdjustment(t,s,f))}}return i},r.U.P={},r.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},r.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},r.U.P.curveTo=function(t,e,a,i,n,o,s){t.cmds.push("C"),t.crds.push(e,a,i,n,o,s)},r.U.P.qcurveTo=function(t,e,a,i,n){t.cmds.push("Q"),t.crds.push(e,a,i,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,a,i,n){for(var o=e.stack,s=e.nStems,f=e.haveWidth,d=e.width,h=e.open,p=0,v=e.x,y=e.y,U=0,x=0,g=0,m=0,C=0,L=0,w=0,k=0,N=0,O=0,Y={val:0,size:0};p<t.length;){r.CFF.getCharString(t,p,Y);var S=Y.val;if(p+=Y.size,S=="o1"||S=="o18")o.length%2!=0&&!f&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,f=!0;else if(S=="o3"||S=="o23")o.length%2!=0&&!f&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,f=!0;else if(S=="o4")o.length>1&&!f&&(d=o.shift()+i.nominalWidthX,f=!0),h&&r.U.P.closePath(n),y+=o.pop(),r.U.P.moveTo(n,v,y),h=!0;else if(S=="o5")for(;o.length>0;)v+=o.shift(),y+=o.shift(),r.U.P.lineTo(n,v,y);else if(S=="o6"||S=="o7")for(var A=o.length,T=S=="o6",H=0;H<A;H++){var z=o.shift();T?v+=z:y+=z,T=!T,r.U.P.lineTo(n,v,y)}else if(S=="o8"||S=="o24"){A=o.length;for(var K=0;K+6<=A;)U=v+o.shift(),x=y+o.shift(),g=U+o.shift(),m=x+o.shift(),v=g+o.shift(),y=m+o.shift(),r.U.P.curveTo(n,U,x,g,m,v,y),K+=6;S=="o24"&&(v+=o.shift(),y+=o.shift(),r.U.P.lineTo(n,v,y))}else{if(S=="o11")break;if(S=="o1234"||S=="o1235"||S=="o1236"||S=="o1237")S=="o1234"&&(x=y,g=(U=v+o.shift())+o.shift(),O=m=x+o.shift(),L=m,k=y,v=(w=(C=(N=g+o.shift())+o.shift())+o.shift())+o.shift(),r.U.P.curveTo(n,U,x,g,m,N,O),r.U.P.curveTo(n,C,L,w,k,v,y)),S=="o1235"&&(U=v+o.shift(),x=y+o.shift(),g=U+o.shift(),m=x+o.shift(),N=g+o.shift(),O=m+o.shift(),C=N+o.shift(),L=O+o.shift(),w=C+o.shift(),k=L+o.shift(),v=w+o.shift(),y=k+o.shift(),o.shift(),r.U.P.curveTo(n,U,x,g,m,N,O),r.U.P.curveTo(n,C,L,w,k,v,y)),S=="o1236"&&(U=v+o.shift(),x=y+o.shift(),g=U+o.shift(),O=m=x+o.shift(),L=m,w=(C=(N=g+o.shift())+o.shift())+o.shift(),k=L+o.shift(),v=w+o.shift(),r.U.P.curveTo(n,U,x,g,m,N,O),r.U.P.curveTo(n,C,L,w,k,v,y)),S=="o1237"&&(U=v+o.shift(),x=y+o.shift(),g=U+o.shift(),m=x+o.shift(),N=g+o.shift(),O=m+o.shift(),C=N+o.shift(),L=O+o.shift(),w=C+o.shift(),k=L+o.shift(),Math.abs(w-v)>Math.abs(k-y)?v=w+o.shift():y=k+o.shift(),r.U.P.curveTo(n,U,x,g,m,N,O),r.U.P.curveTo(n,C,L,w,k,v,y));else if(S=="o14"){if(o.length>0&&!f&&(d=o.shift()+a.nominalWidthX,f=!0),o.length==4){var Q=o.shift(),P=o.shift(),I=o.shift(),b=o.shift(),E=r.CFF.glyphBySE(a,I),R=r.CFF.glyphBySE(a,b);r.U._drawCFF(a.CharStrings[E],e,a,i,n),e.x=Q,e.y=P,r.U._drawCFF(a.CharStrings[R],e,a,i,n)}h&&(r.U.P.closePath(n),h=!1)}else if(S=="o19"||S=="o20")o.length%2!=0&&!f&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,f=!0,p+=s+7>>3;else if(S=="o21")o.length>2&&!f&&(d=o.shift()+i.nominalWidthX,f=!0),y+=o.pop(),v+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,v,y),h=!0;else if(S=="o22")o.length>1&&!f&&(d=o.shift()+i.nominalWidthX,f=!0),v+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,v,y),h=!0;else if(S=="o25"){for(;o.length>6;)v+=o.shift(),y+=o.shift(),r.U.P.lineTo(n,v,y);U=v+o.shift(),x=y+o.shift(),g=U+o.shift(),m=x+o.shift(),v=g+o.shift(),y=m+o.shift(),r.U.P.curveTo(n,U,x,g,m,v,y)}else if(S=="o26")for(o.length%2&&(v+=o.shift());o.length>0;)U=v,x=y+o.shift(),v=g=U+o.shift(),y=(m=x+o.shift())+o.shift(),r.U.P.curveTo(n,U,x,g,m,v,y);else if(S=="o27")for(o.length%2&&(y+=o.shift());o.length>0;)x=y,g=(U=v+o.shift())+o.shift(),m=x+o.shift(),v=g+o.shift(),y=m,r.U.P.curveTo(n,U,x,g,m,v,y);else if(S=="o10"||S=="o29"){var F=S=="o10"?i:a;if(o.length==0)console.debug("error: empty stack");else{var D=o.pop(),j=F.Subrs[D+F.Bias];e.x=v,e.y=y,e.nStems=s,e.haveWidth=f,e.width=d,e.open=h,r.U._drawCFF(j,e,a,i,n),v=e.x,y=e.y,s=e.nStems,f=e.haveWidth,d=e.width,h=e.open}}else if(S=="o30"||S=="o31"){var M=o.length,G=(K=0,S=="o31");for(K+=M-(A=-3&M);K<A;)G?(x=y,g=(U=v+o.shift())+o.shift(),y=(m=x+o.shift())+o.shift(),A-K==5?(v=g+o.shift(),K++):v=g,G=!1):(U=v,x=y+o.shift(),g=U+o.shift(),m=x+o.shift(),v=g+o.shift(),A-K==5?(y=m+o.shift(),K++):y=m,G=!0),r.U.P.curveTo(n,U,x,g,m,v,y),K+=4}else{if((S+"").charAt(0)=="o")throw console.debug("Unknown operation: "+S,t),S;o.push(S)}}}e.x=v,e.y=y,e.nStems=s,e.haveWidth=f,e.width=d,e.open=h};var c=r,u={Typr:c};return l.Typr=c,l.default=u,Object.defineProperty(l,"__esModule",{value:!0}),l}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function so(){return function(l){var r=Uint8Array,c=Uint16Array,u=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(S,A){for(var T=new c(31),H=0;H<31;++H)T[H]=A+=1<<S[H-1];var z=new u(T[30]);for(H=1;H<30;++H)for(var K=T[H];K<T[H+1];++K)z[K]=K-T[H]<<5|H;return[T,z]},n=i(t,2),o=n[0],s=n[1];o[28]=258,s[258]=28;for(var f=i(e,0)[0],d=new c(32768),h=0;h<32768;++h){var p=(43690&h)>>>1|(21845&h)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[h]=((65280&p)>>>8|(255&p)<<8)>>>1}var v=function(S,A,T){for(var H=S.length,z=0,K=new c(A);z<H;++z)++K[S[z]-1];var Q,P=new c(A);for(z=0;z<A;++z)P[z]=P[z-1]+K[z-1]<<1;{Q=new c(1<<A);var I=15-A;for(z=0;z<H;++z)if(S[z])for(var b=z<<4|S[z],E=A-S[z],R=P[S[z]-1]++<<E,F=R|(1<<E)-1;R<=F;++R)Q[d[R]>>>I]=b}return Q},y=new r(288);for(h=0;h<144;++h)y[h]=8;for(h=144;h<256;++h)y[h]=9;for(h=256;h<280;++h)y[h]=7;for(h=280;h<288;++h)y[h]=8;var U=new r(32);for(h=0;h<32;++h)U[h]=5;var x=v(y,9),g=v(U,5),m=function(S){for(var A=S[0],T=1;T<S.length;++T)S[T]>A&&(A=S[T]);return A},C=function(S,A,T){var H=A/8|0;return(S[H]|S[H+1]<<8)>>(7&A)&T},L=function(S,A){var T=A/8|0;return(S[T]|S[T+1]<<8|S[T+2]<<16)>>(7&A)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],k=function(S,A,T){var H=new Error(A||w[S]);if(H.code=S,Error.captureStackTrace&&Error.captureStackTrace(H,k),!T)throw H;return H},N=function(S,A,T){var H=S.length;if(!H||T&&!T.l&&H<5)return A||new r(0);var z=!A||T,K=!T||T.i;T||(T={}),A||(A=new r(3*H));var Q,P=function(ue){var Le=A.length;if(ue>Le){var Ue=new r(Math.max(2*Le,ue));Ue.set(A),A=Ue}},I=T.f||0,b=T.p||0,E=T.b||0,R=T.l,F=T.d,D=T.m,j=T.n,M=8*H;do{if(!R){T.f=I=C(S,b,1);var G=C(S,b+1,3);if(b+=3,!G){var Z=S[(te=((Q=b)/8|0)+(7&Q&&1)+4)-4]|S[te-3]<<8,ee=te+Z;if(ee>H){K&&k(0);break}z&&P(E+Z),A.set(S.subarray(te,ee),E),T.b=E+=Z,T.p=b=8*ee;continue}if(G==1)R=x,F=g,D=9,j=5;else if(G==2){var V=C(S,b,31)+257,W=C(S,b+10,15)+4,ye=V+C(S,b+5,31)+1;b+=14;for(var he=new r(ye),$=new r(19),re=0;re<W;++re)$[a[re]]=C(S,b+3*re,7);b+=3*W;var fe=m($),X=(1<<fe)-1,ne=v($,fe);for(re=0;re<ye;){var te,B=ne[C(S,b,X)];if(b+=15&B,(te=B>>>4)<16)he[re++]=te;else{var ve=0,q=0;for(te==16?(q=3+C(S,b,3),b+=2,ve=he[re-1]):te==17?(q=3+C(S,b,7),b+=3):te==18&&(q=11+C(S,b,127),b+=7);q--;)he[re++]=ve}}var oe=he.subarray(0,V),J=he.subarray(V);D=m(oe),j=m(J),R=v(oe,D),F=v(J,j)}else k(1);if(b>M){K&&k(0);break}}z&&P(E+131072);for(var _e=(1<<D)-1,ie=(1<<j)-1,se=b;;se=b){var de=(ve=R[L(S,b)&_e])>>>4;if((b+=15&ve)>M){K&&k(0);break}if(ve||k(2),de<256)A[E++]=de;else{if(de==256){se=b,R=null;break}var ge=de-254;if(de>264){var Ee=t[re=de-257];ge=C(S,b,(1<<Ee)-1)+o[re],b+=Ee}var De=F[L(S,b)&ie],be=De>>>4;if(De||k(3),b+=15&De,J=f[be],be>3&&(Ee=e[be],J+=L(S,b)&(1<<Ee)-1,b+=Ee),b>M){K&&k(0);break}z&&P(E+131072);for(var xe=E+ge;E<xe;E+=4)A[E]=A[E-J],A[E+1]=A[E+1-J],A[E+2]=A[E+2-J],A[E+3]=A[E+3-J];E=xe}}T.l=R,T.p=se,T.b=E,R&&(I=1,T.m=D,T.d=F,T.n=j)}while(!I);return E==A.length?A:function(ue,Le,Ue){(Ue==null||Ue>ue.length)&&(Ue=ue.length);var He=new(ue instanceof c?c:ue instanceof u?u:r)(Ue-Le);return He.set(ue.subarray(Le,Ue)),He}(A,0,E)},O=new r(0),Y=typeof TextDecoder<"u"&&new TextDecoder;try{Y.decode(O,{stream:!0})}catch{}return l.convert_streams=function(S){var A=new DataView(S),T=0;function H(){var V=A.getUint16(T);return T+=2,V}function z(){var V=A.getUint32(T);return T+=4,V}function K(V){Z.setUint16(ee,V),ee+=2}function Q(V){Z.setUint32(ee,V),ee+=4}for(var P={signature:z(),flavor:z(),length:z(),numTables:H(),reserved:H(),totalSfntSize:z(),majorVersion:H(),minorVersion:H(),metaOffset:z(),metaLength:z(),metaOrigLength:z(),privOffset:z(),privLength:z()},I=0;Math.pow(2,I)<=P.numTables;)I++;I--;for(var b=16*Math.pow(2,I),E=16*P.numTables-b,R=12,F=[],D=0;D<P.numTables;D++)F.push({tag:z(),offset:z(),compLength:z(),origLength:z(),origChecksum:z()}),R+=16;var j,M=new Uint8Array(12+16*F.length+F.reduce(function(V,W){return V+W.origLength+4},0)),G=M.buffer,Z=new DataView(G),ee=0;return Q(P.flavor),K(P.numTables),K(b),K(I),K(E),F.forEach(function(V){Q(V.tag),Q(V.origChecksum),Q(R),Q(V.origLength),V.outOffset=R,(R+=V.origLength)%4!=0&&(R+=4-R%4)}),F.forEach(function(V){var W,ye=S.slice(V.offset,V.offset+V.compLength);if(V.compLength!=V.origLength){var he=new Uint8Array(V.origLength);W=new Uint8Array(ye,2),N(W,he)}else he=new Uint8Array(ye);M.set(he,V.outOffset);var $=0;(R=V.outOffset+V.origLength)%4!=0&&($=4-R%4),M.set(new Uint8Array($).buffer,V.outOffset+V.origLength),j=R+$}),G.slice(0,j)},Object.defineProperty(l,"__esModule",{value:!0}),l}({}).convert_streams}function lo(l,r){const c={M:2,L:2,Q:4,C:6,Z:0},u={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,i=8,n=16,o=32;let s;function f(w){if(!s){const k={R:e,L:t,D:a,C:n,U:o,T:i};s=new Map;for(let N in u){let O=0;u[N].split(",").forEach(Y=>{let[S,A]=Y.split("+");S=parseInt(S,36),A=A?parseInt(A,36):0,s.set(O+=S,k[N]);for(let T=A;T--;)s.set(++O,k[N])})}}return s.get(w)||o}const d=1,h=2,p=3,v=4,y=[null,"isol","init","fina","medi"];function U(w){const k=new Uint8Array(w.length);let N=o,O=d,Y=-1;for(let S=0;S<w.length;S++){const A=w.codePointAt(S);let T=f(A)|0,H=d;T&i||(N&(t|a|n)?T&(e|a|n)?(H=p,(O===d||O===p)&&k[Y]++):T&(t|o)&&(O===h||O===v)&&k[Y]--:N&(e|o)&&(O===h||O===v)&&k[Y]--,O=k[S]=H,N=T,Y=S,A>65535&&S++)}return k}function x(w,k){const N=[];for(let Y=0;Y<k.length;Y++){const S=k.codePointAt(Y);S>65535&&Y++,N.push(l.U.codeToGlyph(w,S))}const O=w.GSUB;if(O){const{lookupList:Y,featureList:S}=O;let A;const T=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,H=[];S.forEach(z=>{if(T.test(z.tag))for(let K=0;K<z.tab.length;K++){if(H[z.tab[K]])continue;H[z.tab[K]]=!0;const Q=Y[z.tab[K]],P=/^(isol|init|fina|medi)$/.test(z.tag);P&&!A&&(A=U(k));for(let I=0;I<N.length;I++)(!A||!P||y[A[I]]===z.tag)&&l.U._applySubs(N,I,Q,Y)}})}return N}function g(w,k){const N=new Int16Array(k.length*3);let O=0;for(;O<k.length;O++){const T=k[O];if(T===-1)continue;N[O*3+2]=w.hmtx.aWidth[T];const H=w.GPOS;if(H){const z=H.lookupList;for(let K=0;K<z.length;K++){const Q=z[K];for(let P=0;P<Q.tabs.length;P++){const I=Q.tabs[P];if(Q.ltype===1){if(l._lctf.coverageIndex(I.coverage,T)!==-1&&I.pos){A(I.pos,O);break}}else if(Q.ltype===2){let b=null,E=Y();if(E!==-1){const R=l._lctf.coverageIndex(I.coverage,k[E]);if(R!==-1){if(I.fmt===1){const F=I.pairsets[R];for(let D=0;D<F.length;D++)F[D].gid2===T&&(b=F[D])}else if(I.fmt===2){const F=l.U._getGlyphClass(k[E],I.classDef1),D=l.U._getGlyphClass(T,I.classDef2);b=I.matrix[F][D]}if(b){b.val1&&A(b.val1,E),b.val2&&A(b.val2,O);break}}}}else if(Q.ltype===4){const b=l._lctf.coverageIndex(I.markCoverage,T);if(b!==-1){const E=Y(S),R=E===-1?-1:l._lctf.coverageIndex(I.baseCoverage,k[E]);if(R!==-1){const F=I.markArray[b],D=I.baseArray[R][F.markClass];N[O*3]=D.x-F.x+N[E*3]-N[E*3+2],N[O*3+1]=D.y-F.y+N[E*3+1];break}}}else if(Q.ltype===6){const b=l._lctf.coverageIndex(I.mark1Coverage,T);if(b!==-1){const E=Y();if(E!==-1){const R=k[E];if(m(w,R)===3){const F=l._lctf.coverageIndex(I.mark2Coverage,R);if(F!==-1){const D=I.mark1Array[b],j=I.mark2Array[F][D.markClass];N[O*3]=j.x-D.x+N[E*3]-N[E*3+2],N[O*3+1]=j.y-D.y+N[E*3+1];break}}}}}}}}else if(w.kern&&!w.cff){const z=Y();if(z!==-1){const K=w.kern.glyph1.indexOf(k[z]);if(K!==-1){const Q=w.kern.rval[K].glyph2.indexOf(T);Q!==-1&&(N[z*3+2]+=w.kern.rval[K].vals[Q])}}}}return N;function Y(T){for(let H=O-1;H>=0;H--)if(k[H]!==-1&&(!T||T(k[H])))return H;return-1}function S(T){return m(w,T)===1}function A(T,H){for(let z=0;z<3;z++)N[H*3+z]+=T[z]||0}}function m(w,k){const N=w.GDEF&&w.GDEF.glyphClassDef;return N?l.U._getGlyphClass(k,N):0}function C(...w){for(let k=0;k<w.length;k++)if(typeof w[k]=="number")return w[k]}function L(w){const k=Object.create(null),N=w["OS/2"],O=w.hhea,Y=w.head.unitsPerEm,S=C(N&&N.sTypoAscender,O&&O.ascender,Y),A={unitsPerEm:Y,ascender:S,descender:C(N&&N.sTypoDescender,O&&O.descender,0),capHeight:C(N&&N.sCapHeight,S),xHeight:C(N&&N.sxHeight,S),lineGap:C(N&&N.sTypoLineGap,O&&O.lineGap),supportsCodePoint(T){return l.U.codeToGlyph(w,T)>0},forEachGlyph(T,H,z,K){let Q=0;const P=1/A.unitsPerEm*H,I=x(w,T);let b=0;const E=g(w,I);return I.forEach((R,F)=>{if(R!==-1){let D=k[R];if(!D){const{cmds:j,crds:M}=l.U.glyphToPath(w,R);let G="",Z=0;for(let he=0,$=j.length;he<$;he++){const re=c[j[he]];G+=j[he];for(let fe=1;fe<=re;fe++)G+=(fe>1?",":"")+M[Z++]}let ee,V,W,ye;if(M.length){ee=V=1/0,W=ye=-1/0;for(let he=0,$=M.length;he<$;he+=2){let re=M[he],fe=M[he+1];re<ee&&(ee=re),fe<V&&(V=fe),re>W&&(W=re),fe>ye&&(ye=fe)}}else ee=W=V=ye=0;D=k[R]={index:R,advanceWidth:w.hmtx.aWidth[R],xMin:ee,yMin:V,xMax:W,yMax:ye,path:G}}K.call(null,D,Q+E[F*3]*P,E[F*3+1]*P,b),Q+=E[F*3+2]*P,z&&(Q+=z*H)}b+=T.codePointAt(b)>65535?2:1}),Q}};return A}return function(k){const N=new Uint8Array(k,0,4),O=l._bin.readASCII(N,0,4);if(O==="wOFF")k=r(k);else if(O==="wOF2")throw new Error("woff2 fonts not supported");return L(l.parse(k)[0])}}const co=Bt({name:"Typr Font Parser",dependencies:[oo,so,lo],init(l,r,c){const u=l(),t=r();return c(u,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function fo(){return function(l){var r=function(){this.buckets=new Map};r.prototype.add=function(g){var m=g>>5;this.buckets.set(m,(this.buckets.get(m)||0)|1<<(31&g))},r.prototype.has=function(g){var m=this.buckets.get(g>>5);return m!==void 0&&(m&1<<(31&g))!=0},r.prototype.serialize=function(){var g=[];return this.buckets.forEach(function(m,C){g.push((+C).toString(36)+":"+m.toString(36))}),g.join(",")},r.prototype.deserialize=function(g){var m=this;this.buckets.clear(),g.split(",").forEach(function(C){var L=C.split(":");m.buckets.set(parseInt(L[0],36),parseInt(L[1],36))})};var c=Math.pow(2,8),u=c-1,t=~u;function e(g){var m=function(L){return L&t}(g).toString(16),C=function(L){return(L&t)+c-1}(g).toString(16);return"codepoint-index/plane"+(g>>16)+"/"+m+"-"+C+".json"}function a(g,m){var C=g&u,L=m.codePointAt(C/6|0);return((L=(L||48)-48)&1<<C%6)!=0}function i(g,m){var C;(C=g,C.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(L){return L.split("-").map(function(w){return parseInt(w.trim(),16)})})).forEach(function(L){var w=L[0],k=L[1];k===void 0&&(k=w),m(w,k)})}function n(g,m){i(g,function(C,L){for(var w=C;w<=L;w++)m(w)})}var o={},s={},f=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function h(g){var m=f.get(g);return m||(m=new r,n(g.ranges,function(C){return m.add(C)}),f.set(g,m)),m}var p,v=new Map;function y(g,m,C){return g[m]?m:g[C]?C:function(L){for(var w in L)return w}(g)}function U(g,m){var C=m;if(!g.includes(C)){C=1/0;for(var L=0;L<g.length;L++)Math.abs(g[L]-m)<Math.abs(C-m)&&(C=g[L])}return C}function x(g){return p||(p=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(m){p.add(m)})),p.has(g)}return l.CodePointSet=r,l.clearCache=function(){o={},s={}},l.getFontsForString=function(g,m){m===void 0&&(m={});var C,L=m.lang;L===void 0&&(L=new RegExp("\\p{Script=Hangul}","u").test(C=g)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(C)?"ja":"en");var w=m.category;w===void 0&&(w="sans-serif");var k=m.style;k===void 0&&(k="normal");var N=m.weight;N===void 0&&(N=400);var O=(m.dataUrl||d).replace(/\/$/g,""),Y=new Map,S=new Uint8Array(g.length),A={},T={},H=new Array(g.length),z=new Map,K=!1;function Q(b){var E=v.get(b);return E||(E=fetch(O+"/"+b).then(function(R){if(!R.ok)throw new Error(R.statusText);return R.json().then(function(F){if(!Array.isArray(F)||F[0]!==1)throw new Error("Incorrect schema version; need 1, got "+F[0]);return F[1]})}).catch(function(R){if(O!==d)return K||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+O+'", trying default CDN. '+R.message),K=!0),O=d,v.delete(b),Q(b);throw R}),v.set(b,E)),E}for(var P=function(b){var E=g.codePointAt(b),R=e(E);H[b]=R,o[R]||z.has(R)||z.set(R,Q(R).then(function(F){o[R]=F})),E>65535&&(b++,I=b)},I=0;I<g.length;I++)P(I);return Promise.all(z.values()).then(function(){z.clear();for(var b=function(R){var F=g.codePointAt(R),D=null,j=o[H[R]],M=void 0;for(var G in j){var Z=T[G];if(Z===void 0&&(Z=T[G]=new RegExp(G).test(L||"en")),Z){for(var ee in M=G,j[G])if(a(F,j[G][ee])){D=ee;break}break}}if(!D){e:for(var V in j)if(V!==M){for(var W in j[V])if(a(F,j[V][W])){D=W;break e}}}D||(console.debug("No font coverage for U+"+F.toString(16)),D="latin"),H[R]=D,s[D]||z.has(D)||z.set(D,Q("font-meta/"+D+".json").then(function(ye){s[D]=ye})),F>65535&&(R++,E=R)},E=0;E<g.length;E++)b(E);return Promise.all(z.values())}).then(function(){for(var b,E=null,R=0;R<g.length;R++){var F=g.codePointAt(R);if(E&&(x(F)||h(E).has(F)))S[R]=S[R-1];else{E=s[H[R]];var D=A[E.id];if(!D){var j=E.typeforms,M=y(j,w,"sans-serif"),G=y(j[M],k,"normal"),Z=U((b=j[M])===null||b===void 0?void 0:b[G],N);D=A[E.id]=O+"/font-files/"+E.id+"/"+M+"."+G+"."+Z+".woff"}var ee=Y.get(D);ee==null&&(ee=Y.size,Y.set(D,ee)),S[R]=ee}F>65535&&(R++,S[R]=S[R-1])}return{fontUrls:Array.from(Y.keys()),chars:S}})},Object.defineProperty(l,"__esModule",{value:!0}),l}({})}function uo(l,r){const c=Object.create(null),u=Object.create(null);function t(a,i){const n=o=>{console.error(`Failure loading font ${a}`,o)};try{const o=new XMLHttpRequest;o.open("get",a,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)n(new Error(o.statusText));else if(o.status>0)try{const s=l(o.response);s.src=a,i(s)}catch(s){n(s)}},o.onerror=n,o.send()}catch(o){n(o)}}function e(a,i){let n=c[a];n?i(n):u[a]?u[a].push(i):(u[a]=[i],t(a,o=>{o.src=a,c[a]=o,u[a].forEach(s=>s(o)),delete u[a]}))}return function(a,i,{lang:n,fonts:o=[],style:s="normal",weight:f="normal",unicodeFontsURL:d}={}){const h=new Uint8Array(a.length),p=[];a.length||x();const v=new Map,y=[];if(s!=="italic"&&(s="normal"),typeof f!="number"&&(f=f==="bold"?700:400),o&&!Array.isArray(o)&&(o=[o]),o=o.slice().filter(m=>!m.lang||m.lang.test(n)).reverse(),o.length){let w=0;(function k(N=0){for(let O=N,Y=a.length;O<Y;O++){const S=a.codePointAt(O);if(w===1&&p[h[O-1]].supportsCodePoint(S)||O>0&&/\s/.test(a[O]))h[O]=h[O-1],w===2&&(y[y.length-1][1]=O);else for(let A=h[O],T=o.length;A<=T;A++)if(A===T){const H=w===2?y[y.length-1]:y[y.length]=[O,O];H[1]=O,w=2}else{h[O]=A;const{src:H,unicodeRange:z}=o[A];if(!z||g(S,z)){const K=c[H];if(!K){e(H,()=>{k(O)});return}if(K.supportsCodePoint(S)){let Q=v.get(K);typeof Q!="number"&&(Q=p.length,p.push(K),v.set(K,Q)),h[O]=Q,w=1;break}}}S>65535&&O+1<Y&&(h[O+1]=h[O],O++,w===2&&(y[y.length-1][1]=O))}U()})()}else y.push([0,a.length-1]),U();function U(){if(y.length){const m=y.map(C=>a.substring(C[0],C[1]+1)).join(`
`);r.getFontsForString(m,{lang:n||void 0,style:s,weight:f,dataUrl:d}).then(({fontUrls:C,chars:L})=>{const w=p.length;let k=0;y.forEach(O=>{for(let Y=0,S=O[1]-O[0];Y<=S;Y++)h[O[0]+Y]=L[k++]+w;k++});let N=0;C.forEach((O,Y)=>{e(O,S=>{p[Y+w]=S,++N===C.length&&x()})})})}else x()}function x(){i({chars:h,fonts:p})}function g(m,C){for(let L=0;L<C.length;L++){const[w,k=w]=C[L];if(w<=m&&m<=k)return!0}return!1}}}const ho=Bt({name:"FontResolver",dependencies:[uo,co,fo],init(l,r,c){return l(r,c())}});function po(l,r){const u=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:p,lang:v,fonts:y,style:U,weight:x,preResolvedFonts:g,unicodeFontsURL:m},C){const L=({chars:w,fonts:k})=>{let N,O;const Y=[];for(let S=0;S<w.length;S++)w[S]!==O?(O=w[S],Y.push(N={start:S,end:S,fontObj:k[w[S]]})):N.end=S;C(Y)};g?L(g):l(p,L,{lang:v,fonts:y,style:U,weight:x,unicodeFontsURL:m})}function i({text:p="",font:v,lang:y,sdfGlyphSize:U=64,fontSize:x=400,fontWeight:g=1,fontStyle:m="normal",letterSpacing:C=0,lineHeight:L="normal",maxWidth:w=1/0,direction:k,textAlign:N="left",textIndent:O=0,whiteSpace:Y="normal",overflowWrap:S="normal",anchorX:A=0,anchorY:T=0,metricsOnly:H=!1,unicodeFontsURL:z,preResolvedFonts:K=null,includeCaretPositions:Q=!1,chunkedBoundsSize:P=8192,colorRanges:I=null},b){const E=f(),R={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),x=+x,C=+C,w=+w,L=L||"normal",O=+O,a({text:p,lang:y,style:m,weight:g,fonts:typeof v=="string"?[{src:v}]:v,unicodeFontsURL:z,preResolvedFonts:K},F=>{R.fontLoad=f()-E;const D=isFinite(w);let j=null,M=null,G=null,Z=null,ee=null,V=null,W=null,ye=null,he=0,$=0,re=Y!=="nowrap";const fe=new Map,X=f();let ne=O,te=0,B=new d;const ve=[B];F.forEach(ie=>{const{fontObj:se}=ie,{ascender:de,descender:ge,unitsPerEm:Ee,lineGap:De,capHeight:be,xHeight:xe}=se;let ue=fe.get(se);if(!ue){const pe=x/Ee,Te=L==="normal"?(de-ge+De)*pe:L*x,ut=(Te-(de-ge)*pe)/2,Ae=Math.min(Te,(de-ge)*pe),Se=(de+ge)/2*pe+Ae/2;ue={index:fe.size,src:se.src,fontObj:se,fontSizeMult:pe,unitsPerEm:Ee,ascender:de*pe,descender:ge*pe,capHeight:be*pe,xHeight:xe*pe,lineHeight:Te,baseline:-ut-de*pe,caretTop:Se,caretBottom:Se-Ae},fe.set(se,ue)}const{fontSizeMult:Le}=ue,Ue=p.slice(ie.start,ie.end+1);let He,we;se.forEachGlyph(Ue,x,C,(pe,Te,ut,Ae)=>{Te+=te,Ae+=ie.start,He=Te,we=pe;const Se=p.charAt(Ae),Re=pe.advanceWidth*Le,Ce=B.count;let me;if("isEmpty"in pe||(pe.isWhitespace=!!Se&&new RegExp(t).test(Se),pe.canBreakAfter=!!Se&&e.test(Se),pe.isEmpty=pe.xMin===pe.xMax||pe.yMin===pe.yMax||u.test(Se)),!pe.isWhitespace&&!pe.isEmpty&&$++,re&&D&&!pe.isWhitespace&&Te+Re+ne>w&&Ce){if(B.glyphAt(Ce-1).glyphObj.canBreakAfter)me=new d,ne=-Te;else for(let Be=Ce;Be--;)if(Be===0&&S==="break-word"){me=new d,ne=-Te;break}else if(B.glyphAt(Be).glyphObj.canBreakAfter){me=B.splitAt(Be+1);const Pe=me.glyphAt(0).x;ne-=Pe;for(let Fe=me.count;Fe--;)me.glyphAt(Fe).x-=Pe;break}me&&(B.isSoftWrapped=!0,B=me,ve.push(B),he=w)}let ke=B.glyphAt(B.count);ke.glyphObj=pe,ke.x=Te+ne,ke.y=ut,ke.width=Re,ke.charIndex=Ae,ke.fontData=ue,Se===`
`&&(B=new d,ve.push(B),ne=-(Te+Re+C*x)+O)}),te=He+we.advanceWidth*Le+C*x});let q=0;ve.forEach(ie=>{let se=!0;for(let de=ie.count;de--;){const ge=ie.glyphAt(de);se&&!ge.glyphObj.isWhitespace&&(ie.width=ge.x+ge.width,ie.width>he&&(he=ie.width),se=!1);let{lineHeight:Ee,capHeight:De,xHeight:be,baseline:xe}=ge.fontData;Ee>ie.lineHeight&&(ie.lineHeight=Ee);const ue=xe-ie.baseline;ue<0&&(ie.baseline+=ue,ie.cap+=ue,ie.ex+=ue),ie.cap=Math.max(ie.cap,ie.baseline+De),ie.ex=Math.max(ie.ex,ie.baseline+be)}ie.baseline-=q,ie.cap-=q,ie.ex-=q,q+=ie.lineHeight});let oe=0,J=0;if(A&&(typeof A=="number"?oe=-A:typeof A=="string"&&(oe=-he*(A==="left"?0:A==="center"?.5:A==="right"?1:o(A)))),T&&(typeof T=="number"?J=-T:typeof T=="string"&&(J=T==="top"?0:T==="top-baseline"?-ve[0].baseline:T==="top-cap"?-ve[0].cap:T==="top-ex"?-ve[0].ex:T==="middle"?q/2:T==="bottom"?q:T==="bottom-baseline"?-ve[ve.length-1].baseline:o(T)*q)),!H){const ie=r.getEmbeddingLevels(p,k);j=new Uint16Array($),M=new Uint8Array($),G=new Float32Array($*2),Z={},W=[1/0,1/0,-1/0,-1/0],ye=[],Q&&(V=new Float32Array(p.length*4)),I&&(ee=new Uint8Array($*3));let se=0,de=-1,ge=-1,Ee,De;if(ve.forEach((be,xe)=>{let{count:ue,width:Le}=be;if(ue>0){let Ue=0;for(let Ae=ue;Ae--&&be.glyphAt(Ae).glyphObj.isWhitespace;)Ue++;let He=0,we=0;if(N==="center")He=(he-Le)/2;else if(N==="right")He=he-Le;else if(N==="justify"&&be.isSoftWrapped){let Ae=0;for(let Se=ue-Ue;Se--;)be.glyphAt(Se).glyphObj.isWhitespace&&Ae++;we=(he-Le)/Ae}if(we||He){let Ae=0;for(let Se=0;Se<ue;Se++){let Re=be.glyphAt(Se);const Ce=Re.glyphObj;Re.x+=He+Ae,we!==0&&Ce.isWhitespace&&Se<ue-Ue&&(Ae+=we,Re.width+=we)}}const pe=r.getReorderSegments(p,ie,be.glyphAt(0).charIndex,be.glyphAt(be.count-1).charIndex);for(let Ae=0;Ae<pe.length;Ae++){const[Se,Re]=pe[Ae];let Ce=1/0,me=-1/0;for(let ke=0;ke<ue;ke++)if(be.glyphAt(ke).charIndex>=Se){let Be=ke,Pe=ke;for(;Pe<ue;Pe++){let Fe=be.glyphAt(Pe);if(Fe.charIndex>Re)break;Pe<ue-Ue&&(Ce=Math.min(Ce,Fe.x),me=Math.max(me,Fe.x+Fe.width))}for(let Fe=Be;Fe<Pe;Fe++){const qe=be.glyphAt(Fe);qe.x=me-(qe.x+qe.width-Ce)}break}}let Te;const ut=Ae=>Te=Ae;for(let Ae=0;Ae<ue;Ae++){const Se=be.glyphAt(Ae);Te=Se.glyphObj;const Re=Te.index,Ce=ie.levels[Se.charIndex]&1;if(Ce){const me=r.getMirroredCharacter(p[Se.charIndex]);me&&Se.fontData.fontObj.forEachGlyph(me,0,0,ut)}if(Q){const{charIndex:me,fontData:ke}=Se,Be=Se.x+oe,Pe=Se.x+Se.width+oe;V[me*4]=Ce?Pe:Be,V[me*4+1]=Ce?Be:Pe,V[me*4+2]=be.baseline+ke.caretBottom+J,V[me*4+3]=be.baseline+ke.caretTop+J;const Fe=me-de;Fe>1&&s(V,de,Fe),de=me}if(I){const{charIndex:me}=Se;for(;me>ge;)ge++,I.hasOwnProperty(ge)&&(De=I[ge])}if(!Te.isWhitespace&&!Te.isEmpty){const me=se++,{fontSizeMult:ke,src:Be,index:Pe}=Se.fontData,Fe=Z[Be]||(Z[Be]={});Fe[Re]||(Fe[Re]={path:Te.path,pathBounds:[Te.xMin,Te.yMin,Te.xMax,Te.yMax]});const qe=Se.x+oe,dt=Se.y+be.baseline+J;G[me*2]=qe,G[me*2+1]=dt;const st=qe+Te.xMin*ke,ht=dt+Te.yMin*ke,yt=qe+Te.xMax*ke,lt=dt+Te.yMax*ke;st<W[0]&&(W[0]=st),ht<W[1]&&(W[1]=ht),yt>W[2]&&(W[2]=yt),lt>W[3]&&(W[3]=lt),me%P===0&&(Ee={start:me,end:me,rect:[1/0,1/0,-1/0,-1/0]},ye.push(Ee)),Ee.end++;const je=Ee.rect;if(st<je[0]&&(je[0]=st),ht<je[1]&&(je[1]=ht),yt>je[2]&&(je[2]=yt),lt>je[3]&&(je[3]=lt),j[me]=Re,M[me]=Pe,I){const bt=me*3;ee[bt]=De>>16&255,ee[bt+1]=De>>8&255,ee[bt+2]=De&255}}}}}),V){const be=p.length-de;be>1&&s(V,de,be)}}const _e=[];fe.forEach(({index:ie,src:se,unitsPerEm:de,ascender:ge,descender:Ee,lineHeight:De,capHeight:be,xHeight:xe})=>{_e[ie]={src:se,unitsPerEm:de,ascender:ge,descender:Ee,lineHeight:De,capHeight:be,xHeight:xe}}),R.typesetting=f()-X,b({glyphIds:j,glyphFontIndices:M,glyphPositions:G,glyphData:Z,fontData:_e,caretPositions:V,glyphColors:ee,chunkedBounds:ye,fontSize:x,topBaseline:J+ve[0].baseline,blockBounds:[oe,J-q,oe+he,J],visibleBounds:W,timings:R})})}function n(p,v){i({...p,metricsOnly:!0},y=>{const[U,x,g,m]=y.blockBounds;v({width:g-U,height:m-x})})}function o(p){let v=p.match(/^([\d.]+)%$/),y=v?parseFloat(v[1]):NaN;return isNaN(y)?0:y/100}function s(p,v,y){const U=p[v*4],x=p[v*4+1],g=p[v*4+2],m=p[v*4+3],C=(x-U)/y;for(let L=0;L<y;L++){const w=(v+L)*4;p[w]=U+C*L,p[w+1]=U+C*(L+1),p[w+2]=g,p[w+3]=m}}function f(){return(self.performance||Date).now()}function d(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(p){let v=d.flyweight;return v.data=this.data,v.index=p,v},splitAt(p){let v=new d;return v.data=this.data.splice(p*h.length),v}},d.flyweight=h.reduce((p,v,y,U)=>(Object.defineProperty(p,v,{get(){return this.data[this.index*h.length+y]},set(x){this.data[this.index*h.length+y]=x}}),p),{data:null,index:0}),{typeset:i,measure:n}}const wt=()=>(self.performance||Date).now(),Mr=Ra();let fa;function vo(l,r,c,u,t,e,a,i,n,o,s=!0){return s?mo(l,r,c,u,t,e,a,i,n,o).then(null,f=>(fa||(console.warn("WebGL SDF generation failed, falling back to JS",f),fa=!0),da(l,r,c,u,t,e,a,i,n,o))):da(l,r,c,u,t,e,a,i,n,o)}const Lr=[],go=5;let bn=0;function Oa(){const l=wt();for(;Lr.length&&wt()-l<go;)Lr.shift()();bn=Lr.length?setTimeout(Oa,0):0}const mo=(...l)=>new Promise((r,c)=>{Lr.push(()=>{const u=wt();try{Mr.webgl.generateIntoCanvas(...l),r({timing:wt()-u})}catch(t){c(t)}}),bn||(bn=setTimeout(Oa,0))}),yo=4,bo=2e3,ua={};let xo=0;function da(l,r,c,u,t,e,a,i,n,o){const s="TroikaTextSDFGenerator_JS_"+xo++%yo;let f=ua[s];return f||(f=ua[s]={workerModule:Bt({name:s,workerId:s,dependencies:[Ra,wt],init(d,h){const p=d().javascript.generate;return function(...v){const y=h();return{textureData:p(...v),timing:h()-y}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(l,r,c,u,t,e).then(({textureData:d,timing:h})=>{const p=wt(),v=new Uint8Array(d.length*4);for(let y=0;y<d.length;y++)v[y*4+o]=d[y];return Mr.webglUtils.renderImageData(a,v,i,n,l,r,1<<3-o),h+=wt()-p,--f.requests===0&&(f.idleTimer=setTimeout(()=>{Ji(s)},bo)),{timing:h}})}function So(l){l._warm||(Mr.webgl.isSupported(l),l._warm=!0)}const _o=Mr.webglUtils.resizeWebGLCanvasWithoutClearing,er={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},To=new at;function Ot(){return(self.performance||Date).now()}const ha=Object.create(null);function Ma(l,r){l=wo({},l);const c=Ot(),u=[];if(l.font&&u.push({label:"user",src:Uo(l.font)}),l.font=u,l.text=""+l.text,l.sdfGlyphSize=l.sdfGlyphSize||er.sdfGlyphSize,l.unicodeFontsURL=l.unicodeFontsURL||er.unicodeFontsURL,l.colorRanges!=null){let d={};for(let h in l.colorRanges)if(l.colorRanges.hasOwnProperty(h)){let p=l.colorRanges[h];typeof p!="number"&&(p=To.set(p).getHex()),d[h]=p}l.colorRanges=d}Object.freeze(l);const{textureWidth:t,sdfExponent:e}=er,{sdfGlyphSize:a}=l,i=t/a*4;let n=ha[a];if(!n){const d=document.createElement("canvas");d.width=t,d.height=a*256/i,n=ha[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:d,sdfTexture:new ci(d,void 0,void 0,void 0,Jn,Jn),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,Ao(n)}const{sdfTexture:o,sdfCanvas:s}=n;Pa(l).then(d=>{const{glyphIds:h,glyphFontIndices:p,fontData:v,glyphPositions:y,fontSize:U,timings:x}=d,g=[],m=new Float32Array(h.length*4);let C=0,L=0;const w=Ot(),k=v.map(A=>{let T=n.glyphsByFont.get(A.src);return T||n.glyphsByFont.set(A.src,T=new Map),T});h.forEach((A,T)=>{const H=p[T],{src:z,unitsPerEm:K}=v[H];let Q=k[H].get(A);if(!Q){const{path:R,pathBounds:F}=d.glyphData[z][A],D=Math.max(F[2]-F[0],F[3]-F[1])/a*(er.sdfMargin*a+.5),j=n.glyphCount++,M=[F[0]-D,F[1]-D,F[2]+D,F[3]+D];k[H].set(A,Q={path:R,atlasIndex:j,sdfViewBox:M}),g.push(Q)}const{sdfViewBox:P}=Q,I=y[L++],b=y[L++],E=U/K;m[C++]=I+P[0]*E,m[C++]=b+P[1]*E,m[C++]=I+P[2]*E,m[C++]=b+P[3]*E,h[T]=Q.atlasIndex}),x.quads=(x.quads||0)+(Ot()-w);const N=Ot();x.sdf={};const O=s.height,Y=Math.ceil(n.glyphCount/i),S=Math.pow(2,Math.ceil(Math.log2(Y*a)));S>O&&(console.info(`Increasing SDF texture size ${O}->${S}`),_o(s,t,S),o.dispose()),Promise.all(g.map(A=>Ia(A,n,l.gpuAccelerateSDF).then(({timing:T})=>{x.sdf[A.atlasIndex]=T}))).then(()=>{g.length&&!n.contextLost&&(Na(n),o.needsUpdate=!0),x.sdfTotal=Ot()-N,x.total=Ot()-c,r(Object.freeze({parameters:l,sdfTexture:o,sdfGlyphSize:a,sdfExponent:e,glyphBounds:m,glyphAtlasIndices:h,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{n.contextLost||So(s)})}function Ia({path:l,atlasIndex:r,sdfViewBox:c},{sdfGlyphSize:u,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:n}=er,o=Math.max(c[2]-c[0],c[3]-c[1]),s=Math.floor(r/4),f=s%(i/u)*u,d=Math.floor(s/(i/u))*u,h=r%4;return vo(u,u,l,c,o,n,t,f,d,h,a)}function Ao(l){const r=l.sdfCanvas;r.addEventListener("webglcontextlost",c=>{console.log("Context Lost",c),c.preventDefault(),l.contextLost=!0}),r.addEventListener("webglcontextrestored",c=>{console.log("Context Restored",c),l.contextLost=!1;const u=[];l.glyphsByFont.forEach(t=>{t.forEach(e=>{u.push(Ia(e,l,!0))})}),Promise.all(u).then(()=>{Na(l),l.sdfTexture.needsUpdate=!0})})}function Eo({font:l,characters:r,sdfGlyphSize:c},u){let t=Array.isArray(r)?r.join(`
`):""+r;Ma({font:l,sdfGlyphSize:c,text:t},u)}function wo(l,r){for(let c in r)r.hasOwnProperty(c)&&(l[c]=r[c]);return l}let Er;function Uo(l){return Er||(Er=typeof document>"u"?{}:document.createElement("a")),Er.href=l,Er.href}function Na(l){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:c}=l,{width:u,height:t}=r,e=l.sdfCanvas.getContext("webgl");let a=c.image.data;(!a||a.length!==u*t*4)&&(a=new Uint8Array(u*t*4),c.image={width:u,height:t,data:a},c.flipY=!1,c.isDataTexture=!0),e.readPixels(0,0,u,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const Co=Bt({name:"Typesetter",dependencies:[po,ho,Qi],init(l,r,c){return l(r,c())}}),Pa=Bt({name:"Typesetter",dependencies:[Co],init(l){return function(r){return new Promise(c=>{l.typeset(r,c)})}},getTransferables(l){const r=[];for(let c in l)l[c]&&l[c].buffer&&r.push(l[c].buffer);return r}});Pa.onMainThread;const pa={};function ko(l){let r=pa[l];return r||(r=pa[l]=new Sn(1,1,l,l).translate(.5,.5,0)),r}const Do="aTroikaGlyphBounds",va="aTroikaGlyphIndex",Lo="aTroikaGlyphColor";class Ro extends Aa{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new xn,this.boundingBox=new or}computeBoundingSphere(){}computeBoundingBox(){}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let c=ko(r);["position","normal","uv"].forEach(u=>{this.attributes[u]=c.attributes[u].clone()}),this.setIndex(c.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,c,u,t,e){this.updateAttributeData(Do,r,4),this.updateAttributeData(va,c,1),this.updateAttributeData(Lo,e,3),this._blockBounds=u,this._chunkedBounds=t,this.instanceCount=c.length,this._updateBounds()}_updateBounds(){const r=this._blockBounds;if(r){const{curveRadius:c,boundingBox:u}=this;if(c){const{PI:t,floor:e,min:a,max:i,sin:n,cos:o}=Math,s=t/2,f=t*2,d=Math.abs(c),h=r[0]/d,p=r[2]/d,v=e((h+s)/f)!==e((p+s)/f)?-d:a(n(h)*d,n(p)*d),y=e((h-s)/f)!==e((p-s)/f)?d:i(n(h)*d,n(p)*d),U=e((h+t)/f)!==e((p+t)/f)?d*2:i(d-o(h)*d,d-o(p)*d);u.min.set(v,r[1],c<0?-U:0),u.max.set(y,r[3],c<0?0:U)}else u.min.set(r[0],r[1],0),u.max.set(r[2],r[3],0);u.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let c=this.getAttribute(va).count,u=this._chunkedBounds;if(u)for(let t=u.length;t--;){c=u[t].end;let e=u[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=c}updateAttributeData(r,c,u){const t=this.getAttribute(r);c?t&&t.array.length===c.length?(t.array.set(c),t.needsUpdate=!0):(this.setAttribute(r,new li(c,u)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(r)}}const Fo=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Oo=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Mo=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Io=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function No(l){const r=yn(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Pt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new mt(0,0,0,0)},uTroikaClipRect:{value:new mt(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Pt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new at},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new fi},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Fo,vertexTransform:Oo,fragmentDefs:Mo,fragmentColorTransform:Io,customRewriter({vertexShader:c,fragmentShader:u}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(u)&&(u=u.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(c)||(c=c.replace(Fa,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:c,fragmentShader:u}}});return r.transparent=!0,r.forceSinglePass=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const En=new si({color:16777215,side:ui,transparent:!0}),ga=8421504,ma=new Ea,wr=new We,cn=new We,qt=[],Po=new We,fn="+x+y";function ya(l){return Array.isArray(l)?l[0]:l}let Ga=()=>{const l=new Or(new Sn(1,1),En);return Ga=()=>l,l},Ba=()=>{const l=new Or(new Sn(1,1,32,1),En);return Ba=()=>l,l};const Go={type:"syncstart"},Bo={type:"synccomplete"},ja=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],jo=ja.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let za=class extends Or{constructor(){const r=new Ro;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=ga,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=fn,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(Go),Ma({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},c=>{this._isSyncing=!1,this._textRenderInfo=c,this.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.blockBounds,c.chunkedBounds,c.glyphColors);const u=this._queuedSyncs;u&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{u.forEach(t=>t&&t())})),this.dispatchEvent(Bo),r&&r()})))}onBeforeRender(r,c,u,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(r){return No(r)}get material(){let r=this._derivedMaterial;const c=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=En.clone());if((!r||!r.isDerivedFrom(c))&&(r=this._derivedMaterial=this.createDerivedMaterial(c),c.addEventListener("dispose",function u(){c.removeEventListener("dispose",u),r.dispose()})),this.hasOutline()){let u=r._outlineMtl;return u||(u=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),u.isTextOutlineMaterial=!0,u.depthWrite=!1,u.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),u.dispose()})),[u,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return ya(this.material).getDepthMaterial()}set customDepthMaterial(r){}get customDistanceMaterial(){return ya(this.material).getDistanceMaterial()}set customDistanceMaterial(r){}_prepareForRender(r){const c=r.isTextOutlineMaterial,u=r.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:i,blockBounds:n}=t;u.uTroikaSDFTexture.value=i,u.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),u.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,u.uTroikaSDFExponent.value=t.sdfExponent,u.uTroikaTotalBounds.value.fromArray(n),u.uTroikaUseGlyphColors.value=!c&&!!t.glyphColors;let o=0,s=0,f=0,d,h,p,v=0,y=0;if(c){let{outlineWidth:x,outlineOffsetX:g,outlineOffsetY:m,outlineBlur:C,outlineOpacity:L}=this;o=this._parsePercent(x)||0,s=Math.max(0,this._parsePercent(C)||0),d=L,v=this._parsePercent(g)||0,y=this._parsePercent(m)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(p=this.strokeColor,u.uTroikaStrokeColor.value.set(p??ga),h=this.strokeOpacity,h==null&&(h=1)),d=this.fillOpacity;u.uTroikaEdgeOffset.value=o,u.uTroikaPositionOffset.value.set(v,y),u.uTroikaBlurRadius.value=s,u.uTroikaStrokeWidth.value=f,u.uTroikaStrokeOpacity.value=h,u.uTroikaFillOpacity.value=d??1,u.uTroikaCurveRadius.value=this.curveRadius||0;let U=this.clipRect;if(U&&Array.isArray(U)&&U.length===4)u.uTroikaClipRect.value.fromArray(U);else{const x=(this.fontSize||.1)*100;u.uTroikaClipRect.value.set(n[0]-x,n[1]-x,n[2]+x,n[3]+x)}this.geometry.applyClipRect(u.uTroikaClipRect.value)}u.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;const e=c?this.outlineColor||0:this.color;if(e==null)delete r.color;else{const i=r.hasOwnProperty("color")?r.color:r.color=new at;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let a=this.orientation||fn;if(a!==r._orientation){let i=u.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==fn&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,o,s,f,d]=n;wr.set(0,0,0)[s]=o==="-"?1:-1,cn.set(0,0,0)[d]=f==="-"?-1:1,ma.lookAt(Po,wr.cross(cn),cn),i.setFromMatrix4(ma)}else i.identity();r._orientation=a}}_parsePercent(r){if(typeof r=="string"){let c=r.match(/^(-?[\d.]+)%$/),u=c?parseFloat(c[1]):NaN;r=(isNaN(u)?0:u/100)*this.fontSize}return r}localPositionToTextCoords(r,c=new Pt){c.copy(r);const u=this.curveRadius;return u&&(c.x=Math.atan2(r.x,Math.abs(u)-Math.abs(r.z))*Math.abs(u)),c}worldPositionToTextCoords(r,c=new Pt){return wr.copy(r),this.localPositionToTextCoords(this.worldToLocal(wr),c)}raycast(r,c){const{textRenderInfo:u,curveRadius:t}=this;if(u){const e=u.blockBounds,a=t?Ba():Ga(),i=a.geometry,{position:n,uv:o}=i.attributes;for(let s=0;s<o.count;s++){let f=e[0]+o.getX(s)*(e[2]-e[0]);const d=e[1]+o.getY(s)*(e[3]-e[1]);let h=0;t&&(h=t-Math.cos(f/t)*t,f=Math.sin(f/t)*t),n.setXYZ(s,f,d,h)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,qt.length=0,a.raycast(r,qt);for(let s=0;s<qt.length;s++)qt[s].object=this,c.push(qt[s])}}copy(r){const c=this.geometry;return super.copy(r),this.geometry=c,jo.forEach(u=>{this[u]=r[u]}),this}clone(){return new this.constructor().copy(this)}};ja.forEach(l=>{const r="_private_"+l;Object.defineProperty(za.prototype,l,{get(){return this[r]},set(c){c!==this[r]&&(this[r]=c,this._needsSync=!0)}})});new or;new at;const Wa=ae.forwardRef(({sdfGlyphSize:l=64,anchorX:r="center",anchorY:c="middle",font:u,fontSize:t=1,children:e,characters:a,onSync:i,...n},o)=>{const s=_n(({invalidate:p})=>p),[f]=ae.useState(()=>new za),[d,h]=ae.useMemo(()=>{const p=[];let v="";return ae.Children.forEach(e,y=>{typeof y=="string"||typeof y=="number"?v+=y:p.push(y)}),[p,v]},[e]);return zi(()=>new Promise(p=>Eo({font:u,characters:a},p)),["troika-text",u,a]),ae.useLayoutEffect(()=>void f.sync(()=>{s(),i&&i(f)})),ae.useEffect(()=>()=>f.dispose(),[f]),ae.createElement("primitive",vn({object:f,ref:o,font:u,text:h,anchorX:r,anchorY:c,fontSize:t,sdfGlyphSize:l},n),d)});function zo(){var l=0,r=1,c,u,t,e,a=wa,i=!1,n;function o(f){return f==null||isNaN(f=+f)?n:a(t===0?.5:(f=(e(f)-c)*t,i?Math.max(0,Math.min(1,f)):f))}o.domain=function(f){return arguments.length?([l,r]=f,c=e(l=+l),u=e(r=+r),t=c===u?0:1/(u-c),o):[l,r]},o.clamp=function(f){return arguments.length?(i=!!f,o):i},o.interpolator=function(f){return arguments.length?(a=f,o):a};function s(f){return function(d){var h,p;return arguments.length?([h,p]=d,a=f(h,p),o):[a(0),a(1)]}}return o.range=s(Ri),o.rangeRound=s(Fi),o.unknown=function(f){return arguments.length?(n=f,o):n},function(f){return e=f,c=f(l),u=f(r),t=c===u?0:1/(u-c),o}}function Wo(l,r){return r.domain(l.domain()).interpolator(l.interpolator()).clamp(l.clamp()).unknown(l.unknown())}function Ha(){var l=Di(zo()(wa));return l.copy=function(){return Wo(l,Ha())},Li.apply(l,arguments)}const ba=Math.abs,Ge=Math.atan2,St=Math.cos,Ho=Math.max,un=Math.min,nt=Math.sin,Nt=Math.sqrt,Ye=1e-12,ir=Math.PI,Fr=ir/2,Rr=2*ir;function Vo(l){return l>1?0:l<-1?ir:Math.acos(l)}function xa(l){return l>=1?Fr:l<=-1?-Fr:Math.asin(l)}function Xo(l){return l.innerRadius}function Yo(l){return l.outerRadius}function Zo(l){return l.startAngle}function Ko(l){return l.endAngle}function Jo(l){return l&&l.padAngle}function qo(l,r,c,u,t,e,a,i){var n=c-l,o=u-r,s=a-t,f=i-e,d=f*n-s*o;if(!(d*d<Ye))return d=(s*(r-e)-f*(l-t))/d,[l+d*n,r+d*o]}function Ur(l,r,c,u,t,e,a){var i=l-c,n=r-u,o=(a?e:-e)/Nt(i*i+n*n),s=o*n,f=-o*i,d=l+s,h=r+f,p=c+s,v=u+f,y=(d+p)/2,U=(h+v)/2,x=p-d,g=v-h,m=x*x+g*g,C=t-e,L=d*v-p*h,w=(g<0?-1:1)*Nt(Ho(0,C*C*m-L*L)),k=(L*g-x*w)/m,N=(-L*x-g*w)/m,O=(L*g+x*w)/m,Y=(-L*x+g*w)/m,S=k-y,A=N-U,T=O-y,H=Y-U;return S*S+A*A>T*T+H*H&&(k=O,N=Y),{cx:k,cy:N,x01:-s,y01:-f,x11:k*(t/C-1),y11:N*(t/C-1)}}function Sa(){var l=Xo,r=Yo,c=ze(0),u=null,t=Zo,e=Ko,a=Jo,i=null,n=Ni(o);function o(){var s,f,d=+l.apply(this,arguments),h=+r.apply(this,arguments),p=t.apply(this,arguments)-Fr,v=e.apply(this,arguments)-Fr,y=ba(v-p),U=v>p;if(i||(i=s=n()),h<d&&(f=h,h=d,d=f),!(h>Ye))i.moveTo(0,0);else if(y>Rr-Ye)i.moveTo(h*St(p),h*nt(p)),i.arc(0,0,h,p,v,!U),d>Ye&&(i.moveTo(d*St(v),d*nt(v)),i.arc(0,0,d,v,p,U));else{var x=p,g=v,m=p,C=v,L=y,w=y,k=a.apply(this,arguments)/2,N=k>Ye&&(u?+u.apply(this,arguments):Nt(d*d+h*h)),O=un(ba(h-d)/2,+c.apply(this,arguments)),Y=O,S=O,A,T;if(N>Ye){var H=xa(N/d*nt(k)),z=xa(N/h*nt(k));(L-=H*2)>Ye?(H*=U?1:-1,m+=H,C-=H):(L=0,m=C=(p+v)/2),(w-=z*2)>Ye?(z*=U?1:-1,x+=z,g-=z):(w=0,x=g=(p+v)/2)}var K=h*St(x),Q=h*nt(x),P=d*St(C),I=d*nt(C);if(O>Ye){var b=h*St(g),E=h*nt(g),R=d*St(m),F=d*nt(m),D;if(y<ir)if(D=qo(K,Q,R,F,b,E,P,I)){var j=K-D[0],M=Q-D[1],G=b-D[0],Z=E-D[1],ee=1/nt(Vo((j*G+M*Z)/(Nt(j*j+M*M)*Nt(G*G+Z*Z)))/2),V=Nt(D[0]*D[0]+D[1]*D[1]);Y=un(O,(d-V)/(ee-1)),S=un(O,(h-V)/(ee+1))}else Y=S=0}w>Ye?S>Ye?(A=Ur(R,F,K,Q,h,S,U),T=Ur(b,E,P,I,h,S,U),i.moveTo(A.cx+A.x01,A.cy+A.y01),S<O?i.arc(A.cx,A.cy,S,Ge(A.y01,A.x01),Ge(T.y01,T.x01),!U):(i.arc(A.cx,A.cy,S,Ge(A.y01,A.x01),Ge(A.y11,A.x11),!U),i.arc(0,0,h,Ge(A.cy+A.y11,A.cx+A.x11),Ge(T.cy+T.y11,T.cx+T.x11),!U),i.arc(T.cx,T.cy,S,Ge(T.y11,T.x11),Ge(T.y01,T.x01),!U))):(i.moveTo(K,Q),i.arc(0,0,h,x,g,!U)):i.moveTo(K,Q),!(d>Ye)||!(L>Ye)?i.lineTo(P,I):Y>Ye?(A=Ur(P,I,b,E,d,-Y,U),T=Ur(K,Q,R,F,d,-Y,U),i.lineTo(A.cx+A.x01,A.cy+A.y01),Y<O?i.arc(A.cx,A.cy,Y,Ge(A.y01,A.x01),Ge(T.y01,T.x01),!U):(i.arc(A.cx,A.cy,Y,Ge(A.y01,A.x01),Ge(A.y11,A.x11),!U),i.arc(0,0,d,Ge(A.cy+A.y11,A.cx+A.x11),Ge(T.cy+T.y11,T.cx+T.x11),U),i.arc(T.cx,T.cy,Y,Ge(T.y11,T.x11),Ge(T.y01,T.x01),!U))):i.arc(0,0,d,C,m,U)}if(i.closePath(),s)return i=null,s+""||null}return o.centroid=function(){var s=(+l.apply(this,arguments)+ +r.apply(this,arguments))/2,f=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2-ir/2;return[St(f)*s,nt(f)*s]},o.innerRadius=function(s){return arguments.length?(l=typeof s=="function"?s:ze(+s),o):l},o.outerRadius=function(s){return arguments.length?(r=typeof s=="function"?s:ze(+s),o):r},o.cornerRadius=function(s){return arguments.length?(c=typeof s=="function"?s:ze(+s),o):c},o.padRadius=function(s){return arguments.length?(u=s==null?null:typeof s=="function"?s:ze(+s),o):u},o.startAngle=function(s){return arguments.length?(t=typeof s=="function"?s:ze(+s),o):t},o.endAngle=function(s){return arguments.length?(e=typeof s=="function"?s:ze(+s),o):e},o.padAngle=function(s){return arguments.length?(a=typeof s=="function"?s:ze(+s),o):a},o.context=function(s){return arguments.length?(i=s??null,o):i},o}function Qo(l,r){return r<l?-1:r>l?1:r>=l?0:NaN}function $o(l){return l}function es(){var l=$o,r=Qo,c=null,u=ze(0),t=ze(Rr),e=ze(0);function a(i){var n,o=(i=Pi(i)).length,s,f,d=0,h=new Array(o),p=new Array(o),v=+u.apply(this,arguments),y=Math.min(Rr,Math.max(-Rr,t.apply(this,arguments)-v)),U,x=Math.min(Math.abs(y)/o,e.apply(this,arguments)),g=x*(y<0?-1:1),m;for(n=0;n<o;++n)(m=p[h[n]=n]=+l(i[n],n,i))>0&&(d+=m);for(r!=null?h.sort(function(C,L){return r(p[C],p[L])}):c!=null&&h.sort(function(C,L){return c(i[C],i[L])}),n=0,f=d?(y-o*g)/d:0;n<o;++n,v=U)s=h[n],m=p[s],U=v+(m>0?m*f:0)+g,p[s]={data:i[s],index:n,value:m,startAngle:v,endAngle:U,padAngle:x};return p}return a.value=function(i){return arguments.length?(l=typeof i=="function"?i:ze(+i),a):l},a.sortValues=function(i){return arguments.length?(r=i,c=null,a):r},a.sort=function(i){return arguments.length?(c=i,r=null,a):c},a.startAngle=function(i){return arguments.length?(u=typeof i=="function"?i:ze(+i),a):u},a.endAngle=function(i){return arguments.length?(t=typeof i=="function"?i:ze(+i),a):t},a.padAngle=function(i){return arguments.length?(e=typeof i=="function"?i:ze(+i),a):e},a}const gt={SCALE_FACTOR:.75,LIGHT_YEAR_TO_SCENE:.75/3.26,TOP_CANDIDATES_COUNT:20},Ut={BASE_SIZE:2,MAX_SIZE:8,SIZE_ATTENUATION:300,SIZE_MIN_CLAMP:1,SIZE_MAX_CLAMP:30,ALPHA_MULTIPLIER:.9},At={TOP_CANDIDATE:"#ffd700",HABITABLE_EARTHLIKE:"#00ff88",HABITABLE:"#00ccff",HIGH_SCORE:"#ff8800",BRIGHTNESS_MIN:.2,BRIGHTNESS_RANGE:.3,HIGH_SCORE_THRESHOLD:60},_t={TEXTURE_SIZE:128,GRADIENT_STOPS:[.1,.3,.5],SPIKE_STOPS:[.3],CORE_RADIUS_MULTIPLIER:.15,SPIKE_WIDTH:2,SPIKE_LENGTH_MULTIPLIER:.9},Qt={HIT_THRESHOLD:20,DRAG_THRESHOLD:5,POINTER_CURSOR:"pointer",DEFAULT_CURSOR:"grab"},ct={RING_DISTANCES:[10,50,100,500,1e3],SEGMENTS:64,LINE_WIDTH:1,INITIAL_OPACITY:.15,OPACITY_STEP:.02,COLOR:"#ffffff",LABEL_FONT_SIZE:3,LABEL_OFFSET:5},$t={GRID_SIZE:1e3,GRID_DIVISIONS:20,GRID_COLOR:"#333333",GRID_SECONDARY_COLOR:"#222222",GRID_Y_OFFSET:-.1},Je={LENGTH:50,LINE_WIDTH:2,OPACITY:.5,X_AXIS_COLOR:"#ff4444",Y_AXIS_COLOR:"#44ff44",Z_AXIS_COLOR:"#4444ff"},Tt={CAMERA_X:0,CAMERA_Y:20,CAMERA_Z:60,CAMERA_FOV:60,CAMERA_NEAR:.1,CAMERA_FAR:5e3,AMBIENT_LIGHT_INTENSITY:.3},Mt={MIN_DISTANCE:20,MAX_DISTANCE:1e3,MIN_POLAR_ANGLE:0,MAX_POLAR_ANGLE:Math.PI,AUTO_ROTATE:!0,AUTO_ROTATE_SPEED:.3},dn={SOL_FONT_SIZE:2,SOL_COLOR:"#ffd700",SOL_TEXT:"SOL"},_a={X_OFFSET:15,Y_OFFSET:-10};function ts(l){return At.BRIGHTNESS_MIN+l/100*At.BRIGHTNESS_RANGE}function rs(l){const r=l/100;return Ut.BASE_SIZE+r*(Ut.MAX_SIZE-Ut.BASE_SIZE)}function ns(l,r){if(r.has(l.id))return new at(At.TOP_CANDIDATE);if(l.isHabitable&&l.isEarthLike)return new at(At.HABITABLE_EARTHLIKE);if(l.isHabitable)return new at(At.HABITABLE);if(l.score>=At.HIGH_SCORE_THRESHOLD)return new at(At.HIGH_SCORE);const c=ts(l.score);return new at(c,c,c)}function as(){const l=_t.TEXTURE_SIZE,r=document.createElement("canvas");r.width=l,r.height=l;const c=r.getContext("2d"),u=l/2;c.clearRect(0,0,l,l);const t=c.createRadialGradient(u,u,0,u,u,u);t.addColorStop(0,"rgba(255, 255, 255, 1)"),t.addColorStop(.1,"rgba(255, 255, 255, 0.8)"),t.addColorStop(_t.GRADIENT_STOPS[0],"rgba(255, 255, 255, 0.3)"),t.addColorStop(_t.GRADIENT_STOPS[1],"rgba(255, 255, 255, 0.1)"),t.addColorStop(1,"rgba(255, 255, 255, 0)"),c.fillStyle=t,c.fillRect(0,0,l,l),c.save(),c.translate(u,u);for(let i=0;i<4;i++){c.rotate(Math.PI/2);const n=c.createLinearGradient(0,0,0,-u);n.addColorStop(0,"rgba(255, 255, 255, 0.8)"),n.addColorStop(_t.SPIKE_STOPS[0],"rgba(255, 255, 255, 0.3)"),n.addColorStop(1,"rgba(255, 255, 255, 0)"),c.fillStyle=n,c.beginPath(),c.moveTo(-2,0),c.lineTo(0,-u*_t.SPIKE_LENGTH_MULTIPLIER),c.lineTo(_t.SPIKE_WIDTH,0),c.closePath(),c.fill()}c.restore();const e=c.createRadialGradient(u,u,0,u,u,l*_t.CORE_RADIUS_MULTIPLIER);e.addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(.5,"rgba(255, 255, 255, 0.8)"),e.addColorStop(1,"rgba(255, 255, 255, 0)"),c.fillStyle=e,c.fillRect(0,0,l,l);const a=new hi(r);return a.needsUpdate=!0,a}const is=`
  attribute vec3 planetColor;
  attribute float planetSize;

  varying vec3 vColor;

  void main() {
    vColor = planetColor;

    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * mvPosition;

    // Size attenuation
    gl_PointSize = planetSize * (${Ut.SIZE_ATTENUATION.toFixed(1)} / -mvPosition.z);
    gl_PointSize = clamp(gl_PointSize, ${Ut.SIZE_MIN_CLAMP.toFixed(1)}, ${Ut.SIZE_MAX_CLAMP.toFixed(1)});
  }
`,os=`
  uniform sampler2D uTexture;

  varying vec3 vColor;

  void main() {
    vec4 texColor = texture2D(uTexture, gl_PointCoord);
    gl_FragColor = vec4(vColor * texColor.rgb, texColor.a * ${Ut.ALPHA_MULTIPLIER.toFixed(1)});
  }
`;function ss({planets:l,onPlanetClick:r,onPlanetHover:c}){const u=ae.useRef(null),t=ae.useRef(null),e=ae.useRef(null),[a,i]=ae.useState(-1),{gl:n,camera:o}=_n(),s=ae.useRef(null),f=ae.useMemo(()=>as(),[]),d=ae.useMemo(()=>{const x=[...l].sort((g,m)=>m.score-g.score);return new Set(x.slice(0,gt.TOP_CANDIDATES_COUNT).map(g=>g.id))},[l]),h=ae.useMemo(()=>{const x=l.length,g=new Float32Array(x*3),m=new Float32Array(x*3),C=new Float32Array(x);return l.forEach((L,w)=>{g[w*3]=L.x*gt.SCALE_FACTOR,g[w*3+1]=L.y*gt.SCALE_FACTOR,g[w*3+2]=L.z*gt.SCALE_FACTOR;const k=ns(L,d);m[w*3]=k.r,m[w*3+1]=k.g,m[w*3+2]=k.b,C[w]=rs(L.score)}),{positions:g,colors:m,sizes:C}},[l,d]);ae.useEffect(()=>{if(!t.current)return;const x=t.current;x.setAttribute("position",new nn(h.positions,3)),x.setAttribute("planetColor",new nn(h.colors,3)),x.setAttribute("planetSize",new nn(h.sizes,1)),x.computeBoundingSphere()},[h]);const p=ae.useCallback(x=>{if(l.length===0)return;const g=n.domElement.getBoundingClientRect(),m=x.clientX-g.left,C=x.clientY-g.top;let L=-1,w=1/0;for(let k=0;k<l.length;k++){const N=l[k],Y=new We(N.x*gt.SCALE_FACTOR,N.y*gt.SCALE_FACTOR,N.z*gt.SCALE_FACTOR).project(o);if(Y.z>1)continue;const S=(Y.x+1)/2*g.width,A=(1-Y.y)/2*g.height,T=m-S,H=C-A,z=Math.sqrt(T*T+H*H);z<Qt.HIT_THRESHOLD&&z<w&&(L=k,w=z)}L!==a?(i(L),L>=0?(n.domElement.style.cursor=Qt.POINTER_CURSOR,c==null||c(l[L],{x:x.clientX,y:x.clientY})):(n.domElement.style.cursor=Qt.DEFAULT_CURSOR,c==null||c(null))):L>=0&&(c==null||c(l[L],{x:x.clientX,y:x.clientY}))},[l,a,n,o,c]),v=ae.useCallback(x=>{s.current={x:x.clientX,y:x.clientY}},[]),y=ae.useCallback(x=>{if(s.current){const g=x.clientX-s.current.x,m=x.clientY-s.current.y;if(Math.sqrt(g*g+m*m)>Qt.DRAG_THRESHOLD)return}a>=0&&l[a]&&(r==null||r(l[a]))},[a,l,r]),U=ae.useCallback(()=>{i(-1),n.domElement.style.cursor=Qt.DEFAULT_CURSOR,c==null||c(null)},[n,c]);return ae.useEffect(()=>{const x=n.domElement;return x.addEventListener("pointerdown",v),x.addEventListener("pointermove",p),x.addEventListener("click",y),x.addEventListener("pointerleave",U),()=>{x.removeEventListener("pointerdown",v),x.removeEventListener("pointermove",p),x.removeEventListener("click",y),x.removeEventListener("pointerleave",U)}},[n,v,p,y,U]),ae.useEffect(()=>()=>{f.dispose()},[f]),l.length===0?null:_.jsxs("points",{ref:u,frustumCulled:!1,children:[_.jsx("bufferGeometry",{ref:t}),_.jsx("shaderMaterial",{ref:e,vertexShader:is,fragmentShader:os,uniforms:{uTexture:{value:f}},transparent:!0,depthWrite:!1,blending:di})]})}function ls({distance:l,color:r,opacity:c,showPrefix:u=!1}){const t=l*gt.LIGHT_YEAR_TO_SCENE,e=ae.useMemo(()=>{const a=[];for(let i=0;i<=ct.SEGMENTS;i++){const n=i/ct.SEGMENTS*Math.PI*2;a.push(new We(Math.cos(n)*t,0,Math.sin(n)*t))}return a},[t]);return _.jsxs("group",{children:[_.jsx(kr,{points:e,color:r,lineWidth:ct.LINE_WIDTH,opacity:c,transparent:!0}),_.jsx(Wa,{position:[t,0,ct.LABEL_OFFSET],fontSize:ct.LABEL_FONT_SIZE,color:r,anchorX:"center",anchorY:"middle",children:u?`LY ${l}`:l})]})}function cs(){return _.jsxs("group",{rotation:[0,0,0],children:[ct.RING_DISTANCES.map((l,r)=>_.jsx(ls,{distance:l,color:ct.COLOR,opacity:ct.INITIAL_OPACITY-r*ct.OPACITY_STEP,showPrefix:r===0},l)),_.jsx("gridHelper",{args:[$t.GRID_SIZE,$t.GRID_DIVISIONS,$t.GRID_COLOR,$t.GRID_SECONDARY_COLOR],position:[0,$t.GRID_Y_OFFSET,0]}),_.jsx(kr,{points:[[0,0,0],[Je.LENGTH,0,0]],color:Je.X_AXIS_COLOR,lineWidth:Je.LINE_WIDTH,opacity:Je.OPACITY,transparent:!0}),_.jsx(kr,{points:[[0,0,0],[0,Je.LENGTH,0]],color:Je.Y_AXIS_COLOR,lineWidth:Je.LINE_WIDTH,opacity:Je.OPACITY,transparent:!0}),_.jsx(kr,{points:[[0,0,0],[0,0,Je.LENGTH]],color:Je.Z_AXIS_COLOR,lineWidth:Je.LINE_WIDTH,opacity:Je.OPACITY,transparent:!0})]})}function fs({data:l,stats:r}){const{t:c}=Ke(),u=pi(),[t,e]=ae.useState("all"),[a,i]=ae.useState(null),[n,o]=ae.useState({x:0,y:0}),s=bi(l,t),f=ae.useCallback(h=>{u(`/planets/${Cr(h.name)}`)},[u]),d=ae.useCallback((h,p)=>{i(h),p&&o(p)},[]);return _.jsxs("div",{className:"galaxy-view-container",children:[_.jsx("div",{className:"galaxy-canvas",children:_.jsx(yi,{camera:{position:[Tt.CAMERA_X,Tt.CAMERA_Y,Tt.CAMERA_Z],fov:Tt.CAMERA_FOV,near:Tt.CAMERA_NEAR,far:Tt.CAMERA_FAR},gl:{antialias:!0,alpha:!0},children:_.jsxs(ae.Suspense,{fallback:null,children:[_.jsx("ambientLight",{intensity:Tt.AMBIENT_LIGHT_INTENSITY}),_.jsx(ss,{planets:s,onPlanetClick:f,onPlanetHover:d}),_.jsx(cs,{}),_.jsx(Wa,{position:[0,0,0],fontSize:dn.SOL_FONT_SIZE,color:dn.SOL_COLOR,anchorX:"center",anchorY:"middle",children:dn.SOL_TEXT}),_.jsx(Oi,{enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:Mt.MIN_DISTANCE,maxDistance:Mt.MAX_DISTANCE,minPolarAngle:Mt.MIN_POLAR_ANGLE,maxPolarAngle:Mt.MAX_POLAR_ANGLE,autoRotate:Mt.AUTO_ROTATE,autoRotateSpeed:Mt.AUTO_ROTATE_SPEED})]})})}),_.jsxs("div",{className:"galaxy-controls",children:[_.jsx("div",{className:"filter-buttons",children:["all","habitable","earthLike","top20"].map(h=>_.jsx("button",{className:`filter-btn ${t===h?"active":""}`,onClick:()=>e(h),children:c(`pages.habitability.galaxy.filters.${h}`)},h))}),_.jsx("p",{className:"galaxy-hint",children:c("pages.habitability.galaxy.hint")})]}),_.jsxs("div",{className:"galaxy-legend",children:[_.jsxs("div",{className:"legend-item",children:[_.jsx("span",{className:"legend-dot top"}),_.jsx("span",{children:c("pages.habitability.galaxy.legend.top")})]}),_.jsxs("div",{className:"legend-item",children:[_.jsx("span",{className:"legend-dot habitable-earthlike"}),_.jsx("span",{children:c("pages.habitability.galaxy.legend.habitableEarthLike")})]}),_.jsxs("div",{className:"legend-item",children:[_.jsx("span",{className:"legend-dot habitable"}),_.jsx("span",{children:c("pages.habitability.galaxy.legend.habitable")})]}),_.jsxs("div",{className:"legend-item",children:[_.jsx("span",{className:"legend-dot other"}),_.jsx("span",{children:c("pages.habitability.galaxy.legend.other")})]})]}),_.jsxs("div",{className:"galaxy-callouts",children:[r.nearestHabitable&&_.jsxs("div",{className:"galaxy-callout clickable",onClick:()=>u(`/planets/${Cr(r.nearestHabitable.name)}`),children:[_.jsxs("span",{className:"callout-label",children:[c("pages.habitability.stats.nearest"),":"]}),_.jsx("span",{className:"callout-value",children:r.nearestHabitable.name}),_.jsx("span",{className:"callout-distance",children:c("pages.habitability.galaxy.distance",{distance:r.nearestHabitable.distanceLy.toFixed(1)})})]}),r.topScorerName&&_.jsxs("div",{className:"galaxy-callout clickable",onClick:()=>u(`/planets/${Cr(r.topScorerName)}`),children:[_.jsxs("span",{className:"callout-label",children:[c("pages.habitability.stats.topScore"),":"]}),_.jsx("span",{className:"callout-value",children:r.topScorerName}),_.jsx("span",{className:"callout-score",children:c("pages.habitability.charts.score",{score:r.topScore.toFixed(1)})})]})]}),a&&_.jsxs("div",{className:"galaxy-tooltip",style:{left:n.x+_a.X_OFFSET,top:n.y+_a.Y_OFFSET},children:[_.jsx("div",{className:"tooltip-name",children:a.name}),_.jsx("div",{className:"tooltip-score",children:c("pages.habitability.charts.score",{score:a.score.toFixed(1)})}),_.jsxs("div",{className:"tooltip-distance",children:[a.distanceLy.toFixed(1)," ",c("pages.habitability.charts.lightYears")]}),a.isHabitable&&_.jsx("div",{className:"tooltip-badge habitable",children:c("pages.habitability.charts.badges.habitableZone")}),a.isEarthLike&&_.jsx("div",{className:"tooltip-badge earth-like",children:c("pages.habitability.charts.badges.earthLike")})]})]})}function us({stats:l}){const{t:r}=Ke(),c=[{key:"total",value:l.total.toLocaleString(),label:r("pages.habitability.stats.total")},{key:"habitableZone",value:l.habitableZone.toLocaleString(),label:r("pages.habitability.stats.habitableZone"),highlight:!0},{key:"earthLike",value:l.earthLike.toLocaleString(),label:r("pages.habitability.stats.earthLike"),highlight:!0},{key:"topScore",value:l.topScore.toFixed(1),label:r("pages.habitability.stats.topScore"),sublabel:l.topScorerName}];return _.jsx("div",{className:"habitability-stats-bar",children:c.map(u=>_.jsxs("div",{className:`stat-item ${u.highlight?"highlight":""}`,children:[_.jsx("div",{className:"stat-value",children:u.value}),_.jsx("div",{className:"stat-label",children:u.label}),u.sublabel&&_.jsx("div",{className:"stat-sublabel",children:u.sublabel})]},u.key))})}function ds({candidates:l}){return _.jsx("div",{className:"candidates-grid",children:l.map((r,c)=>_.jsx(hs,{planet:r,rank:c+1},r.pl_name))})}function hs({planet:l,rank:r}){const{t:c}=Ke();return _.jsxs(vi,{to:`/planets/${Cr(l.pl_name)}`,className:"candidate-card",children:[_.jsx("div",{className:"candidate-rank",children:c("pages.habitability.candidates.rank",{rank:r})}),_.jsxs("div",{className:"candidate-content",children:[_.jsx("h4",{className:"candidate-name",children:l.pl_name}),_.jsxs("div",{className:"candidate-score",children:[_.jsx("span",{className:"score-value",children:l.habitability_score.toFixed(1)}),_.jsx("span",{className:"score-label",children:"/ 100"})]}),_.jsxs("div",{className:"candidate-details",children:[l.planet_type&&_.jsx("span",{className:"detail-item",children:l.planet_type}),l.distance_ly&&_.jsx("span",{className:"detail-item",children:c("pages.habitability.candidates.distance",{distance:l.distance_ly.toFixed(1)})}),l.pl_eqt&&_.jsxs("span",{className:"detail-item",children:[l.pl_eqt.toFixed(0),"K"]})]}),_.jsxs("div",{className:"candidate-badges",children:[l.is_habitable_zone&&_.jsx("span",{className:"badge habitable",children:c("pages.habitability.charts.badges.habitableZone")}),l.is_earth_like&&_.jsx("span",{className:"badge earth-like",children:c("pages.habitability.charts.badges.earthLike")})]})]}),_.jsxs("div",{className:"candidate-hover",children:[c("pages.habitability.candidates.viewDetails")," "]})]})}function kt({children:l,aspectRatio:r=16/9,minHeight:c=200,className:u="",mobileBreakpoint:t=600}){const e=ae.useRef(null),[a,i]=ae.useState({width:0,height:0,isMobile:!1});return ae.useEffect(()=>{const n=e.current;if(!n)return;const o=()=>{const f=n.clientWidth,d=Math.max(f/r,c),h=f<t;i({width:f,height:d,isMobile:h})};o();const s=new ResizeObserver(o);return s.observe(n),()=>{s.disconnect()}},[r,c,t]),_.jsx("div",{ref:e,className:`d3-chart-container ${u}`,children:a.width>0&&l(a)})}const Ir={top:20,right:20,bottom:40,left:50},ce={primary:"#00ccff",secondary:"#00ff88",tertiary:"#ffd700",muted:"#666666",axis:"#888888",grid:"#333333",text:"#ffffff",goldilocks:"rgba(0, 255, 136, 0.2)"};function ps({data:l}){const{t:r}=Ke(),c=l.filter(u=>u.min>=60).reduce((u,t)=>u+t.pct,0);return _.jsxs("div",{className:"insight-card",children:[_.jsx("h3",{className:"card-title",children:r("pages.habitability.insights.scoreDistribution.title")}),_.jsx("p",{className:"card-description",children:r("pages.habitability.insights.scoreDistribution.description",{pct:c.toFixed(1)})}),_.jsx(kt,{aspectRatio:2,children:u=>_.jsx(vs,{data:l,...u})})]})}function vs({data:l,width:r,height:c}){const u=ae.useRef(null),{t}=Ke();return ae.useEffect(()=>{if(!u.current||r===0)return;const e=ot(u.current);e.selectAll("*").remove();const a=Ir,i=r-a.left-a.right,n=c-a.top-a.bottom,o=e.append("g").attr("transform",`translate(${a.left},${a.top})`),s=nr().domain(l.map(d=>d.range)).range([0,i]).padding(.2),f=Gt().domain([0,ar(l,d=>d.pct)||100]).nice().range([n,0]);o.append("g").attr("class","grid").call(ft(f).tickSize(-i).tickFormat(()=>"")).selectAll("line").attr("stroke",ce.grid).attr("stroke-opacity",.5),o.selectAll(".grid .domain").remove(),o.selectAll(".bar").data(l).join("rect").attr("class","bar").attr("x",d=>s(d.range)||0).attr("y",d=>f(d.pct)).attr("width",s.bandwidth()).attr("height",d=>n-f(d.pct)).attr("fill",d=>d.min>=60?ce.secondary:ce.primary).attr("rx",2),o.selectAll(".bar-label").data(l).join("text").attr("class","bar-label").attr("x",d=>(s(d.range)||0)+s.bandwidth()/2).attr("y",d=>f(d.pct)-5).attr("text-anchor","middle").attr("fill",ce.text).attr("font-size","11px").text(d=>`${d.pct.toFixed(1)}%`),o.append("g").attr("transform",`translate(0,${n})`).call(Ct(s)).selectAll("text").attr("fill",ce.axis).attr("font-size","11px"),o.selectAll(".domain, .tick line").attr("stroke",ce.axis),o.append("g").call(ft(f).ticks(5).tickFormat(d=>`${d}%`)).selectAll("text").attr("fill",ce.axis).attr("font-size","11px"),o.append("text").attr("transform","rotate(-90)").attr("y",-40).attr("x",-n/2).attr("text-anchor","middle").attr("fill",ce.text).attr("font-size","12px").text(t("pages.habitability.charts.axes.percentOfPlanets"))},[l,r,c,t]),_.jsx("svg",{ref:u,width:r,height:c})}function gs({data:l}){const{t:r}=Ke();return _.jsxs("div",{className:"insight-card",children:[_.jsx("h3",{className:"card-title",children:r("pages.habitability.insights.temperature.title")}),_.jsx("p",{className:"card-description",children:r("pages.habitability.insights.temperature.description")}),_.jsx(kt,{aspectRatio:2,children:({width:c,height:u})=>_.jsx(ms,{data:l,width:c,height:u,isMobile:!1})})]})}function ms({data:l,width:r,height:c}){const u=ae.useRef(null),{t}=Ke();return ae.useEffect(()=>{if(!u.current||r===0)return;const e=ot(u.current);e.selectAll("*").remove();const a=Ir,i=r-a.left-a.right,n=c-a.top-a.bottom,o=e.append("g").attr("transform",`translate(${a.left},${a.top})`),s=l.length>2e3?l.filter((v,y)=>y%Math.ceil(l.length/2e3)===0):l,f=Mi().domain([50,ar(l,v=>v.temp)||3e3]).range([0,i]),d=Gt().domain([0,100]).range([n,0]),h=200,p=320;o.append("rect").attr("x",f(h)).attr("y",0).attr("width",f(p)-f(h)).attr("height",n).attr("fill",ce.goldilocks),o.append("text").attr("x",f(Math.sqrt(h*p))).attr("y",15).attr("text-anchor","middle").attr("fill",ce.secondary).attr("font-size","11px").attr("font-weight","bold").text(t("pages.habitability.charts.goldilocksZone")),o.append("g").attr("class","grid").call(ft(d).tickSize(-i).tickFormat(()=>"")).selectAll("line").attr("stroke",ce.grid).attr("stroke-opacity",.5),o.selectAll(".grid .domain").remove(),o.selectAll(".point").data(s).join("circle").attr("class","point").attr("cx",v=>f(v.temp)).attr("cy",v=>d(v.score)).attr("r",v=>v.isHabitable?3:1.5).attr("fill",v=>v.isHabitable&&v.isEarthLike?ce.secondary:v.isHabitable?ce.primary:ce.muted).attr("opacity",v=>v.isHabitable?.8:.3),o.append("g").attr("transform",`translate(0,${n})`).call(Ct(f).tickValues([100,200,500,1e3,2e3]).tickFormat(v=>`${v}K`)).selectAll("text").attr("fill",ce.axis).attr("font-size","11px"),o.selectAll(".domain, .tick line").attr("stroke",ce.axis),o.append("g").call(ft(d).ticks(5)).selectAll("text").attr("fill",ce.axis).attr("font-size","11px"),o.append("text").attr("x",i/2).attr("y",n+35).attr("text-anchor","middle").attr("fill",ce.text).attr("font-size","12px").text(t("pages.habitability.charts.axes.temperature")),o.append("text").attr("transform","rotate(-90)").attr("y",-40).attr("x",-n/2).attr("text-anchor","middle").attr("fill",ce.text).attr("font-size","12px").text(t("pages.habitability.charts.axes.habitabilityScore"))},[l,r,c,t]),_.jsx("svg",{ref:u,width:r,height:c})}const ys={O:"#9bb0ff",B:"#aabfff",A:"#cad7ff",F:"#f8f7ff",G:"#fff4ea",K:"#ffd2a1",M:"#ffcc6f",L:"#ff8800",T:"#ff6666",Y:"#cc4444",Unknown:"#888888"};function bs({data:l}){const{t:r}=Ke(),c=l.filter(u=>["F","G","K","M"].includes(u.starClass)&&u.count>=10);return _.jsxs("div",{className:"insight-card",children:[_.jsx("h3",{className:"card-title",children:r("pages.habitability.insights.starType.title")}),_.jsx("p",{className:"card-description",children:r("pages.habitability.insights.starType.description")}),_.jsx(kt,{aspectRatio:2,children:u=>_.jsx(xs,{data:c,...u})})]})}function xs({data:l,width:r,height:c}){const u=ae.useRef(null),{t}=Ke();return ae.useEffect(()=>{if(!u.current||r===0)return;const e=ot(u.current);e.selectAll("*").remove();const a={...Ir,left:60},i=r-a.left-a.right,n=c-a.top-a.bottom,o=e.append("g").attr("transform",`translate(${a.left},${a.top})`),s=[...l].sort((h,p)=>p.avgScore-h.avgScore),f=nr().domain(s.map(h=>h.starClass)).range([0,n]).padding(.3),d=Gt().domain([0,ar(s,h=>h.avgScore)||50]).nice().range([0,i]);o.append("g").attr("class","grid").call(Ct(d).tickSize(n).tickFormat(()=>"")).selectAll("line").attr("stroke",ce.grid).attr("stroke-opacity",.5),o.selectAll(".grid .domain").remove(),o.selectAll(".bar").data(s).join("rect").attr("class","bar").attr("y",h=>f(h.starClass)||0).attr("x",0).attr("height",f.bandwidth()).attr("width",h=>d(h.avgScore)).attr("fill",h=>ys[h.starClass]||ce.muted).attr("rx",2),o.selectAll(".bar-label").data(s).join("text").attr("class","bar-label").attr("y",h=>(f(h.starClass)||0)+f.bandwidth()/2).attr("x",h=>d(h.avgScore)+5).attr("dy","0.35em").attr("fill",ce.text).attr("font-size","11px").text(h=>`${h.avgScore.toFixed(1)} (${h.count.toLocaleString()})`),o.append("g").call(ft(f)).selectAll("text").attr("fill",ce.axis).attr("font-size","12px").attr("font-weight","bold"),o.selectAll(".domain, .tick line").attr("stroke",ce.axis),o.append("g").attr("transform",`translate(0,${n})`).call(Ct(d).ticks(5)).selectAll("text").attr("fill",ce.axis).attr("font-size","11px"),o.append("text").attr("x",i/2).attr("y",n+35).attr("text-anchor","middle").attr("fill",ce.text).attr("font-size","12px").text(t("pages.habitability.charts.axes.avgHabitabilityScore"))},[l,r,c,t]),_.jsx("svg",{ref:u,width:r,height:c})}const Ss=2009,_s=2018;function Ts({data:l}){const{t:r}=Ke();return _.jsxs("div",{className:"insight-card",children:[_.jsx("h3",{className:"card-title",children:r("pages.habitability.insights.discovery.title")}),_.jsx("p",{className:"card-description",children:r("pages.habitability.insights.discovery.description")}),_.jsx(kt,{aspectRatio:2,children:c=>_.jsx(As,{data:l,...c})})]})}function As({data:l,width:r,height:c}){const u=ae.useRef(null),{t}=Ke();return ae.useEffect(()=>{if(!u.current||r===0||l.length===0)return;const e=ot(u.current);e.selectAll("*").remove();const a=Ir,i=r-a.left-a.right,n=c-a.top-a.bottom,o=e.append("g").attr("transform",`translate(${a.left},${a.top})`),s=l.filter(g=>g.year>=1995),f=Gt().domain([qn(s,g=>g.year)||1995,ar(s,g=>g.year)||2024]).range([0,i]),d=Gt().domain([0,ar(s,g=>g.cumulative)||1e3]).nice().range([n,0]),h=Qn().x(g=>f(g.year)).y0(n).y1(g=>d(g.cumulative)).curve(xr),p=Qn().x(g=>f(g.year)).y0(n).y1(g=>d(g.cumulativeHabitable)).curve(xr);o.append("g").attr("class","grid").call(ft(d).tickSize(-i).tickFormat(()=>"")).selectAll("line").attr("stroke",ce.grid).attr("stroke-opacity",.5),o.selectAll(".grid .domain").remove(),o.append("path").datum(s).attr("fill",ce.primary).attr("fill-opacity",.3).attr("d",h),o.append("path").datum(s).attr("fill",ce.secondary).attr("fill-opacity",.5).attr("d",p);const v=$n().x(g=>f(g.year)).y(g=>d(g.cumulative)).curve(xr);o.append("path").datum(s).attr("fill","none").attr("stroke",ce.primary).attr("stroke-width",2).attr("d",v);const y=$n().x(g=>f(g.year)).y(g=>d(g.cumulativeHabitable)).curve(xr);o.append("path").datum(s).attr("fill","none").attr("stroke",ce.secondary).attr("stroke-width",2).attr("d",y),[{year:Ss,label:t("pages.habitability.insights.discovery.kepler")},{year:_s,label:t("pages.habitability.insights.discovery.tess")}].forEach(g=>{g.year>=(qn(s,m=>m.year)||1995)&&(o.append("line").attr("x1",f(g.year)).attr("x2",f(g.year)).attr("y1",0).attr("y2",n).attr("stroke",ce.tertiary).attr("stroke-width",1).attr("stroke-dasharray","4,4").attr("opacity",.7),o.append("text").attr("x",f(g.year)).attr("y",-5).attr("text-anchor","middle").attr("fill",ce.tertiary).attr("font-size","10px").text(g.label))}),o.append("g").attr("transform",`translate(0,${n})`).call(Ct(f).tickFormat(g=>String(g)).ticks(6)).selectAll("text").attr("fill",ce.axis).attr("font-size","11px"),o.selectAll(".domain, .tick line").attr("stroke",ce.axis),o.append("g").call(ft(d).ticks(5)).selectAll("text").attr("fill",ce.axis).attr("font-size","11px");const x=o.append("g").attr("transform",`translate(${i-120}, 10)`);x.append("rect").attr("x",0).attr("y",0).attr("width",15).attr("height",3).attr("fill",ce.primary),x.append("text").attr("x",20).attr("y",4).attr("fill",ce.text).attr("font-size","10px").text(t("pages.habitability.charts.legend.allDiscoveries")),x.append("rect").attr("x",0).attr("y",15).attr("width",15).attr("height",3).attr("fill",ce.secondary),x.append("text").attr("x",20).attr("y",19).attr("fill",ce.text).attr("font-size","10px").text(t("pages.habitability.charts.legend.habitableZone"))},[l,r,c,t]),_.jsx("svg",{ref:u,width:r,height:c})}function Ta({data:l,xLabels:r,yLabels:c,maxValue:u,title:t,xAxisLabel:e,yAxisLabel:a,colorScheme:i="blue",showValues:n=!0}){return _.jsxs("div",{className:"chart-wrapper",children:[_.jsx("h3",{className:"chart-title",children:t}),_.jsx(kt,{aspectRatio:1.2,minHeight:300,children:({width:o,height:s})=>_.jsx(Es,{data:l,xLabels:r,yLabels:c,maxValue:u,width:o,height:s,xAxisLabel:e,yAxisLabel:a,colorScheme:i,showValues:n})})]})}function Es({data:l,xLabels:r,yLabels:c,maxValue:u,width:t,height:e,xAxisLabel:a,yAxisLabel:i,colorScheme:n,showValues:o}){const s=ae.useRef(null);return ae.useEffect(()=>{if(!s.current||l.length===0)return;const f=ot(s.current);f.selectAll("*").remove();const d={top:20,right:20,bottom:60,left:80},h=t-d.left-d.right,p=e-d.top-d.bottom,v=f.append("g").attr("transform",`translate(${d.left},${d.top})`),y=nr().domain(r).range([0,h]).padding(.05),U=nr().domain(c).range([0,p]).padding(.05),x=n==="green"?["#0a1a0a","#00ff88"]:n==="orange"?["#1a0a0a","#ff8800"]:["#0a0a1a","#00ccff"],g=Ha().domain([0,u]).interpolator(Ii(x[0],x[1]));v.selectAll("rect").data(l).join("rect").attr("x",m=>y(m.x)||0).attr("y",m=>U(m.y)||0).attr("width",y.bandwidth()).attr("height",U.bandwidth()).attr("fill",m=>m.value>0?g(m.value):"#111").attr("stroke","#222").attr("stroke-width",1).attr("rx",2),o&&v.selectAll("text.cell-value").data(l.filter(m=>m.value>0)).join("text").attr("class","cell-value").attr("x",m=>(y(m.x)||0)+y.bandwidth()/2).attr("y",m=>(U(m.y)||0)+U.bandwidth()/2).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("fill",m=>m.value>u*.6?"#000":"#fff").attr("font-size",Math.min(y.bandwidth(),U.bandwidth())*.35).text(m=>m.value),v.append("g").attr("transform",`translate(0,${p})`).call(Ct(y)).selectAll("text").attr("fill",ce.text).attr("font-size",11),v.selectAll(".domain, .tick line").attr("stroke",ce.axis),v.append("g").call(ft(U)).selectAll("text").attr("fill",ce.text).attr("font-size",10),a&&v.append("text").attr("x",h/2).attr("y",p+45).attr("text-anchor","middle").attr("fill",ce.axis).attr("font-size",12).text(a),i&&v.append("text").attr("transform","rotate(-90)").attr("x",-p/2).attr("y",-60).attr("text-anchor","middle").attr("fill",ce.axis).attr("font-size",12).text(i)},[l,r,c,u,t,e,n,o,a,i]),_.jsx("svg",{ref:s,width:t,height:e})}const Va={Habitability:"#00ff88","Planet Type":"#ff8800",Orbital:"#00ccff",System:"#aa88ff",Star:"#ffd700"};function ws({data:l,title:r,maxItems:c=20}){const u=l.slice(0,c);return _.jsxs("div",{className:"chart-wrapper",children:[_.jsx("h3",{className:"chart-title",children:r}),_.jsx(kt,{aspectRatio:.8,minHeight:400,children:({width:t,height:e})=>_.jsx(Us,{data:u,width:t,height:e})}),_.jsx("div",{className:"chart-legend horizontal",children:Object.entries(Va).map(([t,e])=>_.jsxs("div",{className:"legend-item",children:[_.jsx("span",{className:"legend-dot",style:{background:e}}),_.jsx("span",{children:t})]},t))})]})}function Us({data:l,width:r,height:c}){const u=ae.useRef(null);return ae.useEffect(()=>{if(!u.current||l.length===0)return;const t=ot(u.current);t.selectAll("*").remove();const e={top:10,right:60,bottom:30,left:140},a=r-e.left-e.right,i=c-e.top-e.bottom,n=t.append("g").attr("transform",`translate(${e.left},${e.top})`),o=nr().domain(l.map(f=>f.label)).range([0,i]).padding(.2),s=Gt().domain([0,Math.max(...l.map(f=>f.pct))*1.1]).range([0,a]);n.selectAll("line.grid").data(s.ticks(5)).join("line").attr("class","grid").attr("x1",f=>s(f)).attr("x2",f=>s(f)).attr("y1",0).attr("y2",i).attr("stroke",ce.grid).attr("stroke-dasharray","2,2"),n.selectAll("rect").data(l).join("rect").attr("x",0).attr("y",f=>o(f.label)||0).attr("width",f=>s(f.pct)).attr("height",o.bandwidth()).attr("fill",f=>Va[f.category]||ce.muted).attr("rx",2).attr("opacity",.85),n.selectAll("text.pct").data(l).join("text").attr("class","pct").attr("x",f=>s(f.pct)+5).attr("y",f=>(o(f.label)||0)+o.bandwidth()/2).attr("dominant-baseline","middle").attr("fill",ce.text).attr("font-size",11).text(f=>`${f.pct.toFixed(1)}%`),n.append("g").call(ft(o).tickSize(0)).selectAll("text").attr("fill",ce.text).attr("font-size",11),n.selectAll(".domain").remove(),n.append("g").attr("transform",`translate(0,${i})`).call(Ct(s).ticks(5).tickFormat(f=>`${f}%`)).selectAll("text").attr("fill",ce.text).attr("font-size",10),n.selectAll(".domain, .tick line").attr("stroke",ce.axis)},[l,r,c]),_.jsx("svg",{ref:u,width:r,height:c})}function Cs({data:l,title:r,totalPlanets:c}){return _.jsxs("div",{className:"chart-wrapper",children:[_.jsx("h3",{className:"chart-title",children:r}),_.jsx(kt,{aspectRatio:1.3,minHeight:300,children:({width:u,height:t})=>_.jsx(ks,{data:l,width:u,height:t,totalPlanets:c})}),_.jsx("div",{className:"chart-legend horizontal",children:l.map(u=>_.jsxs("div",{className:"legend-item",children:[_.jsx("span",{className:"legend-dot",style:{background:u.color}}),_.jsxs("span",{children:[u.category," (",u.count.toLocaleString(),")"]})]},u.category))})]})}function ks({data:l,width:r,height:c,totalPlanets:u}){const t=ae.useRef(null),{t:e}=Ke();return ae.useEffect(()=>{if(!t.current||l.length===0)return;const a=ot(t.current);a.selectAll("*").remove();const n=Math.min(r,c)/2-20,o=n*.55,s=a.append("g").attr("transform",`translate(${r/2},${c/2})`),f=es().value(v=>v.count).sort(null),d=Sa().innerRadius(o).outerRadius(n),h=Sa().innerRadius(o).outerRadius(n+8);s.selectAll("path").data(f(l)).join("path").attr("d",d).attr("fill",v=>v.data.color).attr("stroke","#000").attr("stroke-width",2).style("cursor","pointer").on("mouseover",function(v,y){ot(this).transition().duration(200).attr("d",h(y)),p.style("opacity",1).html(`<strong>${y.data.category}</strong><br/>${y.data.count.toLocaleString()} ${e("pages.habitability.charts.breakdown.planets")}<br/>${y.data.pct.toFixed(2)}%`).style("left",`${v.offsetX+10}px`).style("top",`${v.offsetY-10}px`)}).on("mouseout",function(v,y){ot(this).transition().duration(200).attr("d",d(y)),p.style("opacity",0)}),s.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("fill",ce.text).attr("font-size",14).attr("dy",-10).text(e("pages.habitability.charts.breakdown.total")),s.append("text").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("fill",ce.primary).attr("font-size",24).attr("font-weight","bold").attr("dy",15).text(u.toLocaleString());const p=ot(t.current.parentNode).append("div").attr("class","chart-tooltip").style("opacity",0).style("position","absolute").style("background","rgba(0,0,0,0.9)").style("border","1px solid #333").style("border-radius","4px").style("padding","8px 12px").style("font-size","12px").style("color","#fff").style("pointer-events","none").style("z-index","10");return()=>{p.remove()}},[l,r,c,u,e]),_.jsx("svg",{ref:t,width:r,height:c})}function Is(){const{t:l}=Ke(),{isLoading:r,error:c,getAllPlanets:u,getTopHabitable:t}=gi(),e=ae.useMemo(()=>{if(r)return null;const a=u(),i=t(10);return{stats:ki(a),spatial:Ci(a),scoreDistribution:Ui(a),temperatureData:wi(a),starTypeStats:Ei(a),discoveryTrends:Ai(a),planetStarHeatmap:Ti(a),featureCooccurrence:_i(a),featurePrevalence:Si(a),habitabilityBreakdown:xi(a),topCandidates:i,totalPlanets:a.length}},[r,u,t]);return r?_.jsx("div",{className:"flex-1 flex items-center justify-center",children:_.jsxs("div",{className:"text-center",children:[_.jsx(mi,{}),_.jsx("p",{className:"mt-4 text-white/60",children:l("pages.habitability.loading")})]})}):c?_.jsx("div",{className:"flex-1 flex items-center justify-center",children:_.jsxs("div",{className:"text-center text-red-400",children:[_.jsx("h2",{className:"text-xl font-bold mb-2",children:l("common.error")}),_.jsx("p",{children:c})]})}):e?_.jsxs("div",{className:"habitability-page",children:[_.jsxs("section",{className:"habitability-hero-section",children:[_.jsxs("div",{className:"habitability-hero-header",children:[_.jsx("h1",{className:"habitability-title",children:l("pages.habitability.title")}),_.jsx("p",{className:"habitability-subtitle",children:l("pages.habitability.subtitle")})]}),_.jsx(fs,{data:e.spatial,stats:e.stats})]}),_.jsx(us,{stats:e.stats}),_.jsxs("section",{className:"habitability-charts-section",children:[_.jsx("h2",{className:"section-title",children:l("pages.habitability.insights.title")}),_.jsxs("div",{className:"charts-grid",children:[_.jsx(ps,{data:e.scoreDistribution}),_.jsx(gs,{data:e.temperatureData}),_.jsx(bs,{data:e.starTypeStats}),_.jsx(Ts,{data:e.discoveryTrends})]})]}),_.jsxs("section",{className:"habitability-charts-section",children:[_.jsx("h2",{className:"section-title",children:l("pages.habitability.deepDive.title")}),_.jsxs("div",{className:"charts-grid",children:[_.jsx(Ta,{data:e.planetStarHeatmap.data,xLabels:e.planetStarHeatmap.xLabels,yLabels:e.planetStarHeatmap.yLabels,maxValue:e.planetStarHeatmap.maxValue,title:l("pages.habitability.deepDive.planetStarHeatmap"),xAxisLabel:l("pages.habitability.deepDive.starClass"),yAxisLabel:l("pages.habitability.deepDive.planetType"),colorScheme:"blue"}),_.jsx(Ta,{data:e.featureCooccurrence.data,xLabels:e.featureCooccurrence.labels,yLabels:e.featureCooccurrence.labels,maxValue:e.featureCooccurrence.maxValue,title:l("pages.habitability.deepDive.featureCooccurrence"),colorScheme:"green",showValues:!0}),_.jsx(ws,{data:e.featurePrevalence,title:l("pages.habitability.deepDive.featurePrevalence")}),_.jsx(Cs,{data:e.habitabilityBreakdown,title:l("pages.habitability.deepDive.habitabilityBreakdown"),totalPlanets:e.totalPlanets})]})]}),_.jsxs("section",{className:"habitability-candidates-section",children:[_.jsx("h2",{className:"section-title",children:l("pages.habitability.candidates.title")}),_.jsx("p",{className:"section-description",children:l("pages.habitability.candidates.description")}),_.jsx(ds,{candidates:e.topCandidates})]}),_.jsxs("section",{className:"habitability-methodology-section",children:[_.jsx("h2",{className:"section-title",children:l("pages.habitability.methodology.title")}),_.jsxs("div",{className:"methodology-card",children:[_.jsx("p",{className:"methodology-intro",children:l("pages.habitability.methodology.description")}),_.jsxs("ul",{className:"methodology-list",children:[_.jsx("li",{children:l("pages.habitability.methodology.temperature")}),_.jsx("li",{children:l("pages.habitability.methodology.size")}),_.jsx("li",{children:l("pages.habitability.methodology.starType")}),_.jsx("li",{children:l("pages.habitability.methodology.insolation")})]})]})]})]}):null}export{Is as default};
