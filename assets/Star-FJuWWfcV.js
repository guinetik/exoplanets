import{r as l,j as e,s as y,u as z,f as R,L as I,n as T,b,g as O,d as U,a as q}from"./index-DFXkWtwF.js";import{a as P,Q as G,C as _,A as E,F as $,D as V,c as W,V as X,e as Y,L as Q,f as K,d as Z}from"./react-three-fiber.esm-D45o6kR3.js";import{c as J,g as H,a as B}from"./planetUniforms-BseECf1B.js";import{_ as ee,O as se}from"./OrbitControls-CAXRvJD8.js";const te=l.forwardRef(function({children:m,follow:r=!0,lockX:p=!1,lockY:t=!1,lockZ:u=!1,...i},h){const c=l.useRef(null),d=l.useRef(null),n=new G;return P(({camera:x})=>{if(!r||!d.current)return;const a=c.current.rotation.clone();d.current.updateMatrix(),d.current.updateWorldMatrix(!1,!1),d.current.getWorldQuaternion(n),x.getWorldQuaternion(c.current.quaternion).premultiply(n.invert()),p&&(c.current.rotation.x=a.x),t&&(c.current.rotation.y=a.y),u&&(c.current.rotation.z=a.z)}),l.useImperativeHandle(h,()=>d.current,[]),l.createElement("group",ee({ref:d},i),l.createElement("group",{ref:c},m))}),A=.15;function ae({body:s,isHovered:m,onHover:r,onClick:p}){var M;const t=l.useRef(null),u=l.useRef(null),i=l.useRef(null),h=l.useRef(null),c=l.useRef(Math.random()*Math.PI*2),d=l.useMemo(()=>({uStarColor:{value:new _(s.color)},uTime:{value:0},uTemperature:{value:s.temperature??5778}}),[s.color,s.temperature]),n=l.useRef(null),x=l.useMemo(()=>({uStarColor:{value:new _(s.color)},uTime:{value:0},uIntensity:{value:s.emissiveIntensity??1}}),[s.color,s.emissiveIntensity]),a=l.useMemo(()=>s.planetData?J({planet:s.planetData,detailLevel:"simple",starTemp:s.planetData.st_teff??void 0}):{uBaseColor:{value:new _(s.color)},uTime:{value:0},uTemperature:{value:s.temperature??300},uHasAtmosphere:{value:s.hasAtmosphere??.5},uSeed:{value:Math.random()},uDensity:{value:.5},uInsolation:{value:.5},uStarTemp:{value:5778},uDetailLevel:{value:0}},[s.planetData,s.color,s.temperature,s.hasAtmosphere]),f=l.useMemo(()=>{var o;return H((o=s.planetData)==null?void 0:o.planet_subtype,s.planetType)},[(M=s.planetData)==null?void 0:M.planet_subtype,s.planetType]),D=l.useMemo(()=>B(f),[f]);P((o,v)=>{if(s.type==="planet"&&t.current&&s.orbitPeriod>0&&!m&&(c.current+=Math.PI*2*v*A/(s.orbitPeriod/60)),s.type==="star"&&s.orbitRadius>0&&t.current&&s.orbitPeriod>0&&(c.current+=Math.PI*2*v*A*2/(s.orbitPeriod/60)),s.type==="planet"&&t.current){const j=Math.min(Math.max(s.orbitEccentricity||0,0),.99),g=s.orbitRadius,k=g*Math.sqrt(1-j*j),C=g*j,w=g*Math.cos(c.current)-C,F=k*Math.sin(c.current);t.current.position.x=w,t.current.position.z=F}if(s.type==="star"&&s.orbitRadius>0&&t.current){const j=Math.min(Math.max(s.orbitEccentricity||0,0),.99),g=s.orbitRadius,k=g*Math.sqrt(1-j*j),C=s.isCompanionStar?Math.PI:0,w=g*Math.cos(c.current+C),F=k*Math.sin(c.current+C);t.current.position.x=w,t.current.position.z=F}u.current&&!m&&(u.current.rotation.y+=v*.2);const S=o.clock.elapsedTime;s.type==="star"?(i.current&&(i.current.uniforms.uTime.value=S),n.current&&(n.current.uniforms.uTime.value=S)):s.type==="planet"&&h.current&&(h.current.uniforms.uTime.value=S)});const N=m?1.3:1;if(s.type==="star"){const o=e.jsxs(e.Fragment,{children:[e.jsx("pointLight",{position:[0,0,0],color:s.color,intensity:s.isCompanionStar?1.5:2,distance:s.isCompanionStar?40:50}),e.jsx(te,{children:e.jsxs("mesh",{children:[e.jsx("planeGeometry",{args:[s.diameter*1.8,s.diameter*1.8]}),e.jsx("shaderMaterial",{transparent:!0,depthWrite:!1,blending:E,uniforms:{uColor:{value:new _(s.color)},uIntensity:{value:s.emissiveIntensity??1}},vertexShader:`
                varying vec2 vUv;
                void main() {
                  vUv = uv;
                  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
              `,fragmentShader:`
                uniform vec3 uColor;
                uniform float uIntensity;
                varying vec2 vUv;
                void main() {
                  vec2 center = vUv - 0.5;
                  float dist = length(center) * 2.0;
                  // Start glow from edge of star (around 0.55 radius in UV space)
                  float glow = 1.0 - smoothstep(0.55, 1.0, dist);
                  // Clamp intensity: min 0.7, max 1.8 to prevent huge glows
                  float clampedIntensity = clamp(uIntensity, 0.7, 1.8);
                  glow = pow(glow, 2.5) * clampedIntensity * 0.35;
                  gl_FragColor = vec4(uColor, glow);
                }
              `})]})}),e.jsxs("mesh",{ref:u,children:[e.jsx("sphereGeometry",{args:[s.diameter/2,64,64]}),e.jsx("shaderMaterial",{ref:i,vertexShader:y.get("starSurfaceVert"),fragmentShader:y.get("starSurfaceFrag"),uniforms:d})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[s.diameter/2*1.15,64,64]}),e.jsx("shaderMaterial",{ref:n,vertexShader:y.get("starCoronaVert"),fragmentShader:y.get("starCoronaFrag"),uniforms:x,transparent:!0,depthWrite:!1,blending:E,side:$})]})]});return s.orbitRadius>0?e.jsx("group",{ref:t,children:o}):e.jsx("group",{children:o})}return e.jsxs("group",{ref:t,children:[e.jsxs("mesh",{ref:u,scale:[N,N,N],onPointerOver:o=>{var j,g;o.stopPropagation(),document.body.style.cursor="pointer";const v=o.clientX??((j=o.nativeEvent)==null?void 0:j.clientX),S=o.clientY??((g=o.nativeEvent)==null?void 0:g.clientY);r(s,v&&S?{x:v,y:S}:void 0)},onPointerMove:o=>{var v,S;if(m){const j=o.clientX??((v=o.nativeEvent)==null?void 0:v.clientX),g=o.clientY??((S=o.nativeEvent)==null?void 0:S.clientY);j&&g&&r(s,{x:j,y:g})}},onPointerOut:o=>{o.stopPropagation(),document.body.style.cursor="grab",r(null)},onClick:o=>{o.stopPropagation(),p==null||p(s)},children:[e.jsx("sphereGeometry",{args:[s.diameter/2,48,48]}),e.jsx("shaderMaterial",{ref:h,vertexShader:y.get("planetVert"),fragmentShader:y.get(D),uniforms:a})]}),s.hasRings&&e.jsxs("mesh",{rotation:[Math.PI/2.5,0,0],children:[e.jsx("ringGeometry",{args:[s.diameter*.7,s.diameter*1.2,64]}),e.jsx("meshBasicMaterial",{color:new _(s.color).lerp(new _("#ffffff"),.4),transparent:!0,opacity:.5,side:V})]}),m&&e.jsxs("mesh",{scale:[1.4,1.4,1.4],children:[e.jsx("sphereGeometry",{args:[s.diameter/2,24,24]}),e.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.15,side:W})]})]})}function L({radius:s,eccentricity:m=0,isHighlighted:r,isBinaryOrbit:p=!1}){const t=l.useRef(null),u=Math.min(Math.max(m,0),.99),i=s,h=i*Math.sqrt(1-u*u),c=p?0:i*u,d=u>.1,n=l.useMemo(()=>{const a=[];for(let N=0;N<=128;N++){const M=N/128*Math.PI*2,o=i*Math.cos(M)-c,v=h*Math.sin(M);a.push(new X(o,0,v))}const f=new Y().setFromPoints(a),D=new Q({transparent:!0,depthWrite:!1});return new K(f,D)},[i,h,c]);return P(()=>{if(t.current){const x=t.current.material;let a,f;r?(a="#ffffff",f=.8):p?(a="#ffaa44",f=.5):d?(a="#aaaaff",f=.45):(a="#888888",f=.3),x.color.set(a),x.opacity=f}}),e.jsx("primitive",{ref:t,object:n})}function ne({star:s,bodies:m,hoveredBody:r,onBodyHover:p}){const{t}=z(),u=m.filter(n=>n.type==="star"),i=u.find(n=>n.isPrimaryStar||!n.isCompanionStar),h=u.filter(n=>n.isCompanionStar),c=m.filter(n=>n.type==="planet"),d=u.length>1;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"starsystem-info-panel",children:[e.jsxs("h1",{className:"starsystem-star-name",children:[s.hostname,d&&e.jsx("span",{className:"binary-badge",style:{marginLeft:"8px",fontSize:"0.5em",opacity:.8},children:"★★ Binary"})]}),e.jsxs("div",{className:"starsystem-star-details",children:[e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:t("pages.starSystem.info.type")}),e.jsx("span",{className:"detail-value",children:s.st_spectype||s.star_class||t("pages.starSystem.info.unknown")})]}),s.st_teff&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:t("pages.starSystem.info.temperature")}),e.jsx("span",{className:"detail-value",children:R("st_teff",s.st_teff)})]}),s.st_rad&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:t("pages.starSystem.info.radius")}),e.jsx("span",{className:"detail-value",children:R("st_rad",s.st_rad)})]}),s.st_mass&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:t("pages.starSystem.info.mass")}),e.jsx("span",{className:"detail-value",children:R("st_mass",s.st_mass)})]}),s.distance_ly&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:t("pages.starSystem.info.distance")}),e.jsx("span",{className:"detail-value",children:R("distance_ly",s.distance_ly)})]}),s.st_age&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:t("pages.starSystem.info.age")}),e.jsx("span",{className:"detail-value",children:R("st_age",s.st_age)})]})]}),e.jsxs("div",{className:"starsystem-planet-count",children:[s.sy_snum>1&&e.jsxs("span",{className:"star-count",children:[s.sy_snum," ",t("pages.starSystem.info.stars")," •"," "]}),s.sy_pnum," ",s.sy_pnum===1?t("pages.starSystem.info.planet"):t("pages.starSystem.info.planets"),s.cb_flag&&e.jsxs("span",{className:"circumbinary-note",style:{opacity:.7},children:[" ","(",t("pages.starSystem.info.circumbinary"),")"]})]})]}),e.jsxs("div",{className:"starsystem-planets-panel",children:[e.jsx("h2",{className:"planets-panel-title",children:t("pages.starSystem.info.planetaryBodies")}),e.jsxs("ul",{className:"planets-list",children:[i&&e.jsxs("li",{className:`planet-item ${(r==null?void 0:r.id)===i.id?"hovered":""}`,onMouseEnter:()=>p(i),onMouseLeave:()=>p(null),children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:i.color}}),e.jsx("span",{className:"planet-name",children:i.name}),e.jsx("span",{className:"planet-type",children:t(d?"pages.starSystem.info.primaryStar":"pages.starSystem.info.star")})]}),h.map(n=>e.jsxs("li",{className:`planet-item ${(r==null?void 0:r.id)===n.id?"hovered":""}`,onMouseEnter:()=>p(n),onMouseLeave:()=>p(null),children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:n.color}}),e.jsx("span",{className:"planet-name",children:n.name}),e.jsx("span",{className:"planet-type",children:t("pages.starSystem.info.companionStar")})]},n.id)),c.map(n=>{var x;return e.jsx("li",{className:`planet-item ${(r==null?void 0:r.id)===n.id?"hovered":""}`,onMouseEnter:()=>p(n),onMouseLeave:()=>p(null),children:e.jsxs(I,{to:`/planets/${T(n.id)}`,className:"planet-item-link",children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:n.color}}),e.jsx("span",{className:"planet-name",children:n.name}),e.jsx("span",{className:"planet-type",children:((x=n.planetData)==null?void 0:x.planet_type)||t("pages.starSystem.info.planet")})]})},n.id)})]})]}),e.jsx("div",{className:"starsystem-hint",children:t("pages.starSystem.hint")})]})}function re({count:s=3e3}){const m=l.useMemo(()=>{const r=new Float32Array(s*3);for(let p=0;p<s;p++){const t=Math.random()*Math.PI*2,u=Math.acos(2*Math.random()-1),i=500;r[p*3]=i*Math.sin(u)*Math.cos(t),r[p*3+1]=i*Math.sin(u)*Math.sin(t),r[p*3+2]=i*Math.cos(u)}return r},[s]);return e.jsxs("points",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:s,array:m,itemSize:3})}),e.jsx("pointsMaterial",{size:1.5,color:16777215,transparent:!0,opacity:.6,sizeAttenuation:!1})]})}function ie({shouldAutoRotate:s,maxDistance:m}){const r=l.useRef(null);return P((p,t)=>{r.current&&s&&(r.current.setAzimuthalAngle(r.current.getAzimuthalAngle()+t*.1),r.current.update())}),e.jsx(se,{ref:r,enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:5,maxDistance:m,autoRotate:!1})}function le({star:s,planets:m,onPlanetClick:r}){const p=b(),[t,u]=l.useState(null),[i,h]=l.useState(null),c=l.useMemo(()=>O(s,m),[s,m]),d=l.useMemo(()=>{const a=Math.max(...c.map(o=>o.orbitRadius),10),f=c.find(o=>o.type==="star"),N=((f==null?void 0:f.diameter)??3)*4,M=a*2.5;return Math.max(N,M)},[c]),n=l.useCallback((a,f)=>{u(a),h(f??null)},[]),x=l.useCallback(a=>{a.type==="planet"&&p(`/planets/${T(a.id)}`)},[p]);return e.jsxs("div",{className:"starsystem-container",children:[e.jsx(Z,{camera:{position:[0,d*.5,d],fov:50},style:{background:"black"},children:e.jsxs(l.Suspense,{fallback:null,children:[e.jsx("ambientLight",{intensity:.6}),e.jsx("hemisphereLight",{args:["#ffffff","#444444",.5]}),e.jsx(re,{count:3e3}),c.map(a=>e.jsx(ae,{body:a,isHovered:(t==null?void 0:t.id)===a.id,onHover:n,onClick:x},a.id)),c.filter(a=>a.type==="planet").map(a=>e.jsx(L,{radius:a.orbitRadius,eccentricity:a.orbitEccentricity,isHighlighted:(t==null?void 0:t.id)===a.id},`orbit-${a.id}`)),c.filter(a=>a.type==="star"&&a.orbitRadius>0).map(a=>e.jsx(L,{radius:a.orbitRadius,eccentricity:a.orbitEccentricity,isHighlighted:(t==null?void 0:t.id)===a.id,isBinaryOrbit:!0},`orbit-${a.id}`)),e.jsx(ie,{shouldAutoRotate:!t,maxDistance:d*3})]})}),e.jsx(ne,{star:s,bodies:c,hoveredBody:t,onBodyHover:a=>n(a)}),t&&t.type==="planet"&&i&&t.planetData&&e.jsxs("div",{className:"starsystem-cursor-tooltip",style:{left:i.x+20,top:i.y-10},children:[e.jsxs("div",{className:"cursor-tooltip-header",children:[e.jsx("div",{className:"cursor-tooltip-name",children:t.planetData.pl_name}),e.jsx("div",{className:"cursor-tooltip-type",children:t.planetData.planet_type})]}),e.jsxs("div",{className:"cursor-tooltip-details",children:[t.planetData.pl_rade&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Radius"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[t.planetData.pl_rade.toFixed(2)," R⊕"]})]}),t.planetData.pl_bmasse&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Mass"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[t.planetData.pl_bmasse.toFixed(2)," M⊕"]})]}),t.planetData.pl_orbper&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Orbital Period"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[t.planetData.pl_orbper.toFixed(2)," days"]})]}),t.planetData.pl_orbsmax&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Semi-major Axis"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[t.planetData.pl_orbsmax.toFixed(3)," AU"]})]}),t.planetData.pl_eqt&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Eq. Temperature"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[t.planetData.pl_eqt.toFixed(0)," K"]})]}),t.planetData.disc_year&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Discovered"}),e.jsx("span",{className:"cursor-tooltip-value",children:t.planetData.disc_year})]}),t.planetData.discoverymethod&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Method"}),e.jsx("span",{className:"cursor-tooltip-value",children:t.planetData.discoverymethod})]})]}),e.jsx("div",{className:"cursor-tooltip-hint",children:"Click to view details"})]})]})}function ue(){const{t:s}=z(),{starId:m}=U(),r=b(),{getStarBySlug:p,getPlanetsByHost:t,isLoading:u}=q(),i=m?p(m):void 0,h=i?t(i.hostname):[],c=l.useCallback(d=>{r(`/planets/${T(d.pl_name)}`)},[r]);return u?e.jsx("div",{className:"spinner-container",children:e.jsxs("div",{className:"spinner-content",children:[e.jsx("div",{className:"spinner-orbit",children:e.jsx("div",{className:"spinner-planet"})}),e.jsx("div",{className:"spinner-text",children:s("pages.star.loading")})]})}):i?e.jsxs("div",{className:"starsystem-page",children:[e.jsx(I,{to:"/",className:"starsystem-back-button",children:s("pages.star.backToStarfield")}),e.jsx(le,{star:i,planets:h,onPlanetClick:c})]}):e.jsx("div",{className:"error-container",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h1",{className:"error-title",children:s("pages.star.notFound.title")}),e.jsx("p",{className:"error-message",children:s("pages.star.notFound.message",{starId:m||""})}),e.jsx(I,{to:"/",className:"starsystem-back-link",children:s("pages.star.notFound.returnToStarfield")})]})})}export{ue as default};
