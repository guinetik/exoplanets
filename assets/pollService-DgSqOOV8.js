import{k as i,i as g,l,m as w,T as d,o as h,p,q as f,t as y,w as b}from"./index-CaY8PH_5.js";const s=g({prefix:"PollService"}),u="exoplanets_poll";async function v(e,t){if(!i())return s.warn("Firebase not configured, creating local-only vote"),{id:t,planet:e,userid:t,timestamp:Date.now()};const r=l(),a=w(r,u,t),c={planet:e,userid:t,timestamp:d.now()};return await h(a,c),s.info("Vote cast:",{planet:e,userid:t}),{id:t,planet:e,userid:t,timestamp:Date.now()}}async function F(e){if(!i())return s.warn("Firebase not configured, returning null"),null;try{const t=l(),r=p(t,u),a=y(r,b("userid","==",e)),c=await f(a);if(c.empty)return null;const n=c.docs[0],o=n.data();return{id:n.id,planet:o.planet,userid:o.userid,timestamp:o.timestamp instanceof d?o.timestamp.toMillis():o.timestamp}}catch(t){return s.error("Failed to fetch user vote:",t),null}}async function D(){if(!i())return s.warn("Firebase not configured, returning empty counts"),[];try{const e=l(),t=p(e,u),r=await f(t),a=new Map;return r.forEach(n=>{const m=n.data().planet;a.set(m,(a.get(m)||0)+1)}),Array.from(a.entries()).map(([n,o])=>({planet:n,count:o})).sort((n,o)=>o.count-n.count)}catch(e){return s.error("Failed to fetch vote counts:",e),[]}}async function V(){if(!i())return 0;try{const e=l(),t=p(e,u);return(await f(t)).size}catch(e){return s.error("Failed to fetch total votes:",e),0}}const M={castVote:v,getUserVote:F,getVoteCounts:D,getTotalVotes:V};export{M as p};
