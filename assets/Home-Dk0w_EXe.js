import{r as i,C as _e,V as se,B,j as e,A as Ae,a as Te,b as ne,s as $,u as Ie,c as he,d as me,n as Se}from"./index-2bvuyZSE.js";import{u as ue,a as W,C as Re}from"./react-three-fiber.esm-Kinnim7p.js";const d={DEGREES_TO_RADIANS:Math.PI/180,RADIANS_TO_DEGREES:180/Math.PI,FULL_CIRCLE:360,HALF_CIRCLE:180,MILLISECONDS_PER_DAY:864e5,JULIAN_DATE_OFFSET:24405875e-1,J2000_JULIAN_DATE:2451545,JULIAN_CENTURIES_PER_CENTURY:36525,GMST_CONSTANT:280.46061837,GMST_RATE:360.98564736629,GMST_T_SQUARED_COEFF:387933e-9,GMST_T_CUBED_DIVISOR:3871e4,HOUR_ANGLE_MIN:-180,HOUR_ANGLE_MAX:180,MIN_MAGNITUDE:0,MAX_MAGNITUDE:20,MAGNITUDE_CLAMP_MIN:.1,MAGNITUDE_CLAMP_MAX:3,MAGNITUDE_SIZE_COEFFICIENT:2.5,MAGNITUDE_EXPONENT_DIVISOR:10,COORDINATE_DECIMAL_PLACES:2,DEFAULT_SPHERE_RADIUS:1,DEFAULT_STAR_RADIUS:100,HORIZON_ALTITUDE_THRESHOLD:-5,COSINE_MAX:1,COSINE_MIN:-1},fe={O:5995775,B:8101887,A:13293567,F:16316415,G:16774378,K:16765601,M:16737860,L:13386786,T:10044586,Y:6697847},ae=16777215;function V(t){return t*d.DEGREES_TO_RADIANS}function re(t){return t*d.RADIANS_TO_DEGREES}function pe(t){return t.getTime()/d.MILLISECONDS_PER_DAY+d.JULIAN_DATE_OFFSET}function Le(t){const s=pe(t),n=(s-d.J2000_JULIAN_DATE)/d.JULIAN_CENTURIES_PER_CENTURY;let o=d.GMST_CONSTANT+d.GMST_RATE*(s-d.J2000_JULIAN_DATE)+d.GMST_T_SQUARED_COEFF*n*n-n*n*n/d.GMST_T_CUBED_DIVISOR;return o=(o%d.FULL_CIRCLE+d.FULL_CIRCLE)%d.FULL_CIRCLE,o}function Ne(t,s){return((Le(t)+s)%d.FULL_CIRCLE+d.FULL_CIRCLE)%d.FULL_CIRCLE}function Me(t,s,n=new Date){const{ra:o,dec:a}=t,{latitude:l,longitude:E}=s;let r=Ne(n,E)-o;r<d.HOUR_ANGLE_MIN&&(r+=d.FULL_CIRCLE),r>d.HOUR_ANGLE_MAX&&(r-=d.FULL_CIRCLE);const h=V(r),_=V(a),A=V(l),S=Math.sin(_)*Math.sin(A)+Math.cos(_)*Math.cos(A)*Math.cos(h),O=re(Math.asin(S)),I=(Math.sin(_)-Math.sin(V(O))*Math.sin(A))/(Math.cos(V(O))*Math.cos(A));let R;return Math.abs(I)>d.COSINE_MAX?R=I>0?0:d.HALF_CIRCLE:R=re(Math.acos(Math.max(d.COSINE_MIN,Math.min(d.COSINE_MAX,I)))),Math.sin(h)>0&&(R=d.FULL_CIRCLE-R),{altitude:O,azimuth:R}}function Ce(t,s=d.DEFAULT_SPHERE_RADIUS){const n=V(t.altitude),o=V(t.azimuth),a=Math.sin(n)*s,l=Math.cos(n)*s,E=-Math.sin(o)*l,u=-Math.cos(o)*l;return{x:E,y:a,z:u}}function Oe(t,s,n,o=new Date,a=d.DEFAULT_STAR_RADIUS){const l=Me({ra:t,dec:s},n,o);return{...Ce(l,a),visible:l.altitude>d.HORIZON_ALTITUDE_THRESHOLD}}function xe(t){if(!t)return ae;const s=t.charAt(0).toUpperCase();return fe[s]??ae}function De(t){if(t===null||isNaN(t))return .5;const s=Math.max(d.MIN_MAGNITUDE,Math.min(d.MAX_MAGNITUDE,t)),n=d.MAGNITUDE_SIZE_COEFFICIENT*Math.pow(10,-s/d.MAGNITUDE_EXPONENT_DIVISOR);return Math.max(d.MAGNITUDE_CLAMP_MIN,Math.min(d.MAGNITUDE_CLAMP_MAX,n))}function ge(t){const s=Math.abs(t),n=t>=0?"N":"S";return`${s.toFixed(d.COORDINATE_DECIMAL_PLACES)}°${n}`}function ve(t){const s=Math.abs(t),n=t>=0?"E":"W";return`${s.toFixed(d.COORDINATE_DECIMAL_PLACES)}°${n}`}function Pe(t){return`${t.toFixed(d.COORDINATE_DECIMAL_PLACES)}°`}function Ue(t){return`${t.toFixed(d.COORDINATE_DECIMAL_PLACES)}°`}const ie={"New York":{latitude:40.7128,longitude:-74.006},London:{latitude:51.5074,longitude:-.1278},Tokyo:{latitude:35.6762,longitude:139.6503},Sydney:{latitude:-33.8688,longitude:151.2093},"São Paulo":{latitude:-23.5505,longitude:-46.6333},"Cape Town":{latitude:-33.9249,longitude:18.4241},"Rio de Janeiro":{latitude:-22.9068,longitude:-43.1729},Greenwich:{latitude:51.4772,longitude:0}},Y={EARTH_SPIN_DURATION:5e3,CAMERA_SWOOP_DURATION:2500,STARS_FADE_DURATION:2e3,WELCOME_CARD_DELAY:300,WELCOME_CARD_DISMISS_DURATION:300,LETTER_ANIMATION_DELAY:.25,PLANETS_LINE_START_OFFSET:3},D={BASE_RADIUS:580,SCALE_MULTIPLIER:.35,INITIAL_Z:-600,Z_MOVEMENT_DISTANCE:500,ROTATION_SPEED:.15,ATMOSPHERE_SCALE:1.05,ATMOSPHERE_OPACITY:.15,OUTER_GLOW_SCALE:1.12,OUTER_GLOW_OPACITY:.08,ATMOSPHERE_COLOR:4491519,OUTER_GLOW_COLOR:6728447},g={INITIAL_AZIMUTH:180,INITIAL_ALTITUDE:10,LOOKAT_DISTANCE:100,DRAG_SENSITIVITY:.3,MIN_ALTITUDE:-10,MAX_ALTITUDE:90,DEFAULT_CURSOR:"grab",DRAGGING_CURSOR:"grabbing"},q={COUNT:3e3,SPHERE_RADIUS:800,POINT_SIZE:.8,COLOR:8947848,OPACITY_MULTIPLIER:.5},ce={STAR_DISTANCE:500,BASE_SCALE:20},Z={MIN_SPEED:.5,SPEED_MODULO:100,SPEED_DIVISOR:50,MIN_INTENSITY:.15,INTENSITY_MODULO:50,INTENSITY_DIVISOR:200},X={BASE_HIT_THRESHOLD:15,SIZE_SCALE_MULTIPLIER:.3,HOVER_LERP:.15,CLICK_DISTANCE_THRESHOLD:5,POINTER_CURSOR:"pointer",DEFAULT_CURSOR:"grab"},Q={MIN_INTERVAL_MS:5e3,MAX_INTERVAL_MS:12e3,MAX_ACTIVE:3,INITIAL_DELAY_MS:3e3},G={LIFETIME_S:20,BASE_SIZE:.8,ALTITUDE:80,SPEED:15,SPEED_MIN_FACTOR:.8,SPEED_VARIATION:.4,TUMBLE_X:.01,TUMBLE_Y:.02},K={START_Y_BASE:10,START_Y_RANGE:40,START_Z_LOWER:.3,START_Z_RANGE:.7,DIR_Y_SCALE:.3,DIR_Z_SCALE:.5},J=[{name:"ISS",color:"#ffffff",size:1,panels:!0,spawnProbability:.15},{name:"Satellite",color:"#aaaaaa",size:.6,panels:!0,spawnProbability:.55},{name:"Debris",color:"#666666",size:.3,panels:!1,spawnProbability:.3}],j={BODY_HEIGHT_MULTIPLIER:.5,BODY_DEPTH_MULTIPLIER:.5,PANEL_X_OFFSET:.8,PANEL_WIDTH:.8,PANEL_THICKNESS:.05,PANEL_DEPTH:.4,PANEL_COLOR:"#1a3a5c"},k={ORBITAL_RADIUS:610,ANGULAR_VELOCITY:2*Math.PI/90,START_ANGLE:-Math.PI/2,ORBIT_DIRECTION:1,SIZE_MULTIPLIER:8,ROTATION_X:0,ROTATION_Y:5e-4},ye={DURATION_MS:2e3},le={INOUT_BACK_C1:1.70158,INOUT_BACK_C2_MULTIPLIER:1.525},N={RADIUS:580,POSITION_Y:-600,WIDTH_SEGMENTS:64,HEIGHT_SEGMENTS_SURFACE:64,HEIGHT_SEGMENTS_ATMOSPHERE:64,ATMOSPHERE_SCALE:1.02,FALLBACK_COLOR:8432354,SHADER_RETRY_DELAY_MS:100,ROTATION_LERP:.05},H={BACKGROUND_COLOR:"#000",BACKGROUND_COLOR_ALT:"#000000",CAMERA_FOV:60,CAMERA_NEAR:.1,CAMERA_FAR:2e3,CAMERA_INITIAL_X:0,CAMERA_INITIAL_Y:50,CAMERA_INITIAL_Z:400,AMBIENT_LIGHT_INTENSITY:.3};function be(t){return t<J[0].spawnProbability?J[0]:t<J[0].spawnProbability+J[1].spawnProbability?J[1]:J[2]}function je(){const s=document.createElement("canvas");s.width=128,s.height=128;const n=s.getContext("2d"),o=128/2;n.clearRect(0,0,128,128);const a=n.createRadialGradient(o,o,0,o,o,o);a.addColorStop(0,"rgba(255, 255, 255, 1)"),a.addColorStop(.1,"rgba(255, 255, 255, 0.8)"),a.addColorStop(.3,"rgba(255, 255, 255, 0.3)"),a.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=a,n.fillRect(0,0,128,128),n.save(),n.translate(o,o);for(let u=0;u<4;u++){n.rotate(Math.PI/2);const r=n.createLinearGradient(0,0,0,-o);r.addColorStop(0,"rgba(255, 255, 255, 0.8)"),r.addColorStop(.3,"rgba(255, 255, 255, 0.3)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=r,n.beginPath(),n.moveTo(-2,0),n.lineTo(0,-o*.9),n.lineTo(2,0),n.closePath(),n.fill()}n.restore();const l=n.createRadialGradient(o,o,0,o,o,128*.15);l.addColorStop(0,"rgba(255, 255, 255, 1)"),l.addColorStop(.5,"rgba(255, 255, 255, 0.8)"),l.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=l,n.fillRect(0,0,128,128);const E=new Te(s);return E.needsUpdate=!0,E}function we(t){let s=0;for(let n=0;n<t.length;n++){const o=t.charCodeAt(n);s=(s<<5)-s+o,s=s&s}return Math.abs(s)}const Ge=`
  attribute vec3 starColor;
  attribute float starSize;
  attribute float twinkleSpeed;
  attribute float twinklePhase;
  attribute float twinkleIntensity;
  attribute float isHovered;

  uniform float uTime;

  varying vec3 vColor;
  varying float vOpacity;

  void main() {
    vColor = starColor;

    // Subtle twinkle - very gentle brightness variation
    float twinkle = sin(uTime * twinkleSpeed * 0.3 + twinklePhase);
    float twinkleScale = 1.0 + twinkle * twinkleIntensity * 0.15;

    // Stable opacity - minimal twinkle effect
    float baseOpacity = isHovered > 0.5 ? 1.0 : 0.95;
    vOpacity = baseOpacity;

    // Calculate final size - interpolate between base and hover scale
    float baseScale = starSize * 20.0;
    float hoverScale = 40.0;
    float targetScale = mix(baseScale, hoverScale, isHovered);
    float finalSize = targetScale * twinkleScale;

    // Position
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * mvPosition;

    // Size attenuation - scale by distance from camera
    // Using higher multiplier to match original sprite sizes
    gl_PointSize = finalSize * (1500.0 / -mvPosition.z);
  }
`,Fe=`
  uniform sampler2D uTexture;

  varying vec3 vColor;
  varying float vOpacity;

  void main() {
    vec4 texColor = texture2D(uTexture, gl_PointCoord);
    gl_FragColor = vec4(vColor * texColor.rgb, texColor.a * vOpacity);
  }
`;function He({stars:t,observer:s,date:n,onStarClick:o,onStarHover:a}){const l=i.useRef(null),E=i.useRef(null),u=i.useRef(null),[r,h]=i.useState(-1),_=i.useRef(null),{gl:A,camera:S}=ue(),O=i.useMemo(()=>je(),[]),I=i.useMemo(()=>{const c=[];for(const T of t){if(T.ra===null||T.dec===null)continue;const f=Oe(T.ra,T.dec,s,n,ce.STAR_DISTANCE);if(!f.visible)continue;const x=we(T.hostname);c.push({star:T,position:new se(f.x,f.y,f.z),color:new _e(xe(T.star_class)),size:De(T.sy_vmag),twinkleSpeed:Z.MIN_SPEED+x%Z.SPEED_MODULO/Z.SPEED_DIVISOR,twinklePhase:x%1e3/1e3*Math.PI*2,twinkleIntensity:Z.MIN_INTENSITY+x%Z.INTENSITY_MODULO/Z.INTENSITY_DIVISOR})}return c},[t,s,n]),R=i.useMemo(()=>{const c=I.length,T=new Float32Array(c*3),f=new Float32Array(c*3),x=new Float32Array(c),b=new Float32Array(c),w=new Float32Array(c),F=new Float32Array(c),z=new Float32Array(c);return I.forEach((v,M)=>{T[M*3]=v.position.x,T[M*3+1]=v.position.y,T[M*3+2]=v.position.z,f[M*3]=v.color.r,f[M*3+1]=v.color.g,f[M*3+2]=v.color.b,x[M]=v.size,b[M]=v.twinkleSpeed,w[M]=v.twinklePhase,F[M]=v.twinkleIntensity,z[M]=0}),{positions:T,colors:f,sizes:x,twinkleSpeeds:b,twinklePhases:w,twinkleIntensities:F,isHovered:z}},[I]),P=i.useRef(null);i.useEffect(()=>{if(!u.current)return;const c=u.current;c.setAttribute("position",new B(R.positions,3)),c.setAttribute("starColor",new B(R.colors,3)),c.setAttribute("starSize",new B(R.sizes,1)),c.setAttribute("twinkleSpeed",new B(R.twinkleSpeeds,1)),c.setAttribute("twinklePhase",new B(R.twinklePhases,1)),c.setAttribute("twinkleIntensity",new B(R.twinkleIntensities,1));const T=new B(R.isHovered,1);c.setAttribute("isHovered",T),P.current=T,c.computeBoundingSphere()},[R]),W(c=>{if(E.current&&(E.current.uniforms.uTime.value=c.clock.elapsedTime),P.current){const T=P.current.array;let f=!1;for(let x=0;x<T.length;x++){const w=(x===r?1:0)-T[x];Math.abs(w)>.001&&(T[x]+=w*X.HOVER_LERP,f=!0)}f&&(P.current.needsUpdate=!0)}});const m=i.useCallback(c=>{if(I.length===0)return;const T=A.domElement.getBoundingClientRect(),f=c.clientX-T.left,x=c.clientY-T.top;let b=-1,w=1/0;for(let F=0;F<I.length;F++){const z=I[F],v=z.position.clone().project(S);if(v.z>1)continue;const M=(v.x+1)/2*T.width,p=(1-v.y)/2*T.height,C=f-M,oe=x-p,te=Math.sqrt(C*C+oe*oe),de=X.BASE_HIT_THRESHOLD+z.size*ce.BASE_SCALE*X.SIZE_SCALE_MULTIPLIER;te<de&&te<w&&(b=F,w=te)}b!==r?(h(b),b>=0?(A.domElement.style.cursor=X.POINTER_CURSOR,a==null||a(I[b].star,{x:c.clientX,y:c.clientY})):(A.domElement.style.cursor=X.DEFAULT_CURSOR,a==null||a(null))):b>=0&&(a==null||a(I[b].star,{x:c.clientX,y:c.clientY}))},[I,r,A,S,a]),L=i.useCallback(c=>{_.current={x:c.clientX,y:c.clientY}},[]),U=i.useCallback(c=>{if(_.current){const T=c.clientX-_.current.x,f=c.clientY-_.current.y;if(Math.sqrt(T*T+f*f)>X.CLICK_DISTANCE_THRESHOLD)return}r>=0&&I[r]&&(o==null||o(I[r].star))},[r,I,o]),y=i.useCallback(()=>{h(-1),A.domElement.style.cursor=X.DEFAULT_CURSOR,a==null||a(null)},[A,a]);return i.useEffect(()=>{const c=A.domElement;return c.addEventListener("pointerdown",L),c.addEventListener("pointermove",m),c.addEventListener("click",U),c.addEventListener("pointerleave",y),()=>{c.removeEventListener("pointerdown",L),c.removeEventListener("pointermove",m),c.removeEventListener("click",U),c.removeEventListener("pointerleave",y)}},[A,L,m,U,y]),i.useEffect(()=>()=>{O.dispose()},[O]),I.length===0?null:e.jsxs("points",{ref:l,frustumCulled:!1,children:[e.jsx("bufferGeometry",{ref:u}),e.jsx("shaderMaterial",{ref:E,vertexShader:Ge,fragmentShader:Fe,uniforms:{uTime:{value:0},uTexture:{value:O}},transparent:!0,depthWrite:!1,blending:Ae})]})}function Ye({longitude:t=0}){const[s,n]=i.useState(!1),[o,a]=i.useState(null),l=i.useRef(0),E=i.useRef(0),u=i.useMemo(()=>({uRotation:{value:0}}),[]);return i.useEffect(()=>{const r=()=>{try{$.isLoaded()?(a({surfaceVert:$.get("earthSurfaceVert"),surfaceFrag:$.get("earthSurfaceFrag"),atmosphereVert:$.get("atmosphereVert"),atmosphereFrag:$.get("atmosphereFrag")}),n(!0)):setTimeout(r,N.SHADER_RETRY_DELAY_MS)}catch(h){console.warn("Earth shaders not available, using fallback:",h),n(!0)}};r()},[]),i.useEffect(()=>{l.current=-t*Math.PI/180},[t]),W(()=>{const r=l.current-E.current;E.current+=r*N.ROTATION_LERP,u.uRotation.value=E.current}),!s||!o?e.jsx("group",{children:e.jsxs("mesh",{position:[0,N.POSITION_Y,0],children:[e.jsx("sphereGeometry",{args:[N.RADIUS,N.WIDTH_SEGMENTS,N.HEIGHT_SEGMENTS_SURFACE]}),e.jsx("meshBasicMaterial",{color:N.FALLBACK_COLOR})]})}):e.jsxs("group",{children:[e.jsxs("mesh",{position:[0,N.POSITION_Y,0],children:[e.jsx("sphereGeometry",{args:[N.RADIUS,N.WIDTH_SEGMENTS,N.HEIGHT_SEGMENTS_SURFACE]}),e.jsx("shaderMaterial",{vertexShader:o.surfaceVert,fragmentShader:o.surfaceFrag,uniforms:u})]}),e.jsxs("mesh",{position:[0,N.POSITION_Y,0],scale:[N.ATMOSPHERE_SCALE,N.ATMOSPHERE_SCALE,N.ATMOSPHERE_SCALE],children:[e.jsx("sphereGeometry",{args:[N.RADIUS,N.WIDTH_SEGMENTS,N.HEIGHT_SEGMENTS_ATMOSPHERE]}),e.jsx("shaderMaterial",{vertexShader:o.atmosphereVert,fragmentShader:o.atmosphereFrag,transparent:!0,side:ne,depthWrite:!1})]})]})}function ke({satellite:t,onExpired:s}){const n=i.useRef(null),o=i.useRef(t.createdAt);W(l=>{if(!n.current)return;const E=l.clock.elapsedTime-o.current;if(E>G.LIFETIME_S){s(t.id);return}const u=E*t.speed,r=t.startPosition.clone().add(t.direction.clone().multiplyScalar(u));n.current.position.copy(r),n.current.rotation.x+=G.TUMBLE_X,n.current.rotation.y+=G.TUMBLE_Y});const a=G.BASE_SIZE*t.type.size;return e.jsxs("group",{ref:n,position:t.startPosition,children:[e.jsxs("mesh",{children:[e.jsx("boxGeometry",{args:[a,a*j.BODY_HEIGHT_MULTIPLIER,a*j.BODY_DEPTH_MULTIPLIER]}),e.jsx("meshBasicMaterial",{color:t.type.color})]}),t.type.panels&&e.jsxs(e.Fragment,{children:[e.jsxs("mesh",{position:[a*j.PANEL_X_OFFSET,0,0],children:[e.jsx("boxGeometry",{args:[a*j.PANEL_WIDTH,a*j.PANEL_THICKNESS,a*j.PANEL_DEPTH]}),e.jsx("meshBasicMaterial",{color:j.PANEL_COLOR})]}),e.jsxs("mesh",{position:[-a*j.PANEL_X_OFFSET,0,0],children:[e.jsx("boxGeometry",{args:[a*j.PANEL_WIDTH,a*j.PANEL_THICKNESS,a*j.PANEL_DEPTH]}),e.jsx("meshBasicMaterial",{color:j.PANEL_COLOR})]})]})]})}function ze(){const[t,s]=i.useState([]),n=i.useRef(0),o=i.useRef(null);W(l=>{o.current||(o.current=l.clock)}),i.useEffect(()=>{const l=()=>{o.current&&s(r=>{var y;if(r.length>=Q.MAX_ACTIVE)return r;const h=Math.random()>.5,_=h?-80:G.ALTITUDE,A=K.START_Y_BASE+Math.random()*K.START_Y_RANGE,S=-80*(K.START_Z_LOWER+Math.random()*K.START_Z_RANGE),O=h?1:-1,I=(Math.random()-.5)*K.DIR_Y_SCALE,R=(Math.random()-.5)*K.DIR_Z_SCALE,P=new se(O,I,R).normalize(),m=Math.random(),L=be(m),U={id:n.current++,type:L,startPosition:new se(_,A,S),direction:P,speed:G.SPEED*(G.SPEED_MIN_FACTOR+Math.random()*G.SPEED_VARIATION),createdAt:((y=o.current)==null?void 0:y.elapsedTime)??0,altitude:G.ALTITUDE};return[...r,U]})},E=()=>{const r=Q.MIN_INTERVAL_MS+Math.random()*(Q.MAX_INTERVAL_MS-Q.MIN_INTERVAL_MS);return setTimeout(()=>{l(),u=E()},r)};let u=setTimeout(()=>{l(),u=E()},Q.INITIAL_DELAY_MS);return()=>clearTimeout(u)},[]);const a=l=>{s(E=>E.filter(u=>u.id!==l))};return e.jsx("group",{children:t.map(l=>e.jsx(ke,{satellite:l,onExpired:a},l.id))})}function Be(){const t=i.useRef(null);W(n=>{if(!t.current)return;const o=k.START_ANGLE+k.ORBIT_DIRECTION*n.clock.elapsedTime*k.ANGULAR_VELOCITY,a=k.ORBITAL_RADIUS*Math.sin(o),l=N.POSITION_Y+k.ORBITAL_RADIUS*Math.cos(o);t.current.position.set(a,l,0),t.current.rotation.x+=k.ROTATION_X,t.current.rotation.y+=k.ROTATION_Y});const s=G.BASE_SIZE*k.SIZE_MULTIPLIER;return e.jsxs("group",{ref:t,children:[e.jsxs("mesh",{children:[e.jsx("boxGeometry",{args:[s*.3,s*.15,s*1.2]}),e.jsx("meshBasicMaterial",{color:"#d3d3d3",toneMapped:!1})]}),e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("boxGeometry",{args:[s*.6,s*.4,s*.5]}),e.jsx("meshBasicMaterial",{color:"#e8e8e8",toneMapped:!1})]}),e.jsxs("mesh",{position:[s*2,s*.1,0],children:[e.jsx("boxGeometry",{args:[s*3,s*.08,s*.6]}),e.jsx("meshBasicMaterial",{color:"#1e90ff",toneMapped:!1})]}),e.jsxs("mesh",{position:[-s*2,s*.1,0],children:[e.jsx("boxGeometry",{args:[s*3,s*.08,s*.6]}),e.jsx("meshBasicMaterial",{color:"#1e90ff",toneMapped:!1})]}),e.jsxs("mesh",{position:[0,0,s*.7],children:[e.jsx("boxGeometry",{args:[s*.4,s*.3,s*.3]}),e.jsx("meshBasicMaterial",{color:"#d3d3d3",toneMapped:!1})]}),e.jsxs("mesh",{position:[0,0,-s*.7],children:[e.jsx("boxGeometry",{args:[s*.4,s*.3,s*.3]}),e.jsx("meshBasicMaterial",{color:"#d3d3d3",toneMapped:!1})]}),e.jsxs("mesh",{position:[-s*1.2,-s*.08,0],children:[e.jsx("boxGeometry",{args:[s*.15,s*.15,s*.8]}),e.jsx("meshBasicMaterial",{color:"#a9a9a9",toneMapped:!1})]}),e.jsxs("mesh",{position:[s*1.2,-s*.08,0],children:[e.jsx("boxGeometry",{args:[s*.15,s*.15,s*.8]}),e.jsx("meshBasicMaterial",{color:"#a9a9a9",toneMapped:!1})]})]})}function Ee(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}let ee=!1;function Xe(t){const n=le.INOUT_BACK_C1*le.INOUT_BACK_C2_MULTIPLIER;return t<.5?Math.pow(2*t,2)*((n+1)*2*t-n)/2:(Math.pow(2*t-2,2)*((n+1)*(t*2-2)+n)+2)/2}const Ve=`
  varying vec3 vNormal;
  varying vec3 vPosition;
  varying vec2 vUv;

  void main() {
    vNormal = normalize(normalMatrix * normal);
    vPosition = position;
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,We=`
  uniform float uTime;
  uniform float uOpacity;

  varying vec3 vNormal;
  varying vec3 vPosition;
  varying vec2 vUv;

  // Simple noise function
  float hash(vec2 p) {
    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
  }

  float noise(vec2 p) {
    vec2 i = floor(p);
    vec2 f = fract(p);
    f = f * f * (3.0 - 2.0 * f);

    float a = hash(i);
    float b = hash(i + vec2(1.0, 0.0));
    float c = hash(i + vec2(0.0, 1.0));
    float d = hash(i + vec2(1.0, 1.0));

    return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
  }

  float fbm(vec2 p) {
    float sum = 0.0;
    float amp = 0.5;
    for(int i = 0; i < 4; i++) {
      sum += noise(p) * amp;
      p *= 2.0;
      amp *= 0.5;
    }
    return sum;
  }

  void main() {
    // Convert position to spherical coordinates for texture mapping
    vec3 nPos = normalize(vPosition);
    float longitude = atan(nPos.x, nPos.z) + uTime * 0.1;
    float latitude = asin(nPos.y);
    vec2 uv = vec2(longitude / 3.14159, latitude / 1.5708 + 0.5);

    // Ocean base color
    vec3 oceanColor = vec3(0.02, 0.08, 0.15);
    vec3 oceanHighlight = vec3(0.05, 0.15, 0.3);

    // Land generation using noise
    float landNoise = fbm(uv * 8.0);
    float landMask = smoothstep(0.45, 0.55, landNoise);

    // Land colors
    vec3 landLow = vec3(0.08, 0.25, 0.05); // Green lowlands
    vec3 landHigh = vec3(0.3, 0.2, 0.1);   // Brown highlands
    vec3 landColor = mix(landLow, landHigh, fbm(uv * 16.0));

    // Ice caps at poles
    float iceMask = smoothstep(0.7, 0.9, abs(nPos.y));
    vec3 iceColor = vec3(0.9, 0.95, 1.0);

    // Clouds
    float cloudNoise = fbm(uv * 6.0 + uTime * 0.05);
    float cloudMask = smoothstep(0.5, 0.7, cloudNoise);
    vec3 cloudColor = vec3(1.0, 1.0, 1.0);

    // Combine layers
    vec3 surfaceColor = mix(oceanColor, landColor, landMask);
    surfaceColor = mix(surfaceColor, iceColor, iceMask);
    surfaceColor = mix(surfaceColor, cloudColor, cloudMask * 0.7);

    // Simple lighting from camera direction
    vec3 lightDir = normalize(vec3(0.5, 0.3, 1.0));
    float light = max(0.0, dot(vNormal, lightDir));
    float ambient = 0.15;

    // Atmosphere rim lighting
    float rim = 1.0 - max(0.0, dot(vNormal, vec3(0.0, 0.0, 1.0)));
    vec3 atmosphereColor = vec3(0.3, 0.6, 1.0);
    vec3 rimGlow = atmosphereColor * pow(rim, 3.0) * 0.5;

    vec3 finalColor = surfaceColor * (light + ambient) + rimGlow;

    gl_FragColor = vec4(finalColor, uOpacity);
  }
`;function Ze({progress:t}){const s=i.useRef(null),n=i.useMemo(()=>({uTime:{value:0},uOpacity:{value:1}}),[]);if(W((l,E)=>{s.current&&(s.current.rotation.y+=E*D.ROTATION_SPEED),n.uTime.value=l.clock.elapsedTime}),t>=1)return null;const o=D.SCALE_MULTIPLIER*(1-t),a=D.INITIAL_Z-t*D.Z_MOVEMENT_DISTANCE;return e.jsxs("group",{ref:s,position:[0,0,a],scale:[o,o,o],children:[e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[D.BASE_RADIUS,64,64]}),e.jsx("shaderMaterial",{vertexShader:Ve,fragmentShader:We,uniforms:n,transparent:!0})]}),e.jsxs("mesh",{scale:[D.ATMOSPHERE_SCALE,D.ATMOSPHERE_SCALE,D.ATMOSPHERE_SCALE],children:[e.jsx("sphereGeometry",{args:[D.BASE_RADIUS,32,32]}),e.jsx("meshBasicMaterial",{color:D.ATMOSPHERE_COLOR,transparent:!0,opacity:D.ATMOSPHERE_OPACITY,side:ne})]}),e.jsxs("mesh",{scale:[D.OUTER_GLOW_SCALE,D.OUTER_GLOW_SCALE,D.OUTER_GLOW_SCALE],children:[e.jsx("sphereGeometry",{args:[D.BASE_RADIUS,32,32]}),e.jsx("meshBasicMaterial",{color:D.OUTER_GLOW_COLOR,transparent:!0,opacity:D.OUTER_GLOW_OPACITY,side:ne})]})]})}function Ke({introState:t,onBearingChange:s,controlsEnabled:n}){const{camera:o,gl:a}=ue(),l=i.useRef(!1),E=i.useRef({x:0,y:0}),u=i.useRef({azimuth:g.INITIAL_AZIMUTH,altitude:g.INITIAL_ALTITUDE});return W(()=>{const{phase:r}=t;if(r==="earth-spin"||r==="camera-swoop")o.position.set(0,0,0),o.lookAt(0,0,-100),o.updateProjectionMatrix();else if((r==="stars-fade"||r==="complete")&&!n){o.position.set(0,0,0);const h=u.current.azimuth*Math.PI/180,_=u.current.altitude*Math.PI/180;o.lookAt(-Math.sin(h)*Math.cos(_)*g.LOOKAT_DISTANCE,Math.sin(_)*g.LOOKAT_DISTANCE,-Math.cos(h)*Math.cos(_)*g.LOOKAT_DISTANCE),o.updateProjectionMatrix()}}),i.useEffect(()=>{if(!n)return;const r=a.domElement,h=()=>{const{azimuth:m,altitude:L}=u.current,U=m*Math.PI/180,y=L*Math.PI/180;o.position.set(0,0,0),o.lookAt(-Math.sin(U)*Math.cos(y)*100,Math.sin(y)*100,-Math.cos(U)*Math.cos(y)*100),o.updateProjectionMatrix(),s(m,L)},_=m=>{l.current=!0,E.current={x:m.clientX,y:m.clientY},r.style.cursor=g.DRAGGING_CURSOR},A=()=>{l.current=!1,r.style.cursor=g.DEFAULT_CURSOR},S=m=>{if(!l.current)return;const L=m.clientX-E.current.x,U=m.clientY-E.current.y;u.current.azimuth-=L*g.DRAG_SENSITIVITY,u.current.altitude+=U*g.DRAG_SENSITIVITY,u.current.azimuth=(u.current.azimuth%360+360)%360,u.current.altitude=Math.max(g.MIN_ALTITUDE,Math.min(g.MAX_ALTITUDE,u.current.altitude)),E.current={x:m.clientX,y:m.clientY},h()},O=()=>{l.current=!1,r.style.cursor=g.DEFAULT_CURSOR},I=m=>{if(m.touches.length!==1)return;l.current=!0;const L=m.touches[0];E.current={x:L.clientX,y:L.clientY}},R=()=>{l.current=!1},P=m=>{if(!l.current||m.touches.length!==1)return;m.preventDefault();const L=m.touches[0],U=L.clientX-E.current.x,y=L.clientY-E.current.y;u.current.azimuth-=U*g.DRAG_SENSITIVITY,u.current.altitude+=y*g.DRAG_SENSITIVITY,u.current.azimuth=(u.current.azimuth%360+360)%360,u.current.altitude=Math.max(g.MIN_ALTITUDE,Math.min(g.MAX_ALTITUDE,u.current.altitude)),E.current={x:L.clientX,y:L.clientY},h()};return r.style.cursor=g.DEFAULT_CURSOR,r.addEventListener("mousedown",_),r.addEventListener("mouseup",A),r.addEventListener("mousemove",S),r.addEventListener("mouseleave",O),r.addEventListener("touchstart",I),r.addEventListener("touchend",R),r.addEventListener("touchmove",P,{passive:!1}),h(),()=>{r.removeEventListener("mousedown",_),r.removeEventListener("mouseup",A),r.removeEventListener("mousemove",S),r.removeEventListener("mouseleave",O),r.removeEventListener("touchstart",I),r.removeEventListener("touchend",R),r.removeEventListener("touchmove",P)}},[a,o,n,s]),null}function Je({opacity:t}){const s=q.COUNT,n=i.useMemo(()=>{const o=new Float32Array(s*3);for(let a=0;a<s;a++){const l=Math.random()*Math.PI*2,E=Math.acos(2*Math.random()-1),u=q.SPHERE_RADIUS;o[a*3]=u*Math.sin(E)*Math.cos(l),o[a*3+1]=u*Math.sin(E)*Math.sin(l),o[a*3+2]=u*Math.cos(E)}return o},[]);return e.jsxs("points",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:s,array:n,itemSize:3})}),e.jsx("pointsMaterial",{size:q.POINT_SIZE,color:q.COLOR,transparent:!0,opacity:t*q.OPACITY_MULTIPLIER,sizeAttenuation:!1})]})}function $e(){const[t,s]=i.useState({phase:ee?"complete":"earth-spin",progress:ee?1:0}),n=i.useRef(Date.now()),o=i.useCallback(()=>{s({phase:"complete",progress:1})},[]);i.useEffect(()=>{let u;const r=()=>{const h=Date.now(),_=h-n.current;s(A=>{if(A.phase==="complete")return A;if(A.phase==="earth-spin"){const S=Math.min(_/Y.EARTH_SPIN_DURATION,1);return S>=1?(n.current=h,{phase:"camera-swoop",progress:0}):{...A,progress:S}}if(A.phase==="camera-swoop"){const S=Math.min(_/Y.CAMERA_SWOOP_DURATION,1);return S>=1?(n.current=h,{phase:"stars-fade",progress:0}):{...A,progress:S}}if(A.phase==="stars-fade"){const S=Math.min(_/Y.STARS_FADE_DURATION,1);return S>=1?{phase:"complete",progress:1}:{...A,progress:S}}return A}),t.phase!=="complete"&&(u=requestAnimationFrame(r))};return u=requestAnimationFrame(r),()=>cancelAnimationFrame(u)},[t.phase]);const a=t.phase==="stars-fade"?Ee(t.progress):t.phase==="complete"?1:0,l=t.phase==="camera-swoop"?Xe(t.progress):t.phase==="stars-fade"||t.phase==="complete"?1:0,E=t.phase==="complete";return{state:t,introEarthExitProgress:l,starsOpacity:a,controlsEnabled:E,skipIntro:o}}function qe(t){const[s,n]=i.useState(t),[o,a]=i.useState(t),[l,E]=i.useState(!1),u=i.useRef(Date.now()),r=i.useRef(t);i.useEffect(()=>{if(!l)return;let _;const A=()=>{const S=Date.now()-u.current,O=Math.min(S/ye.DURATION_MS,1),I=Ee(O),R=r.current.latitude+(o.latitude-r.current.latitude)*I,P=r.current.longitude+(o.longitude-r.current.longitude)*I;n({latitude:R,longitude:P}),O<1?_=requestAnimationFrame(A):(E(!1),n(o))};return _=requestAnimationFrame(A),()=>cancelAnimationFrame(_)},[l,o]);const h=i.useCallback(_=>{r.current=s,u.current=Date.now(),a(_),E(!0)},[s]);return{currentLocation:s,changeLocation:h,isAnimating:l}}function Qe({starCount:t,planetCount:s,onDismiss:n,isExiting:o}){const{t:a}=Ie();return e.jsx("div",{className:`welcome-card-container ${o?"exiting":""}`,children:e.jsxs("div",{className:"welcome-card",children:[e.jsx("h2",{className:"welcome-title",children:a("pages.home.infoCard.title")}),e.jsx("p",{className:"welcome-description",children:a("pages.home.infoCard.description")}),e.jsx("div",{className:"welcome-stats",children:a("pages.home.infoCard.stats",{starCount:t.toLocaleString(),planetCount:s.toLocaleString()})}),e.jsx("p",{className:"welcome-hint",children:a("pages.home.infoCard.hint")}),e.jsx("button",{className:"welcome-dismiss",onClick:n,children:a("pages.home.infoCard.dismiss")})]})})}function et({stars:t,onStarClick:s}){const{currentLocation:n,changeLocation:o,isAnimating:a}=qe(ie["São Paulo"]),[l]=i.useState(()=>new Date),[E,u]=i.useState({azimuth:180,altitude:-10}),[r,h]=i.useState(!1),[_,A]=i.useState(null),[S,O]=i.useState(null),[I,R]=i.useState("São Paulo"),[P,m]=i.useState(!1),[L,U]=i.useState(!1),y=i.useRef(ee),{state:c,introEarthExitProgress:T,starsOpacity:f,controlsEnabled:x,skipIntro:b}=$e();i.useEffect(()=>{const p=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=p}},[]),i.useEffect(()=>{if(c.phase==="complete"&&!y.current&&!P){const p=setTimeout(()=>{m(!0)},Y.WELCOME_CARD_DELAY);return()=>clearTimeout(p)}},[c.phase,P]);const w=i.useCallback(()=>{ee=!0,y.current=!0,U(!0),setTimeout(()=>{m(!1),U(!1)},Y.WELCOME_CARD_DISMISS_DURATION)},[]),F=i.useCallback((p,C)=>{u({azimuth:p,altitude:C})},[]),z=i.useCallback((p,C)=>{o(C),R(p),h(!1)},[o]),v=i.useCallback((p,C)=>{A(p),O(C??null)},[]),M=c.phase==="complete";return e.jsxs("div",{className:"starfield-container",children:[e.jsxs(Re,{camera:{fov:H.CAMERA_FOV,near:H.CAMERA_NEAR,far:H.CAMERA_FAR,position:[H.CAMERA_INITIAL_X,H.CAMERA_INITIAL_Y,H.CAMERA_INITIAL_Z]},gl:{antialias:!0,alpha:!1},style:{background:H.BACKGROUND_COLOR},children:[e.jsx("color",{attach:"background",args:[H.BACKGROUND_COLOR_ALT]}),e.jsx(Ke,{introState:c,onBearingChange:F,controlsEnabled:x}),e.jsx("ambientLight",{intensity:H.AMBIENT_LIGHT_INTENSITY}),e.jsx(Ze,{progress:T}),(c.phase==="stars-fade"||c.phase==="complete")&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{opacity:1}),e.jsx(He,{stars:t,observer:n,date:l,onStarClick:s,onStarHover:v}),e.jsx(Ye,{longitude:n.longitude}),c.phase==="complete"&&e.jsx(ze,{}),c.phase==="complete"&&e.jsx(Be,{})]})]}),(c.phase==="stars-fade"||c.phase==="complete")&&e.jsx("div",{className:"scene-fade-overlay",style:{opacity:1-f,pointerEvents:f>=1?"none":"auto"}}),M&&e.jsxs("div",{className:"starfield-bearing",children:[e.jsx("div",{className:"bearing-title",children:"Telescope Bearing"}),e.jsxs("div",{className:"bearing-value",children:[e.jsx("span",{className:"bearing-icon",children:"↔"})," ",Pe(E.azimuth)]}),e.jsxs("div",{className:"bearing-value",children:[e.jsx("span",{className:"bearing-icon",children:"↕"})," ",Ue(E.altitude)]})]}),_&&S&&M&&e.jsxs("div",{className:"starfield-tooltip",style:{left:`${S.x+20}px`,top:`${S.y-10}px`},children:[e.jsx("div",{className:"tooltip-name",children:_.hostname}),e.jsxs("div",{className:"tooltip-info",children:[_.sy_pnum," planet",_.sy_pnum!==1?"s":"",_.distance_ly&&e.jsxs(e.Fragment,{children:[" · ",_.distance_ly.toFixed(1)," ly"]})]}),e.jsx("div",{className:"tooltip-hint",children:"Click to explore"})]}),M&&e.jsxs("div",{className:"starfield-location",children:[a?e.jsxs("span",{className:"location-coords location-animating",children:["Traveling to ",I,"..."]}):e.jsxs("span",{className:"location-coords",children:[I," · ",ge(n.latitude),","," ",ve(n.longitude)]}),e.jsx("button",{className:"location-button",onClick:()=>h(!r),disabled:a,children:"CHANGE LOCATION"}),r&&!a&&e.jsx("div",{className:"location-picker",children:Object.entries(ie).map(([p,C])=>e.jsx("button",{className:"location-option",onClick:()=>z(p,C),children:p},p))})]}),M&&e.jsx("div",{className:"starfield-info",children:e.jsxs("span",{children:[t.length.toLocaleString()," exoplanet host stars"]})}),c.phase!=="complete"&&e.jsxs("div",{className:"intro-overlay",onClick:b,children:[c.phase==="earth-spin"&&e.jsx("div",{className:"intro-text",children:e.jsxs("div",{className:"intro-title-container",children:[e.jsx("div",{className:"intro-title-line intro-title-line-exo",children:"EXO".split("").map((p,C)=>e.jsx("span",{className:"intro-letter",style:{animationDelay:`${C*Y.LETTER_ANIMATION_DELAY}s`},children:p},C))}),e.jsx("div",{className:"intro-title-line intro-title-line-planets",children:"PLANETS".split("").map((p,C)=>e.jsx("span",{className:"intro-letter",style:{animationDelay:`${Y.PLANETS_LINE_START_OFFSET*Y.LETTER_ANIMATION_DELAY+C*Y.LETTER_ANIMATION_DELAY}s`},children:p},C))})]})}),(c.phase==="camera-swoop"||c.phase==="stars-fade")&&e.jsx("div",{className:"intro-text",style:{opacity:c.phase==="stars-fade"?1-f:1},children:e.jsx("span",{className:"intro-subtitle",children:"Explore the cosmos"})}),c.phase!=="stars-fade"&&e.jsx("div",{className:"intro-skip",children:"Click anywhere to skip"})]}),P&&e.jsx(Qe,{starCount:t.length,planetCount:t.reduce((p,C)=>p+(C.sy_pnum||0),0),onDismiss:w,isExiting:L})]})}function nt(){const{getAllStars:t}=he(),s=me(),n=t(),o=i.useCallback(a=>{s(`/stars/${Se(a.hostname)}`)},[s]);return e.jsx(et,{stars:n,onStarClick:o})}export{nt as default};
