import{r as i,j as e,s as y,u as L,f as R,L as F,n as T,b as z,g as O,d as U,a as $}from"./index-UIUtINQF.js";import{a as P,Q as q,C as _,A as E,F as G,D as V,c as W,V as X,e as Y,L as Q,f as K,d as Z}from"./react-three-fiber.esm-ojhMyjz4.js";import{c as J,g as H,a as B}from"./planetUniforms-pGUBQEGW.js";import{_ as ee,O as se}from"./OrbitControls-3QnJ2iCw.js";const ae=i.forwardRef(function({children:m,follow:l=!0,lockX:p=!1,lockY:a=!1,lockZ:u=!1,...c},f){const t=i.useRef(null),d=i.useRef(null),r=new q;return P(({camera:h})=>{if(!l||!d.current)return;const n=t.current.rotation.clone();d.current.updateMatrix(),d.current.updateWorldMatrix(!1,!1),d.current.getWorldQuaternion(r),h.getWorldQuaternion(t.current.quaternion).premultiply(r.invert()),p&&(t.current.rotation.x=n.x),a&&(t.current.rotation.y=n.y),u&&(t.current.rotation.z=n.z)}),i.useImperativeHandle(f,()=>d.current,[]),i.createElement("group",ee({ref:d},c),i.createElement("group",{ref:t},m))}),b=.15;function te({body:s,isHovered:m,onHover:l,onClick:p}){var M;const a=i.useRef(null),u=i.useRef(null),c=i.useRef(null),f=i.useRef(null),t=i.useRef(Math.random()*Math.PI*2),d=i.useMemo(()=>({uStarColor:{value:new _(s.color)},uTime:{value:0},uTemperature:{value:s.temperature??5778}}),[s.color,s.temperature]),r=i.useRef(null),h=i.useMemo(()=>({uStarColor:{value:new _(s.color)},uTime:{value:0},uIntensity:{value:s.emissiveIntensity??1}}),[s.color,s.emissiveIntensity]),n=i.useMemo(()=>s.planetData?J({planet:s.planetData,detailLevel:"simple",starTemp:s.planetData.st_teff??void 0}):{uBaseColor:{value:new _(s.color)},uTime:{value:0},uTemperature:{value:s.temperature??300},uHasAtmosphere:{value:s.hasAtmosphere??.5},uSeed:{value:Math.random()},uDensity:{value:.5},uInsolation:{value:.5},uStarTemp:{value:5778},uDetailLevel:{value:0}},[s.planetData,s.color,s.temperature,s.hasAtmosphere]),x=i.useMemo(()=>{var o;return H((o=s.planetData)==null?void 0:o.planet_subtype,s.planetType)},[(M=s.planetData)==null?void 0:M.planet_subtype,s.planetType]),C=i.useMemo(()=>B(x),[x]);P((o,v)=>{if(s.type==="planet"&&a.current&&s.orbitPeriod>0&&!m&&(t.current+=Math.PI*2*v*b/(s.orbitPeriod/60)),s.type==="star"&&s.orbitRadius>0&&a.current&&s.orbitPeriod>0&&(t.current+=Math.PI*2*v*b*2/(s.orbitPeriod/60)),s.type==="planet"&&a.current){const j=Math.min(Math.max(s.orbitEccentricity||0,0),.99),g=s.orbitRadius,w=g*Math.sqrt(1-j*j),D=g*j,k=g*Math.cos(t.current)-D,I=w*Math.sin(t.current);a.current.position.x=k,a.current.position.z=I}if(s.type==="star"&&s.orbitRadius>0&&a.current){const j=Math.min(Math.max(s.orbitEccentricity||0,0),.99),g=s.orbitRadius,w=g*Math.sqrt(1-j*j),D=s.isCompanionStar?Math.PI:0,k=g*Math.cos(t.current+D),I=w*Math.sin(t.current+D);a.current.position.x=k,a.current.position.z=I}u.current&&!m&&(u.current.rotation.y+=v*.2);const S=o.clock.elapsedTime;s.type==="star"?(c.current&&(c.current.uniforms.uTime.value=S),r.current&&(r.current.uniforms.uTime.value=S)):s.type==="planet"&&f.current&&(f.current.uniforms.uTime.value=S)});const N=m?1.3:1;if(s.type==="star"){const o=e.jsxs(e.Fragment,{children:[e.jsx("pointLight",{position:[0,0,0],color:s.color,intensity:s.isCompanionStar?1.5:2,distance:s.isCompanionStar?40:50}),e.jsx(ae,{children:e.jsxs("mesh",{children:[e.jsx("planeGeometry",{args:[s.diameter*1.8,s.diameter*1.8]}),e.jsx("shaderMaterial",{transparent:!0,depthWrite:!1,blending:E,uniforms:{uColor:{value:new _(s.color)},uIntensity:{value:s.emissiveIntensity??1}},vertexShader:`
                varying vec2 vUv;
                void main() {
                  vUv = uv;
                  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
              `,fragmentShader:`
                uniform vec3 uColor;
                uniform float uIntensity;
                varying vec2 vUv;
                void main() {
                  vec2 center = vUv - 0.5;
                  float dist = length(center) * 2.0;
                  // Start glow from edge of star (around 0.55 radius in UV space)
                  float glow = 1.0 - smoothstep(0.55, 1.0, dist);
                  // Clamp intensity: min 0.7, max 1.8 to prevent huge glows
                  float clampedIntensity = clamp(uIntensity, 0.7, 1.8);
                  glow = pow(glow, 2.5) * clampedIntensity * 0.35;
                  gl_FragColor = vec4(uColor, glow);
                }
              `})]})}),e.jsxs("mesh",{ref:u,children:[e.jsx("sphereGeometry",{args:[s.diameter/2,64,64]}),e.jsx("shaderMaterial",{ref:c,vertexShader:y.get("starSurfaceVert"),fragmentShader:y.get("starSurfaceFrag"),uniforms:d})]}),e.jsxs("mesh",{children:[e.jsx("sphereGeometry",{args:[s.diameter/2*1.15,64,64]}),e.jsx("shaderMaterial",{ref:r,vertexShader:y.get("starCoronaVert"),fragmentShader:y.get("starCoronaFrag"),uniforms:h,transparent:!0,depthWrite:!1,blending:E,side:G})]})]});return s.orbitRadius>0?e.jsx("group",{ref:a,children:o}):e.jsx("group",{children:o})}return e.jsxs("group",{ref:a,children:[e.jsxs("mesh",{ref:u,scale:[N,N,N],onPointerOver:o=>{var j,g;o.stopPropagation(),document.body.style.cursor="pointer";const v=o.clientX??((j=o.nativeEvent)==null?void 0:j.clientX),S=o.clientY??((g=o.nativeEvent)==null?void 0:g.clientY);l(s,v&&S?{x:v,y:S}:void 0)},onPointerMove:o=>{var v,S;if(m){const j=o.clientX??((v=o.nativeEvent)==null?void 0:v.clientX),g=o.clientY??((S=o.nativeEvent)==null?void 0:S.clientY);j&&g&&l(s,{x:j,y:g})}},onPointerOut:o=>{o.stopPropagation(),document.body.style.cursor="grab",l(null)},onClick:o=>{o.stopPropagation(),p==null||p(s)},children:[e.jsx("sphereGeometry",{args:[s.diameter/2,48,48]}),e.jsx("shaderMaterial",{ref:f,vertexShader:y.get("planetVert"),fragmentShader:y.get(C),uniforms:n})]}),s.hasRings&&e.jsxs("mesh",{rotation:[Math.PI/2.5,0,0],children:[e.jsx("ringGeometry",{args:[s.diameter*.7,s.diameter*1.2,64]}),e.jsx("meshBasicMaterial",{color:new _(s.color).lerp(new _("#ffffff"),.4),transparent:!0,opacity:.5,side:V})]}),m&&e.jsxs("mesh",{scale:[1.4,1.4,1.4],children:[e.jsx("sphereGeometry",{args:[s.diameter/2,24,24]}),e.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.15,side:W})]})]})}function A({radius:s,eccentricity:m=0,isHighlighted:l,isBinaryOrbit:p=!1}){const a=i.useRef(null),u=Math.min(Math.max(m,0),.99),c=s,f=c*Math.sqrt(1-u*u),t=p?0:c*u,d=u>.1,r=i.useMemo(()=>{const n=[];for(let N=0;N<=128;N++){const M=N/128*Math.PI*2,o=c*Math.cos(M)-t,v=f*Math.sin(M);n.push(new X(o,0,v))}const x=new Y().setFromPoints(n),C=new Q({transparent:!0,depthWrite:!1});return new K(x,C)},[c,f,t]);return P(()=>{if(a.current){const h=a.current.material;let n,x;l?(n="#ffffff",x=.8):p?(n="#ffaa44",x=.5):d?(n="#aaaaff",x=.45):(n="#888888",x=.3),h.color.set(n),h.opacity=x}}),e.jsx("primitive",{ref:a,object:r})}function ne({star:s,bodies:m,hoveredBody:l,onBodyHover:p}){const{t:a}=L(),u=m.filter(r=>r.type==="star"),c=u.find(r=>r.isPrimaryStar||!r.isCompanionStar),f=u.filter(r=>r.isCompanionStar),t=m.filter(r=>r.type==="planet"),d=u.length>1;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"starsystem-info-panel",children:[e.jsxs("h1",{className:"starsystem-star-name",children:[s.hostname,d&&e.jsx("span",{className:"binary-badge",style:{marginLeft:"8px",fontSize:"0.5em",opacity:.8},children:"★★ Binary"})]}),e.jsxs("div",{className:"starsystem-star-details",children:[e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.type")}),e.jsx("span",{className:"detail-value",children:s.st_spectype||s.star_class||a("pages.starSystem.info.unknown")})]}),s.st_teff&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.temperature")}),e.jsx("span",{className:"detail-value",children:R("st_teff",s.st_teff)})]}),s.st_rad&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.radius")}),e.jsx("span",{className:"detail-value",children:R("st_rad",s.st_rad)})]}),s.st_mass&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.mass")}),e.jsx("span",{className:"detail-value",children:R("st_mass",s.st_mass)})]}),s.distance_ly&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.distance")}),e.jsx("span",{className:"detail-value",children:R("distance_ly",s.distance_ly)})]}),s.st_age&&e.jsxs("div",{className:"star-detail",children:[e.jsx("span",{className:"detail-label",children:a("pages.starSystem.info.age")}),e.jsx("span",{className:"detail-value",children:R("st_age",s.st_age)})]})]}),e.jsxs("div",{className:"starsystem-planet-count",children:[s.sy_snum>1&&e.jsxs("span",{className:"star-count",children:[s.sy_snum," ",a("pages.starSystem.info.stars")," •"," "]}),s.sy_pnum," ",s.sy_pnum===1?a("pages.starSystem.info.planet"):a("pages.starSystem.info.planets"),s.cb_flag&&e.jsxs("span",{className:"circumbinary-note",style:{opacity:.7},children:[" ","(",a("pages.starSystem.info.circumbinary"),")"]})]})]}),e.jsxs("div",{className:"starsystem-planets-panel",children:[e.jsx("h2",{className:"planets-panel-title",children:a("pages.starSystem.info.planetaryBodies")}),e.jsxs("ul",{className:"planets-list",children:[c&&e.jsxs("li",{className:`planet-item ${(l==null?void 0:l.id)===c.id?"hovered":""}`,onMouseEnter:()=>p(c),onMouseLeave:()=>p(null),children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:c.color}}),e.jsx("span",{className:"planet-name",children:c.name}),e.jsx("span",{className:"planet-type",children:a(d?"pages.starSystem.info.primaryStar":"pages.starSystem.info.star")})]}),f.map(r=>e.jsxs("li",{className:`planet-item ${(l==null?void 0:l.id)===r.id?"hovered":""}`,onMouseEnter:()=>p(r),onMouseLeave:()=>p(null),children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:r.color}}),e.jsx("span",{className:"planet-name",children:r.name}),e.jsx("span",{className:"planet-type",children:a("pages.starSystem.info.companionStar")})]},r.id)),t.map(r=>{var h;return e.jsx("li",{className:`planet-item ${(l==null?void 0:l.id)===r.id?"hovered":""}`,onMouseEnter:()=>p(r),onMouseLeave:()=>p(null),children:e.jsxs(F,{to:`/planets/${T(r.id)}`,className:"planet-item-link",children:[e.jsx("span",{className:"planet-color-dot",style:{backgroundColor:r.color}}),e.jsx("span",{className:"planet-name",children:r.name}),e.jsx("span",{className:"planet-type",children:((h=r.planetData)==null?void 0:h.planet_type)||a("pages.starSystem.info.planet")})]})},r.id)})]})]}),e.jsx("div",{className:"starsystem-hint",children:a("pages.starSystem.hint")})]})}function re({count:s=3e3}){const m=i.useMemo(()=>{const l=new Float32Array(s*3);for(let p=0;p<s;p++){const a=Math.random()*Math.PI*2,u=Math.acos(2*Math.random()-1),c=500;l[p*3]=c*Math.sin(u)*Math.cos(a),l[p*3+1]=c*Math.sin(u)*Math.sin(a),l[p*3+2]=c*Math.cos(u)}return l},[s]);return e.jsxs("points",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:s,array:m,itemSize:3})}),e.jsx("pointsMaterial",{size:1.5,color:16777215,transparent:!0,opacity:.6,sizeAttenuation:!1})]})}function le({shouldAutoRotate:s,maxDistance:m}){const l=i.useRef(null);return P((p,a)=>{l.current&&s&&(l.current.setAzimuthalAngle(l.current.getAzimuthalAngle()+a*.1),l.current.update())}),e.jsx(se,{ref:l,enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:5,maxDistance:m,autoRotate:!1})}function ie({star:s,planets:m,onPlanetClick:l}){const p=z(),[a,u]=i.useState(null),[c,f]=i.useState(null),t=i.useMemo(()=>O(s,m),[s,m]),d=i.useMemo(()=>{const n=Math.max(...t.map(o=>o.orbitRadius),10),x=t.find(o=>o.type==="star"),N=((x==null?void 0:x.diameter)??3)*4,M=n*2.5;return Math.max(N,M)},[t]),r=i.useCallback((n,x)=>{u(n),f(x??null)},[]),h=i.useCallback(n=>{n.type==="planet"&&p(`/planets/${T(n.id)}`)},[p]);return e.jsxs("div",{className:"starsystem-container",children:[e.jsx(Z,{camera:{position:[0,d*.5,d],fov:50},style:{background:"black"},children:e.jsxs(i.Suspense,{fallback:null,children:[e.jsx("ambientLight",{intensity:.6}),e.jsx("hemisphereLight",{args:["#ffffff","#444444",.5]}),e.jsx(re,{count:3e3}),t.map(n=>e.jsx(te,{body:n,isHovered:(a==null?void 0:a.id)===n.id,onHover:r,onClick:h},n.id)),t.filter(n=>n.type==="planet").map(n=>e.jsx(A,{radius:n.orbitRadius,eccentricity:n.orbitEccentricity,isHighlighted:(a==null?void 0:a.id)===n.id},`orbit-${n.id}`)),t.filter(n=>n.type==="star"&&n.orbitRadius>0).map(n=>e.jsx(A,{radius:n.orbitRadius,eccentricity:n.orbitEccentricity,isHighlighted:(a==null?void 0:a.id)===n.id,isBinaryOrbit:!0},`orbit-${n.id}`)),e.jsx(le,{shouldAutoRotate:!a,maxDistance:d*3})]})}),e.jsx(ne,{star:s,bodies:t,hoveredBody:a,onBodyHover:n=>r(n)}),a&&a.type==="planet"&&c&&a.planetData&&e.jsxs("div",{className:"starsystem-cursor-tooltip",style:{left:c.x+20,top:c.y-10},children:[e.jsxs("div",{className:"cursor-tooltip-header",children:[e.jsx("div",{className:"cursor-tooltip-name",children:a.planetData.pl_name}),e.jsx("div",{className:"cursor-tooltip-type",children:a.planetData.planet_type})]}),e.jsxs("div",{className:"cursor-tooltip-details",children:[a.planetData.pl_rade&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Radius"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_rade.toFixed(2)," R⊕"]})]}),a.planetData.pl_bmasse&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Mass"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_bmasse.toFixed(2)," M⊕"]})]}),a.planetData.pl_orbper&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Orbital Period"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_orbper.toFixed(2)," days"]})]}),a.planetData.pl_orbsmax&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Semi-major Axis"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_orbsmax.toFixed(3)," AU"]})]}),a.planetData.pl_eqt&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Eq. Temperature"}),e.jsxs("span",{className:"cursor-tooltip-value",children:[a.planetData.pl_eqt.toFixed(0)," K"]})]}),a.planetData.disc_year&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Discovered"}),e.jsx("span",{className:"cursor-tooltip-value",children:a.planetData.disc_year})]}),a.planetData.discoverymethod&&e.jsxs("div",{className:"cursor-tooltip-detail",children:[e.jsx("span",{className:"cursor-tooltip-label",children:"Method"}),e.jsx("span",{className:"cursor-tooltip-value",children:a.planetData.discoverymethod})]})]}),e.jsx("div",{className:"cursor-tooltip-hint",children:"Click to view details"})]})]})}function ue(){const{t:s}=L(),{starId:m}=U(),l=z(),{getStarBySlug:p,getPlanetsByHost:a,isLoading:u}=$(),[c,f]=i.useState(!1),t=m?p(m):void 0,d=t?a(t.hostname):[],r=i.useCallback(h=>{l(`/planets/${T(h.pl_name)}`)},[l]);return u?e.jsx("div",{className:"spinner-container",children:e.jsxs("div",{className:"spinner-content",children:[e.jsx("div",{className:"spinner-orbit",children:e.jsx("div",{className:"spinner-planet"})}),e.jsx("div",{className:"spinner-text",children:s("pages.star.loading")})]})}):t?e.jsxs("div",{className:"starsystem-page",children:[e.jsx(F,{to:"/",className:"starsystem-back-button",children:s("pages.star.backToStarfield")}),e.jsx(ie,{star:t,planets:d,onPlanetClick:r}),e.jsx("button",{className:"starsystem-info-toggle",onClick:()=>f(!c),title:s(c?"pages.star.hideInfo":"pages.star.showInfo"),children:c?"✕":"ℹ"}),c&&e.jsx("div",{className:"starsystem-info-panel",onClick:()=>f(!1),children:e.jsxs("div",{className:"starsystem-info-panel-content",onClick:h=>h.stopPropagation(),children:[e.jsx("button",{className:"starsystem-info-close",onClick:()=>f(!1),children:"✕"}),e.jsx("h2",{children:t==null?void 0:t.hostname}),e.jsxs("div",{className:"starsystem-info-content",children:[e.jsxs("div",{className:"starsystem-info-row",children:[e.jsx("span",{className:"label",children:s("pages.star.distance")}),e.jsx("span",{className:"value",children:t!=null&&t.distance_ly?`${t.distance_ly.toFixed(2)} ly`:"N/A"})]}),e.jsxs("div",{className:"starsystem-info-row",children:[e.jsx("span",{className:"label",children:s("pages.star.planets")}),e.jsx("span",{className:"value",children:d.length})]}),(t==null?void 0:t.star_class)&&e.jsxs("div",{className:"starsystem-info-row",children:[e.jsx("span",{className:"label",children:s("pages.star.spectralType")}),e.jsx("span",{className:"value",children:t.star_class})]})]})]})})]}):e.jsx("div",{className:"error-container",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h1",{className:"error-title",children:s("pages.star.notFound.title")}),e.jsx("p",{className:"error-message",children:s("pages.star.notFound.message",{starId:m||""})}),e.jsx(F,{to:"/",className:"starsystem-back-link",children:s("pages.star.notFound.returnToStarfield")})]})})}export{ue as default};
