import{I as ot,j as s,u as st,c as nt,J as ct,r as y,aG as at,ai as Z,L as rt,n as lt}from"./index-7jcvKRO2.js";import"./reviewService-CkX8SfGl.js";import{p as V}from"./pollService-BkCxAmOo.js";import{U as it}from"./UserPrompt-CURdh0Fb.js";const dt={"Gas Giant":"#d4a854","Neptune-like":"#3b8fd9","Sub-Neptune":"#4eb8e0","Super-Earth":"#b5885a","Earth-sized":"#5a9668","Sub-Earth":"#c4623a",Terrestrial:"#d9a050"},ut=.3,pt=13,ht=.01,_t=1e4,ft=180,xt=250,Et=400,mt=800,St=.15,gt=.08,yt=.9,Nt=.2,vt=.4,bt=1,jt=.15,B=1,Tt=200,At=100,X=.2,q=1.3,Ct=.8,Mt=.15,It=.85,Rt=.1,Lt=.9,Gt=.1,K=.6,Ot=1,Vt=.2,Bt=.3,Ht=.05,Pt=.15,J=.8,kt=.5,$t=3500,$=5778,Dt=8e3;function et(t){let o=0;for(let n=0;n<t.length;n++)o=(o<<5)-o+t.charCodeAt(n),o=o&o;return Math.abs(o%1e3)/1e3}function Q(t,o,n,e=.5){return t==null||isNaN(t)?e:Math.max(0,Math.min(1,(t-o)/(n-o)))}function D(t,o,n){const e=Math.max(0,Math.min(1,(n-t)/(o-t)));return e*e*(3-2*e)}function p(t,o,n){return t*(1-n)+o*n}function tt(t,o,n){return[p(t[0],o[0],n),p(t[1],o[1],n),p(t[2],o[2],n)]}function N(t,o,n){return Math.max(o,Math.min(n,t))}function P(t){return t-Math.floor(t)}function wt(t,o,n){const c=n<o?[o,n,-1,.6666666666666666]:[n,o,0,-.3333333333333333],d=c[0]<t?[t,c[1],c[3],c[0]]:[c[0],c[1],c[2],t],a=d[0]-Math.min(d[3],d[1]),i=Math.abs(d[2]+(d[3]-d[1])/(6*a+1e-10)),h=a/(d[0]+1e-10),l=d[0];return[i,h,l]}function Ut(t,o,n){const e=[1,.6666666666666666,.3333333333333333,3],c=Math.abs(P(t+e[0])*6-e[3]),d=Math.abs(P(t+e[1])*6-e[3]),a=Math.abs(P(t+e[2])*6-e[3]),i=n*p(e[0],N(c-e[0],0,1),o),h=n*p(e[0],N(d-e[0],0,1),o),l=n*p(e[0],N(a-e[0],0,1),o);return[i,h,l]}function Ft(t){const o=t.replace("#",""),n=parseInt(o.substring(0,2),16)/255,e=parseInt(o.substring(2,4),16)/255,c=parseInt(o.substring(4,6),16)/255;return[n,e,c]}function Wt(t){const o=[1,.7,.5],n=[1,.98,.95],e=[.85,.9,1];if(t<$){const c=D($t,$,t);return tt(o,n,c)}else{const c=D($,Dt,t);return tt(n,e,c)}}function Yt(t,o,n){const e=[1,.7,.2],c=[1,.5,.15],d=[.95,.25,.1],a=[.35,.18,.1],i=[.5,.25,.12],h=N((o-800)/2200,0,1),l=.7+h*.3+n*.15,r=t*.5+.5;let u=p(a[0],i[0],r),v=p(a[1],i[1],r),E=p(a[2],i[2],r);const b=l*.6,f=h>.6?e:h>.3?c:d;return u=p(u,f[0],b),v=p(v,f[1],b),E=p(E,f[2],b),u+=f[0]*l*.25,v+=f[1]*l*.15,E+=f[2]*l*.08,[N(u,0,1.2),N(v,0,1),N(E,0,1)]}function zt(t,o){const n=[.95,.97,1],e=[.75,.88,1],c=[.65,.92,1],d=N((250-o)/150,0,1),a=t*.5+.5;let i=p(e[0],n[0],a),h=p(e[1],n[1],a),l=p(e[2],n[2],a);const r=t*.35;i=p(i,c[0],r),h=p(h,c[1],r),l=p(l,c[2],r);const u=1+d*.15;return i*=u,h*=u,l*=u,[N(i,0,1.1),N(h,0,1.1),N(l,0,1.1)]}function Xt(t){const o=t.planet_type||"Terrestrial",n=t.planet_subtype,e=dt[o]||"#888888",c=et(t.pl_name),d=Q(t.pl_dens,ut,pt,.5),a=Q(t.pl_insol,ht,_t,.5),i=t.pl_eqt??300,h=t.st_teff??$;let l,r,u;if(n==="Lava World")[l,r,u]=Yt(c,i,a);else if(n==="Ice World")[l,r,u]=zt(c,i);else{const[O,m,S]=Ft(e),H=["Sub-Earth","Earth-sized","Super-Earth","Terrestrial"].includes(o);let[C,A,w]=wt(O,m,S);const U=c*St;C=P(C+U);const _=(d-.5)*gt;C=P(C-_+1);const x=d*jt;if(A=N(A*(yt+c*Nt)+x,vt,bt),[l,r,u]=Ut(C,A,w),H){let g=i;g+=(a-.5)*Tt,a<.5&&(g-=(.5-a)*At);const j=D(xt,ft,g),R=D(Et,mt,g);let T=l*B,L=r*B,M=u*B;if(j>0){const F=(Ct+c*Mt)*K,W=(It+c*Rt)*K,Y=(Lt+c*Gt)*K;T=p(T,F,j),L=p(L,W,j),M=p(M,Y,j)}if(R>0){const F=Ot*J,W=(Vt+c*Bt)*J,Y=(Ht+c*Pt)*J,z=R*kt;T=p(T,F,z),L=p(L,W,z),M=p(M,Y,z)}l=T,r=L,u=M}else{l*=B,r*=B,u*=B;const g=500,R=N((i-g)/(2e3-g),0,1);if(R>0){const T=R*.3;l=l*(1+T*.5),r=r*(1-T*.2),u=u*(1-T*.4)}}}const[v,E,b]=Wt(h);l=p(l,l*v,X),r=p(r,r*E,X),u=p(u,u*b,X),l*=q,r*=q,u*=q;const f=Math.round(N(l*255,0,255)),I=Math.round(N(r*255,0,255)),G=Math.round(N(u*255,0,255));return`rgb(${f}, ${I}, ${G})`}function qt(t){return t==null?.5:Math.max(.1,Math.min(1,t/11.2))}function Kt({planet:t,size:o=64}){const n=t.planet_type||"Terrestrial",e=Xt(t),c=et(t.pl_name),d=qt(t.pl_rade),a=o/2*(.65+d*.3),i=ot(t),h=["Sub-Earth","Earth-sized","Super-Earth","Terrestrial"].includes(n),l=n==="Gas Giant",r=Math.floor(c*10),u=Math.floor(c*20),v=Math.floor(c*30),E=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/),b=E?parseInt(E[1]):200,f=E?parseInt(E[2]):200,I=E?parseInt(E[3]):200,G=`rgba(${b}, ${f}, ${I}, 0.4)`,O=`rgba(${b}, ${f}, ${I}, 0.2)`,m=o/2,S=o/2,H=r*360,C=r*360+5,A=r*360-3;return s.jsxs("svg",{width:o,height:o,viewBox:`0 0 ${o} ${o}`,className:"planet-visualization",style:{overflow:"visible"},children:[s.jsxs("defs",{children:[s.jsxs("filter",{id:`glow-${c}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[s.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),s.jsxs("feMerge",{children:[s.jsx("feMergeNode",{in:"coloredBlur"}),s.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),h&&s.jsxs("pattern",{id:`surface-${r}`,x:"0",y:"0",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:[s.jsx("circle",{cx:r,cy:u,r:"0.5",fill:e,opacity:"0.3"}),s.jsx("circle",{cx:u+10,cy:v,r:"0.3",fill:e,opacity:"0.2"}),s.jsx("circle",{cx:v+5,cy:r+10,r:"0.4",fill:e,opacity:"0.25"})]}),l&&s.jsxs("pattern",{id:`clouds-${r}`,x:"0",y:"0",width:"30",height:"30",patternUnits:"userSpaceOnUse",children:[s.jsx("ellipse",{cx:r*10,cy:u*10,rx:"3",ry:"1.5",fill:"white",opacity:"0.1"}),s.jsx("ellipse",{cx:u*10+15,cy:v*10,rx:"2",ry:"1",fill:"white",opacity:"0.08"}),s.jsx("ellipse",{cx:v*10+5,cy:r*10+15,rx:"2.5",ry:"1.2",fill:"white",opacity:"0.12"})]}),n==="Neptune-like"&&s.jsxs("linearGradient",{id:`bands-${r}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:e,stopOpacity:"1"}),s.jsx("stop",{offset:"30%",stopColor:e,stopOpacity:"0.8"}),s.jsx("stop",{offset:"50%",stopColor:e,stopOpacity:"0.9"}),s.jsx("stop",{offset:"70%",stopColor:e,stopOpacity:"0.8"}),s.jsx("stop",{offset:"100%",stopColor:e,stopOpacity:"1"})]})]}),s.jsx("circle",{cx:m,cy:S,r:a+4,fill:G,opacity:"0.3"}),s.jsx("circle",{cx:m,cy:S,r:a+2,fill:O,opacity:"0.5"}),s.jsx("circle",{cx:m,cy:S,r:a,fill:n==="Neptune-like"?`url(#bands-${r})`:e,filter:`url(#glow-${c})`,style:{fill:h?`url(#surface-${r})`:l?`url(#clouds-${r})`:e}}),h&&s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:m-a*.3,cy:S-a*.2,r:a*.08,fill:"black",opacity:"0.2"}),s.jsx("circle",{cx:m+a*.4,cy:S+a*.3,r:a*.06,fill:"black",opacity:"0.15"}),s.jsx("ellipse",{cx:m+a*.2,cy:S-a*.4,rx:a*.1,ry:a*.05,fill:"black",opacity:"0.18"})]}),i&&s.jsxs(s.Fragment,{children:[s.jsx("ellipse",{cx:m,cy:S,rx:a*1.4,ry:a*.15,fill:"transparent",stroke:e,strokeWidth:1,opacity:.4,transform:`rotate(${H} ${m} ${S})`}),s.jsx("ellipse",{cx:m,cy:S,rx:a*1.25,ry:a*.12,fill:"transparent",stroke:e,strokeWidth:.8,opacity:.5,transform:`rotate(${C} ${m} ${S})`}),s.jsx("ellipse",{cx:m,cy:S,rx:a*1.1,ry:a*.1,fill:"transparent",stroke:e,strokeWidth:.6,opacity:.6,transform:`rotate(${A} ${m} ${S})`})]})]})}const k=at({prefix:"VotePage"}),Jt=20;function os(){const{t}=st(),{isLoading:o,getTopHabitable:n}=nt(),{profile:e,loading:c}=ct(),[d,a]=y.useState([]),[i,h]=y.useState(null),[l,r]=y.useState(0),[u,v]=y.useState(!0),[E,b]=y.useState(!1),[f,I]=y.useState(null),[G,O]=y.useState(!1),m=y.useMemo(()=>o?[]:[...n(Jt)].sort((x,g)=>{var T,L;const j=((T=d.find(M=>M.planet===x.pl_name))==null?void 0:T.count)||0,R=((L=d.find(M=>M.planet===g.pl_name))==null?void 0:L.count)||0;return R!==j?R-j:g.habitability_score-x.habitability_score}),[o,n,d]);y.useEffect(()=>{async function _(){v(!0);try{const[x,g]=await Promise.all([V.getVoteCounts(),V.getTotalVotes()]);if(a(x),r(g),e){const j=await V.getUserVote(e.uid);h((j==null?void 0:j.planet)||null)}}catch(x){k.error("Failed to load vote data:",x)}finally{v(!1)}}_()},[e]);const S=y.useCallback(_=>{const x=d.find(g=>g.planet===_);return(x==null?void 0:x.count)||0},[d]),H=y.useMemo(()=>d.length===0?null:d[0].planet,[d]),C=y.useCallback(_=>{if(!e){I(_),b(!0);return}A(_)},[e]),A=y.useCallback(async _=>{if(!(!e||G)){O(!0);try{await V.castVote(_,e.uid),h(_);const[x,g]=await Promise.all([V.getVoteCounts(),V.getTotalVotes()]);a(x),r(g),k.info("Vote cast successfully:",_)}catch(x){k.error("Failed to cast vote:",x)}finally{O(!1)}}},[e,G]),w=y.useCallback(_=>{b(!1),k.info("Guest user created:",_)},[]),U=y.useCallback(()=>{b(!1),e&&f&&A(f),I(null)},[e,f,A]);return y.useEffect(()=>{e&&f&&!E&&(A(f),I(null))},[e,f,E,A]),o||c?s.jsxs("div",{className:"vote-loading",children:[s.jsx(Z,{}),s.jsx("p",{children:t("pages.vote.loading")})]}):s.jsxs("div",{className:"vote-page",children:[s.jsxs("header",{className:"vote-header",children:[s.jsx("h1",{className:"vote-title",children:t("pages.vote.title")}),s.jsx("p",{className:"vote-subtitle",children:t("pages.vote.subtitle")}),s.jsxs("div",{className:"vote-stats",children:[s.jsx("span",{className:"vote-total",children:t("pages.vote.totalVotes",{count:l})}),i&&s.jsx("span",{className:"vote-your-pick",children:t("pages.vote.yourPick",{planet:i})})]})]}),s.jsx("section",{className:"vote-grid",children:m.map((_,x)=>s.jsx(Zt,{planet:_,rank:x+1,voteCount:S(_.pl_name),isLeader:_.pl_name===H,isUserVote:_.pl_name===i,isVoting:G,onVote:()=>C(_.pl_name)},_.pl_name))}),u&&!o&&s.jsx("div",{className:"vote-loading-overlay",children:s.jsx(Z,{})}),E&&s.jsx(it,{onSubmit:w,onClose:U})]})}function Zt({planet:t,rank:o,voteCount:n,isLeader:e,isUserVote:c,isVoting:d,onVote:a}){const{t:i}=st(),h=["vote-card",e&&n>0?"vote-card-leader":"",c?"vote-card-selected":""].filter(Boolean).join(" ");return s.jsxs("div",{className:h,children:[s.jsxs("div",{className:"vote-rank",children:[e&&n>0&&s.jsx("span",{className:"vote-crown",children:"ðŸ‘‘"}),"#",o]}),s.jsx("div",{className:"vote-card-visualization",children:s.jsx(Kt,{planet:t,size:64})}),s.jsxs("div",{className:"vote-card-content",children:[s.jsx(rt,{to:`/planets/${lt(t.pl_name)}`,className:"vote-planet-name",children:t.pl_name}),s.jsxs("div",{className:"vote-planet-score",children:[s.jsx("span",{className:"score-value",children:t.habitability_score.toFixed(1)}),s.jsx("span",{className:"score-label",children:"/ 100"})]}),s.jsxs("div",{className:"vote-planet-details",children:[t.planet_type&&s.jsx("span",{className:"detail-item",children:t.planet_type}),t.distance_ly&&s.jsxs("span",{className:"detail-item",children:[t.distance_ly.toFixed(1)," ",i("pages.vote.lightYears")]})]}),s.jsxs("div",{className:"vote-badges",children:[t.is_habitable_zone&&s.jsx("span",{className:"badge habitable",children:i("pages.habitability.charts.badges.habitableZone")}),t.is_earth_like&&s.jsx("span",{className:"badge earth-like",children:i("pages.habitability.charts.badges.earthLike")})]})]}),s.jsxs("div",{className:"vote-card-footer",children:[s.jsxs("div",{className:"vote-count",children:[s.jsx("span",{className:"vote-count-number",children:n}),s.jsx("span",{className:"vote-count-label",children:i("pages.vote.votes",{count:n})})]}),s.jsx("button",{className:`vote-button ${c?"vote-button-selected":""}`,onClick:a,disabled:d,children:i(c?"pages.vote.voted":"pages.vote.voteButton")})]}),c&&s.jsx("div",{className:"vote-selected-badge",children:i("pages.vote.yourChoice")})]})}export{os as default};
